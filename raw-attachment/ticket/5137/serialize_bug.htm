<script src="/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/thickbox.js"></script>
<script type="text/javascript" src="/js/jquery.validate.js"></script>

<div id='sugestao_form'>
	<h3>Deixe sua sugest&atilde;o</h3>
	<form action='/actions/sugestao.php' method="post" id='sugestao_form'>
	    <div class='form_items'>
            <div class="form_item">
                <label for='nome'>Nome: *</label><label class='error' for='nome'>Este campo &eacute; obrigatorio</label><br/>
                <input type='text' id='nome' class="input_text required" name='nome'/>
            </div>
            <div class="form_item radio">
                <label for='sexo'>Sexo:</label><br/>
                <input type='radio' class="input_radio" name='sexo' value='m'/> mulher<br/>
                <input type='radio' class="input_radio" name='sexo' value='h'/> homem<br/>
            </div>
            <div class="form_item">
                <label for='idade'>Idade:</label><br/>
                <input type='text' class="input_text input_text_peq" id='idade' name='idade' maxlength="3"/>
            </div>
            <div class="form_item">
                <label for='email'>Email: *</label><label class='error' for='email'>Email v&aacute;lido &eacute; obrigatorio</label><br/>
                <input type='text' class="input_text email required" name='email' id='email'/>
            </div>
            <div class="form_item">
                <label for='cidade'>Cidade: *</label><label class='error' for='cidade'>Este campo &eacute; obrigatorio</label><br/>
                <input type='text' class="input_text required" name='cidade' id='cidade' />
            </div>
            <div class="form_item">
                <label for='sugestao'>Sugest&atilde;o: *</label><label class='error error_textarea' for='sugestao'>Este campo &eacute; obrigatorio</label><br/>
                <textarea class="required" name='sugestao' id='sugestao' maxlength='200'></textarea>
                <span id='charcount'></span><label id='char_error' class="error">Max. 200 caracteres</label>
            </div>
            <div class='form_submit form_item'>
                <input type='submit' class="input_submit" value='Enviar' id='submit'/>
            </div>
		</div>       
    </form>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$('form#sugestao_form').validate({
			submitHandler: function() {
				form = $('form#sugestao_form');
				form.find('.form_submit').addClass('results');
				form.find('.results').html('<img src="/img/loading.gif" alt="enviando">');
				form.find('input').addClass('disabled');
				form.find('input').attr('disabled', 'disabled');
				form.find('textarea').addClass('disabled');
				form.find('textarea').attr('disabled', 'disabled');
				alert($('#sugestao_form').serialize()); //here the alert box is empty
				$.get(form.attr("action"), form.serialize(), function(response){ //so, no variables are sent
					form.find(".results").html(response);
				});
				return false;
			}
		});
		$('#charcount').html('200')
		$('textarea#sugestao').keydown(function(){
			textCounter($(this));
		});
		$('textarea#sugestao').keyup(function(){
			textCounter($(this));
		});
		
	});
	
	function textCounter(field) {
		if (field.val().length > 200) {// if too long...trim it!
			field.val(field.val().substring(0,200));
			$('#char_error').show();	
		}else {
			$('#charcount').html(200 - field.val().length);
			$('#char_error').hide();}
	}
</script>