<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">jquery.patch on Ticket #2056 – Attachment – jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/PPcE5K0pdi.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          


<div class="flex-column attachment">
  <nav class="content-nav">
    <ul class="flex-row">
      <li>
        <a href="/ticket/2056">Back to Ticket #2056</a>
      </li>
    </ul>
  </nav>

  <h1>
    <a href="/ticket/2056">Ticket #2056</a>: jquery.patch
  
  <hr>

  <div class="attachment-info">
    <h6>File jquery.patch, 13.2 KB (added by greg, December 15, 2007 02:04AM UTC)</h6>
    
      <p>patch file</p>
    
  </div>

  
    <div class="attachment-preview">
      
      <pre class="language-patch" tabindex="0"><code class="language-patch">Index: src/core.js
===================================================================
--- src/core.js	(revision 4145)
+++ src/core.js	(working copy)
@@ -157,15 +157,7 @@
 	// Determine the position of an element within 
 	// the matched set of elements
 	index: function( elem ) {
-		var ret = -1;
-
-		// Locate the position of the desired element
-		this.each(function(i){
-			if ( this == elem )
-				ret = i;
-		});
-
-		return ret;
+		return jQuery.inArray( elem, this )
 	},
 
 	attr: function( name, value, type ) {
@@ -201,22 +193,20 @@
 		return this.attr( key, value, "curCSS" );
 	},
 
+	getText: function( elem ) {
+		return jQuery.map( elem.childNodes, function(child){
+			var nt = child.nodeType;
+			return nt == 8 ? null
+						   : nt == 1 ? jQuery.fn.getText( child )
+						   : child.nodeValue;
+		}).join("");
+	},
+
 	text: function( text ) {
-		if ( typeof text != "object" && text != null )
-			return this.empty().append( (this[0] && this[0].ownerDocument || document).createTextNode( text ) );
-
-		var ret = "";
-
-		jQuery.each( text || this, function(){
-			jQuery.each( this.childNodes, function(){
-				if ( this.nodeType != 8 )
-					ret += this.nodeType != 1 ?
-						this.nodeValue :
-						jQuery.fn.text( [ this ] );
-			});
-		});
-
-		return ret;
+		if ( typeof text != "object" && text !== null && text !== undefined )
+			return this.empty().append( document.createTextNode( text ) );
+		else
+		  return jQuery.map( text || this, jQuery.fn.getText ).join("");
 	},
 
 	wrapAll: function( html ) {
@@ -476,16 +466,15 @@
 	},
 	
 	domManip: function( args, table, reverse, callback ) {
-		var clone = this.length > 1, elems; 
+		var len = this.length, clone, elems;
+		if( len === 0 ) return this;
+		else {
+		  clone = len > 1
+		  elems = jQuery.clean( args, this[0].ownerDocument );
+		  if ( reverse ) elems.reverse();
+		}
 
 		return this.each(function(){
-			if ( !elems ) {
-				elems = jQuery.clean( args, this.ownerDocument );
-
-				if ( reverse )
-					elems.reverse();
-			}
-
 			var obj = this;
 
 			if ( table && jQuery.nodeName( this, "table" ) && jQuery.nodeName( elems[0], "tr" ) )
@@ -1077,15 +1066,12 @@
 	},
 
 	makeArray: function( array ) {
-		var ret = [];
-
 		// Need to use typeof to fight Safari childNodes crashes
-		if ( typeof array != "array" )
-			for ( var i = 0, length = array.length; i < length; i++ )
-				ret.push( array[ i ] );
-		else
-			ret = array.slice( 0 );
+		if ( typeof array == "array" ) return array.slice( 0 );
 
+		var ret = [];
+		for ( var i = 0, length = array.length; i < length; i++ )
+			ret.push( array[ i ] );
 		return ret;
 	},
 
@@ -1100,18 +1086,24 @@
 	merge: function( first, second ) {
 		// We have to loop this way because IE & Opera overwrite the length
 		// expando of getElementsByTagName
-
 		// Also, we need to make sure that the correct elements are being returned
-		// (IE returns comment nodes in a '*' query)
-		if ( jQuery.browser.msie ) {
-			for ( var i = 0; second[ i ]; i++ )
-				if ( second[ i ].nodeType != 8 )
-					first.push( second[ i ] );
+		for ( var i = 0, next=second[1]; ; ){
+			if( !next ){
+				if( second[i] ) first.push( second[i] );
+				break;
+			}
+			first.push( second[i], next );
+			i+=2
+			next = second[ i+1 ];
+		}
+		return first;
+	},
 
-		} else
-			for ( var i = 0; second[ i ]; i++ )
+	msie_merge: function(first, second){
+		for ( var i = 0; second[ i ]; i++ )
+			// (IE returns comment nodes in a '*' query)
+			if ( second[ i ].nodeType != 8 )
 				first.push( second[ i ] );
-
 		return first;
 	},
 
@@ -1130,45 +1122,63 @@
 			}
 
 		} catch( e ) {
-			ret = array;
+			return array;
 		}
 
 		return ret;
 	},
 
+	reject: function(elems, callback) {
+		var ret = [];
+		for( var i = 0, el = elems.length; i < el; i++ ) {
+			if ( !callback( elems[i], i ) ) ret.push( elems[i] );
+		}
+		return ret;
+	},
+
 	grep: function( elems, callback, inv ) {
 		// If a string is passed in for the function, make a function
 		// for it (a handy shortcut)
 		if ( typeof callback == "string" )
 			callback = eval("false||function(a,i){return " + callback + "}");
 
+		if( inv ) return jQuery.reject(elems, callback);
+
 		var ret = [];
-
-		// Go through the array, only saving the items
-		// that pass the validator function
-		for ( var i = 0, length = elems.length; i < length; i++ )
-			if ( !inv && callback( elems[ i ], i ) || inv && !callback( elems[ i ], i ) )
-				ret.push( elems[ i ] );
-
+		for ( var i = 0, length = elems.length; i < length; i++ ) {
+			if ( callback( elems[i], i ) ) ret.push( elems[i] );
+		}
 		return ret;
 	},
 
+	// automatically flattens returned arrays
+	// map(xs, function(x) {return [x]}) == xs
 	map: function( elems, callback ) {
-		var ret = [];
+		var arrays = []; // array of arrays to be concated together
 
-		// Go through the array, translating each of the items to their
-		// new value (or values).
-		for ( var i = 0, length = elems.length; i < length; i++ ) {
+		for (var i = 0, length = elems.length; i < length; i++ ) {
 			var value = callback( elems[ i ], i );
 
-			if ( value !== null && value != undefined ) {
-				if ( value.constructor != Array )
-					value = [ value ];
+			if ( value !== null && value !== undefined ) {
+				if ( value.constructor != Array ) arrays.push( [value] );
+				else arrays.push( value );
+			} 
+		}
+		// if arrays has no members, Array.concat will return undefined
+		if( arrays.length === 0 ) return arrays;
+		return Array.concat.apply(Array, arrays);
+	},
 
-				ret = ret.concat( value );
-			}
+
+	// map without flattening, error on undefined, filter null
+	collect: function( elems, callback ) {
+		ret = []
+		for (var i = 0, length = elems.length; i < length; i++ ) {
+			var value = callback( elems[ i ], i );
+			if( value === undefined )
+			  throw("collect: callback return undefined value ");
+			if( value !== null ) ret.push( value );
 		}
-
 		return ret;
 	}
 });
@@ -1330,3 +1340,5 @@
 					this.css( type, size.constructor == String ? size : size + "px" );
 	};
 });
+
+if ( jQuery.browser.msie ) jQuery.extend({merge: jQuery.msie_merge})
Index: src/selector.js
===================================================================
--- src/selector.js	(revision 4145)
+++ src/selector.js	(working copy)
@@ -8,8 +8,8 @@
 
 jQuery.extend({
 	expr: {
-		"": "m[2]=='*'||jQuery.nodeName(a,m[2])",
-		"#": "a.getAttribute('id')==m[2]",
+		"" : function(a){return m[2]=='*'||jQuery.nodeName(a,m[2])},
+		"#": function(a){return a.getAttribute('id')==m[2]},
 		":": {
 			// Position Checks
 			lt: "i<m[3]-0", 0="" 1="" @@="" -67,16="" +67,19="" },="" The="" regular="" expressions="" that="" power="" the="" parsing="" engine="" -="" parse:="" [="" +="" {="" attributes:="" Match:="" [@value="test" ],="" [@foo]="" ^(\[)="" *@?([\w-]+)="" *([!*$^~="]*)" *('?"?)(.*?)\4="" *\]="" ,="" argument:="" :contains('foo')="" ^(:)([\w-]+)\("?'?(.*?(\(.*?\))?[^(]*?)"?'?\)="" ^(:)([\w-]+)\(["']?(.*?(\(.*?\))?[^(]*?)["']?\)="" :even,="" :last-chlid,="" #id,="" .class="" new="" RegExp("^([:.#]*)("="" chars="" "+)")="" other:="" :last-child,="" RegExp("^([:.#]?)("="" multiFilter:="" function(="" expr,="" elems,="" not="" )="" var="" old,="" cur="[];" -293,112="" +296,126="" return="" tmp;="" filter:="" function(t,r,not)="" last;="" variables="" used="" only="" in="" filter="" function="" placed="" here="" so="" they="" can="" be="" bound="" to="" expr="" functions="" m:="" null,="" r:="" function(t,r_passed,not)="" last,="" p="jQuery.parse;" m="null," r="r_passed;" match(key)="" if(m){="" Remove="" what="" we="" just="" matched="" t="t.substring(" m[0].length="" );="" m[2]="m[2].replace(/\\/g," "");="" }="" m;="" Look="" for="" common="" while="" (="" &&="" !="last" last="t;" i="0;" p[i];="" i++="" if="" break;="" !m="" :not()="" is="" a="" special="" case="" optimized="" by="" keeping="" it="" out="" of="" expression="" list="" m[1]="=" ":"="" "not"="" optimize="" one="" selector="" found="" (most="" case)="" m[3]="" ?="" jQuery.filter(m[3],="" r,="" true).r="" :="" jQuery(="" ).not(="" We="" get="" big="" speed="" boost="" filtering="" class="" else="" "."="" m[2],="" not);="" "["="" tmp="[]," type="m[3];" match("attributes")="" ){="" m2="m[2]," m5="m[5];" rl="r.length;" <="" rl;="" z="a[" jQuery.props[m[2]]="" ||="" ];="" jQuery.props[m2]="" null="" href|src|selected="" .test(m[2])="" '';="" .test(m2)="" (type="=" ""="" !!z="" "=" && z == m[5] ||
-						 type == " ^=" && z && !z.indexOf(m[5]) ||
-						 type == " $=" && z.substr(z.length - m[5].length) == m[5] ||
-						 (type == " *=" || type == " ~=") && z.indexOf(m[5]) >= 0) ^ not )
+						 type == " ="="" "!=" && z != m5 ||
+						 type == " :"="" "nth-child"="" merge="{}," parse="" equations="" like="" 'even',="" 'odd',="" '5',="" '2n',="" '3n+2',="" '4n-1',="" '-n+6'="" test="/(-?)(\d*)n((?:\+|-)?\d*)/.exec(" "even"="" "2n"="" "odd"="" "2n+1"="" \D="" .test(m[3])="" "0n+"="" m[3]),="" calculate="" numbers="" (first)n+(last)="" including="" are="" negative="" first="(test[1]" (test[2]="" 1))="" 0,="" 0;="" loop="" through="" all="" elements="" left="" jQuery="" object="" node="r[i]," parentNode="node.parentNode," id="jQuery.data(parentNode);" match("argument")="" m3="m[3]" jQuery.filter(m3,="" continue;="" handling="" nth-child="" .test(m3)="" m3),="" !merge[id]="" c="1;" n="parentNode.firstChild;" n;="" n.nodeType="=" n.nodeIndex="c++;" merge[id]="true;" add="false;" node.nodeIndex="=" (node.nodeIndex="" last)="" %="">= 0 )
 							add = true;
-					} else if ( (node.nodeIndex - last) % first == 0 && (node.nodeIndex - last) / first >= 0 )
-						add = true;
 
-					if ( add ^ not )
-						tmp.push( node );
+						if ( add ^ not )
+							tmp.push( node );
+					}
+
+					r = tmp;
+					continue;
 				}
+			} else {
+				if ( !match("other") ) break;
 
-				r = tmp;
+				// We can get a big speed boost by filtering by class here
+				if ( m[0].charAt(0) == "." ){
+					r = jQuery.classFilter(r, m[2], not);
+					continue;
+				}
 
+			}
+			
 			// Otherwise, find the expression to execute
-			} else {
-				var f = jQuery.expr[m[1]];
-				if ( typeof f != "string" )
-					f = jQuery.expr[m[1]][m[2]];
+			var k = m[1]
 
-				// Build a custom macro to enclose it
-				f = eval("false||function(a,i){return " + f + "}");
+			if( k == ':' ){
+				var exprs = jQuery.expr[':'];
+				k = m[2]; f = exprs[k];
 
-				// Execute it against the current filter
-				r = jQuery.grep( r, f, not );
-			}
+				if( typeof f == "string" ){
+				  eval("f=function(a,i){return " + f + "}");
+				  exprs[k] = f;
+				}
+				// Build a custom function to enclose it
+			} else f = jQuery.expr[k];
+
+			// Execute it against the current filter
+			r = jQuery.grep( r, f, not );
 		}
 
 		// Return an array of filtered elements (r)</m[3]-0",></code></pre>
    </div>
  

  <div class="attachment-download flex-column flex-center">
    <h3>Download in other formats:</h3>
    <a class="attachment-download-link" download="" href="/raw-attachment/ticket/2056/jquery.patch">Original Format</a>
  </div>
</h1></div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
