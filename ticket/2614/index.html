<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#2614 (IE implementation of DOMContentLoaded failing when no assets) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/2613/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/2615/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#2614</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened March 29, 2008 11:44AM UTC</p>
      
        <p>Closed December 19, 2008 04:30AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">IE implementation of DOMContentLoaded failing when no assets</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        diego
      </td>
      <th>Owned by:</th>
      <td>john</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.3">1.3</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>event</td>
      
        <th>Version:</th>
      
      <td>1.2.6</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th>Cc:</th>
      
      <td>diego, zachleat</td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>The "doScroll()" trick is not enough in all situations to ensure that the ".ready()" function will be fired before "onload" event. This is due to the fact that we are not using a precisely timed event but an slightly unpredictable javascript timeout.</p><p>The order in which these event are fired should always be "ready" event first and then the "onload" event. This is to ensure that user's functions are fired in the same order across different browser. This behavior is needed to be able to overwrite some javascript function before the "onload" event. For example during unit testing it is desirable to overwrite the "alert()" function before the "onload" event to avoid these synchronous blockers.</p><p>This patch does exactly that by completely implementing the IEContentLoaded trick which also needs an "onreadystatechange" event to be used in combinations with the "doScroll()" trick.</p><p>This is the thread where I left the first note.</p><p><a href="http://groups.google.com/group/jquery-dev/browse_thread/thread/7c6a479ac24c4e77" class="ext-link"><span class="icon"></span>http://groups.google.com/group/jquery-dev/browse_thread/thread/7c6a479ac24c4e77</a></p><p>I also adjusted the "ready()" method to be triggered automatically on jQuery startup so "isReady" is always set to true even if Lazy Loaded after the "onload" event.</p><p><a href="http://groups.google.com/group/jquery-dev/browse_thread/thread/c713fa86d4a28785/" class="ext-link"><span class="icon"></span>http://groups.google.com/group/jquery-dev/browse_thread/thread/c713fa86d4a28785/</a></p><p>Here is the small patch.</p><p>Diego Perini</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (2)</summary>

  <ul class="ticket-attachments">
    
      <li>
        <a href="/attachment/ticket/2614/event-ready.patch/index.html">event-ready.patch</a> (1.7 KB) - added by diego
        <strong>July 16, 2008 10:20AM UTC</strong>.<br>
        <p>Patch for event.js in trunk</p>
      </li>
    
      <li>
        <a href="/attachment/ticket/2614/ready_load_order_jquery.html/index.html">ready_load_order_jquery.html</a> (0.7 KB) - added by diego
        <strong>November 27, 2008 04:16PM UTC</strong>.<br>
        <p>Test firing order for the ready() function</p>
      </li>
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (19)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 12, 2008 12:23PM UTC by <span class="author">Andrea Giamm</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi Diego, I have read the ml and I though about this alternative function.</p><p>If I am not wrong, the problem is unpredictable setTimeout execution order, so my proposal is to use a single interval for every kind of purpose (but we could use a setTimeout as well, but in this case an interval could be faster) using a simple stack queue:</p><pre class="wiki">
IEContentLoaded = function(events){
    function    index(w){
         for(var i = 0, length = events.length; i &lt; length; i++)
                if(events[i].w === w)
                    return  i;
         return -1;
    };
    function    init(i){
        for(var j = 0, length = events[i].fn.length; j &lt; length; j++)
            events[i].fn[j]();
        events.splice(i, 1);
        // or // events = events.slice(0, i).concat(events.slice(++i))
    };
    var i;
    return  function(w, fn){
        var j = index(w);
        ~j ? events[j].fn.push(fn) : events.push({w:w,fn:[fn]});
        if(!i)
            i = setInterval(function(){
                for(var j = 0, length = events.length; j &lt; length; j++)
                    try {
                        events[j].w.document.documentElement.doScroll('left');
                        init(j);
                    } catch (e) {}
                if(length === 0)
                    clearInterval(i);
            }, 10);
    }
}([]);
</pre><p>It seems to work as expected in IE 5.5, IE 6, IE 7, and IE 8 beta 1</p><p>For IE5 I suppose we should use the concat slice instead of splice, but it is only a minor detail.</p><p>Kind Regards</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 12, 2008 12:34PM UTC by <span class="author">Andrea Giamm</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Sorry, I forgot the readyState ...</p><pre class="wiki">
IEContentLoaded = function(events){
    function    index(w){
         for(var i = 0, length = events.length; i &lt; length; i++)
                if(events[i].w === w)
                    return  i;
         return -1;
    };
    function    init(i){
        for(var j = 0, length = events[i].fn.length; j &lt; length; j++)
            events[i].fn[j]();
        events.splice(i, 1);
        // or // events = events.slice(0, i).concat(events.slice(++i))
    };
    var i;
    return  function(w, fn){
        var j = index(w), d = w.document;
        if(~j)
            events[j].fn.push(fn);
        else {
            j = events.push({w:w,fn:[fn]}) - 1;
            d.onreadystatechange = function() {
        		if (d.readyState == 'complete') {
        			d.onreadystatechange = null;
                    if(~index(w))
                        init(j);
        		}
        	};
        };
        if(!i)
            i = setInterval(function(){
                for(var j = 0, length = events.length; j &lt; length; j++)
                    try {
                        events[j].w.document.documentElement.doScroll('left');
                        init(j);
                    } catch (e) {}
                if(length === 0)
                    clearInterval(i);
            }, 10);
    }
}([]);
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 12, 2008 12:46PM UTC by <span class="author">Andrea Giamm</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Please ignore above example, I did not think about for loop problems.</p><p>This should be the last proposal:</p><pre class="wiki">
IEContentLoaded = function(events){
    function    index(w){
         for(var i = 0, length = events.length; i &lt; length; i++)
                if(events[i].w === w)
                    return  i;
         return -1;
    };
    function    init(i){
        for(var j = 0, length = events[i].fn.length; j &lt; length; j++)
            events[i].fn[j]();
        events.splice(i, 1); // IE5 =&gt; events = events.slice(0, i).concat(events.slice(++i))
    };
    var i;
    return  function(w, fn){
        var j = index(w), d = w.document;
        if(~j)
            events[j].fn.push(fn);
        else {
            j = events.push({w:w,fn:[fn]}) - 1;
            d.onreadystatechange = function() {
                if (d.readyState == 'complete') {
                    d.onreadystatechange = null;
                    j = index(w);
                    if(~j)
                        init(j);
                }
            };
        };
        if(!i)
            i = setInterval(function(){
                for(var j = 0, length = events.length; j &lt; length; j++)
                    try {
                        events[j].w.document.documentElement.doScroll('left');
                        init(--length && j--);
                    } catch (e) {}
                if(length === 0)
                    clearInterval(i);
            }, 10);
    }
}([]);
</pre><p>Kind Regards</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 12, 2008 12:48PM UTC by <span class="author">Andrea Giamm</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>... init(length-- && j--); ... (I need more coffee)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 12, 2008 08:59PM UTC by <span class="author">diego</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I rearranged the original patch so for iframes we can use a fall back that ensure that the ready() method will fire before the standard "onload" event on Internet Explorer.</p><p>Attached a new event-ready.patch for jquery-1.2.6.js.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 15, 2008 07:09PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ john</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 15, 2008 07:09PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.2.4</span> → <span class="change-field-new">1.3</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.2.3</span> → <span class="change-field-new">1.2.6</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 16, 2008 10:19AM UTC by <span class="author">diego</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Revised patch as discussed. Avoid using jQuery.browser.msie.</p><p>Re-submitted the attached patch, diffs made for event.js in current trunk.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 12, 2008 01:28PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixed in SVN commit [5941].</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 26, 2008 06:17PM UTC by <span class="author">zachleat</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">closed</span> → <span class="change-field-new">reopened</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This fix is not correct.  As reported in </p><p><a href="http://www.thefutureoftheweb.com/blog/adddomloadevent#comment16" class="ext-link"><span class="icon"></span>http://www.thefutureoftheweb.com/blog/adddomloadevent#comment16</a></p><p>and I have confirmed in my own tests, adding "onreadystatechange" to the document element will fire after images have loaded, not before.</p><p>What you need to do is branch based on window == top, if they are equal use the doScroll("left") hack, if not use the same code that was used in jQuery 1.2.1 to fire the DOMContentLoaded event in IE (document.write a deferred script tag).</p><p>Or, you could just use the deferred script tag all the time for IE, but anything that avoids document.write's would be ideal.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 26, 2008 08:13PM UTC by <span class="author">diego</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>zachleat,</p><p>that message is two years old. The two events produce similar results but are not the same. "onreadystatechange" will fire before the "onload" event, preceding it by just few milliseconds. That is exactly what we need, especially for iframes but not only for that...</p><p>Using "document.write" is risky because it is possible to completely overwrite the document, leaving the users with a white page or other similar problems on IE (operation aborted).</p><p>In normal windows the "doScroll()" trick fire before images are loaded.</p><p>This technique is solid enough and works very well on IE.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 27, 2008 02:00PM UTC by <span class="author">flesler</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-new">→ diego, zachleat</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>need:</th>
                  <td>
                    
                      <span class="change-field-old">Review</span> → <span class="change-field-new">Test Case</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Can anyone provide an example or counter-example proving this works well or doesn't work ?</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 27, 2008 04:14PM UTC by <span class="author">diego</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok Ariel, here is one test for current jQuery 1.2.6.</p><p>It shows the order of events is not what we would expect.</p><p>We expect ready() to fire before onload() on all browsers, so the order in the above example should be:</p><ul><li>ready</li><li>load</li></ul><p>instead from Internet Explorer we get:</p><ul><li>load</li><li>ready</li></ul><p>this produces unexpected behavior from code running on IE, normally this is more of an issue when both event are used, each starting different parts of the main code.</p><p>I have to stress that the "onreadystatechange" addition is absolutely necessary to fix other unexpected behaviors in IE especially those bound to the difference between cached and un-cached pages and the use of the Back/Forward buttons. The "doScroll()" trick is not an event, it is just a polling loop and is really useful only on the first fresh read of the page. When the page and it's content are already cached you will notice the firing happens through the "onreadystatechange" event.</p><p>You may easily test this strange IE behavior by inserting some logging lines in both of them and see the differences when a page has no assets at all, when it does have assets but is the first visit, and when it is fetched directly from the browser internal cache.</p><p>You see, also the solution on IE is just a few line this is a very elaborate strategy to get what most people want.</p><p>Unfortunately for all of us IE is not a joke, it still has more than half of the market. This solution also works on IE8, so keep it handy for the next 10 year.</p><p></p><hr><p></p><p>Diego</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:14">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 28, 2008 02:37PM UTC by <span class="author">diego</span></span>
        <a class="ticket-change-link" href="#comment:14">comment:14</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I also suggest to change:</p><p>   if ( document.attachEvent )</p><p>with:</p><p>   if ( document.createEventObject )</p><p>to avoid Opera going through the IE path. Not sure if this would create misbehaviors in Opera, however it is better to ensure the conditional branch each browser will follow.</p><p></p><hr><p></p><p>Diego</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:15">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 01, 2008 05:22AM UTC by <span class="author">zachleat</span></span>
        <a class="ticket-change-link" href="#comment:15">comment:15</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Please see the following test cases in Internet Explorer:</p><p><a href="http://www.zachleat.com/Projects/jquery/original/parent.html" class="ext-link"><span class="icon"></span>http://www.zachleat.com/Projects/jquery/original/parent.html</a></p><p><a href="http://www.zachleat.com/Projects/jquery/diego-patch/parent.html" class="ext-link"><span class="icon"></span>http://www.zachleat.com/Projects/jquery/diego-patch/parent.html</a></p><p><a href="http://www.zachleat.com/Projects/jquery/my-patch/parent.html" class="ext-link"><span class="icon"></span>http://www.zachleat.com/Projects/jquery/my-patch/parent.html</a></p><p>image.php contains the following PHP code: sleep(2); which will cause the client to wait 2 seconds before it considers the image to be downloaded.</p><p>The times displayed are the date difference between the first line of JS execution and the event firing.  Note how the original and diego-patch versions both fire AFTER the image has loaded in the child iframe.  The only difference in my-patch is that it uses the isReady method that was used for IE in jQuery 1.2.1 (deferred script load and document.write).  For comparison, the HTC method presented by Dean Edwards is also included.  This method is described here:</p><p><a href="http://dean.edwards.name/weblog/2005/09/busted2/" class="ext-link"><span class="icon"></span>http://dean.edwards.name/weblog/2005/09/busted2/</a></p><p>I'm pretty sure the test is sound, please let me know if it is not.</p><p>Thanks,</p><p>Zach</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:16">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 01, 2008 11:59AM UTC by <span class="author">diego</span></span>
        <a class="ticket-change-link" href="#comment:16">comment:16</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Zach,</p><p>your tests are correct, this is a well known IE problem, we talked about it in several posts on the jquery-dev list. The reason the method changed from 1.2.1 is that it was giving too many problems on IE.</p><p>"document.write()" had to be excluded for several reasons:</p> <ul><li>- XHTML does not allows it, not compliant</li> <li>- doesn't work with small pages or when no assets</li> <li>- it sometime completely overrides the page content</li> <li>- it gives problems when there are mixed HTTP/HTTPS requests</li></ul><p>so the only alternative method we could resort to for IFRAMEs is to use Microsoft own HTC method where feasible, that is an extra external file that people try to avoid if possible.</p><p>There is nothing that stops you launching your code before the images are loaded if you know what you do on IE. Effectively it is possible in IE to append child to the BODY before the page is completely loaded.</p><p>There are other events that can be used in IE as a notification about the loading process, these are "activate" and "beforeactivate", but as said these are useful only to attach widget to the BODY before the page is completely loaded and would not work as a generic "ready()" method that fits everybody needs.</p><p>As an example if we used these "activation" events we would not be able to correctly execute a CSS selection on the page since the page may not be completely loaded yet.</p><p>The unique scope of this patch is to fix the order in which "ready" and "onload" will fire on Internet Explorer.</p><p>Hope I have clarified some aspect of this problem...</p><p></p><hr><p></p><p>Diego</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:17">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 01, 2008 04:50PM UTC by <span class="author">zachleat</span></span>
        <a class="ticket-change-link" href="#comment:17">comment:17</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok, if that's the scope of this patch that's fine.  I still think that jQuery should supply a DOMContentLoaded event for iframed content (in IE).  Would it be okay with everyone if I opened a separate support ticket for that request?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:18">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 01, 2008 06:49PM UTC by <span class="author">zachleat</span></span>
        <a class="ticket-change-link" href="#comment:18">comment:18</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>As a side node, the current Prototype code base uses the deferred script method exclusively for iframe/non-iframe DOMContentLoaded in IE.  Do you have test cases that show the examples you're describing (XHTML, override page content, http/https)?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:19">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 19, 2008 04:30AM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:19">comment:19</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">reopened</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixed in SVN rev [5970].</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
