<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#8065 (Significant Performance Difference in 1.5RC1) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/8064/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/8066/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#8065</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(duplicate)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened January 26, 2011 06:03PM UTC</p>
      
        <p>Closed February 09, 2011 03:14PM UTC</p>
      
      
        <p>Last modified March 13, 2012 05:59PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Significant Performance Difference in 1.5RC1</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        mhildreth@chainbridgetech.com
      </td>
      <th>Owned by:</th>
      <td>mhildreth@chainbridgetech.com</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next">1.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.5rc1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I'm not sure if you would categorize this as a bug, but I did see a significant degredation in performance when switching from 1.4.2 to 1.5.1. I saw the same thing when switching from 1.4.2 to 1.4.4 also.</p><p>We have a menu comprised of UL's and LI's that we use jquery to animate and provide other behaviors for. In two cases, I'm seeing that the calls chain to the function uniquesort, which for wrapped sets that have many items, takes much longer (like 6x). The specific calls include the wrapped set's .add and .parent functions. These functions don't seem to call uniquesort in 1.4.2.</p><p>I've changed the code to work around this issue by changing something that looked like this:</p><p>var subItems = $("#menu&gt;ul&gt;li&gt;ul&gt;li&gt;a");</p><p>subItems.parent().hover(...);</p><p>to something like this:</p><p>var subItems = $("#menu&gt;ul&gt;li&gt;ul&gt;li&gt;a");</p><p>var subItems.each(function(){$(this).parent().hover(...);});</p><p>By calling parent() on each of the items in the subItems wrapped set, rather than chaining it on to the subItems wrapped set, no uniquesort is performed against the result. This code is about 1.5x slower when using 1.4.2, but the execution times are at least consistent when using 1.5rc1.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (12)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 26, 2011 08:37PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ mhildreth@chainbridgetech.com</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for taking the time to contribute to the jQuery project! Please provide a reduced jsFiddle test case to help us assess your ticket!</p><p>Additionally, test against the jQuery 0 GIT version to ensure the issue still exists. </p><p>In the case of performance issues, we recommend creating a perf test at <a href="http://jsperf.com" class="ext-link"><span class="icon"></span>http://jsperf.com</a> (be sure to use <a href="http://code.jquery.com/jquery-git.js" class="ext-link"><span class="icon"></span>http://code.jquery.com/jquery-git.js</a> & jQuery.noConflict() to test against the most recent jQuery ).</p><p>Be Excellent to eachother!</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 07:49AM UTC by <span class="author">SDraconis</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This sounds like it is related to <a href="/ticket/7341">#7341</a>, which was unfortunately closed as "wontfix" despite the fact that the performance implications are significant.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 02:30PM UTC by <span class="author">mhildreth@chainbridgetech.com</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Yes, too bad that's listed as wontfix. </p><p>I understand the comments that say that the old way had a bunch of errors and the new way is correct, but I think a good suggestion is in comment#11. Since the wrapped set subItems is already known to be sorted and unique, it seems redundant to redo the unique sort when calling .parent(). </p><p>I wasn't running into the "long running script dialog" in IE, but I only tested IE8, not IE6 or 7. The work-around I put in place doesn't mangle the the code that badly, and even through that section of the code is 1.5x slower, the menu initialization overall is still faster (reduced to 0.8x), so I'd call it a wash.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 03:14PM UTC by <span class="author">snover</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ duplicate</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I’m going to merge this into <a href="/ticket/7341">#7341</a> since this seems to be the same issue; if you can provide a patch to improve performance here without using sourceIndex we would be happy to accept it.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 03:14PM UTC by <span class="author">snover</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Duplicate of <a href="/ticket/7341">#7341</a>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 03:46PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In addition to snover's comments, I think it's important to point out that your selectors could use to optimization, at the very least, you can use the jQuery( selector, context ) signature to improve speed:</p><p><a href="http://jsperf.com/awful-selector" class="ext-link"><span class="icon"></span>http://jsperf.com/awful-selector</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 04:10PM UTC by <span class="author">mhildreth</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Well, the code I submitted with the ticket was just pseudo code. The actual code looks more like this:</p><p>var menuWrapper = $("menu");</p><p>var topMenu = menuWrapper.children("ul");</p><p>var topMenuItems = topMenu.children();</p><p>var topMenuItemLinks = topMenuItems.children("a");</p><p>var subMenus = topMenu.find("ul");</p><p>var subMenuItems = subMenus.children();</p><p>var subMenuItemLinks = subMenuItems.children("a");</p><p>/*Snip*/</p><p>function initHovers() {</p><p>  subMenuItemLinks.parent().hover(function(){/*Snip*/});</p><p>}();</p><p>Now the first part is just as fast if not faster. All indicators point to the slow down in calling initHovers() where it calls .parent(). There are about 400 items in the subMenuItemLinks set at that point, so the uniqueSort operation gets really exaggerated. I'm open to suggestions if you have any as to how I could improve the selectors in this case.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 04:17PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Just curious, are you using the HTML5 </p><pre class="wiki">menu</pre> element?<p></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 04:24PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Also, take a look at this and tell me what you think...</p><p><a href="http://jsfiddle.net/rwaldron/ZjV3N/2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/rwaldron/ZjV3N/2/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 04:34PM UTC by <span class="author">mhildreth</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>No. Just a bunch of ul's, li's, and a's. As you can probably guess, they form a typical horizontal navigation menu. We use jquery to traverse it to wire up events and provide the animation effects for the drop-downs. This is for an application that has a broad range of consumers (which unforunately includes a decent amount of IE6 users), so HTML5 is not really an option for us and likely won't be any time soon.</p><p>Looking at your jsfiddle test. You are correct, for the sample markup included, they are the same. However, the menu allows for "break" items in it which are li's that do not contain a's, but instead and hr. The "break" items just serve to separate groups of li's in a sinlge nested ul (submenu). In this case, we don't want to have those li's light up when hovered over because there's nothing clickable inside them - make sense? That's why I'm finding the a's and then asking for parents. Those parents are the ones that should light up when hovered over.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 05:21PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I broke down the var refs to the actual method chain, and it's insightful. Take a look at this... </p><p><a href="http://jsperf.com/traversing-menu-awful-selector" class="ext-link"><span class="icon"></span>http://jsperf.com/traversing-menu-awful-selector</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 09, 2011 05:46PM UTC by <span class="author">mhildreth</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>OK, so I revised the test to include more links. Check out revision 2:</p><p><a href="http://jsperf.com/traversing-menu-awful-selector/2" class="ext-link"><span class="icon"></span>http://jsperf.com/traversing-menu-awful-selector/2</a></p><p>As the number of links grows larger, the difference in selectors narrows. However in this example 100, but in the one that started this whole thing, it's more like 400. You can see that the call to .parent() causes somewhere between a 30x and 100x burden.</p><p>[Caveat - I get that having 100 items in the menu is a bit silly, but clients want what they want :-)]</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
