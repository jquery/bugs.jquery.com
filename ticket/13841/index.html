<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13841 ($.when().always gives different types of arguments depending on resolve/rejects) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13839/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13842/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#13841</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened April 30, 2013 03:57PM UTC</p>
      
        <p>Closed May 02, 2013 08:29PM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">$.when().always gives different types of arguments depending on resolve/rejects</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        karl.westin@gmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>deferred</td>
      
        <th>Version:</th>
      
      <td>2.0.0</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th>Cc:</th>
      
      <td>jaubourg</td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Consider the following code:</p><pre class="wiki">
$.when(a, b).always(function() {
  console.log(arguments);
});
</pre><p>if both a and b are resolved, the callback receives two <strong>arguments</strong> arrays</p><p>if a is resolved and b is rejected, we receive the same</p><p>if a is rejected (before anything happens to b), the callback receives the arguments a was rejected with. I expected this to be one "arguments" array</p><p>Please see the example here: </p><p><a href="http://jsbin.com/ariquj/3/edit" class="ext-link"><span class="icon"></span>http://jsbin.com/ariquj/3/edit</a></p><p>I understand that we wanna call "always" as soon as possible, but i still think the argument types should be the same. (i.e. always arrays)</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (3)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 30, 2013 05:08PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-new">→ jaubourg</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">deferred</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>The pattern is a little clearer with three of them: <a href="http://jsbin.com/ariquj/4/edit" class="ext-link"><span class="icon"></span>http://jsbin.com/ariquj/4/edit</a></p><p>It definitely seems a challenge to use the data that's returned. Perhaps the maximum size array should be returned with <code>undefined</code> for pending ones? </p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 01, 2013 12:41AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is a false dilemma. The real question is : why would you use <code>always</code> if you care about the arguments that much? Surely, the logic in the <code>always</code> handler is not that "common".</p><p>You don't even need a contrived example using <code>when</code> to show the "issue". Just take a simple ajax request as an example :</p><pre class="wiki">$.ajax( /* ... */ ).always( function( a, b, c ) {
  // So what are a, b and c ? Well it depends, of course!
} );
</pre><p>When you call <code>always</code> on a promise, the arguments depend on the state of the promise and, also, on the internals of whatever code created the promise.</p><p>So you can use an ugly anti-pattern and use <code>state</code> to know how to deal with the arguments:</p><pre class="wiki">promise.always( function() {
  if ( promise.state() === "resolved" ) {
    // deal with arguments as in a done handler
  } else {
    // deal with arguments as in a fail handler
  }
} );
</pre><p>Of course, looking at the comments in the anti-pattern, one can clearly see what the proper pattern actually is:</p><pre class="wiki">promise.done( function() {
  // deal with arguments as in a done handler (duh!)
} ).fail( function() {
  // deal with arguments as in a fail handler (duh!)
} );
</pre><p>Now, if you need to group common logic together, then use <code>always</code>... but only for logic that does not depend on arguments : it wouldn't be __common__ logic anymore otherwise because arguments are not the same when resolved or when rejected. You can rince and repeat as needed :</p><pre class="wiki">promise.always( function() {
  // common code before
} ).done( function() {
  // code dependant on resolve values
} ).fail( function() {
  // code depending on rejection values
} ).always( function() {
  // common code after
} );
</pre><p>Realistically, you can have common logic which has parts that depend on the actual state (and associated arguments) of the underlying promise. It would be more readable and maintainable to have it all in one go in a single <code>always</code> handler. You can use <code>then</code> to mitigate the ugliness of the anti-pattern :</p><pre class="wiki">promise.then( function() {
  // Some logic
  return { resolved: someValue };
}, function() {
  // Some other logic
  return { rejected: someOtherValue };
} ).always( function( result ) {
  someCommonLogic();
  if ( result.resolved ) {
    showData( result.resolved );
  } else {
    showError( result.rejected );
  }
  someOtherCommonLogic();
  if ( result.rejected ) {
    tryAgainLater();
  }
  someFinalCommonLogic();
} );
</pre><p>It's quite the silly example but you get the idea.</p><p>The approach decouples the way you handle (and transform) arguments from the bulk of the actual common logic. In short, it keeps <code>done</code> and <code>fail</code> specifities as separated as desirable.</p><p>Now, getting back at <code>when</code>, yes, the arguments when the resulting promise is resolved are different from when the promise is rejected (and so is <code>this</code>). But even if you create an alternate helper that rejects with an array containing <code>undefined</code> everywhere except for the index of the promise that triggered the rejection, you won't solve the issue at hand here: using <code>always</code>, if you wanna deal with the arguments in a meaningful fashion, you need to somehow determine if the resulting promise is resolved or rejected which, most (if not all) of the time, is an anti-pattern.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 02, 2013 08:29PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Okay, I see jaubourg's point here. If you care about the return value then use the <code>.done()</code> or <code>.fail()</code> handler where you know what it's going to return. Save <code>.always()</code> for cases where you want to do universal cleanup regardless of the returned values.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
