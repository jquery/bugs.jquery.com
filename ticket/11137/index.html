<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#11137 (Jquery doesn&amp;#39;t parse a rare selector correctly) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/11136/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/11138/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#11137</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(invalid)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened January 06, 2012 08:35PM UTC</p>
      
        <p>Closed January 09, 2012 03:25PM UTC</p>
      
      
        <p>Last modified March 14, 2012 10:21AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Jquery doesn&#39;t parse a rare selector correctly</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        fam.lam
      </td>
      <th>Owned by:</th>
      <td>fam.lam</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>selector</td>
      
        <th>Version:</th>
      
      <td>1.7.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>If you execute this code (in Chrome, you can just paste it in the console), JQuery will hang for a very long time.</p><p>(If you leave out the 'window.open', then you'll just get a hang for about 5-10 seconds).</p><pre class="wiki">
var selector = "[onclick^*=\\"window.open('http://www.firstload.de/\\"]"
$(selector)
</pre></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (15)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 06, 2012 08:38PM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>*in the console of a jQuery using page* of course, otherwise the console uses it's own $ selector, which does return null. Or replace the '$' with 'jQuery' if you want to be sure.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 06, 2012 08:57PM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Oh... sorry... although it is (I think?) a bug that such an invalid selector hangs jQuery so long, I hadn&#39;t noticed I introduced a bug in the selector myself...&#92;
&#92;
Corrected reproduction steps:&#92;
1. go to battle.net (uses an old version of jQuery, but also with a newer version (which you can insert by content scripts if you like) it fails the test&#92;
2. in Chrome&#39;s console, insert &#92;
{{{&#92;
var selector = &quot;[onclick^=&#92;&#92;&quot;window.open(&#39;http://www.firstload.de/&#92;&#92;&quot;]&quot;&#92;
jQuery(selector)&#92;
}}}&#92;
3. wait forever...</span> → <span class="change-field-new">1325884248348624</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Oh... sorry... although it is (I think?) a bug that such an invalid selector hangs jQuery so long, I hadn't noticed I introduced a bug in the selector myself...</p><p>Corrected reproduction steps:</p><p>1. go to battle.net (uses an old version of jQuery, but also with a newer version (which you can insert by content scripts if you like) it fails the test</p><p>2. in Chrome's console, insert </p><pre class="wiki">
var selector = "[onclick^=\\"window.open('http://www.firstload.de/\\"]"
jQuery(selector)
</pre><p>3. wait forever...</p><p>I've created a content script for you:</p><p>Install <a href="http://solidfiles.com/d/b03088d9ff/" class="ext-link"><span class="icon"></span>http://solidfiles.com/d/b03088d9ff/</a> in Chrome and visit battle.net</p><p>It'll first alert the jQuery version it uses (to prove it's not the old version), then run the code from step 2.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 06, 2012 09:29PM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It seems to be this code that hangs:</p><pre class="wiki">
/((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['"][^'"]*['"]|[^\\[\\]'"]+)+\\]|\\\\.|[^ &gt;+~,(\\[\\\\]+)+|[&gt;+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g.exec("[onclick^=\\"window.open('http://www.firstload.de/\\"]");
</pre><p>The actual line where this happens is</p><pre class="wiki">
m = chunker.exec( soFar );
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 06, 2012 10:37PM UTC by <span class="author">sindresorhus</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ fam.lam</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for taking the time to contribute to the jQuery project! Please provide a complete reduced test case on jsFiddle to help us assess your ticket.</p><p>Additionally, be sure to test against the jQuery Edge version to ensure the issue still exists. To get you started, use this boilerplate: <a href="http://jsfiddle.net/FrKyN/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/FrKyN/</a> Open the link and click to "Fork" (in the top menu) to get started.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 07, 2012 01:13AM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Even if I just copy-paste the full web page and required reproduction steps into jsfiddle (removed the comments and made the links absolute: <a href="http://jsfiddle.net/EWPLb/5/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/EWPLb/5/</a> and used the latest jQuery or the 1.7.1 release), I do not get any hangs. (Don't ask me why, the steps above cause it 100% of the time)</p><p>However, you might want to have a look at</p><p><a href="http://code.google.com/p/v8/issues/detail?id=1888" class="ext-link"><span class="icon"></span>http://code.google.com/p/v8/issues/detail?id=1888</a></p><p>(The issue tracker for Chromes javascript kit V8). It explains exactly why it can hang in Chrome, but doesn't in Safari or <a href="/wiki/FireFox">FireFox</a>: the regex too many repeating quantifiers, which may hang for quite a while.</p><p>The regex proposed by that V8 programmer</p><pre class="wiki">
/((?:\\((?:\\([^()]+\\)|[^()])+\\)|\\[(?:\\[[^\\[\\]]*\\]|['"][^'"]*['"]|[^\\[\\]'"])+\\]|\\\\.|[^ &gt;+~,(\\[\\\\])+|[&gt;+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g
</pre><p>indeed does the same thing. (Verified manually and I've also ran it through the jQuery test suite which told me there were no errors:</p><p>''Tests completed in 45812 milliseconds.</p><p>4919 tests of 4919 passed, 0 failed.''</p><p>The only change is in the three +)+ blocks, which are (as explained by that programmer) not necessarily (the blocks are all non-capturing).</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 08, 2012 07:12PM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Or do I have to report this to Sizzle? </p><p>This code seems to reproduce it 100% of the time (if Sizzle is in your current directory)?</p><pre class="wiki">
&lt;html&gt;&lt;head&gt;&lt;script src="sizzle.js"&gt;&lt;/script&gt;&lt;script&gt;
Sizzle("[onclick^*=\\"window.open('http://www.firstload.de/\\"]");
alert('Done');
&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 08, 2012 09:09PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> indeed does the same thing. (Verified manually and I've also ran it through the jQuery test suite which told me there were no errors: ''Tests completed in 45812 milliseconds. 4919 tests of 4919 passed, 0 failed.'' </blockquote><p>Something isn't right, because jQuery should run:</p><pre class="wiki">
Tests completed in 49876 milliseconds.
5876 tests of 5876 passed, 0 failed.
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 08, 2012 10:20PM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hmmm... Can't get it higher than 4919. I ran the index.html file in /test/ after</p><p>1. downloading the full repository from <a href="https://github.com/jquery/jquery/downloads" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/downloads</a></p><p>2. adding the missing files that showed up in index.html's console (qunit.js/css from <a href="http://docs.jquery.com/QUnit," class="ext-link"><span class="icon"></span>http://docs.jquery.com/QUnit,</a> the two sizzle files from sizzles repository)</p><p>3. replace the incorrect regexes with the proposed fix</p><p>4. run index.html -&gt; 4919 tests...</p><p>What do I do wrong?</p><p>Also, should I report it to sizzle as it is reproducable 100% of the time for sizzle itself?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 09, 2012 02:02AM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Are you running it from file:// ? If so, that would explain the short numbers. When the suite is run from file:// several tests are switch "off"</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 09, 2012 06:18AM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Yes, I am. I do not have some server to put them on.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 09, 2012 01:27PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You can easily run a localhost server, but that's irrelevant to this issue</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 09, 2012 03:25PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">selector</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>A few things here:</p><p>1. If the bug cannot be reproduced on jsfiddle, it is usually not a jQuery issue but an issue with user's environment.</p><p>2. We shouldn't spend too much time verifying selectors that use on* attributes, especially the onclick attribute.</p><p>3. <code>onclick^*=...</code> is invalid.  Either use <code>^=</code> or <code>*=</code>, but not both.  This could be the cause of the loop.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 09, 2012 03:43PM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You didn't read comment 2...</p><p>Filed it to Sizzle itself, as it's 100% reproducible for them.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:14">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 09, 2012 03:48PM UTC by <span class="author">fam.lam</span></span>
        <a class="ticket-change-link" href="#comment:14">comment:14</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok... have to apologize. Copied the wrong one again :(</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:15">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 09, 2012 03:57PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:15">comment:15</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Neither selector is valid, but the reason is less obvious for the selector in comment two.  To escape any character, one must insert two backslashes before the character that needs to be escaped (such as parenthesis and periods):</p><p><code>var selector = '[onclick^="window\\\\.open\\\\(\\'http:\\\\/\\\\/www\\\\.firstload\\\\.de\\\\/"]'</code></p><p>These are the same escaping rules that apply to querySelectorAll:</p><p><a href="http://www.w3.org/TR/CSS21/syndata.html#characters" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/CSS21/syndata.html#characters</a></p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
