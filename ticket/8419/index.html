<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#8419 (Ajax calls to encoded Internationalized domain names doesn&amp;#39;t work in Internet Explorer) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/8418/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/8420/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#8419</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened March 02, 2011 07:32AM UTC</p>
      
        <p>Closed March 10, 2011 01:02AM UTC</p>
      
      
        <p>Last modified March 09, 2012 08:20AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Ajax calls to encoded Internationalized domain names doesn&#39;t work in Internet Explorer</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        Andreas
      </td>
      <th>Owned by:</th>
      <td>jaubourg</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next">1.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.5.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Using jQuery 1.5 or 1.5.1, any ajax() calls to encoded Internationalized domain names (IDN) (like xn--bcher-kva.ch) seems to fail in Internet Explorer 8. It worked fine in jQuery 1.4.4 and also with 1.5+ in any other browser than IE. It also works when using the unencoded domain name.</p><p>What happens in IE8 is that the ajax error callback is triggered with the not so helpful "error" in the textstatus variable, and jqXHR.responseText as "undefined".</p><p>I know I'm supposed to provide a test case, but unfortunately I only have access to one IDN, which belongs to a customer, so I can't. I hope this report can come to some use anyway. Maybe someone else who sees the ticket have access to a public IDN and can provide a test case (any simple ajax call will do).</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (9)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 03, 2011 12:41AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ jaubourg</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">assigned</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The error callback has a third parameter, errorThrown, what does it say?</p><p>Also, I don't quite understand what you're saying about which version has the bug. Do you mean 1.4.4 and 1.5+ fail on IE8 and work on any other browser or is it that 1.4.4 works in IE8 while 1.5+ doesn't?</p><p>Finally, if 1.4.4 also exhibits the bug, then it's a bug in IE8's xhr implementation that may not be workaroundable by jQuery.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 03, 2011 11:01AM UTC by <span class="author">Andreas</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 jaubourg]:</p><blockquote> The error callback has a third parameter, errorThrown, what does it say?  Also, I don't quite understand what you're saying about which version has the bug. Do you mean 1.4.4 and 1.5+ fail on IE8 and work on any other browser or is it that 1.4.4 works in IE8 while 1.5+ doesn't?  Finally, if 1.4.4 also exhibits the bug, then it's a bug in IE8's xhr implementation that may not be workaroundable by jQuery.</blockquote><p>The third parameter says "No Transport".</p><p>The error occurs in Internet Explorer 7 and 8 with jQuery 1.5+.</p><p>To summarize:</p><ul><li>jQuery 1.4.4 & IE: Works fine.</li><li>jQuery 1.5 & IE: Fails.</li><li>jQuery 1.5.1 & IE: Fails.</li></ul><ul><li>error() parameters: jqXHR.responseText = "undefined", textStatus = "error", errorThrown = "No Transport".</li></ul>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 03, 2011 01:45PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>OK, so the request is considered cross-domain and, since IE8 and below don't support cross-domain requests, ajax won't find a suitable transport and bail out.</p><p>What happens if you use the non-encoded url? Does IE support this? I've looked into the encoding code (in order for ajax to automagically encode domain names and fix the issue) but the encoding is complex and requires a LOT of code so I'm wondering if the encoding is necessary in the first place (one can hope IE makes it under the hood). </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 03, 2011 04:45PM UTC by <span class="author">Andreas</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:3 jaubourg]:</p><blockquote> OK, so the request is considered cross-domain and, since IE8 and below don't support cross-domain requests, ajax won't find a suitable transport and bail out.  What happens if you use the non-encoded url? Does IE support this? I've looked into the encoding code (in order for ajax to automagically encode domain names and fix the issue) but the encoding is complex and requires a LOT of code so I'm wondering if the encoding is necessary in the first place (one can hope IE makes it under the hood). </blockquote><p>The non-encoded url works, it's just the encoded one that does not work in jQuery 1.5+. Both, however, worked in jQuery 1.4.4. I hope there's a simple fix that can make it work again. </p><p>The cross domain thing you mention makes sense. IE probably does or lacks some conversion between the two domains. Maybe 1.4.4 had some clever work-around that was lost in the ajax rewrite of 1.5?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 04, 2011 04:32AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">No, actually, 1.5 added cross-domain detection. 1.4.4 just didn&#39;t bother controlling this and just let the browser&#39;s implementation throw an exception when it couldn&#39;t handle the request. With the new transport architecture, it makes sense to control this, seeing as it makes it possible to provide fail-over transports in browsers that doesn&#39;t support cross-domain.&#92;
&#92;
Anyway:&#92;
1) Do you absolutely need to use the encoded url?&#92;
2) Can&#39;t you use urls with no domain name (/something_on_the_server)?&#92;
&#92;
I don&#39;t really get why you&#39;re using the encoded domain name in your urls. It seems pretty easy (and much simpler for you incidently) to use the domain name unencoded. Or am I missing something gigantic here?</span> → <span class="change-field-new">1299213205979229</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>No, actually, 1.5 added cross-domain detection. 1.4.4 just didn't bother controlling this and just let the browser's implementation throw an exception when it couldn't handle the request. With the new transport architecture, it makes sense to control this, seeing as it makes it possible to provide fail-over transports in browsers that doesn't support cross-domain.</p><p>Anyway:</p><p>1) Do you absolutely need to use the encoded url?</p><p>2) Can't you use urls with no domain name (/something_on_the_server)?</p><p>I don't really get why you're using the encoded domain name in your urls. It seems pretty easy (and much simpler for you incidently) to use the domain name unencoded. Or am I missing something gigantic here?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 04, 2011 08:04AM UTC by <span class="author">Andreas</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:5 jaubourg]:</p><blockquote> No, actually, 1.5 added cross-domain detection. 1.4.4 just didn't bother controlling this and just let the browser's implementation throw an exception when it couldn't handle the request. With the new transport architecture, it makes sense to control this, seeing as it makes it possible to provide fail-over transports in browsers that doesn't support cross-domain.  Anyway:  1) Do you absolutely need to use the encoded url?   2) Can't you use urls with no domain name (/something_on_the_server)?  I don't really get why you're using the encoded domain name in your urls. It seems pretty easy (and much simpler for you incidently) to use the domain name unencoded. Or am I missing something gigantic here?</blockquote><p>Ah. I see.</p><p>I didn't write this bug report for my own selfish needs :), but to bring an undocumentet "broken" (in a way) behavior up to the community. Cross browser behavior is one of the jQuery features I appreciate the most.</p><p>There is, as you say, several workarounds for it. But for people upgrading existing systems from 1.4.4 to 1.5+ it can be real annoying to debug and not finding any information about this error (at least I didn't). </p><p>I'm not the original creator of the system I found this behavior in, but I think the reason for using the encoded domain is that the absolute URL is set server side with PHP. Server-side, the host name is always returned encoded. I don't think it's that uncommon to use an absolute URL for ajax calls, and with that, an encoded IDN. In more complex systems it might even be necessary. I find it kind of strange that no one else have reported this behavior (as far as I know).</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 04, 2011 05:58PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I hear you. I made this prefilter: <a href="http://jsfiddle.net/jaubourg/2s5hZ/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/jaubourg/2s5hZ/</a></p><p>It basically strips the domain given as the stripDomain option from given URLs. So you can drop the prefilter definition in your app and set the stripDomain option to your encoded domain name using ajaxSetup and you're good to go. It'll just do nothing in 1.4.4 and previous.</p><pre class="wiki">
// In a separate file you include in your app as a plugin
// For instance jquery.strip-domain.js
(function() {
    if ( jQuery.ajaxPrefilter ) {
        
        var rURL = /^([^\\/]+)/,
            rEsc = /(\\-|\\.)/,
            protocol = rURL.exec( document.location.href )[ 1 ].replace( rEsc, "\\\\$1" ),
            rDomains = {};
        
        jQuery.ajaxPrefilter(function( options ) {
            var strip = options.stripDomain,
                rDomain,
                sDomain;
            if( strip ) {
                rDomain = rDomains[ strip ];
                if ( !rDomain ) {
                    sDomain = "^(?:" + protocol + ")?\\\\/\\\\/" + strip.replace( rEsc, "\\\\$1" );
                    rDomains[ strip ] = rDomain = new RegExp( sDomain, "i" )
                }
                options.url = options.url.replace( rDomain, "" );
            }
        });
    }

})( jQuery );

// In your app, after you loaded jQuery and the plugin
jQuery.ajaxSetup({
    stripDomain: "xn--bcher-kva.ch"
});
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 07, 2011 01:04PM UTC by <span class="author">Andreas</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:7 jaubourg]:</p><blockquote> I hear you. I made this prefilter: <a href="http://jsfiddle.net/jaubourg/2s5hZ/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/jaubourg/2s5hZ/</a>  It basically strips the domain given as the stripDomain option from given URLs. So you can drop the prefilter definition in your app and set the stripDomain option to your encoded domain name using ajaxSetup and you're good to go. It'll just do nothing in 1.4.4 and previous.</blockquote><p>Thanks! And thank you for your time investigating this behavior.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 10, 2011 01:02AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">assigned</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
