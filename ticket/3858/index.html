<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#3858 (weird jQuery 1.3 ajax difference in behavior) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/3857/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/3859/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#3858</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened January 15, 2009 04:29AM UTC</p>
      
        <p>Closed January 19, 2009 09:17PM UTC</p>
      
      
        <p>Last modified March 14, 2012 10:57PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">weird jQuery 1.3 ajax difference in behavior</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        shadedecho
      </td>
      <th>Owned by:</th>
      <td>flesler</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.3.1">1.3.1</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.3</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>ajax flxhr</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>First, let me say a big congrats to all the jQuery devs for their excellent work on jQuery 1.3 (and happy third birthday!). I'm very excited about this release.</p><p>I've noticed a problem with some of my jQuery ajax code when going from 1.2.6 to 1.3.  I've got two URL's which demonstrate the different behavior.</p><p>Moreover, the difference in behavior seems to be related to what domain is in the address bar. So, to test and demonstrate this, I've set it up so the following URL's can be visited each with two different domains, so you can see the different behavior just based on the browser address bar domain (page-domain).</p><p>These examples exploit substituting in flXHR (<a href="http://flxhr.flensed.com/)" class="ext-link"><span class="icon"></span>http://flxhr.flensed.com/)</a> as a replacement XHR object (means it speaks the same API), and so it shouldn't be a problem with it speaking that API wrongly or not being adapted properly.</p><p><a href="http://www.flensed.com/code/dev-tests/flxhr-jquery-126.html" class="ext-link"><span class="icon"></span>http://www.flensed.com/code/dev-tests/flxhr-jquery-126.html</a>  (1.2.6-patched, works)</p><p><a href="http://flxhr.flensed.com/code/dev-tests/flxhr-jquery-126.html" class="ext-link"><span class="icon"></span>http://flxhr.flensed.com/code/dev-tests/flxhr-jquery-126.html</a>  (1.2.6-patched, works)</p><p><a href="http://www.flensed.com/code/dev-tests/flxhr-jquery-13.html" class="ext-link"><span class="icon"></span>http://www.flensed.com/code/dev-tests/flxhr-jquery-13.html</a>  (1.3, works)</p><p><a href="http://flxhr.flensed.com/code/dev-tests/flxhr-jquery-13.html" class="ext-link"><span class="icon"></span>http://flxhr.flensed.com/code/dev-tests/flxhr-jquery-13.html</a>  (1.3, fails! the request fails silently and never finishes).</p><p>Now, I know that the temptation will be to say this is something with flXHR misbehaving (what I assumed at first), but consider that all 4 URL's above use the exact same version of flXHR (and everything else), and the only thing that changes from success and causes the failure between the 2nd URL (which works) and the 4th URL (which fails) is jQuery 1.2.6 versus 1.3. Also, notice that the 3rd URL works with jQuery 1.3.</p><p>The failure, as I've tracked it so far, is that a request seems to get sent off exactly the same as in the working examples, but the request only gets to state 3, and never finishes. This is as far as I've been able to diagnose so far.</p><p>Does anyone have any idea what might have changed with 1.3 that would be causing this weird never-finishing request behavior? Can anyone help me figure it out?</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (5)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 15, 2009 01:37PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.3</span> → <span class="change-field-new">1.3.1</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ ariel</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-new">→ 1.3</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ariel - any thoughts here?</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 16, 2009 07:43AM UTC by <span class="author">shadedecho</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>OK, I have an update from some further testing on this topic.</p><p>Contrary to my conjecture originally, I have confirmed that in both cases, flXHR fully returns (that is, gets to readyState=4), with the responseText set as expected.</p><p>However, what I've determined is that jQuery has already "aborted" and given up on the request.  The tricky part is why -- the reason is that sometimes flXHR doesn't immediately go from readyState 0 to 1 when open() is called -- whenever there is an additional cross-domain policy check that needs to first be performed (which is what happens when the URL's are different, as in my original post). So, basically, there's a race condition created, and jQuery now has logic in it which gets tripped up on this race condition.</p><p>The triggering jQuery code difference that causes this "bug" to show up from 1.2.6 to 1.3 is that you now have this bit of code in there:</p><pre class="wiki">
if (ival) {
	// clear poll interval
	clearInterval(ival);
	ival = null;
	// Handle the global AJAX counter
	if ( s.global && ! --jQuery.active )
		jQuery.event.trigger( "ajaxStop" );
}
</pre><p>Basically, this check gets called quickly enough (after the first 13ms interval wait) that flXHR hasn't yet moved from 0 to 1. So, jQuery thinks the operation has somehow been aborted and so it abandons the request (even though flXHR is still going just fine in the background).</p><p></p><hr><p></p><p>So, bottom line, there is a technical reason why I have flXHR not moving to readyState=1 until the policy check is made (which I can explain if you are interested), but basically it creates now an incompatibility with jQuery's new logic relating to how it tries to determine if an XHR request should be abandoned because it was aborted.</p><p>Firstly, I will retract my previous assertion this is purely a jQuery bug. Clearly it's not a "bug" but just an incompatibility between flXHR's implementation of 'XHR' and jQuery's interpretation/recognition of how the native browser XHR works.</p><p>So, this all having been diagnosed, I will ask this for your consideration on how (and if) to proceed... Is jQuery's logic as described here fully appropriate (basically to assume a '0' at this point in code logic is absolutely a sign of an aborted request)?  </p><p>Or is it possible that alternate logic could be suggested, which would continue to work exactly the same for normal jQuery usage, but would alleviate this hitch with flXHR?</p><p>I have two suggestions along those lines:</p><p>1. Use some other logic to detect an aborted XHR request, not just readyState=0 after open() was called.</p><p>2. Don't start the looping "listening" interval immediately after open() as it does now, but start it only after the XHR object has moved out of the '0' state for the first time.  </p><p>This '0-to-1' state change could easily be detected by initially attaching an 'onreadystatechange' handler to look for a movement out of the '0' state, at which point the handler/listener could be unassigned and THEN the interval looping logic would kick in.</p><p>Not only would this resolve the issue with flXHR... but, I would submit for your consideration that it's possibly a slightly more robust logic to use for this test. In other words, it's conceivable that there are other reasons why some browser's XHR object's open() command might not move the object immediately into the '1' state -- for instance, some internal code execution delay in some browser implementation (like activeX). </p><p>It would seem (to me at least) to make a little more sense not to start looping and listening for changes until you know the object has in fact moved to the '1' state fully, and is now clearly in the process of sending/receiving data.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 17, 2009 10:20PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-old">ariel</span> → <span class="change-field-new">flesler</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 19, 2009 02:59PM UTC by <span class="author">shadedecho</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I did a patch release for flXHR (1.0.2, <a href="http://flxhr.flensed.com/download.php)" class="ext-link"><span class="icon"></span>http://flxhr.flensed.com/download.php)</a> which now forces it to maintain a 'readyState' transition process which mimics more closely the internal native XHR, in that it moves the readyState immediately from 0 to 1, even if internally things are still waiting. This resolves the race condition (for now) between flXHR and jQuery.</p><p>However, for posterity sake, I would still renew my question/request that perhaps this logic be reworked a little bit for the next release, given my reasons above. Thanks.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 19, 2009 09:17PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for all your comments and thoughts on this issue. At least for now, I think we're going to have to leave the code as-is. Doing the abort check with readyState === 0 is best that we've found, so far, so I think we'd like to stick with it. On the plus side, it means that your code is that much closer to the "real deal" now :-)</p><p>If an alternative solution could be found, at some point, we can definitely re-open and re-examine the issue.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
