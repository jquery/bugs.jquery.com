<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#14411 (Investigate implementing jQuery (specifically .init) as an Array subclass) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/14410/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/14412/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#14411</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">feature</span>
      <span class="ticket-resolution">(migrated)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened October 01, 2013 10:24PM UTC</p>
      
        <p>Closed October 21, 2014 12:23AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Investigate implementing jQuery (specifically .init) as an Array subclass</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        gibson042
      </td>
      <th>Owned by:</th>
      <td>gibson042</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next/2.next">1.next/2.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>core</td>
      
        <th>Version:</th>
      
      <td>1.10.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th>Cc:</th>
      
      <td>rwaldron</td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Inspired by an <a href="https://github.com/madrobby/zepto/issues/820#issuecomment-25206786" class="ext-link"><span class="icon"></span>interesting Zepto proposal</a> that seems to have legs for us: <a href="http://jsperf.com/jquery-prototype-array/4" class="ext-link"><span class="icon"></span>http://jsperf.com/jquery-prototype-array/4</a></p><p>I suspect that it could reduce size as well, especially in 2.x.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (12)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 01, 2013 10:26PM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">core</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">None</span> → <span class="change-field-new">1.next/2.next</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 01, 2013 10:33PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-new">→ rwaldron</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>It won't work in oldIE, at least. The <code>.length</code> property is squirrely; jeresig tried it around 1.1 timeframe and bailed. @rwaldron wasn't this something still being refined by TC39 for ES6?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 01, 2013 10:41PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 dmethvin]:</p><blockquote> It won't work in oldIE, at least. The <code>.length</code> property is squirrely; jeresig tried it around 1.1 timeframe and bailed. @rwaldron wasn't this something still being refined by TC39 for ES6?</blockquote><p>In ES6, it will be as simple as:</p><pre class="wiki">
class jQuery extends Array {
   constructor(selector, context = document) {
      super();
      // this is now a legit subclass of Array.
   }
   // ... implement jQuery prototype methods here
}

</pre><p>The issue of course is that new subclass semantics can't be "polyfilled" or "ported" to traditional function declaration/expression syntax, because "super" can't be reserved in a function body. </p><p>While jQuery was actually quite vocal in the design and specification of this mechanism, we did so understanding that jQuery-the-code wouldn't benefit from real subclassing of builtins for some time. </p><p>As far as hackish cases like Zepto, __proto__ is never going to be officially standardized, as it has been sent to die in an annex. Instead, Object.setPrototypeOf will compliment Object.getPrototypeOf.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 02, 2013 12:15AM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ gibson042</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">assigned</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm petty sure I already solved the oldIE <code>length</code> issues in the jsperf by accepting immutability on existing instances (which doesn't change any current API promises), but I'll look into it more later. This is mostly just a focal point for link aggregation until and unless it gets to an actual pull request.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 02, 2013 04:29PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:4 gibson042]:</p><blockquote> I'm petty sure I already solved the oldIE <code>length</code> issues in the jsperf by accepting immutability on existing instances (which doesn't change any current API promises), but I'll look into it more later. </blockquote><p>There are actually 2 length related issues:</p><ul><li>In oldIE, trailing commas produce a "hole"</li></ul><p>[[Image(<a href="http://gyazo.com/767c310037b8d505ea54e8bb2dd0bc81.png)" class="ext-link"><span class="icon"></span>http://gyazo.com/767c310037b8d505ea54e8bb2dd0bc81.png)</a>]]</p><ul><li>In every standard, modern JS implementation, Array sub-classes will always have a broken length property.</li></ul><p>Compare the following programs: </p><pre class="wiki">

var a = new Array(1, 2, 3, 4);

console.log( a );
// [ 1, 2, 3, 4 ]

a.length = 10;

console.log( a );
// [ 1, 2, 3, 4, , , , , ,  ]

console.log( a.length );
// 10

a.length = 2;

console.log( a );
// [ 1, 2 ]

console.log( a.length );
// 2

</pre><p>vs. </p><pre class="wiki">

function List() {
  Array.call(this);

  this.push.apply(this, arguments);
}

List.prototype = Object.create(Array.prototype, {
  constructor: {
    value: List
  }
});

var l = new List(1, 2, 3, 4);

console.log( l );
// [ 1, 2, 3, 4 ]

l.length = 10;

console.log( l );
// [ 1, 2, 3, 4 ]

console.log( l.length );
// 10

l.length = 2;

console.log( l );
// [ 1, 2, 3, 4 ]

console.log( l.length );
// 2

</pre><p>This behaviour will be broken with <code>__proto__</code> as well:</p><pre class="wiki">
function List() {
  this.__proto__ = Array.prototype;

  this.push.apply(this, arguments);
}

var l = new List(1, 2, 3, 4);

console.log( l );
// [ 1, 2, 3, 4 ]

l.length = 10;

console.log( l );
// [ 1, 2, 3, 4 ]

console.log( l.length );
// 10

l.length = 2;

console.log( l );
// [ 1, 2, 3, 4 ]

console.log( l.length );
// 2

</pre><p>And of course, the latter version won't work in browsers that don't support __proto__.</p><p>Unrelated to those specific issues, I think inheriting from Array will create a lot of confusing API quirks. Consider the following:</p><ul><li>Same APIs where jQuery's definition doesn't match the built-in:</li>    <li>jQuery.fn.filter and Array.prototype.filter (predicate functions written for use with Array.prototype.filter won't work with jQuery.fn.filter)</li>    <li>jQuery.fn.map and Array.prototype.map (mapping functions written for use with Array.prototype.map won't work with jQuery.fn.map)</li>    <li>jQuery.fn.find and Array.prototype.find (ES6). Same as "filter"</li></ul>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 02, 2013 04:36PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm not sure how any of these problems are relevant. As gibson042 already said, this "doesn't change any current API promises". Nobody is doing <code>var divs = $( "div" ); divs.length = 10;</code> And it doesn't matter if our methods are incompatible with <code>Array.prototype</code> methods, unless the incompatibility will actually break things.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 02, 2013 04:59PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm not seeing the perf benefit, strange. <a href="http://wnd8.com/grab/c42af8.png" class="ext-link"><span class="icon"></span>http://wnd8.com/grab/c42af8.png</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 02, 2013 05:02PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:6 scott.gonzalez]:</p><blockquote> I'm not sure how any of these problems are relevant. </blockquote><p>They are exactly relevant to these two statements: </p><p>"The .length property is squirrely; " - dmethvin</p><p>"I already solved the oldIE length issues in the jsperf by accepting immutability on existing instances" - gibson042</p><p>&gt;Nobody is doing <code>var divs = $( "div" ); divs.length = 10;</code> </p><p>I agree, I'm sure they aren't—but I didn't say any was, I was just trying to thoroughly illustrate the "length problems".</p><blockquote> And it doesn't matter if our methods are incompatible with <code>Array.prototype</code> methods, unless the incompatibility will actually break things.</blockquote><p>I'm not saying it will break extant code, I'm saying that the behaviour could create confusion. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 03, 2013 03:37AM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>To be clear, I'm interested in performance improvement and size reduction. We've never recommended that anyone set <code>.length</code> (or documented the effects of doing so), and we generally can't expose Array methods because our patterns are to accept selectors in place of elements and <code>pushStack</code> new instances instead of mutating context. Nor will we make ''new'' promises like <code>Object.prototype.toString( jQuery() ) === "[object Array]"</code>... this is <strong>exclusively</strong> about seeking more efficient techniques for implementing our extant API.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 03, 2013 03:47AM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:9 gibson042]:</p><blockquote> To be clear, I'm interested in performance improvement and size reduction. We've never recommended that anyone set <code>.length</code> (or documented the effects of doing so),</blockquote><p>Yes, I thought I made it clear that this was understood? <a href="http://bugs.jquery.com/ticket/14411?replyto=9#comment:8" class="ext-link"><span class="icon"></span>http://bugs.jquery.com/ticket/14411?replyto=9#comment:8</a> My point is that once we say "jQuery is now subclassed from Array", developers will expect these things to work like they do with arrays. </p><blockquote>  and we generally can't expose Array methods because our patterns are to accept selectors in place of elements and pushStack new instances instead of mutating context. Nor will we make new promises like Object.prototype.toString( jQuery() ) === "[object Array]"... </blockquote><p>They will be exposed by default and developers will use them. Unless you plan to keep a blacklist of methods to delete? jQuery instance objects will become instanceof Array as well.</p><p>I promise I'm not trying to rain on your parade, these are just real things to consider. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 03, 2013 04:09AM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Replying to [comment:10 rwaldron]:&#92;
&gt; My point is that once we say &quot;jQuery is now subclassed from Array&quot;, developers will expect these things to work like they do with arrays.&#92;
&gt; They will be exposed by default and developers will use them. Unless you plan to keep a blacklist of methods to delete? jQuery instance objects will become instanceof Array as well.&#92;
&#92;
We never have to crow about that, and we can continue chastising everyone who tries to take advantage of undocumented implementation details like we currently do with `jQuery.support` and `jQuery.data`.&#92;
&#92;
&gt; I promise I&#39;m not trying to rain on your parade, these are just real things to consider.&#92;
&#92;
Yep, and I&#39;m actually with you. Changing our prototype chain would be a huge deal... but it might be worthwhile.</span> → <span class="change-field-new">1380773464446051</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:10 rwaldron]:</p><blockquote> My point is that once we say "jQuery is now subclassed from Array", developers will expect these things to work like they do with arrays.</blockquote><blockquote> They will be exposed by default and developers will use them. Unless you plan to keep a blacklist of methods to delete? jQuery instance objects will become instanceof Array as well.</blockquote><p>We never have to crow about that, and we can continue chastising everyone who tries to take advantage of undocumented implementation details like we currently do with <code>jQuery.support</code> and <code>jQuery.data</code>.</p><blockquote> I promise I'm not trying to rain on your parade, these are just real things to consider.</blockquote><p>Yep, and I'm actually with you. Changing our prototype chain would be a huge deal... but it might be worthwhile.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 21, 2014 12:23AM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ migrated</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">assigned</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Migrated to <a href="https://github.com/jquery/jquery/issues/1754" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/issues/1754</a></p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
