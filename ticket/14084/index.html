<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#14084 (elem.css(&amp;#39;width&amp;#39;) provides incorrect output with `box-sizing: border-box` if run before document ready) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/14083/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/14086/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#14084</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened June 30, 2013 03:25PM UTC</p>
      
        <p>Closed September 06, 2013 03:29PM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">elem.css(&#39;width&#39;) provides incorrect output with `box-sizing: border-box` if run before document ready</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        tj@crowdersoftware.com
      </td>
      <th>Owned by:</th>
      <td>m_gol</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.11/2.1">1.11/2.1</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>support</td>
      
        <th>Version:</th>
      
      <td>1.10.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I believe the current documentation for <code>height</code> and <code>width</code> is incorrect vis-a-vis what <code>.css("height")</code> and <code>.css("width")</code> do with <code>box-sizing: border-box</code> elements. The current documentation for <code>height</code> says:</p><blockquote> Note that <code>.height()</code> will always return the content height, regardless of the value of the CSS <code>box-sizing</code> property. As of jQuery 1.8, this may require retrieving the CSS height plus <code>box-sizing</code> property and then subtracting any potential border and padding on each element when the element has <code>box-sizing: border-box</code>. <strong>To avoid this penalty, use <code>.css("height")</code> rather than <code>.height()</code></strong>.</blockquote><p>''(My emphasis. And similarly for <code>.width</code> / <code>.css('width')</code>.)''</p><p>This suggests that <code>.css("height")</code> will return something different from <code>.height()</code>, but it returns exactly the same thing (plus units), regardless of whether the element is using <code>border-box</code> or <code>content-box</code> (I didn't look at <code>padding-box</code>). (And similarly for <code>.css("width")</code> and <code>.width()</code>.)</p><p>For example, this:</p><pre class="wiki">
&lt;style&gt;
  div {
      height: 120px;
      width: 100px;
      padding-top: 20px;
      padding-left: 10px;
      background-color: #abc;
      border: 1px solid black;
  }
  .box {
      box-sizing: border-box;
      -moz-box-sizing: border-box;
  }
  .content {
  }
&lt;/style&gt;
&lt;div class="box"&gt;&lt;/div&gt;
&lt;div class="content"&gt;&lt;/div&gt;
&lt;script&gt;
    showDimensions('box');
    showDimensions('content');
      
    function showDimensions(cls) {
        var elm = $('.' + cls),
            label = "$('." + cls + "')";

        console.log(label + ".height() = " + elm.height());
        console.log(label + ".css('height') = " + elm.css('height'));
  
        console.log(label + ".width() = " + elm.width());
        console.log(label + ".css('width') = " + elm.css('width'));
    }
&lt;/script&gt;
</pre><p>...gives us:</p><blockquote> $('.box').height() = 98 \\\\ $('.box').css('height') = 98px \\\\ $('.box').width() = 88 \\\\ $('.box').css('width') = 88px \\\\ $('.content').height() = 120 \\\\ $('.content').css('height') = 120px \\\\ $('.content').width() = 100 \\\\ $('.content').css('width') = 100px</blockquote><p><a href="http://jsbin.com/etuvom/1" class="ext-link"><span class="icon"></span>Live Example</a> | <a href="http://jsbin.com/etuvom/1/edit" class="ext-link"><span class="icon"></span>Live Source</a> ''(using v1.10.1)''</p><p>Also, the behavior is the same in v1.6.4 (<a href="http://jsbin.com/etuvom/5" class="ext-link"><span class="icon"></span>demo</a>), v1.7.2 (<a href="http://jsbin.com/etuvom/2" class="ext-link"><span class="icon"></span>demo</a>), v1.8.3 (<a href="http://jsbin.com/etuvom/3" class="ext-link"><span class="icon"></span>demo</a>), v1.9.1 (<a href="http://jsbin.com/etuvom/4" class="ext-link"><span class="icon"></span>demo</a>), and v1.10.1 (above), whereas the documentation suggests some change occurred in v1.8.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (33)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 04:37PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I can't confirm it on jsFiddle, weird:</p><p>1.x edge: <a href="http://jsfiddle.net/m_gol/kDVyv/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/m_gol/kDVyv/</a> </p><p>1.8.3: <a href="http://jsfiddle.net/m_gol/kDVyv/2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/m_gol/kDVyv/2/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 04:47PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>That is really strange, I played with the jsbin version and it does look broken, but the jsFiddle is what I expected.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 05:12PM UTC by <span class="author">tj@crowdersoftware.com</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@m_gol, @dmethvin: That <strong>is</strong> really strange! I can confirm that it behaves differently on jsFiddle as well (I get different numbers rather than the same ones), which is...well...strange.</p><p>I don't seem to have the rights to add a file attachment, but <a href="http://pastie.org/8100541" class="ext-link"><span class="icon"></span>this completely standalone version</a> replicates the issue for me (numbers are the same, like jsbin), both with edge and 1.8.3.</p><p>Hopefully it's just me doing something silly, but it's not immediately obvious to me <strong>what</strong>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 05:15PM UTC by <span class="author">tj@crowdersoftware.com</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@m_gol, @dmethvin: The difference is <code>onload</code>. jsFiddle defaults to putting your code in a <code>window.load</code> event handler (a very, very strange default to my way of thinking). Make it "No wrap - body" and the problem gets replicated: <a href="http://jsfiddle.net/kDVyv/7/" class="ext-link"><span class="icon"></span>v1.8.3</a>, <a href="http://jsfiddle.net/kDVyv/8/" class="ext-link"><span class="icon"></span>edge</a>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 05:18PM UTC by <span class="author">tj@crowdersoftware.com</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Sorry, click-itis: Problem does not replicate when using <code>ready</code>: <a href="http://jsfiddle.net/kDVyv/9/" class="ext-link"><span class="icon"></span>v1.8.3</a>, <a href="http://jsfiddle.net/kDVyv/10/" class="ext-link"><span class="icon"></span>edge</a>.</p><p>So rather than a documentation problem, is this an issue with <code>css('height')</code> and <code>css('width')</code> when used at bottom of page?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 05:31PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is because jQuery runs some tests after document ready fired and one of these tests is checking boxSizing support. jsFiddle must be injecting scripts asynchronously while jsBin & static pages don't; inline code is executed before tests run which makes jQuery believe boxSizing is not supported in this browser. If you put this code in a document ready call, it works.</p><p>We should fix it, IMHO. It seems intuitive for users to be able to assume that JS code put at the end of body doesn't need to wait for document ready. This assumption isn't always true as we can see in this example.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 05:41PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>We could "fix" it for 2.x by setting jQuery.support.boxSizing to true as all supported by 2.x browsers have it true.</p><p>It would be best to actually remove this property but I believe we need it for backwards compatibility with 1.x where it's needed - unfortunately jQuery.support is exposed. :(</p><p>As for 1.x, I don't see any quick & pretty solution.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 06:27PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>summary:</th>
                  <td>
                    
                      <span class="change-field-old">`height`/`width` documentation incorrect about `css` and box-sizing: border-box</span> → <span class="change-field-new">elem.css(&#39;width&#39;) provides incorrect output with `box-sizing: border-box` if run before document ready</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 06:40PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">support</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>iirc, assuming the document is ready at the end of the body can have other issues as well, irrespective of whether jQuery is on the page. But perhaps that was only oldIE? One things seems certain from our experience: we should not let this ticket encourage us to pull support tests requiring the <code>body</code> out of document ready. We've done this before and it was fraught with problems.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 06:42PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>That's interesting, Timmy, can you share info about some problems of this nature? I've seen suggestions that putting scripts at the end of body is equivalent to invoking them on doc ready so many times...</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 06:44PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>And what do you think about assuming <code>jQuery.support.boxSizing === true</code> in 2.x?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 07:11PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Did a little searching. I was vaguely recalling a few things.&#92;
&#92;
It is true that scripts running at the end of the body is basically the same as putting them at the end of the body, I would not officially recommend it because there are several conditions that could cause unwanted behavior. [http://stackoverflow.com/questions/1438883/jquery-why-use-document-ready-if-external-js-at-bottom-of-page This answer on SO] goes in more detail. Putting scripts at the end of the body is the same because ALL of the HTML source has been parsed by the browser. The point of the post is, be really sure you&#39;re not using something that hasn&#39;t been parsed yet (scripts using `document.write` or script tags anywhere besides the end of the body can cause errors).&#92;
&#92;
Having said that, there is a [http://www.w3.org/TR/html5/syntax.html#the-end difference], according to the spec. Any scripts using the `defer` flag are executed _before_ the ready event, but not before scripts at the end of the body. Just good to be aware of that.&#92;
&#92;
Finally, in oldIE, there was the [http://blogs.msdn.com/b/ie/archive/2008/04/23/what-happened-to-operation-aborted.aspx operation aborted event], but that could be avoided by ensuring the script tag&#39;s parent is actually the body.&#92;
</span> → <span class="change-field-new">1372706747781617</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Did a little searching. I was vaguely recalling a few things.</p><p>It is true that scripts running at the end of the body is basically the same as putting them at the end of the body, I would not officially recommend it because there are several conditions that could cause unwanted behavior. <a href="http://stackoverflow.com/questions/1438883/jquery-why-use-document-ready-if-external-js-at-bottom-of-page" class="ext-link"><span class="icon"></span>This answer on SO</a> goes in more detail. Putting scripts at the end of the body is the same because ALL of the HTML source has been parsed by the browser. The point of the post is, be really sure you're not using something that hasn't been parsed yet (scripts using <code>document.write</code> or script tags anywhere besides the end of the body can cause errors).</p><p>Having said that, there is a <a href="http://www.w3.org/TR/html5/syntax.html#the-end" class="ext-link"><span class="icon"></span>difference</a>, according to the spec. Any scripts using the <code>defer</code> flag are executed _before_ the ready event (under certain circumstances), but not before scripts at the end of the body. Just good to be aware of that.</p><p>Finally, in oldIE, there was the <a href="http://blogs.msdn.com/b/ie/archive/2008/04/23/what-happened-to-operation-aborted.aspx" class="ext-link"><span class="icon"></span>operation aborted event</a>, but that could be avoided by ensuring the script tag's parent is actually the body.</p><p>But yes, I'd be fine with defaulting to true.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 09:36PM UTC by <span class="author">tj@crowdersoftware.com</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Given the oft-repeated <a href="http://developer.yahoo.com/performance/rules.html" class="ext-link"><span class="icon"></span>recommendation to put scripts at the end of body</a>, barring very, <strong>very</strong> solid reasons contrary, I wouldn't recommend jQuery get things wrong in that situation. Certainly there's no reason this box sizing detect can't be more proactive.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:14">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 09:39PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:14">comment:14</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> Certainly there's no reason this box sizing detect can't be more proactive.</blockquote><p>Great, can you submit a more proactive patch? The trick is supporting 1.x I think.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:15">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 10:07PM UTC by <span class="author">tj@crowdersoftware.com</span></span>
        <a class="ticket-change-link" href="#comment:15">comment:15</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@dmethvin:</p><blockquote> Great, can you submit a more proactive patch? </blockquote><p>Sure! (And thanks for the invite.) Give me a few days to shake some time free, particularly busy work schedule this week.</p><p>What's best, fork on github and do a pull request?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:16">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 10:11PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:16">comment:16</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Definitely fork and pull request, more information is at <a href="http://contribute.jquery.org" class="ext-link"><span class="icon"></span>http://contribute.jquery.org</a> if you need it. Many thanks for your past bug reports, they're exemplars. We'd love to have your name in AUTHORS.txt. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:17">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 01, 2013 10:40PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:17">comment:17</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Just to be clear, no one is arguing against putting scripts at the end of the body. The issue is document ready and whether we can get around needing a body for certain support tests.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:18">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 09, 2013 09:03AM UTC by <span class="author">tj@crowdersoftware.com</span></span>
        <a class="ticket-change-link" href="#comment:18">comment:18</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@dmethvin, @m_gol: I'd like to get your input on this if I could.</p><p>As you know, there are two relevant <code>support</code> properties: <code>boxSizing</code> and <code>boxSizingReliable</code>. Currently, the pre-<code>ready</code> code doesn't set <code>boxSizing</code> at all but sets <code>boxSizingReliable</code> to <code>true</code>, then the <code>ready</code> code sets <code>boxSizing</code> and optionally changes <code>boxSizingReliable</code> to <code>false</code>.</p><p>Re <code>boxSizing</code>:</p><p>The current test uses measurement, and so waits for <code>body</code> (the measurement doesn't work when the element is disconnected). I've tried several browsers* and it seems like the fairly common feature-sniff approach of testing for the property on an element's <code>style</code> works reliably before <code>body</code> exists. E.g., prior to the <code>ready</code> handler:</p><pre class="wiki">
$.each('boxSizing MozBoxSizing msBoxSizing webkitBoxSizing OBoxSizing'.split(' '), function(i, prop) {
    if (prop in div.style) {
        support.boxSizing = true;
        return false;
    }
});
</pre><p>or more briefly but less readably</p><pre class="wiki">
$.each('boxSizing MozBoxSizing msBoxSizing webkitBoxSizing OBoxSizing'.split(' '), function(i, prop) {
    return !(support.boxSizing = prop in div.style);
});
</pre><p>where <code>div</code> is an element that already exists in the function for various other tests.</p><p>Does anyone know of a reason I shouldn't do that? Known invalid results or similar? It would also have the advantage that it wouldn't be subject to bug <a href="/ticket/13543">#13543</a>, so no need for the swapping test that fixed it (nice one, @m_gol).</p><p>Re <code>boxSizingReliable</code>:</p><p><code>boxSizingReliable</code> gets set to <code>false</code> on <code>ready</code> based on a call to <code>getComputedStyle</code> to check whether it's giving the wrong values. The only browser I have handy where <code>boxSizingReliable</code> is false is Firefox (I have v3.6.15 and v20).</p><p>This is more problematic, because the <code>div</code> we check needs to be in the document for us to use <code>getComputedStyle</code> on it. I did have an idea, but I'm not that comfortable with it. [ That could be because I'm a bit outside my comfort zone when we get to browser edge cases. :-) ] The <code>div</code> needs to be in the document, but apparently it doesn't have to be in <code>body</code>. On the browsers I've checked, before <code>ready</code> I can append it to <code>documentElement</code> and do the test successfully, getting the expected values on Firefox (false) and Chrome/Safari/Opera (true) (the test is irrelevant to IE at present). This doesn't (in my tests) trigger creation of the <code>body</code> element like it would if the parser hit a <code>&lt;div&gt;</code> tag in the source. In fact, if I don't remove it, it remains a direct child of the <code>html</code> element even after page load is complete (even on IE! but of course we wouldn't need to do this on IE until/unless it supports <code>getComputedStyle</code>).</p><p>I don't see us appending elements to the <code>documentElement</code> (temporarily) anywhere else in the source, but provided it doesn't have unpleasant side-effects in browsers I haven't tested, it might be a viable option. But again, when it comes to the vagaries of potential cross-browser issues when appending to the document element (and temporarily creating an invalid structure) prior to <code>body</code> being created, I get out of my depth.</p><p>Thoughts?</p><p>Thanks - T.J. :-)</p><p>(* Browsers tested so far: IE6, IE8, IE10, Chrome 26 [Linux], Firefox 3.6.15 [Windows], Firefox 20 [Linux], Safari [iOS 6], Opera 12.15 [Linux].)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:19">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 09, 2013 09:14AM UTC by <span class="author">tj@crowdersoftware.com</span></span>
        <a class="ticket-change-link" href="#comment:19">comment:19</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Follow-up thought: The use-case we're trying to support is people like me who put scripts at the end of <code>body</code>, right? So pretty much my entire post just now was a bit silly.</p><p>The simpler solution is to test if <code>body</code> exists (prior to the <code>ready</code> callback) and if so, do the current <code>boxSizing</code> / <code>boxSizingReliable</code> tests right then; if not, do the current tests on <code>ready</code>. That supports:</p><p>1. Users putting <code>script</code> tags in <code>head</code> and using <code>ready</code> (or <code>onload</code>)</p><p>2. Users putting <code>script</code> tags in <code>body</code> and running them immediately (or using <code>ready</code> or <code>onload</code>)</p><p>It would <strong>not</strong> support users putting the <code>script</code> tag for jQuery in the <code>head</code> and then putting their own scripts in the <code>body</code> and not waiting for <code>ready</code>. I would think "don't do that" would be an acceptable answer to that scenario. :-) (If we ''really'' wanted to support that, we could trigger the tests on the first user-generated call into jQuery, but to me at that point we're going too far.)</p><p>To me, this is much less risky than appending the <code>div</code> to <code>documentElement</code>. It's actually a very small change.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:20">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 09, 2013 02:36PM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:20">comment:20</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Actually, we ''do'' already append to <code>documentElement</code> during initialization: <a href="https://github.com/jquery/sizzle/blob/70f333eb1f62a779bffa748543b36093e8832bd0/sizzle.js#L509" class="ext-link"><span class="icon"></span>https://github.com/jquery/sizzle/blob/70f333eb1f62a779bffa748543b36093e8832bd0/sizzle.js#L509</a></p><p>I personally am all for taking advantage of the technique in jQuery support testing as well.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:21">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 09, 2013 02:58PM UTC by <span class="author">T.J. Crowder</span></span>
        <a class="ticket-change-link" href="#comment:21">comment:21</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@dgibson: <strong>Doh</strong>! That's what I get for filtering out Sizzle results in my search. :-)</p><p>That's fantastic, it means it's tried and true. (And very useful to know...)</p><p>So we have two options:</p><p>1. Use the "<code>in style</code>" test for <code>boxSizing</code> (the current check doesn't work earlier in IE, not even when the <code>div</code> is appended to <code>documentElement</code>) and move the <code>boxSizingReliable</code> test (my long comment earlier today), or</p><p>2. Detect whether <code>body</code> is already present and do the existing tests, deferring them until the <code>ready</code> handler if <code>body</code> isn't present (my shorter follow-up).</p><p>I don't think either is bigger in terms of code than the other to a degree that matters.</p><p>I prefer Option 1 unless someone has a known invalid result on the <code>in</code> test, because it handles use-cases Option 2 doesn't handle and doesn't vary at runtime depending on where the <code>script</code> tag is put. But I'm very new here and defer to those who aren't.</p><p>Once we have a consensus, I'll put together the patch (with tests, of course) and send a pull req.</p><p>-- T.J.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:22">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 09, 2013 07:25PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:22">comment:22</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Option 1 sounds good. I recall that oldIE leaks memory when the <code>in</code> operator is used with host objects like <code>window</code> or <code>document</code>, dunno if that could be an issue here. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:23">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 09, 2013 09:00PM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:23">comment:23</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I also prefer option 1, and would further note (though not necessarily recommend as in-scope for this fix) that <code>documentElement.append( container )</code> can probably cover ''all'' presently-deferred support tests.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:24">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 09, 2013 09:16PM UTC by <span class="author">T.J. Crowder</span></span>
        <a class="ticket-change-link" href="#comment:24">comment:24</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Good deal, I'm on it. Just for <code>boxSizing</code> for now, but I'll look at the other deferred tests as a follow-on effort to see if we can move them up.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:25">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 19, 2013 05:56PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:25">comment:25</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>T.J. Crowder, how is your work going? I can pick up this ticket if you didn't find time.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:26">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 20, 2013 09:22AM UTC by <span class="author">T.J. Crowder</span></span>
        <a class="ticket-change-link" href="#comment:26">comment:26</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@m_gol: I <strong>really</strong> wanted to be the one to fix this, but my plate is clearly overflowing (and running onto the floor, frankly). If you have the bandwidth in the next week, go for it. :-) If not, I'll see if I can pick it up on Sunday.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:27">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 20, 2013 06:15PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:27">comment:27</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/14253">#14253</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:28">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 21, 2013 10:20PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:28">comment:28</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ m_gol</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">assigned</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm taking it. I'll do it as part of my refactoring the support module (i.e. breaking it to tests performed in separate modules).</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:29">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 21, 2013 10:20PM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:29">comment:29</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">None</span> → <span class="change-field-new">1.11/2.1</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:30">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 01, 2013 10:12PM UTC by <span class="author">mikesherov</span></span>
        <a class="ticket-change-link" href="#comment:30">comment:30</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>boxSizingReliable is irrelevant as of FF23. According to our support statement, it can be removed when FF24 comes out. Also, the case in which its hit is quite rare (and involves a sized but disconnected element). I have a PR to remove it once FF24 lands. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:31">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 01, 2013 11:26PM UTC by <span class="author">mikesherov</span></span>
        <a class="ticket-change-link" href="#comment:31">comment:31</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>BTW, setting boxSizing by default to true is something we should do as m_gol stated, even for 1.x. True is the correct assumption for like 95% of pageloads on the net. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:32">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 02, 2013 12:02AM UTC by <span class="author">m_gol</span></span>
        <a class="ticket-change-link" href="#comment:32">comment:32</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@mikesherov <code>boxSizingReliable</code> is needed for IE10 and IE11 as well, I'm afraid. :(</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:33">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 06, 2013 03:29PM UTC by <span class="author">Michał Gołębiowski</span></span>
        <a class="ticket-change-link" href="#comment:33">comment:33</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">assigned</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fix <a href="/ticket/14084">#14084</a>: attach the test div to documentElement, not body. </p><p> Changeset: 776012b8b3898fad2e0727880f1dc4af5c7b33c1</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
