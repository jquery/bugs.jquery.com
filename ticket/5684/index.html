<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#5684 (Effects: exception in animation callback causes endless loop) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/5683/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/5685/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#5684</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">enhancement</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened December 19, 2009 08:23PM UTC</p>
      
        <p>Closed September 28, 2011 04:01PM UTC</p>
      
      
        <p>Last modified March 08, 2012 05:05PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Effects: exception in animation callback causes endless loop</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        jixxer
      </td>
      <th>Owned by:</th>
      <td>gnarf</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.7">1.7</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>effects</td>
      
        <th>Version:</th>
      
      <td>1.4a1</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>exception,animation,callback,1.7-discuss</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>This bug was (in some sense) already discovered 1 year ago (Ticket <a href="/ticket/2846">#2846</a>), but no action was taken.</p><p>If a function, which is passed as callback function to any animation-effect-function (</p><pre class="wiki">animate</pre>/<pre class="wiki">show</pre>/<pre class="wiki">hide</pre>/...), throws an exception jQuery generates an endless loop (actually it's a function called via a  <pre class="wiki">setInterval</pre> which is never canceled and the <pre class="wiki">setInterval</pre> keeps running every 13ms(!).<p></p><p>All linenumbers refer to <a href="http://github.com/jquery/jquery/blob/1.4a2/src/effects.js" class="ext-link"><span class="icon"></span>effects.js jQuery 1.4a2</a></p><p>The proposed patch is (XXXX to be replaced by actual ticket number)</p><p> </p><pre class="wiki">
401c401
401c401,402
&lt; this.options.complete.call( this.elem );
---
&gt; // ignore exceptions in callback check Ticket #XXXX
&gt; try { this.options.complete.call( this.elem ); } catch () { }

 </pre><p></p><p></p><hr><p></p><p>More in detail the following things can happen</p><ul><li>the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)</li></ul><ul><li>if multiple elements where being animated the callback function is only called for the first element which finished animating</li></ul><ul><li>if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback</li></ul><ul><li>all animations started, after such a faulty callback function was triggered, fail to work completely</li></ul><ul><li>depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall</li></ul><ul><li>other jQuery code not related to animation continues too function normally</li></ul><p>As already pointed out in the other bug ticket the cause for this is that the call to </p><pre class="wiki">clearInterval( timerId );</pre> on line 440 in the <pre class="wiki">jQuery.fx.stop</pre> function is never reached.<p></p><p>It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to </p><pre class="wiki">this.options.complete.call( this.elem );</pre> on line 401 in <pre class="wiki">jQuery.fx.step</pre> throws the exception thus (further up the call stack) the code on the lines 430-435 in <pre class="wiki">jQuery.fx.tick()</pre> won't ever be reached which means the <pre class="wiki">timers/jQuery.timers</pre> array is never emptied and <pre class="wiki">jQuery.fx.stop</pre> never called.<p></p><p>I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the "programmer" and not directly by jQuery.</p><p>So if the decision is to not apply this fix both tickets this one and <a href="/ticket/2846">#2846</a> should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless "recursion" effect.</p><p></p><hr><p></p><p>Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.</p><p>Opera 10.10 and FF 3.5.6 show the reported behavior.</p><p>IE6 seems to degrade in some strange way also fails to run any animations afterwards</p><p>Can't test on IE7, IE8, Safari, Chrome, ...</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (1)</summary>

  <ul class="ticket-attachments">
    
      <li>
        <a href="/attachment/ticket/5684/test_#5684.html/index.html">test_#5684.html</a> (2.1 KB) - added by jixxer
        <strong>December 19, 2009 08:26PM UTC</strong>.<br>
        <p>small test case</p>
      </li>
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (25)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 28, 2010 05:24PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This bug drove me crazy for weeks. Finally found the problem yesterday and after a while found this ticket. Anyway, here's a simple test case for any skeptics. Just run this in firebug.</p><pre class="wiki">
$('a:first').hide('blind', function () { console.log('called'); throw new Error('test'); });
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 29, 2010 04:59AM UTC by <span class="author">SlexAxton</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.4</span> → <span class="change-field-new">1.5</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">minor</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>type:</th>
                  <td>
                    
                      <span class="change-field-old">bug</span> → <span class="change-field-new">enhancement</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I created a live test case for this one: <a href="http://jsfiddle.net/shAZT/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/shAZT/</a></p><p>The problem occurs because there is an interval that is never cleared because you are throwing an error in every iteration of the callback...</p><p>While technically, you should catch your errors, it would probably be good for jQuery to be able to handle situations where the programmer fails.</p><p>I'll pass this through as an enhancement to 'protect' the user. Exceptions _usually_ mean _your_ code is broken, so I'd suggest wrapping the code that causes this exception in a try catch block. jQuery could do that, but it'd be too expensive to do for all cases, just so the few people who accidentally cause exceptions don't break (more).</p><p>We'll look at doing some code restructuring so it doesn't rely on the successful callback of the function.</p><p>Thanks for the ticket and test case! Very much appreciated.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 24, 2010 01:12PM UTC by <span class="author">mail@jasonwoods.me.uk</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi all,</p><p>I thought maybe one could try returning the callback function from step(). Then if we return true, it means tick along. If we don't, it means end of the animation. We then drop the timer, and see if we returned a callback. If we returned a callback, we call it.</p><p>This adds just 2 extra compares - not sure if this is just as expensive as a try catch block but I would assume not.</p><p>An additional benefit is the error is still raised for each call of the function - but it doesn't cause a loop and thousands of entries in the error log, so for each instance the function runs and fails, it only fails once and generates a single exception. Only downside to this is the animations may delay slightly because if an exception raises on the first timer, the function fails and other timers won't tick until the next tick. But I consider this perfectly acceptable when an Exception is raised - getting rid of the loop is the most important thing as far as I'm concerned at least!</p><p>Here is the modifications I did to the released 1.4.4 file at <a href="http://code.jquery.com/jquery-1.4.4.js." class="ext-link"><span class="icon"></span>http://code.jquery.com/jquery-1.4.4.js.</a> If you would like me to apply the changes to a working copy or something let me know :)</p><p>(Sorry for dropping the diff directly in the post - thought it was the best place for it as it is only small)</p><pre class="wiki">
#!diff
6746a

.
6744,6745c

			// #5684 (Driskell) step() returns true for incomplete animation (push to timers)
			// returns false when an animation in a set is completed and it is not the last
			// returns a callback when all animationsin a set are completed
			if ( (complete = timers[i]()) !== true ) {
				timer = timers.splice(i--, 1);
				if (complete !== false) complete.call(timer.elem);
.
6741c
		var timers = jQuery.timers,
			complete, timer;
.
6715,6716c
				// #5684 (Driskell) return the callback function so we can remove the timer before we call it
				// this will ensure any exception returned by the completion function does not cause a loop because the timer was not removed
				return this.options.complete;
.
6645,6647c
		// #5684 (Driskell) step() returns true for incomplete animation (push to timers)
		// returns false when an animation in a set is completed and it is not the last
		// returns a callback when all animationsin a set are completed
		if ( (complete = t()) === true ) {
			if ( jQuery.timers.push(t) && !timerId ) timerId = setInterval(fx.tick, fx.interval);
		} else if (complete !== false) complete.call(this.elem);
.
6630c
			fx = jQuery.fx,
			complete;
.
</pre><p>Let me know your thoughts.</p><p>Jason a.k.a. Driskell</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 29, 2010 09:58AM UTC by <span class="author">Jason a.k.a. Driskell &lt;mail@jasonwoods.me.uk&gt;</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Here's new patch file that follows jQuery Core Style Guidelines:</p><p><a href="http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.diff" class="ext-link"><span class="icon"></span>http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.diff</a></p><p>And a prepatched file for those who need:</p><p><a href="http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.js" class="ext-link"><span class="icon"></span>http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.js</a></p><p>Let me know your thoughts.</p><p>Jason a.k.a. Driskell</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 07, 2010 11:31AM UTC by <span class="author">Jason a.k.a. Driskell &lt;mail@jasonwoods.me.uk&gt;</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi,</p><p>Found an issue with my previous patch on my development server - it didn't work when you called stop() to stop the animations. Also when taking the elem from the splice I missed the subscript so it returned undefined - which made things worse than before :) sorry!</p><p>Resolved it all in this new one, which we're now using in production. Let me know if anyone spots any other issues:</p><p>Patch for 1.4.4: <a href="http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.diff.fixed" class="ext-link"><span class="icon"></span>http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.diff.fixed</a></p><p>Prepatched file: <a href="http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.js.fixed" class="ext-link"><span class="icon"></span>http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.js.fixed</a></p><p>If you need the 1.4.4 I used to create the patch it is here: <a href="http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.js.orig" class="ext-link"><span class="icon"></span>http://www.jasonwoods.me.uk/jquery/jquery-1.4.4.js.orig</a></p><p>Also if you need to know I ran diff -E to make the patch. If we need different format let me know.</p><p>Kind Regards,</p><p>Jason a.k.a. Driskell</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 16, 2011 11:45PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-new">→ 1.next</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>We should look into this for 1.7.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 22, 2011 07:27PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-old">exception animation callback</span> → <span class="change-field-new">exception,animation,callback,1.7-discuss</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Nominating ticket for 1.7 discussion.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 22, 2011 10:25PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span> → <span class="change-field-new">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, Sounds like a bug, should be fixed</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 22, 2011 11:55PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>-1, No, no, no, no. Never EVER hide an exception. We could use a try/finally block... but we all know how stupidly unsupported this construct is in old IEs.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2011 01:54AM UTC by <span class="author">ajpiano</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span> → <span class="change-field-new">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>-1, Agreed with jaubourg, not really into masking the exceptions here.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2011 02:57AM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, maybe keep the try/catch, throw a custom error, and stop the animation?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2011 03:41PM UTC by <span class="author">danheberden</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span> → <span class="change-field-new">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+0, any perf tests on the speed impact of running through try/catch? </p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2011 09:19PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span> → <span class="change-field-new">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, If we could use timmywil's suggestion maybe? I don't like a blind try/catch suggested by the OP.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:14">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 26, 2011 07:48AM UTC by <span class="author">mail@jasonwoods.me.uk</span></span>
        <a class="ticket-change-link" href="#comment:14">comment:14</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi all,</p><p>One doesn't need a try/catch... simply calling the completion callback AFTER dropping the animation from the timers queue means the exception occurs ONCE. I agree that a blind try/catch would hide the exception and this is NOT correct behaviour. The issue here is an exception looping. The correct behaviour would be for the exception to occur once - and try/catch would result in no exception and therefore not be correct.</p><p>I attached a patch for this for 1.4.4 which moves the callback so it is the LAST thing jQuery calls as part of the animation step and it works perfectly - it merely adds 2 extra compares to the animation and returns a callback instead of "true" from step(). This is then handled in the functions that called step() and the callback called as soon as all jQuery animation code is finished. As a result, even if the callback fails - jQuery had nothing else to do anyway so we no longer get a loop.</p><p>Just let me know if you want an updated patch for 1.6.1 or something. I'm glad to help.</p><p>Jason.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:15">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 26, 2011 07:58AM UTC by <span class="author">Driskell</span></span>
        <a class="ticket-change-link" href="#comment:15">comment:15</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Just registered an account and hoping I&#39;ll get email notifications this time! :)</span> → <span class="change-field-new">1306396853835794</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>+1, Just registered an account and hoping I'll get email notifications this time! :)</p><p>(I'm the Jason mail@ guy)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:16">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 03, 2011 01:26PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:16">comment:16</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span> → <span class="change-field-new">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, This seems like something that we could work around with just some minor logic tweaking (we certainly don't want to hide the execeptions, though).</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:17">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 03, 2011 02:23PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:17">comment:17</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, repeating errors is obviously wrong</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:18">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 06, 2011 03:39PM UTC by <span class="author">jzaefferer</span></span>
        <a class="ticket-change-link" href="#comment:18">comment:18</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+0</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:19">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 06, 2011 03:51PM UTC by <span class="author">cowboy</span></span>
        <a class="ticket-change-link" href="#comment:19">comment:19</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+0</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:20">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 11, 2011 09:17PM UTC by <span class="author">ajpiano</span></span>
        <a class="ticket-change-link" href="#comment:20">comment:20</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span> → <span class="change-field-new">This bug was (in some sense) already discovered 1 year ago (Ticket #2846), but no action was taken.&#92;
&#92;
If a function, which is passed as callback function to any animation-effect-function ({{{animate}}}/{{{show}}}/{{{hide}}}/...), throws an exception jQuery generates an endless loop (actually it&#39;s a function called via a  {{{setInterval}}} which is never canceled and the {{{setInterval}}} keeps running every 13ms(!).&#92;
&#92;
All linenumbers refer to [http://github.com/jquery/jquery/blob/1.4a2/src/effects.js effects.js jQuery 1.4a2]&#92;
&#92;
The proposed patch is (XXXX to be replaced by actual ticket number)&#92;
&#92;
 {{{&#92;
401c401&#92;
401c401,402&#92;
&lt; this.options.complete.call( this.elem );&#92;
---&#92;
&gt; // ignore exceptions in callback check Ticket #XXXX&#92;
&gt; try { this.options.complete.call( this.elem ); } catch () { }&#92;
&#92;
 }}}&#92;
&#92;
----&#92;
&#92;
More in detail the following things can happen&#92;
&#92;
- the callback function is called repeatedly forever (unless at a certain time it stops throwing the exception)&#92;
&#92;
- if multiple elements where being animated the callback function is only called for the first element which finished animating&#92;
&#92;
- if the reason for the callback function to throw an exception depends on the element which finished animating, the callback is never called for all elements which complete after the first element which caused the exception in the callback&#92;
&#92;
- all animations started, after such a faulty callback function was triggered, fail to work completely&#92;
&#92;
- depending on browser + hardware CPU utilization could og to 100% or even whole browser/OS could stall&#92;
&#92;
- other jQuery code not related to animation continues too function normally&#92;
&#92;
&#92;
As already pointed out in the other bug ticket the cause for this is that the call to {{{clearInterval( timerId );}}} on line 440 in the {{{jQuery.fx.stop}}} function is never reached.&#92;
&#92;
It is also clear why this happens if you are familiar with the inner workings of jQuery for animations. The call to {{{this.options.complete.call( this.elem );}}} on line 401 in {{{jQuery.fx.step}}} throws the exception thus (further up the call stack) the code on the lines 430-435 in {{{jQuery.fx.tick()}}} won&#39;t ever be reached which means the {{{timers/jQuery.timers}}} array is never emptied and {{{jQuery.fx.stop}}} never called.&#92;
&#92;
I understand that it is debatable if this fix should even be applied as it masks an exception and the root fault which triggers this bug is caused by the &quot;programmer&quot; and not directly by jQuery.&#92;
&#92;
So if the decision is to not apply this fix both tickets this one and #2846 should be marked as nofix. But we should add a note to the animation documentation that a fault callback function can have this nasty endless &quot;recursion&quot; effect.&#92;
&#92;
----&#92;
&#92;
Before reporting I tested in Opera 10.10, FF 3.5.6 and IE6.&#92;
&#92;
Opera 10.10 and FF 3.5.6 show the reported behavior.&#92;
&#92;
IE6 seems to degrade in some strange way also fails to run any animations afterwards&#92;
&#92;
Can&#39;t test on IE7, IE8, Safari, Chrome, ...</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.next</span> → <span class="change-field-new">1.7</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Targeting for 1.7 at bug triage</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:21">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 15, 2011 10:40PM UTC by <span class="author">gnarf</span></span>
        <a class="ticket-change-link" href="#comment:21">comment:21</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ gnarf</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">assigned</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm gonna pick this one up and see if I can do anything with it.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:22">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 25, 2011 05:01AM UTC by <span class="author">paulpro@uvic.ca</span></span>
        <a class="ticket-change-link" href="#comment:22">comment:22</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Rather than absorb the error, we could execute the callback asynchronously, so that it will still throw the error, but won't affect the current running thread. It's a very simple edit to make. Can anyone think of any reason not to do it like this:</p><pre class="wiki">
setTimeout(function(){
	options.complete.call(elem);
}, 1);
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:23">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 27, 2011 08:54AM UTC by <span class="author">gnarf</span></span>
        <a class="ticket-change-link" href="#comment:23">comment:23</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="https://github.com/jquery/jquery/pull/520" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/520</a> </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:24">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 28, 2011 04:01PM UTC by <span class="author">Corey Frang</span></span>
        <a class="ticket-change-link" href="#comment:24">comment:24</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">assigned</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Landing pull request 520. Unset the complete function just before calling it to avoid an exception creating a loop. Fixes <a href="/ticket/5684">#5684</a>.</p><p>More Details:</p> <ul><li><a href="https://github.com/jquery/jquery/pull/520" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/520</a></li> <li><a href="http://bugs.jquery.com/ticket/5684" class="ext-link"><span class="icon"></span>http://bugs.jquery.com/ticket/5684</a> </li></ul><p> Changeset: 8dda57f82f1c366f10c591da099f8e9495eaa01b</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:25">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 05, 2011 08:49PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:25">comment:25</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/10425">#10425</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
