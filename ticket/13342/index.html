<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13342 (Support setting $.html() on shadow roots) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13341/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13343/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#13342</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">feature</span>
      <span class="ticket-resolution">(plugin)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened January 29, 2013 12:22AM UTC</p>
      
        <p>Closed May 02, 2013 08:39PM UTC</p>
      
      
        <p>Last modified July 30, 2014 12:17PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Support setting $.html() on shadow roots</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        jan@quickui.org
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>manipulation</td>
      
        <th>Version:</th>
      
      <td>git</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>The forthcoming public support for Shadow DOM components (<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html)" class="ext-link"><span class="icon"></span>https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html)</a> in Google Chrome opens up the possibility of creating reusable web UI components. To date, nearly all Shadow DOM examples use the native DOM API, but it should be possible to use jQuery for this purpose. As it turns out, jQuery is already very nearly able to manipulate the contents of a Web Component. A small change to core.js will enable proper support.</p><p>Example: <a href="http://jsfiddle.net/Jan_Miksovsky/y9hSm/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/Jan_Miksovsky/y9hSm/</a></p><p>This fiddle creates a very basic Web Component that adds some simple text to its content. When viewed in a production browser, the fiddle will display a simple list of names like "Ann". When viewed in a Shadow DOM-capable browser like Google Canary (or, I believe, beta channel), the fiddle will display additional text around each name: "Hello, Ann."</p><p>This is done by creating a shadow root, then setting its innerHTML to "Hello &lt;content&gt;&lt;/content&gt;". It's not possible in jQuery 1.9 to directly manipulate the innerHTML of a shadow root using html(). The issue is that core.js checks to make sure that the nodeType of an element being manipulated by html() is of nodeType 1 (element). However, a shadow root is actually of nodeType 11 (document fragment). Unlike normal document fragments, shadow roots expose an innerHTML property just like regular HTMLElement nodes.</p><p>I have a small fix and accompanying unit test for this, and am filing this bug in preparation for a pull request. (This fix is applied in the private jquery.js used in the fiddle.) This fix updates the check in core.js to permit shadow roots. With that, html() can directly manipulate the innerHTML of shadow roots — that is, Web Component content — correctly. (To see the effects of such manipulation in Google Canary, be sure to turn on "Show Shadow DOM" in the Chrome debugging tools.)</p><p>Shadow DOM support will likely land in production Chrome in the not-too-distant future, followed by Mozilla later this year, so this seems like a proactive time to make this fix (or something similar that accomplishes the same objective). This fix doesn't require Shadow DOM support, and in fact doesn’t directly test for Shadow DOM; it should be backward compatible with other browsers, and safe to roll out at any point, even before Shadow DOM-capable browsers become widespread.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (11)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 29, 2013 01:07AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I have a feeling there is more to shadow DOM support than just allowing <code>.innerHTML</code> on document fragments but I haven't looked at the spec in detail.  Are you experimenting with shadow DOM components yourself? It would be great to support this to a reasonable extent when it lands, but I wonder if it even makes sense to support in 1.9 vs. just putting it in 2.0. What kind of fallback would a web page/app/site use if shadow DOM wasn't there?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 29, 2013 02:07AM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I've been tracking Shadow DOM development for the better part of a year, and recently it's advanced to the point where I'd like to start supporting Shadow DOM in a jQuery-based web UI framework I maintain (<a href="http://quickui.org)." class="ext-link"><span class="icon"></span>http://quickui.org).</a> While the <a href="/wiki/WebKit">WebKit</a> team is framework-agnostic, and does all documentation in the standard DOM API, I prefer to do all DOM manipulation through jQuery.</p><p>This bug is meant to address the first, most basic issue I ran into in doing Shadow DOM work with jQuery. Fixing this is likely just a start; there will likely be many more Shadow DOM-related issues that come up as the technology finds more users.</p><p>As for a fallback, Google is working with several parties to create polyfills for Web Components overall. Given the nature of Shadow DOM, it's really impossible to provide a complete backwards-compatible polyfill, although one could certainly address some of its features in <a href="/wiki/JavaScript">JavaScript</a>. That is, in fact, the work I'm attempting to pursue in my UI framework: give jQuery developers a way to create UI components that render in the Shadow DOM on browsers that support that technology, and fall back to widget-style UI components in older browsers.</p><p>This fix is intended to enable that work -- and that of other people who want to start creating Web Components in <a href="/wiki/JavaScript">JavaScript</a> and jQuery rather than using Google's proposed HTML &lt;element&gt; format for Web Components.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 29, 2013 07:09PM UTC by <span class="author">jan@quickui.org</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Pull request: <a href="https://github.com/jquery/jquery/pull/1149" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/1149</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 30, 2013 08:29PM UTC by <span class="author">paul.irish</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Seems legit. I'm also interested in where else jQuery needs any fixes for Shadow DOM & WC, but this particular case (as discussed on the PR) could be making a general improvement while simultaneously getting shadow dom compat.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 30, 2013 09:05PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">I&#39;d really like to see some examples of how this would be used. The person passing in the DOM fragment knows what it is and could use `.innerHTML` directly, right? And if this would end up being wrapped in some sort of jQuery plugin or other component that might be the right place to put this sort of knowledge. Once you&#39;re *inside* the component I can see that using jQuery all normal-like.&#92;
</span> → <span class="change-field-new">1359580144970741</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>I'd really like to see some examples of how this would be used. The person passing in the DOM fragment knows what it is and could use <code>.innerHTML</code> directly, right? And if this would end up being wrapped in some sort of jQuery plugin or other component that might be the right place to put this sort of knowledge. Once you're *inside* the component I can see that using jQuery all normal-like.</p><p>Edit: Also, this is implying that <code>$()</code> now understands shadow roots and supports some subset of jQuery methods on them. Can I use <code>.append()</code>, <code>.appendTo()</code>, <code>.replaceWith()</code> for example? You may not want to do that but I can bet that if we let people wrap it in a <code>jQuery</code> then people will expect it to behave as consistently as possible.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 30, 2013 11:04PM UTC by <span class="author">jan@quickui.org</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I think the first question, "Why would you want to invoke jQuery on a shadow root?", is effectively the same as the question, "Why would you want to invoke jQuery on document.body?" E.g., you might want to search within a component's Shadow DOM for all elements that match a selector in preparation for some global manipulation. While a component developer could work around this as you suggest (by setting innerHTML), that's just as cumbersome to a jQuery dev as needing to work with &lt;body&gt; specially.</p><p>Of more concern are situations in which the dev is invoking code outside their control. Suppose a jQuery widget exists that performs some useful function, and the widget's create() call invokes this.element.html(). That widget (and any other link it) will fail to perform the expected functions on a shadow root, and the code is outside the dev's control. A common case of this might be wanting to wrap a jQuery UI widget as a web component to encapsulate it and puts its contents out of reach of the widget's host. For an example of a jQuery UI widget wrapped in a component, see <a href="http://jsfiddle.net/Jan_Miksovsky/y2agp/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/Jan_Miksovsky/y2agp/</a> (in Google Canary).</p><p>The dev is forced to work around the problem by placing a placeholder div (or other element) within their shadow root. The extra layer may not seem bad, but if you have a component-centric app architecture, you could easily end up with many hundreds of components on a page, and the extra div per component adds a lot of clutter.</p><p>Your point about the general case of other jQuery functions is well taken. My own framework only needs .html(), but it's reasonable to expect that other people will assume other functions work as well. As it turns out, a quick check shows that .append() does indeed work as expected on a shadow root -- but something like .css() does not, because a shadow root doesn't have a style property. (Although upon reflection, if it has an innerHTML property, there's a case to be made that it should have style too. I'll ask about that.)</p><p>I can see that, before tackling this piecemeal, it might be helpful for the jQuery team to review a more complete assessment of what the current and expected behaviors of all jQuery functions are when applied to a Shadow DOM root. If you like, I can take that on, i.e., see what works as expected and what doesn't, compile the results, and submit a recommendation as to where jQuery could fix things. (In some cases, where the current spec doesn't support the expected behavior, the result might be useful feedback to the folks working on the Web Components spec.)</p><p>Would that help?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 04, 2013 08:48PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">manipulation</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I agree that it would be more helpful for a holistic look at the issue rather than trying to tackle it piecemeal. If someone familiar with where the proposal stands and where it is going would like to take a look that would be great. </p><blockquote> Although upon reflection, if it has an innerHTML property, there's a case to be made that it should have style too.</blockquote><p>That's one reason why I think it's possibly too early to land anything here. It would be pretty easy to encapsulate this in a plugin initially, for example by duck-punching <code>.html()</code> and catching the shadow root case.</p><p>There are some comments on <a href="https://github.com/jquery/jquery/pull/1149" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/1149</a> but I'll close that and let's try to keep discussion here until we decide what to do.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 12, 2013 01:59AM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>There's a discussion in public-webapps about making shadow root an element: <a href="http://lists.w3.org/Archives/Public/public-webapps/2013JanMar/0356.html" class="ext-link"><span class="icon"></span>http://lists.w3.org/Archives/Public/public-webapps/2013JanMar/0356.html</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 14, 2013 07:21PM UTC by <span class="author">angelinafabbro@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Just chiming in with a few points to agree/disagree:</p><p>1. It's probably a little early to incorporate this feature into jQuery specifically because the spec is still not entirely finalized. Piecemeal implementation/partial implementation of shadow root manipulation without &lt;template&gt; and custom elements is not as exciting as with them. Given that jQuery is a library that designers are partial to for ease of use (as many designers are not necessarily web developers, but do code some) I'd hope to have the declarative instantiation of shadow roots through tags otherwise I think it may be ignored for a while. (Except by those of us who think web components are super cool and may be more advanced users of JS.)</p><p>2. Cross-browser support is still sorely lacking, and cross-browser support that jQuery seems to take very seriously. Browsers are holding out for the spec to be finalized. So, I think if you were to do this and do it right the jQuery team may be writing an awful lot of polyfill and fallback code if you were to implement now.  jQuery probably should to to avoid undoing/redoing implementation. I mean, iteration is a good strategy but not with a moving target that has to do with DOM & DOM fragment manipulation.</p><p>but -</p><p>I really like the idea of getting these features into a general purpose library like jQuery as soon as it makes a bit more sense to do so. I think this will aid in propagating the idea of building better web apps with encapsulation.  jQuery has a lot of reach! This would be a good thing for the web.</p><p>Cheers,</p><ul><li>Angelina Fabbro</li></ul>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 02, 2013 08:39PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ plugin</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is a great discussion of the current state of Shadow DOM but I think any implementation should start as a plugin so we can evaluate its utility and stability. So let's close the ticket and watch the spec evolve for now. There is no risk of anyone letting us forget about this.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 30, 2014 12:17PM UTC by <span class="author">balupton</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Shadow DOM is currently broken for jQuery:</p><p>Fix: <a href="https://github.com/jquery/jquery/pull/1631" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/1631</a></p><p>Show case: <a href="http://jsbin.com/lirejo/edit" class="ext-link"><span class="icon"></span>http://jsbin.com/lirejo/edit</a></p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
