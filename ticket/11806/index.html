<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#11806 (IE7 preventDefault() doesn&amp;#39;t prevent F5 keydown causing browser Refresh) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/11805/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/11807/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#11806</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened May 23, 2012 08:15PM UTC</p>
      
        <p>Closed May 23, 2012 08:44PM UTC</p>
      
      
        <p>Last modified May 23, 2012 11:43PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">IE7 preventDefault() doesn&#39;t prevent F5 keydown causing browser Refresh</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        jeffr@livedata.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.7.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>jQuery works as expected on IE9, Chrome, and other more modern browsers.  On IE7, however, the F5 key doesn't get "canceled" via preventDefault() (nor by stopPropagation() nor returning false from the event handler.)</p><pre class="wiki">
$(window).load(function() {
                 $(document).ready(function() {                     $(document).bind('keydown', function(e) {                         if (e.keyCode == 116) {                             e.preventDefault();
.
.
.
</pre><p>On all tested browsers, the 'e.preventDefault()' gets called.  But only by adding this hack:</p><pre class="wiki">
e.originalEvent.keyCode = 0;
</pre><p>was I able to supress the F5 browser refresh on IE7.</p><p>I've seen several references on the web to the keyCode assignment hack, but I don't know why it works or if it is "correct".  However, as it stands right now, jQuery's normalization fails for this special case on IE7.  </p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (13)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 08:18PM UTC by <span class="author">jeffr@livedata.com</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <pre class="wiki">
&lt;!DOCTYPE html&gt;

&lt;html lang="en"&gt;

    &lt;head&gt; 

        &lt;meta charset="utf-8" /&gt;

        &lt;title&gt;Frame 1b&lt;/title&gt;

        &lt;script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js'&gt;&lt;/script&gt;        

        &lt;script type='text/javascript'&gt;//&lt;![CDATA[

            $(window).load(function() {

                $(document).ready(function() { 

                    $(document).bind('keydown', function(e) {

                        if (e.keyCode == 116) {

                            e.preventDefault();
                            e.originalEvent.keyCode = 0;

                        }

                        $('#output1').val(String.fromCharCode(e.keyCode));
                    });

                });

            });//]]&gt; 

        &lt;/script&gt;

    &lt;/head&gt; 

    &lt;body&gt; 

        frame1 

        &lt;textarea id="output1"&gt;&lt;/textarea&gt;   

    &lt;/body&gt; 

&lt;/html&gt;
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 08:28PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Function key behaviour is not going to be consistent across browsers and systems, eg. I'm on OSX in Chrome - F5 is not "refresh the browser".</p><p>Not confirmed. <a href="http://jsfiddle.net/rwaldron/Fq7rH/show/light" class="ext-link"><span class="icon"></span>http://jsfiddle.net/rwaldron/Fq7rH/show/light</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 08:40PM UTC by <span class="author">jeffr@livedata.com</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Here's a jsfiddle to see what I mean:  <a href="http://jsfiddle.net/SMDcX/2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/SMDcX/2/</a></p><p>I'm not expecting consistent function key behavior, but I am hoping we can make "event normalization" work consistently on IE7.  Which, I believe, means some kind of hack like setting event.keyCode = 0.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 08:44PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This seems sufficiently exceptional to justify a wontfix. Just add some of your own code to do this, we don't need to handle every corner case.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 08:58PM UTC by <span class="author">jeffr@livedata.com</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I've been singing the praises of jQuery to my dev team.  One of the things I told them was that jQuery nicely normalized events.</p><p>cf. <a href="http://api.jquery.com/category/events/event-object/" class="ext-link"><span class="icon"></span>http://api.jquery.com/category/events/event-object/</a></p><p>Which includes this:</p><p><strong>event.preventDefault()</strong></p><p> If this method is called, the default action of the event will not be triggered. </p><p>But this apparently isn't true on IE7, if the event is a key&lt;down,press,up&gt; event.  </p><p>I guess I'm surprised to find out that this is considered a corner case.  I thought jQuery was meant to allow me to NOT to have to know all the darned quirks of older browsers. </p><p>Is there a list of things not normalized that will help us know where jQuery does normalize things and where it does not?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 09:03PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>jQuery can't hide everything. IE7 has been around quite a while, I've been with the jQuery project since 2006, and I've never heard of anyone ask about this. So it is indeed a rare requirement. </p><p>This closed ticket can serve as a note that we're not normalizing this, it's too obscure to add to the documentation. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 09:10PM UTC by <span class="author">jeffr@livedata.com</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I understand the basis for your decision. Thanks for clarifying.</p><p>The search function on the ticket system is handy and there aren't that many corner cases mentioned as such. And all seem IE-related.  </p><p>Thanks for responding and thanks for the excellent work on jQuery!</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 09:12PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>How do you expect to "normalize" something that doesn't even exist on all machines? jQuery "normalizes" where disparity exists, not where actual, physical constraints exist eg. my F5 doesn't do "refresh", are you saying that jQuery should normalize OSX???</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 09:22PM UTC by <span class="author">jeffr@livedata.com</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>My example is confusing -- I apologize.</p><p>ANY keydown (or keypress, or keyup) event, as far as I understand it, is supposed to have its default processing prevented via a call to </p><p>event.preventDefault()</p><p>IE7 doesn't seem to do what Microsoft documents, and despite jQuery's correct efforts to "prevent" the event from bubbling (via IE7's proprietary "cancelBubble" and "returnValue"), the keys really do "bubble".  </p><p>I don't want certain keys to "bubble" up.  On IE9, Chrome,and1 Android, jQuery's event.preventDefault() works beautifully.</p><p>On IE7, despite correct efforts, it doesn't work.</p><p>Again, I chose F5 as that was the keydown I was testing with.  The point wasn't to imply that jQuery should normalize the behavior of F5.</p><p>The point was that jQuery ought to do one more "IE special" so that, on IE7, the function event.preventDefault() works as documented.</p><p>To summarize:  I was hoping jQuery would make event.preventDefault() work properly on key events on IE7.  </p><p>I don't own a Mac, but I'm assuming that jQuery's event.preventDefault() already works fine for you -- I was just asking for it to be made to work fine on IE7.  But, understandably, jQuery can't be responsible for smoothing over every nook and cranny of older browsers like IE7.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 09:49PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>According to the DOM 2 Event spec, there is no specified behaviour that Key Events abide: <a href="http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-eventgroupings-keyevents" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-eventgroupings-keyevents</a></p><p>It's likely that IE7 is using DOM2 or worse...</p><p>So what should we normalize to?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 10:13PM UTC by <span class="author">jeffr@livedata.com</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>jQuery has IE-specific code in order to implement the normalized</p><p>event.preventDefault()</p><p>What is it trying to do in that code?  I've been assuming that it is trying to implement the DOM3 standard despite the shaky underpinnings that IE7 provides.</p><p>I would have thought that the goal is to make event.preventDefault() work.</p><p>No?</p><p>If not, why have the function at all?  </p><p>If the goal is to make it work, then shouldn't the IE7 implementation of event.preventDefault() actually PREVENT the default behavior, by "canceling" the key event?  It already has code to do just that!  That code ought to work.  But, for keys, apparently, it does not work.  Based on numerous web postings, the undocumented hack for IE7 is to assign a different value into event.keyCode when the goal is to supress the default action of a given key.</p><p>Anway, jQuery already has code that's trying to implement preventDefault() for IE.  Whoever wrote it presumably had some goal as to what he or she was trying to normalize to.  If their goal was to support capturing a given key event, then the current jQuery implementation (via originalEvent.cancelBubble and originalEvent.returnValue) is inadequate on IE7.</p><p>Perhaps rather than asking me to define how event.preventDefault() should work on key events in IE7, you could tell me what you think preventDefault() ought to do on IE7?  </p><pre class="wiki">
// jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding
// http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html
jQuery.Event.prototype = {
	preventDefault: function() {
		this.isDefaultPrevented = returnTrue;

		var e = this.originalEvent;
		if ( !e ) {
			return;
		}

		// if preventDefault exists run it on the original event
		if ( e.preventDefault ) {
			e.preventDefault();

		// otherwise set the returnValue property of the original event to false '''(IE)'''
		} else {
			e.returnValue = false;
		}
	},
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 10:36PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>For the 99% case, you're right. the <code>.preventDefault()</code> is preventing the default action. But you've found a corner case where it doesn't, and the workaround of clobbering the <code>event.keycode</code> is probably not preventing the default action--it is most likely confusing the code that it bubbles to in a way that stops it from recognizing the keystroke. </p><p>It would be a bunch of extra code and complexity for us to implement inside jQuery--is this an F5 (or is it just F5), is this IE7 (or is it just IE7), did you <code>preventDefault</code>, should we clobber the <code>keycode</code>, will later handlers added by other code (potentially plugins or other code you didn't write) see the correct keystroke or the clobbered one? Coding and testing all of that takes time, and adds bytes that every jQuery user must download regardless of whether they need them or not. </p><p>Again, this is for a rare corner case on an old browser with declining market share that nobody has reported before. We're a bunch of volunteers and this is called bug triage precisely because some bugs cannot be effectively treated given our time and other tradeoffs so we have to leave them unfixed.</p><p>I'd think that for your case it's pretty straightforward to know you want to detect an F5 and stop it from refreshing, so a workaround should work pretty well. In the context of your application it is possible for you to know by context whether the workaround has negative implications. That isn't something easy for us to generalize in a way that avoids other negative consequences that would engender more bug reports.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 23, 2012 11:43PM UTC by <span class="author">jeffr@livedata.com</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I completely understand your reasoning and agree with you.  I have no idea how or why the keycode hack works, and definitely wouldn't want to waste anyone's time potentially gumming up lots of straightforward code paths in order to solve this corner case!  </p><p>This discussion helped me understand the context and challenges of an ambitious project like yours much better, and I hope you didn't mind me pressing the point in order to achieve a better understanding.</p><p>jQuery is an excellent tool and I really appreciate how well it accomplishes its mission.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
