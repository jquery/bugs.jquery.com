<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#1209 (Form Value Function) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/1208/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/1210/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#1209</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">enhancement</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened May 18, 2007 07:27PM UTC</p>
      
        <p>Closed May 11, 2008 11:38PM UTC</p>
      
      
        <p>Last modified May 13, 2008 05:31PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Form Value Function</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        bgoldman
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.2.4">1.2.4</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>core</td>
      
        <th>Version:</th>
      
      <td>1.1.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p> This function sets or gets the value of a form variable <strong>as a form would interpret it.</strong>  This function is useful for jQuery core because everybody uses forms.  This function makes it very easy to get and set form values without having to use fancy selectors.  It's basically shorthand for a bunch of alternatives.</p><p>1) For selects and options: formVal() would return the currently selected value. formVal('foo') would select the option with that value.</p><p>2) For input text fields: formVal() would return the current value. formVal('foo') would set the value to foo.</p><p>3) For textareas: formVal() would return text(). formVal('foo') would set the text() to foo.</p><p>4) For checkboxes: formVal() would return the first matched checked value. formVal('foo') would check the boxes with value foo.</p><p>5) For radios: formVal() would return the checked value. formVal('foo') would check the radio with value foo.</p><pre class="wiki">
    //gets the value of the first matched form field, or sets the value of all the matched form fields
    $.fn.formVal = function(newVal) {
        var self = this.get(0);
    
        if(newVal == null) {
            if(this.size() &lt; 1) return '';
            else if(self.type == 'text') return self.value;
            else if(self.tagName == 'TEXTAREA') return this.text();
            else if(self.type == 'checkbox' || self.type == 'radio') return this.filter('input:checked').val();
            else if(self.tagName == 'OPTION') return this.parent().formVal();
            else if(self.tagName == 'SELECT') {
                var match = this.find('option:selected').eq(0);
                return (match.get(0).value != null) ? match.val() : match.text();
            }
            else return '';
        }
        
        if(self.type == 'text') this.val(newVal);
        else if(self.tagName == 'TEXTAREA') this.text(newVal);
        else if(self.type == 'checkbox' || self.type == 'radio') {
            var matches =  this.filter('[@value=' + newVal + ']');
            if(matches.size() &lt; 1) return this;
            if(self.type == 'radio') this.filter(':checked').removeAttr('checked');
            matches.attr('checked', 'checked');
        }
        else if(self.tagName == 'OPTION') this.parent().formVal(newVal);
        else if(self.tagName == 'SELECT') {
            var match = this.find('option[@value=' + newVal + ']');

            if(match.size() &lt; 1) {
                if(newVal == '') match = this.find('option:empty');
                else match = this.find('option').contains(newVal);
            }

            if(match.size() &lt; 1) return this;
            this.find('option:selected').removeAttr('selected');
            match.eq(0).attr('selected', 'selected');
        }
        
        return this;
    };
</pre></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 18, 2007 08:04PM UTC by <span class="author">bgoldman</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I found a bug with selects and options.  Here is the fixed code:</p><pre class="wiki">
    //gets the value of the first matched form field, or sets the value of all the matched form fields
    $.fn.formVal = function(newVal) {
        var self = this.get(0);
    
        if(newVal == null) {
            if(this.size() &lt; 1) return '';
            else if(self.type == 'text') return self.value;
            else if(self.tagName == 'TEXTAREA') return this.text();
            else if(self.type == 'checkbox' || self.type == 'radio') return this.filter('input:checked').val();
            else if(self.tagName == 'OPTION') return this.parent().formVal();
            else if(self.tagName == 'SELECT') {
                var match = this.find('option:selected').eq(0);
                return (match.is('[@value]')) ? match.val() : match.text();
            }
            else return '';
        }
        
        if(self.type == 'text') this.val(newVal);
        else if(self.tagName == 'TEXTAREA') this.text(newVal);
        else if(self.type == 'checkbox' || self.type == 'radio') {
            var matches =  this.filter('[@value=' + newVal + ']');
            if(matches.size() &lt; 1) return this;
            if(self.type == 'radio') this.filter(':checked').removeAttr('checked');
            matches.attr('checked', 'checked');
        }
        else if(self.tagName == 'OPTION') this.parent().formVal(newVal);
        else if(self.tagName == 'SELECT') {
            var match = this.filter('option[@value=' + newVal + ']');

            if(match.size() &lt; 1) {
                if(newVal == '') match = this.find('option:empty');
                else match = this.find('option').contains(newVal);
            }

            if(match.size() &lt; 1) return this;
            this.find('option:selected').removeAttr('selected');
            match.eq(0).attr('selected', 'selected');
        }
        
        return this;
    };
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 19, 2007 12:41AM UTC by <span class="author">bgoldman</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixed another bug... here we go:</p><pre class="wiki">
    //gets the value of the first matched form field, or sets the value of all the matched form fields
    $.fn.formVal = function(newVal) {
        var self = this.get(0);
    
        if(newVal == null) {
            if(this.size() &lt; 1) return '';
            else if(self.type == 'text') return self.value;
            else if(self.tagName == 'TEXTAREA') return this.text();
            else if(self.type == 'checkbox' || self.type == 'radio') return this.filter('input:checked').val() || '';
            else if(self.tagName == 'OPTION') return this.parent().formVal();
            else if(self.tagName == 'SELECT') {
                var match = this.find('option:selected').eq(0);
                return (match.is('[@value]')) ? match.val() : match.text();
            }
            else return '';
        }

        if(self.type == 'text') this.val(newVal);
        else if(self.tagName == 'TEXTAREA') this.text(newVal);
        else if(self.type == 'checkbox' || self.type == 'radio') {
            this.filter(':checked').removeAttr('checked');
            this.filter('[@value=' + newVal + ']').attr('checked', 'checked');
        }
        else if(self.tagName == 'OPTION') this.parent().formVal(newVal);
        else if(self.tagName == 'SELECT') {
            var match = this.filter('option[@value=' + newVal + ']');

            if(match.size() &lt; 1) {
                if(newVal == '') match = this.find('option:empty');
                else match = this.find('option').filter(function() {
                    return ($(this).text() == newVal);
                });
            }

            if(match.size() &lt; 1) return this;
            this.find('option:selected').removeAttr('selected');
            match.attr('selected', 'selected');
        }
        
        return this;
    };
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 20, 2007 09:08PM UTC by <span class="author">mrclay</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>For SELECT elements, formVal() returns the wrong value when the selected OPTION is marked up with value="": Since "" is falsy, match.is('[@value]') is false and match.text() is incorrectly returned. </p><p>Pseudocode for a fix:</p><pre class="wiki">
if (option.value) { // non-empty string
    return option.value;
}
if (! option.outerHTML) { // definitely not IE, so trust value
    return '';
}
if (/* option.outerHTML has 'value=""' in attributes */) { // likely painful regex
    return '';
} else {
    return option.text;
}
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 21, 2007 07:25PM UTC by <span class="author">mrclay</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Here's a fix for setting/getting SELECT when options might have empty value attributes, but non-empty text. Is there a unit test somewhere for this plugin?</p><pre class="wiki">
//gets the value of the first matched form field, or sets
//the value of all the matched form fields
$.fn.formVal = function(newVal) {
    var self = this.get(0);
    var optVal = function(opt) {
        if(opt.value) return opt.value; // non-empty string, use it
        if(!opt.outerHTML) return ''; // not IE, we should trust value
        // @todo: more rigorous regex to assert value="" in attributes, not text
        return /\\svalue=""(?:\\s|&gt;)/.test(opt.outerHTML) ? '' : opt.text;
    };
    if(newVal == null) {
        if(this.size() &lt; 1) return '';
        if(self.type == 'text') return self.value;
        if(self.tagName == 'TEXTAREA') return this.text();
        if(self.type == 'checkbox' || self.type == 'radio')
          return this.filter('input:checked').val() || '';
        if(self.tagName == 'OPTION') return this.parent().formVal();
        // if a SELECT with no selection, fallthrough to return ''
        // or should re return null?
        if(self.tagName == 'SELECT' && self.selectedIndex &gt;= 0)
          return optVal(self.options[self.selectedIndex]);
        return '';
    }
    if(self.type == 'text') this.val(newVal);
    else if(self.tagName == 'TEXTAREA') this.text(newVal);
    else if(self.type == 'checkbox' || self.type == 'radio') {
        this.filter(':checked').removeAttr('checked');
        this.filter('[@value=' + newVal + ']').attr('checked', 'checked');
    }
    else if(self.tagName == 'OPTION') this.parent().formVal(newVal);
    else if(self.tagName == 'SELECT') {
        // search for matching value
        for (var i=0, l=self.options.length; i&lt;l; ++i) {
            if(newVal == optVal(self.options[i])) {
                self.selectedIndex = i;
                break;
            }
        }
    }
    return this;
};
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 11, 2008 11:38PM UTC by <span class="author">flesler</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I think jQuery.form can do all or most of this. If anything is missing you can propose it for this plugin.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 13, 2008 05:31PM UTC by <span class="author">flesler</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.1.3</span> → <span class="change-field-new">1.2.4</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
