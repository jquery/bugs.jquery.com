<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#4996 (getBoundingClientRect causes &amp;#39;Unspecified Error&amp;#39; in IE after ajax) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/4995/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/4997/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#4996</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened July 31, 2009 04:41PM UTC</p>
      
        <p>Closed September 28, 2010 09:57PM UTC</p>
      
      
        <p>Last modified March 13, 2012 05:50PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">getBoundingClientRect causes &#39;Unspecified Error&#39; in IE after ajax</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        chack7
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.4.3">1.4.3</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>offset</td>
      
        <th>Version:</th>
      
      <td>1.4.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>In jQuery-1.3.2</p><p>Line 4176</p><p>Only occurs in IE</p><p>Reproduce details: Telerik <a href="/wiki/RadTreeView">RadTreeView</a> recursed to set tree elements with droppable</p><p>Html text elements set to draggable</p><p>Works fine until the <a href="/wiki/RadTreeView">RadTreeView</a> is updated with a ajax postback at which point, any attempt to drag and element results in 'Unspecified Error'</p><p>This does not occur in <a href="/wiki/FireFox">FireFox</a></p><p>Workaround: added the following modification</p><p>if ( document.documentElement["getBoundingClientRect"] )</p><p>	jQuery.fn.offset = function() {</p><p>		if ( !this[0] ) return { top: 0, left: 0 };</p><p>		if ( this[0] === this[0].ownerDocument.body ) return jQuery.offset.bodyOffset( this[0] );</p><p>		<em> 2009-07-31: Added try catch to resolve error IE caused by ajax update of controls</em></p><p>		var box;</p><p>		try {</p><p>			box  = this[0].getBoundingClientRect();</p><p>		}</p><p>		catch(ex) {</p><p>			box = {top : 0, left: 0, right: 0, bottom: 0}</p><p>		}</p><p>		///////////////////////////////////////////////////////////////////////////////////</p><p>		var doc = this[0].ownerDocument, body = doc.body, docElem = doc.documentElement,</p><p>			clientTop = docElem.clientTop || body.clientTop || 0, clientLeft = docElem.clientLeft || body.clientLeft || 0,</p><p>			top  = box.top  + (self.pageYOffset || jQuery.boxModel && docElem.scrollTop  || body.scrollTop ) - clientTop,</p><p>			left = box.left + (self.pageXOffset || jQuery.boxModel && docElem.scrollLeft || body.scrollLeft) - clientLeft;</p><p>		return { top: top, left: left };</p><p>	};</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (1)</summary>

  <ul class="ticket-attachments">
    
      <li>
        <a href="/attachment/ticket/4996/offset.zip/index.html">offset.zip</a> (46.2 KB) - added by reiern70
        <strong>March 24, 2010 10:51AM UTC</strong>.<br>
        <p>reproduces the problem with AJAX updates and offset function</p>
      </li>
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (14)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 02, 2009 08:07PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>need:</th>
                  <td>
                    
                      <span class="change-field-old">Review</span> → <span class="change-field-new">Test Case</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Can you provide a test case? Catching and ignoring an error often isn't the right solution. </p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 17, 2009 02:02AM UTC by <span class="author">ckosti</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I have run into the same problem. This will cause the error to occur:</p><p>$(document.createElement('div')).offset();</p><p>An odd case, I know, but I ran into a situation where JQuery UI is holding onto references to elements that had been replaced by AJAX calls, and then calling offset() on those elements, even though they are no longer in the document tree.</p><p>IE throws an error in this case when getBoundingClientRect() is called. Other browsers handle it by returning a rectangle with all zero values.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 10, 2010 06:21AM UTC by <span class="author">reiern70</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi,</p><p>I think I'm experiencing the same problem with jquery 1.4.2. After refreshing some part of the page with AJAX (using Wicket) all my draggable-dropables stop to work because of an error appearing on line </p><p>5942 var box = elem.getBoundingClientRect()</p><p>I think it is exactly the same problem... Right now I could provide a testcase consisting of a very simple Wicket application and instructions on how to reproduce the error. Would that be enough for the developers to try to fix this problem?</p><p>Regards,</p><p>Ernesto</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 24, 2010 10:56AM UTC by <span class="author">reiern70</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi,</p><p>I just attached a test case showing this behavior (it does exactly what ckosti mentioned $(document.createElement('div')).offset();). I discover this problem while using drag-drop in combination with AJAX and went along and created </p><p><a href="http://dev.jqueryui.com/ticket/5374" class="ext-link"><span class="icon"></span>http://dev.jqueryui.com/ticket/5374</a></p><p>But this is clearly the same problem. This has been opened for many months already and is a clear HUGE limitation in using jQuery in combination with other AJAX frameworks. Any chance to get this fixed soon?</p><p>Best,</p><p>Ernesto</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 07, 2010 03:27PM UTC by <span class="author">RSparkyC</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I am having the same problem.  Because we are doing ajax postbacks, we are getting the 'Unspecified Error' in IE when clicking on a draggable object.  Is there still no fix for this other than manually editing the jQuery js files?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 27, 2010 01:59AM UTC by <span class="author">Rasetti</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm having the same problem, using 1.4.2.</p><p>Any chances of fixing it for the next release?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 05, 2010 11:49AM UTC by <span class="author">pete</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You can work around this without modifying the jQuery source.</p><p>1. before the ajax request is made, invoke the destroy method on draggable objects: </p><pre class="wiki"> $("#drag").draggable("destroy"); </pre><p>2. after the ajax response, setup your draggable elements again.</p><p></p><hr><p></p><p>If using ASP.NET Ajax, you can invoke the destroy method like so:</p><pre class="wiki">
Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(function(){
   $("#drag").draggable("destroy");
});
</pre><p>To set the draggable again, you can use <strong>.add_endRequest</strong> in the same manner as .add_beginRequest, or create a function called <strong>pageLoad</strong> in the global namespace that does the work. ASP.NET Ajax will invoke a pageLoad function (if it exists) any time a postback is made (real or ajax).</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 20, 2010 01:06PM UTC by <span class="author">jharte</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi,</p><p>I've hit this issue as well, while using the qTip plug-in: <a href="http://craigsworks.com/projects/qtip/" class="ext-link"><span class="icon"></span>http://craigsworks.com/projects/qtip/</a></p><p>I'm using a couple of ASP.NET AJAX UpdatePanels on my page and I get the error after either of them is updated.</p><p>I've modified my copy of jQuery to handle the error as described in the initial bug report by chack7, but would really like to see this fixed in an official jQuery release.</p><p>Thanks!</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 09, 2010 08:42PM UTC by <span class="author">thephatmann</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I am seeing this issue with the <a href="/wiki/DevBridge">DevBridge</a> autocomplete plugin under IE7/8. The patch to offset( ) posted above fixes the issue, so I recommend that the patch get incorporated into the next jQuery release.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 13, 2010 02:23PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">dimensions</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The test case boils down to this:</p><pre class="wiki">
  $(document.createElement('div')).offset();
</pre><p>It's asking for the offset of an element that is not connected to the document! That's not a reasonable thing to do. Is there some information that .offset() could return for this case instead of an error that wouldn't simply mask the problem? </p><p>If you're experiencing this problem, use the IE8 debugger to break on the error, then look at the stack trace to determine what code is asking for the offset of an element that is not connected to the document. Then report a bug against that code.</p><p>If there are cases where jQuery core itself causes the problem, please attach them to this ticket.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 16, 2010 08:39PM UTC by <span class="author">slenzi</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I was experiencing the same issue and found a thread on stackoverflow where someone posted a solution.</p><p><a href="http://stackoverflow.com/questions/371468/looking-for-a-workaround-for-ie-6-7-unspecified-error-bug-when-accessing-offset" class="ext-link"><span class="icon"></span>http://stackoverflow.com/questions/371468/looking-for-a-workaround-for-ie-6-7-unspecified-error-bug-when-accessing-offset</a></p><p>In jquery-1.4.2.js file on line 5493 there is the following line:</p><pre class="wiki">
var box = elem.getBoundingClientRect()
</pre><p>if you replace that with this is works:</p><pre class="wiki">
var box = null;
try { 
   box = elem.getBoundingClientRect();
} catch(e) {
   box = { top : elem.offsetTop, left : elem.offsetLeft }
};
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 16, 2010 08:44PM UTC by <span class="author">slenzi</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I meant line 5943 in jquery-1.4.2.js!!</p><p>Replying to [comment:11 slenzi]:</p><blockquote> I was experiencing the same issue and found a thread on stackoverflow where someone posted a solution.  <a href="http://stackoverflow.com/questions/371468/looking-for-a-workaround-for-ie-6-7-unspecified-error-bug-when-accessing-offset" class="ext-link"><span class="icon"></span>http://stackoverflow.com/questions/371468/looking-for-a-workaround-for-ie-6-7-unspecified-error-bug-when-accessing-offset</a>  In jquery-1.4.2.js file on line 5493 there is the following line:   <pre class="wiki">
&gt; var box = elem.getBoundingClientRect()
&gt; </pre>  if you replace that with this is works:  <pre class="wiki">
&gt; var box = null;
&gt; try { 
&gt;    box = elem.getBoundingClientRect();
&gt; } catch(e) {
&gt;    box = { top : elem.offsetTop, left : elem.offsetLeft }
&gt; };
&gt; </pre></blockquote>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 03, 2010 07:50PM UTC by <span class="author">thephatmann</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This bug has a test case and a suggested fix, so it should be incorporated into the trunk. But the bug has no owner, since the former owner left. How do we resolve this?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:14">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 28, 2010 09:57PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:14">comment:14</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">dimensions</span> → <span class="change-field-new">offset</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.4</span> → <span class="change-field-new">1.4.3</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.3.2</span> → <span class="change-field-new">1.4.2</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixed <a href="http://github.com/jquery/jquery/commit/cf672a2e7a886cac5ae62f6772c6b4b43b19a2fc" class="ext-link"><span class="icon"></span>http://github.com/jquery/jquery/commit/cf672a2e7a886cac5ae62f6772c6b4b43b19a2fc</a></p>
            </div>
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
