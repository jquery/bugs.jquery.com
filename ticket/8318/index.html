<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#8318 (Incorrect headers are sent when performing cross-domain ajax request) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/8317/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/8319/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#8318</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(invalid)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened February 18, 2011 03:47PM UTC</p>
      
        <p>Closed February 19, 2011 06:06PM UTC</p>
      
      
        <p>Last modified April 18, 2011 03:45PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Incorrect headers are sent when performing cross-domain ajax request</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        anonymous
      </td>
      <th>Owned by:</th>
      <td>anonymous</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next">1.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.5</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>When I perform cross-domain ajax request:</p><pre class="wiki">
$.ajax({
    url:'http://fbtest/cross.php',
    crossDomain:true,
    data:{
        a:5
    },
    type:'POST',
    dataType:'json',
    success:function(data, textStatus, jqXHR) {
        alert(data.name);
    }
});
</pre><p>Script that sends response is:</p><pre class="wiki">
&lt;?php
header('Access-Control-Allow-Origin: *');
echo file_get_contents('cross.json');
</pre><p>cross.json is:</p><pre class="wiki">
{
    "name": "konst"
}
</pre><p>When I do GET request, everything is fine. When I do POST, request is not sent and in chrome it says:</p><pre class="wiki">
XMLHttpRequest cannot load http://fbtest/cross.php. Request header field x-requested-with is not allowed by Access-Control-Allow-Headers.
</pre><p>I've tracked down the code and found these lines in development version of jquery 1.5:</p><pre class="wiki">
// Requested-With header
// Not set for crossDomain requests with no content
// (see why at http://trac.dojotoolkit.org/ticket/9486)
// Won't change header if already provided
if ( !( s.crossDomain && !s.hasContent ) && !headers["x-requested-with"] ) {
	headers[ "x-requested-with" ] = "XMLHttpRequest";
}
</pre><p>So you've got it right - you should NOT set x-requested-with header for cross-domain request. However you do. When I comment out this logic, it works fine. I think there is something wrong with checks you do.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (9)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 18, 2011 05:12PM UTC by <span class="author">jitter</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">When I perform cross-domain ajax request:&#92;
$.ajax({&#92;
	url:&#39;http://fbtest/cross.php&#39;,&#92;
	crossDomain:true,&#92;
	data:{&#92;
		a:5&#92;
	},&#92;
	type:&#39;POST&#39;,&#92;
	dataType:&#39;json&#39;,&#92;
	success:function(data, textStatus, jqXHR) {&#92;
		alert(data.name);&#92;
	}&#92;
});&#92;
Script that sends response is:&#92;
&lt;?php&#92;
header(&#39;Access-Control-Allow-Origin: *&#39;);&#92;
echo file_get_contents(&#39;cross.json&#39;);&#92;
&#92;
cross.json is:&#92;
{&#92;
    &quot;name&quot;: &quot;konst&quot;&#92;
}&#92;
&#92;
When I do GET request, everything is fine. When I do POST, request is not sent and in chrome it says:&#92;
XMLHttpRequest cannot load http://fbtest/cross.php. Request header field x-requested-with is not allowed by Access-Control-Allow-Headers.&#92;
&#92;
I&#39;ve tracked down the code and found these lines in development version of jquery 1.5:&#92;
// Requested-With header&#92;
// Not set for crossDomain requests with no content&#92;
// (see why at http://trac.dojotoolkit.org/ticket/9486)&#92;
// Won&#39;t change header if already provided&#92;
if ( !( s.crossDomain &amp;&amp; !s.hasContent ) &amp;&amp; !headers[&quot;x-requested-with&quot;] ) {&#92;
	headers[ &quot;x-requested-with&quot; ] = &quot;XMLHttpRequest&quot;;&#92;
}&#92;
&#92;
So you&#39;ve got it right - you should NOT set x-requested-with header for cross-domain request. However you do. When I comment out this logic, it works fine. I think there is something wrong with checks you do.</span> → <span class="change-field-new">When I perform cross-domain ajax request:&#92;
{{{&#92;
$.ajax({&#92;
    url:&#39;http://fbtest/cross.php&#39;,&#92;
    crossDomain:true,&#92;
    data:{&#92;
        a:5&#92;
    },&#92;
    type:&#39;POST&#39;,&#92;
    dataType:&#39;json&#39;,&#92;
    success:function(data, textStatus, jqXHR) {&#92;
        alert(data.name);&#92;
    }&#92;
});&#92;
}}}&#92;
Script that sends response is:&#92;
{{{&#92;
&lt;?php&#92;
header(&#39;Access-Control-Allow-Origin: *&#39;);&#92;
echo file_get_contents(&#39;cross.json&#39;);&#92;
}}}&#92;
cross.json is:&#92;
{{{&#92;
{&#92;
    &quot;name&quot;: &quot;konst&quot;&#92;
}&#92;
}}}&#92;
When I do GET request, everything is fine. When I do POST, request is not sent and in chrome it says:&#92;
{{{&#92;
XMLHttpRequest cannot load http://fbtest/cross.php. Request header field x-requested-with is not allowed by Access-Control-Allow-Headers.&#92;
}}}&#92;
&#92;
I&#39;ve tracked down the code and found these lines in development version of jquery 1.5:&#92;
{{{&#92;
// Requested-With header&#92;
// Not set for crossDomain requests with no content&#92;
// (see why at http://trac.dojotoolkit.org/ticket/9486)&#92;
// Won&#39;t change header if already provided&#92;
if ( !( s.crossDomain &amp;&amp; !s.hasContent ) &amp;&amp; !headers[&quot;x-requested-with&quot;] ) {&#92;
	headers[ &quot;x-requested-with&quot; ] = &quot;XMLHttpRequest&quot;;&#92;
}&#92;
}}}&#92;
So you&#39;ve got it right - you should NOT set x-requested-with header for cross-domain request. However you do. When I comment out this logic, it works fine. I think there is something wrong with checks you do.</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 18, 2011 05:30PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Requests with a body will issue a preflight request. Your script doesn't set Access-Control-Allow-Headers for the preflight request. So "you've got it right" - you SHOULD set Access-Control-Allow-Headers properly during the preflight request: <a href="http://www.w3.org/TR/cors/#access-control-allow-headers-response-he" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/cors/#access-control-allow-headers-response-he</a></p><p>X-Requested-With is important for services that want to allow/disallow specific requesters and you should be using Access-Control-Allow-Headers since you'll need it whenever you have to pass custom headers.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 18, 2011 07:10PM UTC by <span class="author">jitter</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ anonymous</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 19, 2011 04:19PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Google took me here ... jauborg: Can you specify HOW you'd "set Access-Control-Allow-Headers properly during the preflight request" ? I've tried a number of header combinations in my serverside PHP script, and still can't get things working properly. What's the correct way of doing this type of request? We're not the only ones with this problem it seems:</p><p><a href="http://forum.jquery.com/topic/jquery-1-5-latest-chrome-post-ajax-request-xmlhttprequest-cannot-load-url-request-header-field-x-requested-with-is-not-allowed-by-access-control-allow-headers" class="ext-link"><span class="icon"></span>http://forum.jquery.com/topic/jquery-1-5-latest-chrome-post-ajax-request-xmlhttprequest-cannot-load-url-request-header-field-x-requested-with-is-not-allowed-by-access-control-allow-headers</a></p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 19, 2011 04:27PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok, got it ... You need to add &lt;?php header("Access-Control-Allow-Headers:  x-requested-with"); ?&gt;</p><p>To your serverside script. Sorry about my whinging ;)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 19, 2011 06:06PM UTC by <span class="author">snover</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 15, 2011 03:49PM UTC by <span class="author">matas</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm sorry to intervene, but no way this ticket is closed/invalid: </p><p>The jxhr should never set any X- header for the crossDomain requests, it says it in the script comment too:</p><p>					if ( !s.crossDomain && !headers["X-Requested-With"] ) {</p><p>						headers[ "X-Requested-With" ] = "XMLHttpRequest";</p><p>					}</p><p>the bug is somewhere in the setting of the crossDomain when it's a 'post' request. it could also have implications in other code areas where the s.crossDomain property is evaluated.</p><p>here's another test script:</p><p><a href="http://jsfiddle.net/RjVVg/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/RjVVg/</a></p><p>please change it back to open!</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 18, 2011 03:29PM UTC by <span class="author">Agos</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'll second the request for reopening. A server-side workaround is not enough, think of third-party APIs.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 18, 2011 03:45PM UTC by <span class="author">Agos</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Whoops sorry, seems like jQuery 1.5.2 fixes this.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
