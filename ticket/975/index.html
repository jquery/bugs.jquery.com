<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#975 ($().html().evalScripts() Eval&amp;#39;s Scripts Twice in Firefox) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/974/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/977/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#975</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened February 18, 2007 04:21AM UTC</p>
      
        <p>Closed July 20, 2007 10:01PM UTC</p>
      
      
        <p>Last modified March 15, 2012 04:28PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">$().html().evalScripts() Eval&#39;s Scripts Twice in Firefox</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        aaron.heimlich@gmail
      </td>
      <th>Owned by:</th>
      <td>john</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.1.4">1.1.4</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.1.3</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>script html double eval execute</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Test page: <a href="http://aheimlich.freepgs.com/tests/jquery/ajax-load/" class="ext-link"><span class="icon"></span>http://aheimlich.freepgs.com/tests/jquery/ajax-load/</a></p><p>Firefox seems to eval scripts as soon as they are appended to the DOM tree, so my patch (see below) simply prevents <code>evalScripts()</code> from running in Firefox, since the way it is most often used ends up making it redundant. Example:</p><pre class="wiki">
jQuery("#target").html('&lt;script type="text/javascript"&gt;alert("I come from the land of Ajax");&lt;/script&gt;').evalScripts()
</pre><p>would cause "I come from the land of Ajax" to get alerted twice in Firefox, but only once in every other browser (and in those browsers, it would be the <code>evalScripts()</code> call that would cause it). Code similar to this is used to inject remote HTML (which may contain &lt;script&gt; tags) into a web page.</p><p>I have only seen this occur in Firefox (though I have heard, but not been able to verify, one report of it happening in IE 6 and 7), so you should continue to use <code>evalScripts()</code> as normal, as it is still necessary in other browsers.</p><h2>Patch</h2><pre class="wiki">
Index: ajax.js
===================================================================
--- ajax.js	(revision 1365)
+++ ajax.js	(working copy)
@@ -121,6 +121,11 @@
 	 * @cat Ajax
 	 */
 	evalScripts: function() {
+		if(jQuery.browser.mozilla) {
+			// Firefox eval's scripts when they get added to the DOM tree,
+			// so this isn't necessary here
+			return this;
+		}
 		return this.find("script").each(function(){
 			if ( this.src )
 				jQuery.getScript( this.src );
</pre><p>It should be trivial to include a switch for situations where you would ''want'' to run <code>evalScripts()</code> in Firefox (though I can't think of any, since, if I understand correctly, the reason <code>evalScripts()</code> exists is to evaluate the contents of &lt;script&gt; tags that have been recently added to the DOM, since most browsers won't do this on their own).</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (1)</summary>

  <ul class="ticket-attachments">
    
      <li>
        <a href="/attachment/ticket/975/eval-scripts-firefox.patch/index.html">eval-scripts-firefox.patch</a> (0.5 KB) - added by aaron.heimlich@gmail
        <strong>February 18, 2007 04:56AM UTC</strong>.<br>
        
      </li>
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (10)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 19, 2007 04:34AM UTC by <span class="author">brandon</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">ajax</span> → <span class="change-field-new">core</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-old">script load double eval execute</span> → <span class="change-field-new">script html double eval execute</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">major</span> → <span class="change-field-new">minor</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>summary:</th>
                  <td>
                    
                      <span class="change-field-old">$().load() Eval&#39;s Scripts Twice in Firefox</span> → <span class="change-field-new">$().html().evalScripts() Eval&#39;s Scripts Twice in Firefox</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The .load() method has been fixed in <a href="http://dev.jquery.com/changeset/1364/" class="ext-link"><span class="icon"></span>Rev 1364</a>.</p><p>However if you call .html().evalScripts() this bug still exists.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 22, 2007 04:45PM UTC by <span class="author">aheimlich</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 brandon]:</p><p>  However if you call .html().evalScripts() this bug still exists.</p><p>Which is what originally prompted me to post this issue (and what my patch is designed to fix)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 24, 2007 04:16AM UTC by <span class="author">brandon</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It seems a more appropriate fix would be to strip the scripts from the HTML before inserting it into the DOM. Then evalScripts should really just be a string method that evals scripts from a string of HTML. This would mean moving the current evalScripts method to the the jQuery namespace from the jQuery.fn namespace (much like jQuery.trim).</p><p>Also, is Firefox right to automatically run the scripts when appended to the DOM? Should the methods like .html(), .apppend(), etc automatically run the scripts for other browsers as well? It seems like this is usually the desired behavior. The clean method would then need to be able to strip and execute script nodes and script tags in an HTML string. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 08, 2007 06:35PM UTC by <span class="author">brandon</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is related to <a href="/ticket/858">#858</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 24, 2007 06:17PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-new">→ 1.1.3</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>need:</th>
                  <td>
                    
                      <span class="change-field-new">→ Test Case</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">minor</span> → <span class="change-field-new">major</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 25, 2007 10:45AM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Added test in [1582]. Passes only in Opera.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 25, 2007 10:46AM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>need:</th>
                  <td>
                    
                      <span class="change-field-old">Test Case</span> → <span class="change-field-new">Patch</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 04, 2007 06:04PM UTC by <span class="author">brandags</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm not sure if this is the same bug or if it's just related, but there is definitely an issue with Firefox loading javascript twice for scripts that are loaded via ajax.</p><p>In the example below, a section of the page is loaded dynamically via ajax, and it contains the following:</p><p>&lt;input type="button" id="btntest" value="Test" /&gt;</p><p>&lt;script type="text/javascript"&gt;</p><p>$(document).ready(function(){</p><p>        $('#btntest').click(function(){</p><p>                alert("HEY");</p><p>        });</p><p>});</p><p>&lt;/script&gt;</p><p>When you click the button, "HEY" is alerted twice! This seems to</p><p>happen whether or not it is enclosed within document.ready. If you put</p><p>the javascript inline then it only does it once, but I'd rather not do</p><p>that. The event should not be firing twice in Firefox. It works fine in IE7.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 20, 2007 09:48PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">core</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">Test page: http://aheimlich.freepgs.com/tests/jquery/ajax-load/&#92;
&#92;
Firefox seems to eval scripts as soon as they are appended to the DOM tree, so my patch (see below) simply prevents `evalScripts()` from running in Firefox, since the way it is most often used ends up making it redundant. Example:&#92;
&#92;
{{{&#92;
jQuery(&quot;#target&quot;).html(&#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;I come from the land of Ajax&quot;);&lt;/script&gt;&#39;).evalScripts()&#92;
}}}&#92;
&#92;
would cause &quot;I come from the land of Ajax&quot; to get alerted twice in Firefox, but only once in every other browser (and in those browsers, it would be the `evalScripts()` call that would cause it). Code similar to this is used to inject remote HTML (which may contain &lt;script&gt; tags) into a web page.&#92;
&#92;
I have only seen this occur in Firefox (though I have heard, but not been able to verify, one report of it happening in IE 6 and 7), so you should continue to use `evalScripts()` as normal, as it is still necessary in other browsers.&#92;
&#92;
== Patch ==&#92;
{{{&#92;
Index: ajax.js&#92;
===================================================================&#92;
--- ajax.js	(revision 1365)&#92;
+++ ajax.js	(working copy)&#92;
@@ -121,6 +121,11 @@&#92;
 	 * @cat Ajax&#92;
 	 */&#92;
 	evalScripts: function() {&#92;
+		if(jQuery.browser.mozilla) {&#92;
+			// Firefox eval&#39;s scripts when they get added to the DOM tree,&#92;
+			// so this isn&#39;t necessary here&#92;
+			return this;&#92;
+		}&#92;
 		return this.find(&quot;script&quot;).each(function(){&#92;
 			if ( this.src )&#92;
 				jQuery.getScript( this.src );&#92;
}}}&#92;
&#92;
It should be trivial to include a switch for situations where you would &#39;&#39;want&#39;&#39; to run `evalScripts()` in Firefox (though I can&#39;t think of any, since, if I understand correctly, the reason `evalScripts()` exists is to evaluate the contents of &lt;script&gt; tags that have been recently added to the DOM, since most browsers won&#39;t do this on their own).</span> → <span class="change-field-new">Test page: http://aheimlich.freepgs.com/tests/jquery/ajax-load/&#92;
&#92;
Firefox seems to eval scripts as soon as they are appended to the DOM tree, so my patch (see below) simply prevents `evalScripts()` from running in Firefox, since the way it is most often used ends up making it redundant. Example:&#92;
&#92;
{{{&#92;
jQuery(&quot;#target&quot;).html(&#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;I come from the land of Ajax&quot;);&lt;/script&gt;&#39;).evalScripts()&#92;
}}}&#92;
&#92;
would cause &quot;I come from the land of Ajax&quot; to get alerted twice in Firefox, but only once in every other browser (and in those browsers, it would be the `evalScripts()` call that would cause it). Code similar to this is used to inject remote HTML (which may contain &lt;script&gt; tags) into a web page.&#92;
&#92;
I have only seen this occur in Firefox (though I have heard, but not been able to verify, one report of it happening in IE 6 and 7), so you should continue to use `evalScripts()` as normal, as it is still necessary in other browsers.&#92;
&#92;
== Patch ==&#92;
{{{&#92;
Index: ajax.js&#92;
===================================================================&#92;
--- ajax.js	(revision 1365)&#92;
+++ ajax.js	(working copy)&#92;
@@ -121,6 +121,11 @@&#92;
 	 * @cat Ajax&#92;
 	 */&#92;
 	evalScripts: function() {&#92;
+		if(jQuery.browser.mozilla) {&#92;
+			// Firefox eval&#39;s scripts when they get added to the DOM tree,&#92;
+			// so this isn&#39;t necessary here&#92;
+			return this;&#92;
+		}&#92;
 		return this.find(&quot;script&quot;).each(function(){&#92;
 			if ( this.src )&#92;
 				jQuery.getScript( this.src );&#92;
}}}&#92;
&#92;
It should be trivial to include a switch for situations where you would &#39;&#39;want&#39;&#39; to run `evalScripts()` in Firefox (though I can&#39;t think of any, since, if I understand correctly, the reason `evalScripts()` exists is to evaluate the contents of &lt;script&gt; tags that have been recently added to the DOM, since most browsers won&#39;t do this on their own).</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.1.3</span> → <span class="change-field-new">1.1.4</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ john</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.1</span> → <span class="change-field-new">1.1.3</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 20, 2007 10:01PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixed in SVN rev [2428].</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
