<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#2655 (jQuery.event module optimizations) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/2654/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/2656/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#2655</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">enhancement</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened April 05, 2008 05:28AM UTC</p>
      
        <p>Closed April 22, 2008 05:27AM UTC</p>
      
      
        <p>Last modified April 22, 2008 02:29PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">jQuery.event module optimizations</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        flesler
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.2.4">1.2.4</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>event</td>
      
        <th>Version:</th>
      
      <td>1.2.3</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>event handle fix</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Hi, here are a few modifications, that I think they will improve perfomance, and some make the code shorter, I'll explain them in case the reason for any change is not clear.</p><p>jQuery.event.fix</p> <ul><li>The same event object, can't be fixed more than once (it happens when triggering.</li></ul><p>jQuery.event.handle</p> <ul><li>Removed the {} fallback when calling jQuery.event.fix, event.type is used in the next line, so IF you were to fall on the last case, the next line would alert 'event.type is not defined' seems like the 3rd case can't be reached.</li> <li>Avoided the need for Array.prototype.slice.call( arguments, 1 ) and args.unshift().</li> <li>Replaced args[0] for event when looping through the handlers, those were 2 array lookups per handler.</li> <li>Same for the namespace (parts).</li> <li>Simplified the val/ret part, ret is not needed and the code is now shorter.</li> <li>The forced call to preventDefault and stopPropagation is only checked and done once, after the loop.</li></ul></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (3)</summary>

  <ul class="ticket-attachments">
    
      <li>
        <a href="/attachment/ticket/2655/handle-fix.2.diff/index.html">handle-fix.2.diff</a> (3.1 KB) - added by flesler
        <strong>April 05, 2008 06:15AM UTC</strong>.<br>
        </li></ul><p>2nd version</p>
      
    
      <li>
        <a href="/attachment/ticket/2655/handle-fix.3.diff/index.html">handle-fix.3.diff</a> (3.2 KB) - added by flesler
        <strong>April 10, 2008 02:40PM UTC</strong>.<br>
        <p>3rd Version</p>
      </li>
    
      <li>
        <a href="/attachment/ticket/2655/handle-fix.diff/index.html">handle-fix.diff</a> (2.1 KB) - added by flesler
        <strong>April 05, 2008 05:28AM UTC</strong>.<br>
        <p>Changes</p>
      </li>
    
  
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 05, 2008 06:17AM UTC by <span class="author">flesler</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Merged the first diff with 2 more changes.</p><p>jQuery.event.handle</p><ul><li>the copy of data and the handler to the event object, is only done if the handler is really going to be called, small change but it's correct and %0.001 faster.</li><li>I saw the new function that's gets bound and saved into $.data('handle'), I simplified it a bit, it was kinda redundant :)</li></ul>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 10, 2008 02:43PM UTC by <span class="author">flesler</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The third version adds 2 things.</p><ul><li>It caches the originally: !parts[0] && !event.exclusive in a variable. Those were 2 boolean casting and 2 boolean checks on each iteration.</li></ul><ul><li>Instead of calling twice jQuery.data, an empty hash if used. It shorter and should be faster.</li></ul>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 10, 2008 02:48PM UTC by <span class="author">flesler</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>ugh.. forget the typos in the previous post.. I'm still sleepy.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 22, 2008 02:32AM UTC by <span class="author">brandon</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">Hi, here are a few modifications, that I think they will improve perfomance, and some make the code shorter, I&#39;ll explain them in case the reason for any change is not clear.&#92;
&#92;
jQuery.event.fix&#92;
* The same event object, can&#39;t be fixed more than once (it happens when triggering.&#92;
&#92;
jQuery.event.handle&#92;
* Removed the {} fallback when calling jQuery.event.fix, event.type is used in the next line, so IF you were to fall on the last case, the next line would alert &#39;event.type is not defined&#39; seems like the 3rd case can&#39;t be reached.&#92;
* Avoided the need for Array.prototype.slice.call( arguments, 1 ) and args.unshift().&#92;
* Replaced args[0] for event when looping through the handlers, those were 2 array lookups per handler.&#92;
* Same for the namespace (parts).&#92;
* Simplified the val/ret part, ret is not needed and the code is now shorter.&#92;
* The forced call to preventDefault and stopPropagation is only checked and done once, after the loop.</span> → <span class="change-field-new">Hi, here are a few modifications, that I think they will improve perfomance, and some make the code shorter, I&#39;ll explain them in case the reason for any change is not clear.&#92;
&#92;
jQuery.event.fix&#92;
 * The same event object, can&#39;t be fixed more than once (it happens when triggering.&#92;
&#92;
jQuery.event.handle&#92;
 * Removed the {} fallback when calling jQuery.event.fix, event.type is used in the next line, so IF you were to fall on the last case, the next line would alert &#39;event.type is not defined&#39; seems like the 3rd case can&#39;t be reached.&#92;
 * Avoided the need for Array.prototype.slice.call( arguments, 1 ) and args.unshift().&#92;
 * Replaced args[0] for event when looping through the handlers, those were 2 array lookups per handler.&#92;
 * Same for the namespace (parts).&#92;
 * Simplified the val/ret part, ret is not needed and the code is now shorter.&#92;
 * The forced call to preventDefault and stopPropagation is only checked and done once, after the loop.</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 22, 2008 05:27AM UTC by <span class="author">brandon</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Mostly applied in Rev [5276].</p><p>Just a couple of things different:</p> <ul><li>The val returned from a handler can be a non-boolean value.</li> <li>An event must always be "fixed" in IE due to its global event object... at least that seems to be the case with my testing so far. I'm holding off on optimizing the event.fix method for lots more testing.</li></ul><p>BTW ... I was seeing over 200% increase in performance of jQuery.event.trigger in IE.</p><p><a href="http://brandonaaron.net/jquery/tickets/2655/baseline-performance-test.html" class="ext-link"><span class="icon"></span>http://brandonaaron.net/jquery/tickets/2655/baseline-performance-test.html</a></p><p><a href="http://brandonaaron.net/jquery/tickets/2655/patched-performance-test.html" class="ext-link"><span class="icon"></span>http://brandonaaron.net/jquery/tickets/2655/patched-performance-test.html</a></p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 22, 2008 02:29PM UTC by <span class="author">flesler</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> The val returned from a handler can be a non-boolean value</blockquote><p>It says: </p><pre class="wiki">
val = handler.apply( this, arguments ) '''!== false '''&& val;
</pre><p>That means that, unless it is explicitely false, it remains true.</p><p>The val is not returned so it doesn't matter what it is, as long as it's not false...</p><p>I might not be getting it, can you clarify me please ?</p><blockquote> An event must always be "fixed" in IE</blockquote><p>You can set event._fixed_ = null in IE, along with the event.target and the others.</p><blockquote> BTW ... I was seeing over 200% increase in performance of jQuery.event.trigger in IE. </blockquote><p>You mean with a change(s) I proposed ?</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
