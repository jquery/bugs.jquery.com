<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13506 (stopPropagation behaviour when trigger is passed an event.) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13505/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13507/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#13506</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened February 24, 2013 12:35PM UTC</p>
      
        <p>Closed February 25, 2013 01:28PM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">stopPropagation behaviour when trigger is passed an event.</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        Danack@basereality.com
      </td>
      <th>Owned by:</th>
      <td>Danack@basereality.com</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.9.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>The stopPropagation behaviour is very unexpected when passed an event object. I believe it works incorrectly whereas the behaviour is correct when passed an event name.</p><p>Pass an event Name - works as expected</p><p></p><hr><p></p><pre class="wiki">
function someFunction(event){
    event.stopPropagation();
}

$('#object1).on('customEvent', someFunction).addClass('customEventClass');
$('#object2).on('customEvent', someFunction).addClass('customEventClass');

$(".customEventClass").trigger('customEvent');


</pre><p>As expected both object1 and object2 will have the function 'someFunction' called, but the event won't bubble up the DOM tree.</p><p>Pass an event Name - very unexpected behaviour</p><p></p><hr><p></p><pre class="wiki">

function someFunction(event){
    event.stopPropagation();
}

$('#object1).on('customEvent', someFunction).addClass('customEventClass');
$('#object2).on('customEvent', someFunction).addClass('customEventClass');


var event = jQuery.Event('customEvent');
$(".customEventClass").trigger(event);

</pre><p>Only one of the objects will receive the event. I expected both of them to receive the event.</p><p>The problem appears to appear to lie in the code</p><p>"while ( (cur = eventPath[i++]) && !event.isPropagationStopped() ) {"</p><p>in the function "trigger: function( event, data, elem, onlyHandlers )"</p><p>The event object is passed in to this function and so on to the callback function for the first object, which calls event.stopPropagation() on the object, which sets the prototypes function "isPropagationStopped" to "returnTrue"</p><p>On the second (and subsequent) calls to "trigger: function( event, data, elem, onlyHandlers )" the event object still has "isPropagationStopped" set to "returnTrue" and so it doesn't actually get triggered for the rest of the elements.</p><p>I think the stopPropagation behaviour should be the same for when trigger is passed an event object, as when it is passed a string.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (5)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 24, 2013 12:44PM UTC by <span class="author">Danack@basereality.com</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I added a fiddle:</p><p><a href="http://jsfiddle.net/Danack/q3MJM/2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/Danack/q3MJM/2/</a></p><p>I believe that the event callback should be called 4 times, but it is only called 3.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 24, 2013 09:08PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ Danack@basereality.com</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Your example is basically equivalent to this:</p><pre class="wiki">
var event = jQuery.Event('customEvent');
$.each($(".customEventClass"), function() {
   $(this).trigger(event);
});
</pre><p>See the problem? The <code>event</code> is reused and propagation is stopped in the first iteration. I don't think it would appropriate for us to change the event between calls since other things may have changed. For example, why use the <code>Event</code> in the first place? Are you passing additional data in the object that you need to preserve across triggering for each element?</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 25, 2013 01:28AM UTC by <span class="author">Danack@basereality.com</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> See the problem?</blockquote><p>Yes, I can see the problem, and if that was what I'd written, I'd consider it to be a bug in my code. But that bit of functionality is in the jQuery library so I consider it a bug in that instead.</p><blockquote> For example, why use the Event in the first place?</blockquote><p>I was planning on extending the event object to be able to pass data back from the code that got triggered to the code that triggered the event like this:</p><p><a href="http://jsfiddle.net/Danack/gWLy2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/Danack/gWLy2/</a></p><p>I realise that there are other ways of achieving this, and yes I can see that trying to fix this might be incredibly messy as (as you say), you can't tell what else may have been modified in the event object. However:</p><p>1) stopPropagation is only meant to stop the event from bubbling up the DOM. It's not meant to stop the event from occurring at all on subsequent $.each() loops.</p><p>2) It really is a gotcha, as the behaviour is completely different from passing in a string event name, even though reading the documentation they should have the same behaviour.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 25, 2013 04:13AM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is absolutely working as intended. If you provide an event object, then the purpose is to have control over the event and be able to inspect it after triggering. This is a fairly advanced use case and it's important to understand what you're doing if you're going to use it. There is nothing that should change here.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 25, 2013 01:28PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In the example it seems that you're stopping propagation to avoid any bubbling, which indicates to me this is being used like a custom pub/sub and not for DOM-like events. You *can* do that but remember the model has been set up primarily to accommodate DOM conventions and not a general pub/sub message system.</p><p>Just have your own loop that <code>triggerHandler</code>s each element; create a fresh <code>Event</code> for each call and inspect it afterwards. Alternatively you could set a data property on the element that was a function and call that; it would be less overhead.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
