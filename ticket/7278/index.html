<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#7278 (Error preventing delayed special events in IE) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/7277/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/7279/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#7278</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(cantfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened October 22, 2010 03:59AM UTC</p>
      
        <p>Closed April 01, 2011 12:29AM UTC</p>
      
      
        <p>Last modified March 14, 2012 02:33AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Error preventing delayed special events in IE</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        scottgonzalez
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        high
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/"></a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>event</td>
      
        <th>Version:</th>
      
      <td>1.4.3</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>special events</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>We ran into a problem using the hoverintent special event with accordions in jQuery UI. I've narrowed down the problem to calling event.preventDefault() when the special event is triggered through a timeout from a native event. For some reason IE won't let you set event.returnValue inside event.preventDefault().</p><p>The only solution I've been able to find is wrapping the <code>e.returnValue = false</code> in a try/catch inside jQuery.Event.prototype.preventDefault().</p><p>full demo: <a href="http://jqueryui.com/demos/accordion/hoverintent.html" class="ext-link"><span class="icon"></span>http://jqueryui.com/demos/accordion/hoverintent.html</a> </p><p>reduced test case: <a href="http://jsfiddle.net/GSD84/1/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/GSD84/1/</a></p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (11)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 22, 2010 04:00AM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">We ran into a problem using the hoverintent special event with accordions in jQuery UI. I&#39;ve narrowed down the problem to calling event.preventDefault() when the special event is triggered through a timeout from a native event. For some reason IE won&#39;t let you set event.returnValue inside event.preventDefault().&#92;
&#92;
The only solution I&#39;ve been able to find is wrapping the `e.returnValue = false` in a try/catch inside jQuery.Event.prototype.preventDefault().&#92;
&#92;
full demo: http://jqueryui.com/demos/accordion/hoverintent.html&#92;
reduced test case: http://jsfiddle.net/GSD84/1/</span> → <span class="change-field-new">We ran into a problem using the hoverintent special event with accordions in jQuery UI. I&#39;ve narrowed down the problem to calling event.preventDefault() when the special event is triggered through a timeout from a native event. For some reason IE won&#39;t let you set event.returnValue inside event.preventDefault().&#92;
&#92;
The only solution I&#39;ve been able to find is wrapping the `e.returnValue = false` in a try/catch inside jQuery.Event.prototype.preventDefault().&#92;
&#92;
full demo: http://jqueryui.com/demos/accordion/hoverintent.html[[BR]]&#92;
reduced test case: http://jsfiddle.net/GSD84/1/</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 22, 2010 04:00AM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">event</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">We ran into a problem using the hoverintent special event with accordions in jQuery UI. I&#39;ve narrowed down the problem to calling event.preventDefault() when the special event is triggered through a timeout from a native event. For some reason IE won&#39;t let you set event.returnValue inside event.preventDefault().&#92;
&#92;
The only solution I&#39;ve been able to find is wrapping the `e.returnValue = false` in a try/catch inside jQuery.Event.prototype.preventDefault().&#92;
&#92;
full demo: http://jqueryui.com/demos/accordion/hoverintent.html[[BR]]&#92;
reduced test case: http://jsfiddle.net/GSD84/1/</span> → <span class="change-field-new">We ran into a problem using the hoverintent special event with accordions in jQuery UI. I&#39;ve narrowed down the problem to calling event.preventDefault() when the special event is triggered through a timeout from a native event. For some reason IE won&#39;t let you set event.returnValue inside event.preventDefault().&#92;
&#92;
The only solution I&#39;ve been able to find is wrapping the `e.returnValue = false` in a try/catch inside jQuery.Event.prototype.preventDefault().&#92;
&#92;
full demo: http://jqueryui.com/demos/accordion/hoverintent.html [[BR]]&#92;
reduced test case: http://jsfiddle.net/GSD84/1/</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 23, 2010 09:25PM UTC by <span class="author">SlexAxton</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-new">→ special events</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">high</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 02, 2010 05:59PM UTC by <span class="author">ravasthi@mac.com</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm not sure if this will be at all helpful, but in my own experience with this issue, it's not just <code>e.returnValue</code> but ''all'' members of the event object that are inaccessible, including <code>e.cancelBubble</code> from <code>event.stopPropagation()</code>.</p><p>In my case, I'm using the <a href="http://flowplayer.org/tools/tooltip/index.html" class="ext-link"><span class="icon"></span>jQuery Tools tooltip plugin</a> with a delay. When handling a custom event that fires just before the tooltip is shown, I do a test that would allow me to prevent the appearance of the tooltip by returning <code>false</code> from the handler. When I do that, and consequently <code>jQuery.handle()</code> calls <code>event.preventDefault()</code> and <code>event.stopPropagation()</code>, both of them have trouble accessing the original event object.</p><p>I used the IE script debugger, and at that point in time, every property of the event object is marked as <code>Member not found</code>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 01, 2011 12:29AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ cantfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I think the problem is that in IE the global <code>event</code> object only exists during the time the event is being delivered. That is some special IE host object and not a standard Javascript object that can be held in a closure. When the code is called in a timeout the event delivery is done so <code>event</code> object has dissolved and is no longer accessible.</p><p>See the comments here:</p><p><a href="http://msdn.microsoft.com/en-us/library/ms535863%28v=vs.85%29.aspx" class="ext-link"><span class="icon"></span>http://msdn.microsoft.com/en-us/library/ms535863%28v=vs.85%29.aspx</a></p><p>As a workaround you could try <code>newEvent = document.createEventObject(event)</code> or perhaps <code>newEvent = $.extend({}, event)</code> if you need an honest JS object. In any case I think this is a limitation of IE that we can't circumvent so you'll need to fake something up.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2012 02:05PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Could we potentially set a flag that causes <code>preventDefault()</code> and other methods that we normalize to not bubble to the original event if the're called asynchronously?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2012 04:01PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Since we're feature-detecting the presence of the preventDefault method, it should be okay to do this in your handle hook:</p><p><a href="http://jsfiddle.net/GSD84/11/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/GSD84/11/</a></p><p>You could copy over any properties you need of course. To prevent clobbering subsequent attached handlers you'll need to restore event.type and event.originalEvent before returning though, which means you also need to make a copy of the event that setTimeout can use when it fires.</p><p>There's no way to handle this generically in core without knowing you intend to hold onto the event object past the normal delivery of the event. Are there are lots of cases like this, or is hoverIntent the main usage?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2012 04:24PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm sure there are other use cases. Off the top of my head, the only other event I can think of is taphold. jQuery Mobile implemented taphold, but they don't pass any of the original event information along. If they did, it would have to come from an event that is already gone, such as mousedown or touchstart. I'll try to put together a patch with the generic solution I was thinking of, though it may not be worth landing even if I can implement it.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2012 06:34PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok, so we can't implement the fix I was thinking of, but wrapping <code>event.returnValue = false;</code> in a try/catch fixes the problem.  This seems really painful for developers to work around inside their own special events, especially when supporting multiple versions of jQuery.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2012 06:54PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It's going to crash on any direct/indirect use of the now-defunct originalEvent inside the user's handler, not just that one. Technically the code isn't doing what it intended on any platform, since a delayed <code>.preventDefault()</code> or <code>.stopPropagation()</code> won't have any effect. By making the handler async it's become impossible to manipulate the event state since the event is technically over. It's just a question of whether that happens silently or with an error.</p><p>If you don't need originalEvent in the timeout can you try setting it to an empty Javascript object instead of leaving the global IE event object in the closure? That seemed to work in the fiddle I posted. Something like that should apply to all versions of jQuery so you have backcompat, which the try/catch won't do.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2012 07:08PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I suppose that's fine. You win this round :-)</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
