<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#14449 (Allow done/fail callbacks to return deferreds) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/14448/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/14450/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#14449</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">feature</span>
      <span class="ticket-resolution">(notabug)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened October 15, 2013 02:06PM UTC</p>
      
        <p>Closed March 01, 2014 10:24PM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Allow done/fail callbacks to return deferreds</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        iliakan@gmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        high
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>deferred</td>
      
        <th>Version:</th>
      
      <td>2.1.0-beta1</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>2.1-discuss</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>As discussed with @dmethvin on jQuery Russia, callbacks assigned to deferreds using .done/fail should be allowed to return deferreds which effectively fit in to the async chain.</p><p>Just like .then was fixed and now is the alias to .pipe, .done/fail should be fixed also.</p><p>It is not going to break anything, because it does not change existing behavior, it only adds correct logic for returning deferreds which follows existing practices and promises implementations (I'm familiar with 5 of them in JS), even if it's non-standard.</p><p>Methods done/fail should be thought of as "short aliases to then", that's how people see them and that's the most useful.</p><p>I planned to submit a pull request, but @dmethvin suggested to post the ticket for discussion first before. Please tell what you think.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 15, 2013 02:29PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">deferred</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-new">→ 2.1-discuss</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">high</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 15, 2013 02:38PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><code>done</code> and <code>fail</code> are here to add callbacks without the overhead of <code>then</code>. If you make them chain like <code>then</code> there's simply no way to attach handlers without creating a new Deferred internally which costs time and memory.</p><p>Now, from an API point of view, a chaining <code>done</code> doesn't make sense since you can just use <code>then</code> with a single argument. As for a chaining <code>fail</code>, it would need to be a new method and I'm not sure of the actual value of that.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 16, 2013 05:46AM UTC by <span class="author">iliakan</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi jaubourg,</p><p>First, performance is rarely an issue when adding a callback to deferred. </p><p>Also, current jQuery deferreds implementation is not performance oriented. I guess so, because there are faster ways to implement deferreds. There are faster deferred libraries. You could make the new .done/.fail/.then work faster, but I guess you just concentrated on 'good enough' performance and the nice jQuery-style API. </p><p>Second, about the API. Julian, I wrote a letter to you about 3 years ago when deferreds were introduced to jQuery explaining the same issue about .done/.fail/.then. </p><p>You declined it then, but through years jQuery gradually follows this vector. You introduced .pipe as another method which does .then right. Now .then switched to .pipe as it should have been from the beginning. Please continue going the right way and finally fix .done/.fail.</p><p>I know you've done most of the current implementation. Please try to look at this API from a standpoint of an outsider. A person who looks at your API from the outside.</p><p>Methods .done/.fail really look like aliases to .then. </p><p>P.S. Imho the most comfortable implementation is when the value returned by the callback from .done(callback) is passed to the next .done(callback) unless it's an error, then it goes to .fail. And if it's a deferred, then wait for it. In this case  there is a clear difference in chaining order between assigning callbacks one-after-another wiith .done(c1).fail(c2) or using .then(c1, c2) to set them together.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 16, 2013 01:45PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> First, performance is rarely an issue when adding a callback to deferred.  Also, current jQuery deferreds implementation is not performance oriented. I guess so, because there are faster ways to implement deferreds. There are faster deferred libraries. You could make the new .done/.fail/.then work faster, but I guess you just concentrated on 'good enough' performance and the nice jQuery-style API.</blockquote><p>Performance is rarely an issue unless you have to create a new Deferred each time you add a *single* callback. Hence why <code>done</code>, <code>fail</code> and <code>progress</code> do not create a new Deferred internally.</p><p>jQuery Deferred have detachable methods. This makes the cost of creating a Deferred much heavier than prototype-based implementations (both in time AND memory). This is not something you can optimize away once you made all the methods attaching callbacks create a Deferred internally.</p><blockquote> Second, about the API. Julian, I wrote a letter to you about 3 years ago when deferreds were introduced to jQuery explaining the same issue about .done/.fail/.then.  You declined it then, but through years jQuery gradually follows this vector. You introduced .pipe as another method which does .then right. Now .then switched to .pipe as it should have been from the beginning.</blockquote><p>This is not at all what the conversation was about. In particular, there was no mention of <code>done</code> and <code>fail</code>. The only proposal there was for <code>then</code>/<code>pipe</code> to handle exceptions like "In *all* implementation of deferreds" (quote).</p><p>I still stand by the arguments I gave you back then (and to which you promised an answer that never came). Pre-emptively catching exceptions and promoting them as rejections ignores the very meachanics of a promise and creates all sorts of problems which, to this day, the promise comunity hasn't found any decent solution to (though some like to claim otherwise).</p><p>Back to the conversation at hand, if you remember, we had just introduced <code>pipe</code> as the async chaining utility because some in the project didn't want to break backward compatibility with the simplest <code>then</code> we had at the time. We eventually decided to break backward compatibility by aliasing <code>pipe</code> as <code>then</code>. The deciding point was that there was still a means to attach callbacks without the cost of creating a Deferred, namely <code>done</code>, <code>fail</code> and <code>progress</code>.</p><p>Not to mention that <code>done</code>, <code>fail</code> and <code>progress</code> allow for multiple callbacks to be added at once which an async chaining implementation would prohibit.</p><blockquote> Please continue going the right way and finally fix .done/.fail.</blockquote><p>There is no notion of right or wrong here. Different elements in an API will have different use. <code>done</code>, <code>fail</code> and <code>progress</code> are just as "right" as <code>then</code>. The original Promise/A proposal had an optional method to attach callbacks without async-chaining.</p><p>To make it clear, what happened previously was that the non async-chaining <code>then</code> was pointless because we alreay had <code>done</code>, <code>fail</code> and <code>progress</code>. If we make them async-chaining now, then we need the old <code>then</code> back in some form which is a step backward.</p><p>Also, let me re-iterate that an async-chaining <code>done</code> would be pretty useless since you can just call <code>then</code> with a single argument already.</p><blockquote> I know you've done most of the current implementation. Please try to look at this API from a standpoint of an outsider. A person who looks at your API from the outside. Methods .done/.fail really look like aliases to .then.</blockquote><p>I don't think outsiders are that confused. In 3 years, I don't remember having been asked about the behaviour of <code>done</code>, <code>fail</code> and <code>progress</code> in relation to async chaining. I suppose most developers are quite happy to have a simple and efficient means to attach callbacks to the promise. In comparison, I've been literally harassed on twitter, on irc, by emails and at conferences about not being Promise/A(+) compliant since day one :P</p><p>Interestingly, I think people understand <code>done</code>/<code>fail</code> all right but are more confused about <code>then</code> itself.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 16, 2013 03:13PM UTC by <span class="author">iliakan</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi Julian,</p><p>Indeed, prototype-based implementations are the fastest. I didn't look deeply into how to optimize current API yet, but surely if one wants to concentrate on performance then using prototypes is the best way to go. </p><p>Right now deferreds in jQuery are clearly not performance oriented. That's because people usually do not make long callback chains on frontend. At least not using .done. With .pipe(.then) - yes, sometimes, but deferred performance is not the bottleneck in this case. </p><p>About the API. In current API the result of callback is discarded. I would suggest passing this result to the next callback. That may break some code which relied on the old behavior of discarding the value, but in the next version which is called 2.1, that is probably doable. Or, of course, you may want to introduce another method for that.</p><p>When done/fail callbacks do not return anything, things will keep working as now, so they are still very simple. But now with the ability to pass results down the chain, much more powerful.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 01, 2014 10:24PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Per recent team discussions, we're moving towards Promise and I don't think we want to introduce other changes here. The current behavior is well established.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
