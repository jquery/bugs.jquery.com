<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#204 ([PATCH] IE Opacity issues resolved) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/203/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/205/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#204</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened September 18, 2006 03:31AM UTC</p>
      
        <p>Closed January 12, 2012 03:19PM UTC</p>
      
      
        <p>Last modified March 15, 2012 09:45AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">[PATCH] IE Opacity issues resolved</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        brandon.aaron@gmail.
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/"></a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>attributes</td>
      
        <th class="missing">Version:</th>
      
      <td></td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I was having all sort of problems with opacity in IE and spent quite a while tracking all the issues down. I wish I could attach the diff but last time I tried attaching a file it errored out. I would love to throw some tests together but I'm already running behind on my project as it is. Hopefully someone else can help out with some testing. One thing to note is that I imagine this will break with other filters applied other than just an alpha filter but so would the current limited support for opacity.</p><pre class="wiki">

Index: jquery/src/jquery/jquery.js
===================================================================
--- jquery/src/jquery/jquery.js (revision 312)
+++ jquery/src/jquery/jquery.js (working copy)
@@ -1425,14 +1425,20 @@
      });
 
      return p == "height" ? oHeight : oWidth;
-   } else if ( p == "opacity" && jQuery.browser.msie )
-     return parseFloat( jQuery.curCSS(e,"filter").replace(/[^0-9.]/,"") ) || 1;
+   }
 
    return jQuery.curCSS( e, p );
  },
 
  curCSS: function(elem, prop, force) {
    var ret;
+   
+   if (prop == 'opacity' && jQuery.browser.msie) {
+     if (elem.style['filter'])
+       return parseFloat(elem.style['filter'].match(/d+/)[0])/100;
+     else
+       return 1;
+   }
 
    if (!force && elem.style[prop]) {
 
@@ -1798,6 +1804,16 @@
      disabled: "disabled",
      checked: "checked"
    };
+   
+   // normalize opacity for ie ... elem is actually elem.style
+   if (name == 'opacity' && jQuery.browser.msie && value != undefined) {
+     return elem['filter'] = 'alpha(opacity=' + value * 100 + ')';
+   } else if (name == 'opacity' && jQuery.browser.msie) {
+     if (elem['filter'])
+       return parseFloat(elem['filter'].match(/d+/)[0])/100;
+     else
+       return 1;
+   }
 
    if ( fix[name] ) {
      if ( value != undefined ) elem[fix[name]] = value;


</pre></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (7)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 18, 2006 04:09AM UTC by <span class="author">brandon.aaro</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><strong>UPDATE</strong></p><p>On images that have patches of solid black in IE some of the black pixels would switch to white while the alpha filter was applied. To fix this I just removed the alpha filter if the value is 1. This also affects fx.js. Here is the updated diff ... still wish I could just attach it instead of pasting inline.</p><pre class="wiki">

Index: jquery/src/jquery/jquery.js
===================================================================
--- jquery/src/jquery/jquery.js (revision 312)
+++ jquery/src/jquery/jquery.js (working copy)
@@ -1425,14 +1425,20 @@
      });
 
      return p == "height" ? oHeight : oWidth;
-   } else if ( p == "opacity" && jQuery.browser.msie )
-     return parseFloat( jQuery.curCSS(e,"filter").replace(/[^0-9.]/,"") ) || 1;
+   }
 
    return jQuery.curCSS( e, p );
  },
 
  curCSS: function(elem, prop, force) {
    var ret;
+   
+   if (prop == 'opacity' && jQuery.browser.msie) {
+     if (elem.style['filter'])
+       return parseFloat(elem.style['filter'].match(/d+/)[0])/100;
+     else
+       return 1;
+   }
 
    if (!force && elem.style[prop]) {
 
@@ -1798,6 +1804,19 @@
      disabled: "disabled",
      checked: "checked"
    };
+   
+   // normalize opacity for ie ... elem is actually elem.style
+   if (name == 'opacity' && jQuery.browser.msie && value != undefined) {
+     if (value == 1)
+       return elem['filter'] = '';
+     else
+       return elem['filter'] = 'alpha(opacity=' + value * 100 + ')';
+   } else if (name == 'opacity' && jQuery.browser.msie) {
+     if (elem['filter'])
+       return parseFloat(elem['filter'].match(/d+/)[0])/100;
+     else
+       return 1;
+   }
 
    if ( fix[name] ) {
      if ( value != undefined ) elem[fix[name]] = value;
Index: jquery/src/fx/fx.js
===================================================================
--- jquery/src/fx/fx.js (revision 312)
+++ jquery/src/fx/fx.js (working copy)
@@ -451,7 +451,10 @@
      if ( prop == "opacity" ) {
        if (jQuery.browser.mozilla && z.now == 1) z.now = 0.9999;
        if (window.ActiveXObject)
-         y.filter = "alpha(opacity=" + z.now*100 + ")";
+         if (z.now == 1)
+           y.filter = "";
+         else
+           y.filter = "alpha(opacity=" + z.now*100 + ")";
        else
          y.opacity = z.now;
 


</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 18, 2006 09:49AM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In case you have more updates to this: You could upload your patch somewhere and post a link to it, that would be ok.</p><p>Any hints at how a test for this could be written would be very useful.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 06, 2006 01:01PM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Added fix to SVN, still needs proper testing</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 06, 2006 03:11PM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">blocker</span> → <span class="change-field-new">critical</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">closed</span> → <span class="change-field-new">reopened</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Not yet working, Brandon tries to figure it out.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 07, 2006 03:32AM UTC by <span class="author">brandon.aaro</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-new">→ brandon.aaron@gmail.com</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>This should take care of everything.</p><p>New patch on revision 404: <a href="http://brandonaaron.net/jquery/opacity/opacity.diff" class="ext-link"><span class="icon"></span>http://brandonaaron.net/jquery/opacity/opacity.diff</a></p><p>Example/Test: <a href="http://brandonaaron.net/jquery/opacity/opacity.html" class="ext-link"><span class="icon"></span>http://brandonaaron.net/jquery/opacity/opacity.html</a></p><p>Broken, unpatched revision 396: <a href="http://brandonaaron.net/jquery/opacity/opacity.broken.html" class="ext-link"><span class="icon"></span>http://brandonaaron.net/jquery/opacity/opacity.broken.html</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 07, 2006 08:08PM UTC by <span class="author">brandon</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">reopened</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixed in SVN Rev: 407.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 12, 2012 03:19PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">goodwork</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-new">→ attributes</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">I was having all sort of problems with opacity in IE and spent quite a while tracking all the issues down. I wish I could attach the diff but last time I tried attaching a file it errored out. I would love to throw some tests together but I&#39;m already running behind on my project as it is. Hopefully someone else can help out with some testing. One thing to note is that I imagine this will break with other filters applied other than just an alpha filter but so would the current limited support for opacity.&#92;
&#92;
{{{&#92;
&#92;
Index: jquery/src/jquery/jquery.js&#92;
===================================================================&#92;
--- jquery/src/jquery/jquery.js (revision 312)&#92;
+++ jquery/src/jquery/jquery.js (working copy)&#92;
@@ -1425,14 +1425,20 @@&#92;
      });&#92;
 &#92;
      return p == &quot;height&quot; ? oHeight : oWidth;&#92;
-   } else if ( p == &quot;opacity&quot; &amp;&amp; jQuery.browser.msie )&#92;
-     return parseFloat( jQuery.curCSS(e,&quot;filter&quot;).replace(/[^0-9.]/,&quot;&quot;) ) || 1;&#92;
+   }&#92;
 &#92;
    return jQuery.curCSS( e, p );&#92;
  },&#92;
 &#92;
  curCSS: function(elem, prop, force) {&#92;
    var ret;&#92;
+   &#92;
+   if (prop == &#39;opacity&#39; &amp;&amp; jQuery.browser.msie) {&#92;
+     if (elem.style[&#39;filter&#39;])&#92;
+       return parseFloat(elem.style[&#39;filter&#39;].match(/d+/)[0])/100;&#92;
+     else&#92;
+       return 1;&#92;
+   }&#92;
 &#92;
    if (!force &amp;&amp; elem.style[prop]) {&#92;
 &#92;
@@ -1798,6 +1804,16 @@&#92;
      disabled: &quot;disabled&quot;,&#92;
      checked: &quot;checked&quot;&#92;
    };&#92;
+   &#92;
+   // normalize opacity for ie ... elem is actually elem.style&#92;
+   if (name == &#39;opacity&#39; &amp;&amp; jQuery.browser.msie &amp;&amp; value != undefined) {&#92;
+     return elem[&#39;filter&#39;] = &#39;alpha(opacity=&#39; + value * 100 + &#39;)&#39;;&#92;
+   } else if (name == &#39;opacity&#39; &amp;&amp; jQuery.browser.msie) {&#92;
+     if (elem[&#39;filter&#39;])&#92;
+       return parseFloat(elem[&#39;filter&#39;].match(/d+/)[0])/100;&#92;
+     else&#92;
+       return 1;&#92;
+   }&#92;
 &#92;
    if ( fix[name] ) {&#92;
      if ( value != undefined ) elem[fix[name]] = value;&#92;
&#92;
&#92;
}}}</span> → <span class="change-field-new">I was having all sort of problems with opacity in IE and spent quite a while tracking all the issues down. I wish I could attach the diff but last time I tried attaching a file it errored out. I would love to throw some tests together but I&#39;m already running behind on my project as it is. Hopefully someone else can help out with some testing. One thing to note is that I imagine this will break with other filters applied other than just an alpha filter but so would the current limited support for opacity.&#92;
&#92;
{{{&#92;
&#92;
Index: jquery/src/jquery/jquery.js&#92;
===================================================================&#92;
--- jquery/src/jquery/jquery.js (revision 312)&#92;
+++ jquery/src/jquery/jquery.js (working copy)&#92;
@@ -1425,14 +1425,20 @@&#92;
      });&#92;
 &#92;
      return p == &quot;height&quot; ? oHeight : oWidth;&#92;
-   } else if ( p == &quot;opacity&quot; &amp;&amp; jQuery.browser.msie )&#92;
-     return parseFloat( jQuery.curCSS(e,&quot;filter&quot;).replace(/[^0-9.]/,&quot;&quot;) ) || 1;&#92;
+   }&#92;
 &#92;
    return jQuery.curCSS( e, p );&#92;
  },&#92;
 &#92;
  curCSS: function(elem, prop, force) {&#92;
    var ret;&#92;
+   &#92;
+   if (prop == &#39;opacity&#39; &amp;&amp; jQuery.browser.msie) {&#92;
+     if (elem.style[&#39;filter&#39;])&#92;
+       return parseFloat(elem.style[&#39;filter&#39;].match(/d+/)[0])/100;&#92;
+     else&#92;
+       return 1;&#92;
+   }&#92;
 &#92;
    if (!force &amp;&amp; elem.style[prop]) {&#92;
 &#92;
@@ -1798,6 +1804,16 @@&#92;
      disabled: &quot;disabled&quot;,&#92;
      checked: &quot;checked&quot;&#92;
    };&#92;
+   &#92;
+   // normalize opacity for ie ... elem is actually elem.style&#92;
+   if (name == &#39;opacity&#39; &amp;&amp; jQuery.browser.msie &amp;&amp; value != undefined) {&#92;
+     return elem[&#39;filter&#39;] = &#39;alpha(opacity=&#39; + value * 100 + &#39;)&#39;;&#92;
+   } else if (name == &#39;opacity&#39; &amp;&amp; jQuery.browser.msie) {&#92;
+     if (elem[&#39;filter&#39;])&#92;
+       return parseFloat(elem[&#39;filter&#39;].match(/d+/)[0])/100;&#92;
+     else&#92;
+       return 1;&#92;
+   }&#92;
 &#92;
    if ( fix[name] ) {&#92;
      if ( value != undefined ) elem[fix[name]] = value;&#92;
&#92;
&#92;
}}}</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-new">→ undecided</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">reopened</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>type:</th>
                  <td>
                    
                      <span class="change-field-new">→ bug</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>This ticket somehow reopened itself while I was deleting spam comments.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
