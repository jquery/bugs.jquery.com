<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#746 ($(&amp;quot;#feeds&amp;quot;).load(&amp;quot;feeds.html&amp;quot;)  Call to .evalScripts() fails in Internet Explorer) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/745/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/747/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#746</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened December 29, 2006 08:00PM UTC</p>
      
        <p>Closed January 01, 2007 03:27PM UTC</p>
      
      
        <p>Last modified March 15, 2012 12:33PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">$(&quot;#feeds&quot;).load(&quot;feeds.html&quot;)  Call to .evalScripts() fails in Internet Explorer</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        pirklk@gmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.1a">1.1a</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.1a</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>load ajax</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>$("#feeds").load("feeds.html")</p><p>Call to .evalScripts() fails in Internet Explorer</p><p>jQuery.fn.extend for load: makes a call to jQuery.ajax(...) and on completion does a self.html(res.responseText) which eventually does a elem[fix[name]] = value and that is why it fails to process the scripts in Internet Explorer.  The "innerHTML" attribute (also "text" attribute) for IE (tested/verified for IE 6.0) strips out &lt;script&gt; tag elements from the HTML.  This is the test code that I used for my IE testing. </p><pre class="wiki">
var script = "&lt;script language="JavaScript"
type="text/JavaScript"&gt;alert('im really running');&lt;/script&gt;";
var oVDiv =document.getElementById("oDiv1");
oVDiv["innerHTML"] = script; // fails
</pre><p>Suggested fix would be to pass res.responseText to evalScripts: function() {</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (8)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 29, 2006 11:26PM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">$(&quot;#feeds&quot;).load(&quot;feeds.html&quot;)  Call to .evalScripts() fails in Internet Explorer&#92;
&#92;
jQuery.fn.extend for load: makes a call to jQuery.ajax(...) and on completion does a self.html(res.responseText) which eventually does a elem[fix[name]] = value and that is why it fails to process the scripts in Internet Explorer.  The &quot;innerHTML&quot; attribute (also &quot;text&quot; attribute) for IE (tested/verified for IE 6.0) strips out &lt;script&gt; tag elements from the HTML.  This is the test code that I used for my IE testing. &#92;
var script = &quot;&lt;script language=&quot;JavaScript&quot;&#92;
type=&quot;text/JavaScript&quot;&gt;alert(&#39;im really running&#39;);&lt;/script&gt;&quot;;&#92;
var oVDiv =document.getElementById(&quot;oDiv1&quot;);&#92;
oVDiv[&quot;innerHTML&quot;] = script; // fails&#92;
&#92;
Suggested fix would be to pass res.responseText to evalScripts: function() {</span> → <span class="change-field-new">$(&quot;#feeds&quot;).load(&quot;feeds.html&quot;)&#92;
&#92;
Call to .evalScripts() fails in Internet Explorer&#92;
&#92;
jQuery.fn.extend for load: makes a call to jQuery.ajax(...) and on completion does a self.html(res.responseText) which eventually does a elem[fix[name]] = value and that is why it fails to process the scripts in Internet Explorer.  The &quot;innerHTML&quot; attribute (also &quot;text&quot; attribute) for IE (tested/verified for IE 6.0) strips out &lt;script&gt; tag elements from the HTML.  This is the test code that I used for my IE testing. &#92;
&#92;
{{{&#92;
var script = &quot;&lt;script language=&quot;JavaScript&quot;&#92;
type=&quot;text/JavaScript&quot;&gt;alert(&#39;im really running&#39;);&lt;/script&gt;&quot;;&#92;
var oVDiv =document.getElementById(&quot;oDiv1&quot;);&#92;
oVDiv[&quot;innerHTML&quot;] = script; // fails&#92;
}}}&#92;
&#92;
Suggested fix would be to pass res.responseText to evalScripts: function() {</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-new">→ 1.1</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">minor</span> → <span class="change-field-new">major</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-new">→ 1.1</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for the report, that helps a lot. The issue occured before, but we failed to find the source of the problem.</p><p>The solution is a bit more complicated, because we have to insert the HTML into the DOM first before we can use any selectors. On the other hand, if we parse the HTML by hand and evaluate any scripts, we have to prevent that they are executed again later.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 30, 2006 03:42AM UTC by <span class="author">malsup</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Here's a modified version of the unit test from the form plugin:</p><pre class="wiki">
test("load doc with scripts", function() {
    stop();
    expect(3);
    $('#test').load('doc-with-scripts.html', function() {
        ok( $('#test').text().match("Lorem ipsum"), "target updated");
        ok( typeof unitTestVariable1 != 'undefined', 'first script block executed');
        ok( typeof unitTestVariable2 != 'undefined', 'second script block executed');
        start();
    });
});
</pre><p>The doc-with-scripts.html file looks like this:</p><pre class="wiki">
&lt;div&gt;
&lt;script type="text/javascript"&gt;
    // set global var
    var unitTestVariable1 = true;
&lt;/script&gt;

Lorem ipsum dolor sit amet...

&lt;script type="text/javascript"&gt;
    // set another global var
    var unitTestVariable2 = true;
&lt;/script&gt;
&lt;/div&gt;
</pre><p>The basic idea is to assert that both script blocks are executed AND the target of the load is updated.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 30, 2006 10:28AM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is the test from the testsuite:</p><pre class="wiki">
test("load(String, Object, Function) - check scripts", function() {
	expect(7);
	stop();
	testFoo = undefined;
	var verifyEvaluation = function() {
	  ok( foobar == "bar", 'Check if script src was evaluated after load' );
	  ok( $('#foo').html() == 'foo', 'Check if script evaluation has modified DOM');
	  ok( $('#ap').html() == 'bar', 'Check if script evaluation has modified DOM');
	  start();
	};
	$('#first').load('data/test.html', function() {
	  ok( $('#first').html().match(/^html text/), 'Check content after loading html' );
	  ok( testFoo == "foo", 'Check if script was evaluated after load' );
	  setTimeout(verifyEvaluation, 600);
	});
});
</pre><p>test.html:</p><pre class="wiki">
html text&lt;br/&gt;
&lt;script type="text/javascript"&gt;
testFoo = "foo"; $('#foo').html('foo');
ok( true, "test.html executed" );
&lt;/script&gt;
&lt;script src="data/test.js"&gt;&lt;/script&gt;
blabla
</pre><p>That works, so what are we missing?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 31, 2006 12:01AM UTC by <span class="author">malsup</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Interesting.  That works for me in IE6 & 7, although it's bugger to test through IE's caching.  We should probably rework ajaxTest.js to append the current time to the URL.  Is the setTimeout necessary?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 31, 2006 03:13PM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The testsuite now has a url function that appends both timestamp and a random number to urls, no matte whether they already have a query string or not. That makes testing in both FF and IE much easier.</p><p>The timeout is necessary to check if test.js is properly evaluated. That requires another requests that we don't control, so we can't use a callback.</p><p>I'll check what happens if the html file contains only a script element and nothing else.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 31, 2006 03:48PM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok, got it. IE strips the script tag when there is nothing else in the file. Even a single character in front of the script tag fixes the problem.</p><p>If anyone comes up with a nice workaround, fine, otherwise I just add a note to load() warning about this issue. If there is nothing else then the script tag, it's easy to strip that, too, and use $.getScript().</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 31, 2006 08:13PM UTC by <span class="author">malsup</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Looks like it strips the script if it is the very first subelement.  For example,</p><pre class="wiki">
&lt;div&gt;
&lt;script type="text/javascript"&gt;
    alert('hello');
&lt;/script&gt;
&lt;/div&gt;
</pre><p>does not alert. But this does:</p><pre class="wiki">
&lt;div&gt;
blah
&lt;script type="text/javascript"&gt;
    alert('hello');
&lt;/script&gt;
</pre><p>Nice work, JÃ¶rn.  Looks like this is just a documentation issue.  Cool.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 01, 2007 03:27PM UTC by <span class="author">joern</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I added a note to load() about this problem. Just put a character in front of your script or use $.getScript() to avoid it.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
