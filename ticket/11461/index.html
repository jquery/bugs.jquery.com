<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#11461 (Add support for HTML5 XHR v2 with responseType set to &amp;#39;arraybuffer&amp;#39; on $.ajax) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/11460/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/11462/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#11461</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">enhancement</span>
      <span class="ticket-resolution">(cantfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened March 09, 2012 03:04PM UTC</p>
      
        <p>Closed March 12, 2012 04:10PM UTC</p>
      
      
        <p>Last modified February 22, 2014 03:56PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Add support for HTML5 XHR v2 with responseType set to &#39;arraybuffer&#39; on $.ajax</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        alessandro.aglietti@gmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.7.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th>Cc:</th>
      
      <td>jaubourg</td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I try to use $.ajax for retrieving binary data as explain in HTML5 <a href="http://dvcs.w3.org/hg/xhr/raw-file/tip/Overview.html#the-responsetype-attribute" class="ext-link"><span class="icon"></span>http://dvcs.w3.org/hg/xhr/raw-file/tip/Overview.html#the-responsetype-attribute</a>.</p><p>And I try with these options:</p><pre class="wiki">
$.ajax({
		url : "/blob/job.pdf",
		success : onSuccess,
		type : 'GET',
		xhrFields : {
			responseType : 'arraybuffer'
		},
		error : onError
});
</pre><p>jQuery raise an error because try to access ''xhr.responseXML'' or ''xhr.responseText'' but this properties are not accessible, instead we need to use ''xhr.response''.</p><p>I resolved with this code from line 8143 to 8154</p><pre class="wiki">
if ( s.dataType == 'binary' ) {
	//USE XHR v2 with binary data
	responses.binary = xhr.response;
} else {
	xml = xhr.responseXML;

	// Construct response list
	if ( xml && xml.documentElement /* #4958 */ ) {
		responses.xml = xml;
	}
	responses.text = xhr.responseText;
}
</pre><p>Now when I will to use XHR with binary response add a dataType 'binary' to the $.ajax():</p><pre class="wiki">
$.ajax({
		url : "/blob/job.pdf",
		success : onSuccess,
		type : 'GET',
		xhrFields : {
			responseType : 'arraybuffer'
		},
		error : onError,
		dataType : 'binary'
	});
</pre><p>I hope this is useful for the community.</p><p>See you soon,</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (11)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 09, 2012 03:17PM UTC by <span class="author">addyosmani</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-new">→ jaubourg</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 12, 2012 04:10PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ cantfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>There is no way to create a backwards compatible implementation</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 15, 2012 09:21AM UTC by <span class="author">alessandro.aglietti@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 rwaldron]:</p><blockquote> There is no way to create a backwards compatible implementation</blockquote><p>Excuse me, but my fix is just backward compatible. Because the old request continuos to work without problem.</p><p>Hugs</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 22, 2012 02:43PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Your fix doesn't take dataType chaining in consideration (like "type1 type2").</p><p>Handle the binary dataType should be possible but god, does the XHR spec make things cumbersome. You may wanna open an issue with ajaxHooks ( <a href="https://github.com/jaubourg/ajaxHooks" class="ext-link"><span class="icon"></span>https://github.com/jaubourg/ajaxHooks</a> ). We could try and find the best possible solution there.</p><p>Replying to [comment:3 alessandro.aglietti@…]:</p><blockquote> Replying to [comment:2 rwaldron]: &gt; There is no way to create a backwards compatible implementation  Excuse me, but my fix is just backward compatible. Because the old request continuos to work without problem.  Hugs</blockquote>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 14, 2012 07:34AM UTC by <span class="author">spongman</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>is there any timeline for adding binary support to jQuery?</p><p>for now, i'm using alessandro's patch (thanks). i don't care about backward compatibility - i don't even know what 'dataType chaining' is, or why i should care.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 18, 2012 02:09PM UTC by <span class="author">robertedgar@netvigator.com</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Count me as another one currently using allessandro's patch or a variation of but wanting an 'official' fix ASAP.</p><p>I will say I don't see why the proposed solution would not be backwards compatible. </p><p>At the end of they day the only time this is going to be used by anyone is when they will know exactly what type of response they are going to get before the call starts, so setting any flags needed to tell jQ to not process the return is easy. If they are not set you just do as you did before. </p><p>I really can't see that this is that hard to resolve it has got to be one of the more trivial things that get requested.</p><p>That said I think it would be better to directly check xhr.responseType rather than s.dataType as I want dataType to indicate the particular subtype of binary data being returned which I may want to process in a converter.</p><p>Rob</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 18, 2012 03:16PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It's exactly because of the conversion logic that we cannot apply allessandro's fix. There is more here than what catch the eye (mainly because of the different binary formats). The patch is good in a 1.4.x ad-hoc/unflexible kind of way.</p><p>I'd love to immerse myself into this binary data business but I'm very very busy at work right now. One thing is for certain, the xhr spec continues to be one of the most convoluted spec I've ever encountered and it just bleeds through any abstraction on top.</p><p>Replying to [comment:6 robertedgar@…]:</p><blockquote> Count me as another one currently using allessandro's patch or a variation of but wanting an 'official' fix ASAP.  I will say I don't see why the proposed solution would not be backwards compatible.   At the end of they day the only time this is going to be used by anyone is when they will know exactly what type of response they are going to get before the call starts, so setting any flags needed to tell jQ to not process the return is easy. If they are not set you just do as you did before.   I really can't see that this is that hard to resolve it has got to be one of the more trivial things that get requested.  That said I think it would be better to directly check xhr.responseType rather than s.dataType as I want dataType to indicate the particular subtype of binary data being returned which I may want to process in a converter.  Rob</blockquote>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 13, 2013 10:27PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi, just a note (Feb 2013) still using this approach, works perfectly for what I need it for, the modifications for jQuery 1.9.1 are:</p><p>line ~8564</p><pre class="wiki">
      if ( s.dataType == 'binary' ) {
            // use XHR2 with binary data
            responses.binary = xhr.response;
      } else {
      
            // When requesting binary data, IE6-9 will throw an exception
            // on any attempt to access responseText (#11426)
            if ( typeof xhr.responseText === "string" ) {
                  responses.text = xhr.responseText;
            }
      }
</pre><p>and</p><pre class="wiki">
      if ( !status && s.isLocal && !s.crossDomain ) {
            if ( s.dataType == 'binary' ) {
                  status = responses.binary ? 200 : 404;
            } else {
                  status = responses.text ? 200 : 404;
            }
          ...
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 15, 2013 11:41PM UTC by <span class="author">anonymoustoo</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for posting the mod for 1.9.1 - great pity such an important request has been left as closed.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 01, 2014 03:13AM UTC by <span class="author">domanite</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">I just hit this too, and am also bummed I can do binary data with jquery.</span> → <span class="change-field-new">1391224519678155</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>I just hit this too, and am also bummed I cannot do binary data with jquery.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 22, 2014 03:56PM UTC by <span class="author">tarik.benmerar</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hello,</p><p>Please, take a look at this pull request :</p><p><a href="https://github.com/jquery/jquery/pull/1525" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/1525</a></p><p>I invite everyone to join the discussion.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
