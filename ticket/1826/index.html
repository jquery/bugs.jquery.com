<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#1826 (namespaces handling for XMLs) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/1825/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/1827/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#1826</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">feature</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened October 19, 2007 12:41PM UTC</p>
      
        <p>Closed April 16, 2011 09:29PM UTC</p>
      
      
        <p>Last modified October 26, 2012 02:07PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">namespaces handling for XMLs</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        Orange
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/"></a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>core</td>
      
        <th>Version:</th>
      
      <td>1.2.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Actual jQuery does return wrong results as soon as the user uses namespaces in an xml, because IE does not handle namespaces the same way as other browsers does.</p><p>In jQuery, this concerns the use of "nodeName" which returns "prefix:tagName" instead of "tagName". This concerns the following lines in jQuery-1.2.1.js which should be corrected with the following, in order to hide namespaces :</p><p><strong>line 1260:</strong> </p><pre class="wiki"> c.nodeName.replace(/^.*:/,'').toUpperCase()</pre> instead of  <pre class="wiki">c.nodeName.toUpperCase()</pre><p></p><p><strong>line 1284:</strong> </p><pre class="wiki"> n.nodeName.replace(/^.*:/,'').toUpperCase()</pre> instead of  <pre class="wiki">n.nodeName.toUpperCase()</pre><p></p><p>An other element that causes wrong behavior is "getElementsByTagName" which has to be used in IE with "prefix:tagName". This could be corrected by the following change :</p><p><strong>line 1362:</strong> </p><pre class="wiki">r = jQuery.merge( r, ret[i].getElementsByTagName( tag ));</pre> should be changed in :<p></p><pre class="wiki">
// getElementsByTagName will not work with IE & namespaces
var retour = [];
if (jQuery.browser.msie && (ret[i].namespaces!=null) && (ret[i].namespaces.length&gt;0)) {
	retour = jQuery.merge(retour,ret[i].getElementsByTagName(tag));
	for(var nsIndex = 0; nsIndex&lt;ret[i].namespaces.length; nsIndex++) {
		var ns = "xmlns:ns='"+ret[i].namespaces(nsIndex)+"'";
		ret[i].setProperty("SelectionNamespaces", ns);
		var IeReturn = ret[i].selectNodes("ns:"+tag);
		retour = jQuery.merge(retour, IeReturn);
	}
} else {
	retour = ret[i].getElementsByTagName(tag);
}
r = jQuery.merge(r, retour);
</pre><p>Changes have been tested on IE6/7, Mozilla, Safari & Opera. They may be easier way to perform it, but this one works.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (8)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2007 01:58PM UTC by <span class="author">Orange</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Error in suggested solution for line 1362 :</p><pre class="wiki">var IeReturn = ret[i].selectNodes("ns:"+tag);</pre> should be <pre class="wiki">var IeReturn = ret[i].selectNodes("//ns:"+tag);</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 06, 2008 05:23AM UTC by <span class="author">IvanTheBeara</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is similar to the solution suggested in ticket 155 but this avoids the potentially slow string searching that does with regular expressions.  However, his only works when the context is the document node (IXMLDocument2).  If the context is a node from within the document (IXMLDOMElement) then this fails because IXMLDOMElement does not have a namespaces property.  In addition, the XPath used in selectNodes returns all matching nodes in the document rather than descendants of the context node.</p><p>To get around these issues you need to look at the ownerDocument and tweak the XPath.  Something like this:</p><pre class="wiki">
// getElementsByTagName will not work with IE & namespaces
var tags = [];
if (jQuery.browser.msie && ret[i].xml !== undefined && tag != '*') {
	var od = (ret[i].ownerDocument) ? ret[i].ownerDocument : ret[i];
	var ns = od.namespaces;
	if ((ns!=null) && (ns.length&gt;0)) {
		for (var nsIndex = 0; nsIndex&lt;ns.length; nsIndex++) {
			od.setProperty("SelectionNamespaces", "xmlns:ns='" + ns(nsIndex) + "'");
			var IeReturn = ret[i].selectNodes(".//ns:"+tag);
			tags = jQuery.merge(tags, IeReturn);
		}
	}
}
tags = jQuery.merge(tags,ret[i].getElementsByTagName(tag));
r = jQuery.merge(r, tags);
</pre><p>This is really only a partial solution to the issue.  What's really needed is a way to specify a namespace in the selector.  I've seen a suggestion that the | character be used for that.  So, "ns|tag" would return all tags of the form &lt;ns:tag&gt;.  But the prefix should not be hard coded in a selector.  The whole point of it is that the prefix should be able to be changed to avoid conflicts without affecting code that processes the document.</p><p>So, either we include the whole namespace URL in the selector, or we have a way to map another namespace prefix to the URI:</p><p>.find(selector, context, nsPrefix, nsURI)</p><p>(for example)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 06, 2008 05:48AM UTC by <span class="author">IvanTheBeara</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>And, while I think of it, the first two fixes (adding the replace to the nodeName comparisons in the section that handles child selectors) more-or-less get the job done, but they also have a problem.  XML is case sensitive.  Converting everything to uppercase to do a comparison might be appropriate for HTML documents but not for XML documents.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 13, 2010 07:15PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/2901">#2901</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 13, 2010 07:20PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This ticket has been open for so long because it appears to be very difficult to solve.</p><p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=414612" class="ext-link"><span class="icon"></span>https://bugzilla.mozilla.org/show_bug.cgi?id=414612</a></p><p>For XML docs we'd need to use getElementsByTagNameNS according to that.</p><p>Also, Sizzle's first resort of querySelectorAll doesn't support namespaces but it should throw an exception:</p><p><a href="http://www.w3.org/TR/selectors-api/#resolving-namespaces" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/selectors-api/#resolving-namespaces</a></p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 13, 2010 07:39PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/3404">#3404</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 16, 2011 09:29PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">1.2.2</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Honestly, I don't think that this is something that we're going to ever implement. Especially considering that at this point we don't even use querySelectorAll on XML documents. Sorry!</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 26, 2012 02:07PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/12787">#12787</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
