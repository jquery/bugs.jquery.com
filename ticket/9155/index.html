<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#9155 (AJAX Headers not persisting in Firefox when Redirected (301 / 303). Chrome, Chromium, Safari and IE works Ok.) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/9154/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/9156/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#9155</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(cantfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened May 06, 2011 09:02PM UTC</p>
      
        <p>Closed May 07, 2011 02:21AM UTC</p>
      
      
        <p>Last modified October 08, 2013 09:51PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">AJAX Headers not persisting in Firefox when Redirected (301 / 303). Chrome, Chromium, Safari and IE works Ok.</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        ygbr
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next">1.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.6</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>When you issue a AJAX Request of any kind using JQuery (tested with 1.5.2 and 1.6), the HTTP Headers don't persist to the next request.</p><p>When you send the first request using Firefox (tested on 3.x and 4.0.1 stable), the server receives the {'X-Requested-With': 'XMLHttpRequest'} or any other Headers you may set on your AJAX request, then when it returns a 301 response, the next request made to the server don't replicate the HTTP Headers (not even the X-Requested-With).</p><p>On Chrome, Chromium, Safari and IE, the Headers are replicated back to the server after the 301/303 redirect responses, generating a 200 response with the correct http request headers.</p><p>Follows a small python client/server script that demonstrates the problem.</p><pre class="wiki">
#!/usr/bin/env python3.2
# -*- coding: utf-8 -*-

import cherrypy

class App:
    
    @cherrypy.expose
    def index(self):
        return '''&lt;!doctype&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Yg test&lt;/title&gt;
    &lt;/head&gt;
    
    &lt;body&gt;
        &lt;form action='/process' method='post'&gt;
            &lt;input type='text' name='username' placeholder='User' /&gt;&lt;br/&gt;
            &lt;input type='text' name='email' placeholder='Email' /&gt;&lt;br/&gt;
            &lt;input type='submit' value='Enviar' /&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;'''

    @cherrypy.expose
    def redirme(self, **kwargs):
        raise cherrypy.HTTPRedirect('/getme')
    
    @cherrypy.expose
    def getme(self):
        return str(cherrypy.request.headers)
    
    @cherrypy.expose
    def index(self):
        return '''
        &lt;script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"&gt;&lt;/script&gt;
        
        &lt;div id='res'&gt;&lt;/div&gt;
        
        &lt;input type='button' id='bt1' value='Direct Request (No Redirection)' /&gt; 
        &lt;input type='button' id='bt2' value='Redirected (301) Request - No X-Requested-With HTTP Header Persisted' /&gt;
        
        &lt;script&gt;
            $(document).ready(function(){
                $('#bt1').click(function(){
                    $('#res').load('/getme');
                });
            
                $('#bt2').click(function(){
                    $('#res').load('/redirme');
                });
            });
        &lt;/script&gt;
'''
        
cherrypy.quickstart(App(), '/')
</pre><p>And the responses using Firefox:</p><pre class="wiki">
# DIRECT REQUEST (without server-side 301/303 redirections):
{'Remote-Addr': '127.0.0.1', 'Accept-Language': 'en-us,en;q=0.5', 'Accept-Encoding': 'gzip, deflate', 'Keep-Alive': '115', 'Connection': 'keep-alive', 'Accept': 'text/html, */*; q=0.01', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1', 'Accept-Charset': 'ISO-8859-1,utf-8;q=0.7,*;q=0.7', 'Host': 'localhost:8080', 'Cookie': 'session_id=057fef543d4197e2caf7c170f04a11601bb7a382', 'Referer': 'http://localhost:8080/', 'X-Requested-With': 'XMLHttpRequest'}

# REDIRECTED REQUEST (server returns a 301 Redirect):
{'Remote-Addr': '127.0.0.1', 'Accept-Language': 'en-us,en;q=0.5', 'Accept-Encoding': 'gzip, deflate', 'Keep-Alive': '115', 'Connection': 'keep-alive', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1', 'Accept-Charset': 'ISO-8859-1,utf-8;q=0.7,*;q=0.7', 'Host': 'localhost:8080', 'Referer': 'http://localhost:8080/', 'Cookie': 'session_id=057fef543d4197e2caf7c170f04a11601bb7a382'}
</pre><p>as you can see, X-Requested-With is present only on the Direct Request.</p><p>Now look the behavior of all other browsers (Using Chromium to demonstrate):</p><pre class="wiki">
# DIRECT REQUEST (without server-side 301/303 redirections):
{'Remote-Addr': '127.0.0.1', 'Accept-Language': 'en-US,en;q=0.8', 'Accept-Encoding': 'gzip,deflate,sdch', 'Connection': 'keep-alive', 'Accept': 'text/html, */*; q=0.01', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_7) AppleWebKit/534.32 (KHTML, like Gecko) Chrome/13.0.751.0 Safari/534.32', 'Accept-Charset': 'ISO-8859-1,utf-8;q=0.7,*;q=0.3', 'Host': 'localhost:8080', 'Cookie': 'session_id=c111ecec6c49475cfd0b3adb92657e7f296e6e52', 'Referer': 'http://localhost:8080/', 'X-Requested-With': 'XMLHttpRequest'}

# REDIRECTED REQUEST (server returns a 301 Redirect):
{'Remote-Addr': '127.0.0.1', 'Accept-Language': 'en-US,en;q=0.8', 'Accept-Encoding': 'gzip,deflate,sdch', 'Connection': 'keep-alive', 'Accept': 'text/html, */*; q=0.01', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_7) AppleWebKit/534.32 (KHTML, like Gecko) Chrome/13.0.751.0 Safari/534.32', 'Accept-Charset': 'ISO-8859-1,utf-8;q=0.7,*;q=0.3', 'Host': 'localhost:8080', 'Cookie': 'session_id=c111ecec6c49475cfd0b3adb92657e7f296e6e52', 'Referer': 'http://localhost:8080/', 'X-Requested-With': 'XMLHttpRequest'}
</pre><p>Clearly there is a serious problem on Firefox (3 and 4) and JQuery AJAX Requests when you get redirects.</p><p>Is this a jQuery bug or a Firefox one???</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 06, 2011 09:09PM UTC by <span class="author">ygbr</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Sorry for the duplicated index method declaration on my python snippet... it is safe to disregard the first index method declaration and remove it, leaving only the last one (altought it will run normally as the last one superseeds the previous).</p><p>Follows the code reviewed:</p><pre class="wiki">
#!/usr/bin/env python3.2
# -*- coding: utf-8 -*-

import cherrypy

class App:
    
    @cherrypy.expose
    def redirme(self, **kwargs):
        raise cherrypy.HTTPRedirect('/getme')
    
    @cherrypy.expose
    def getme(self):
        return str(cherrypy.request.headers)
    
    @cherrypy.expose
    def index(self):
        return '''
        &lt;script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"&gt;&lt;/script&gt;
        
        &lt;div id='res'&gt;&lt;/div&gt;
        
        &lt;input type='button' id='bt1' value='Direct Request (No Redirection)' /&gt; 
        &lt;input type='button' id='bt2' value='Redirected (301) Request - No X-Requested-With HTTP Header Persisted' /&gt;
        
        &lt;script&gt;
            $(document).ready(function(){
                $('#bt1').click(function(){
                    $('#res').load('/getme');
                });
            
                $('#bt2').click(function(){
                    $('#res').load('/redirme');
                });
            });
        &lt;/script&gt;
'''
        
cherrypy.quickstart(App(), '/')
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 06, 2011 09:15PM UTC by <span class="author">ygbr</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Also tested on Opera 11.01 - Mac OS X 10.6.4 - It also behaves correctly!</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 06, 2011 09:34PM UTC by <span class="author">ygbr</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It seems to be a Firefox XHR bug... Do you guys think of any workaround or are we expected to remove all server side redirects in order to work properly with Firefox?</p><p>Follows the bugzilla link for this bug: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=553888" class="ext-link"><span class="icon"></span>https://bugzilla.mozilla.org/show_bug.cgi?id=553888</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 07, 2011 02:21AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ cantfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm afraid we'll have to wait for firefox to get a fix. We have no control whatsoever on the internals of the native xhr :/</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 07, 2011 02:21AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 08, 2013 09:51PM UTC by <span class="author">miketaylr</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In case anybody is looking at this years later like me, this was fixed in Gecko.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
