<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#1136 (Events not removed from jQuery.event.global) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/1135/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/1137/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#1136</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened April 20, 2007 01:00PM UTC</p>
      
        <p>Closed May 31, 2007 03:54AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Events not removed from jQuery.event.global</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        brandon
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        minor
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.1.3">1.1.3</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>event</td>
      
        <th>Version:</th>
      
      <td>1.1.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>From Michael Schwarz on the discuss list:</p><p>I have a very simple page which will be refreshed from time to time. I</p><p>build an example which will be called every 1000 msec to redner a html</p><p>table with a button inside. The button click event is set with the</p><p>bind method. This causes a memory problem.</p><pre class="wiki">

&lt;div id="display"&gt;
&lt;/div&gt;

&lt;script type="text/javascript"&gt;

function clickhandler() {
       alert("clicked");
}

function render() {
       var d = new Date();
       var n = d.getTime();

       $("button").unbind("click", clickhandler);

       var sb = [];
       sb.push("&lt;table&gt;");
       for(var i=0; i&lt;100; i++) {
               sb.push("&lt;tr&gt;&lt;td&gt;" + i + "&lt;/td&gt;&lt;td&gt;" + n + "&lt;/td&gt;&lt;td&gt;&lt;button&gt;Click&lt;/
button&gt;&lt;/td&gt;&lt;/tr&gt;");
       }
       sb.push("&lt;/table&gt;");

       $("#display").html(sb.join(''));
       $("button").bind("click", clickhandler);

       setTimeout(render, 1000);
}

$(window).ready(render);

&lt;/script&gt;

</pre><p>I see the problem, now. The array jQuery.event.global is getting</p><p>bigger and bigger. For a long running Web application (without any</p><p>page refresh) it is a strange problem. If I have removed an event and</p><p>then will delete the element (the DOM element) this should be removed</p><p>from the jQuery.event.global array. If I press F5 it will clear nearly</p><p>everything and memory usage is like before.</p><p>I added some lines to the remove function (line 1245):</p><pre class="wiki">
// original
if(!k) element["on" + type] = null;

// changed to
if (!k) {
   element["on" + type] = null;

   for ( var i=0; i&lt;this.global[type].length; i++) {
       if(this.global[type][i] == element) {
           this.global[type].splice(i, 1);
           break;
       }
   }
}

</pre><p>I see that the for loop isn't very well, maybe there is another way to</p><p>remove the element if there is no handler.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (2)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 25, 2007 05:37AM UTC by <span class="author">carlos.aguay</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You shouldn't break when you find the first element. You could attach several events of the same type to the same element. So 'element' could be present more than once in the array. Therefore it should be something like:</p><pre class="wiki">
var o = this.global[type];
for (var i = o.length; i &gt;= 0; i--) {
  if (o[i] == element) {
    o.splice(i,1);
  }
}
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 31, 2007 03:54AM UTC by <span class="author">brandon</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">From Michael Schwarz on the discuss list:&#92;
&#92;
I have a very simple page which will be refreshed from time to time. I&#92;
build an example which will be called every 1000 msec to redner a html&#92;
table with a button inside. The button click event is set with the&#92;
bind method. This causes a memory problem.&#92;
&#92;
{{{&#92;
&#92;
&lt;div id=&quot;display&quot;&gt;&#92;
&lt;/div&gt;&#92;
&#92;
&lt;script type=&quot;text/javascript&quot;&gt;&#92;
&#92;
function clickhandler() {&#92;
       alert(&quot;clicked&quot;);&#92;
}&#92;
&#92;
function render() {&#92;
       var d = new Date();&#92;
       var n = d.getTime();&#92;
&#92;
       $(&quot;button&quot;).unbind(&quot;click&quot;, clickhandler);&#92;
&#92;
       var sb = [];&#92;
       sb.push(&quot;&lt;table&gt;&quot;);&#92;
       for(var i=0; i&lt;100; i++) {&#92;
               sb.push(&quot;&lt;tr&gt;&lt;td&gt;&quot; + i + &quot;&lt;/td&gt;&lt;td&gt;&quot; + n + &quot;&lt;/td&gt;&lt;td&gt;&lt;button&gt;Click&lt;/&#92;
button&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);&#92;
       }&#92;
       sb.push(&quot;&lt;/table&gt;&quot;);&#92;
&#92;
       $(&quot;#display&quot;).html(sb.join(&#39;&#39;));&#92;
       $(&quot;button&quot;).bind(&quot;click&quot;, clickhandler);&#92;
&#92;
       setTimeout(render, 1000);&#92;
}&#92;
&#92;
$(window).ready(render);&#92;
&#92;
&lt;/script&gt;&#92;
&#92;
}}}&#92;
&#92;
I see the problem, now. The array jQuery.event.global is getting&#92;
bigger and bigger. For a long running Web application (without any&#92;
page refresh) it is a strange problem. If I have removed an event and&#92;
then will delete the element (the DOM element) this should be removed&#92;
from the jQuery.event.global array. If I press F5 it will clear nearly&#92;
everything and memory usage is like before.&#92;
&#92;
I added some lines to the remove function (line 1245):&#92;
&#92;
{{{&#92;
// original&#92;
if(!k) element[&quot;on&quot; + type] = null;&#92;
&#92;
// changed to&#92;
if (!k) {&#92;
   element[&quot;on&quot; + type] = null;&#92;
&#92;
   for ( var i=0; i&lt;this.global[type].length; i++) {&#92;
       if(this.global[type][i] == element) {&#92;
           this.global[type].splice(i, 1);&#92;
           break;&#92;
       }&#92;
   }&#92;
}&#92;
&#92;
}}}&#92;
&#92;
I see that the for loop isn&#39;t very well, maybe there is another way to&#92;
remove the element if there is no handler.</span> → <span class="change-field-new">From Michael Schwarz on the discuss list:&#92;
&#92;
I have a very simple page which will be refreshed from time to time. I&#92;
build an example which will be called every 1000 msec to redner a html&#92;
table with a button inside. The button click event is set with the&#92;
bind method. This causes a memory problem.&#92;
&#92;
{{{&#92;
&#92;
&lt;div id=&quot;display&quot;&gt;&#92;
&lt;/div&gt;&#92;
&#92;
&lt;script type=&quot;text/javascript&quot;&gt;&#92;
&#92;
function clickhandler() {&#92;
       alert(&quot;clicked&quot;);&#92;
}&#92;
&#92;
function render() {&#92;
       var d = new Date();&#92;
       var n = d.getTime();&#92;
&#92;
       $(&quot;button&quot;).unbind(&quot;click&quot;, clickhandler);&#92;
&#92;
       var sb = [];&#92;
       sb.push(&quot;&lt;table&gt;&quot;);&#92;
       for(var i=0; i&lt;100; i++) {&#92;
               sb.push(&quot;&lt;tr&gt;&lt;td&gt;&quot; + i + &quot;&lt;/td&gt;&lt;td&gt;&quot; + n + &quot;&lt;/td&gt;&lt;td&gt;&lt;button&gt;Click&lt;/&#92;
button&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);&#92;
       }&#92;
       sb.push(&quot;&lt;/table&gt;&quot;);&#92;
&#92;
       $(&quot;#display&quot;).html(sb.join(&#39;&#39;));&#92;
       $(&quot;button&quot;).bind(&quot;click&quot;, clickhandler);&#92;
&#92;
       setTimeout(render, 1000);&#92;
}&#92;
&#92;
$(window).ready(render);&#92;
&#92;
&lt;/script&gt;&#92;
&#92;
}}}&#92;
&#92;
I see the problem, now. The array jQuery.event.global is getting&#92;
bigger and bigger. For a long running Web application (without any&#92;
page refresh) it is a strange problem. If I have removed an event and&#92;
then will delete the element (the DOM element) this should be removed&#92;
from the jQuery.event.global array. If I press F5 it will clear nearly&#92;
everything and memory usage is like before.&#92;
&#92;
I added some lines to the remove function (line 1245):&#92;
&#92;
{{{&#92;
// original&#92;
if(!k) element[&quot;on&quot; + type] = null;&#92;
&#92;
// changed to&#92;
if (!k) {&#92;
   element[&quot;on&quot; + type] = null;&#92;
&#92;
   for ( var i=0; i&lt;this.global[type].length; i++) {&#92;
       if(this.global[type][i] == element) {&#92;
           this.global[type].splice(i, 1);&#92;
           break;&#92;
       }&#92;
   }&#92;
}&#92;
&#92;
}}}&#92;
&#92;
I see that the for loop isn&#39;t very well, maybe there is another way to&#92;
remove the element if there is no handler.</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is now fixed in Rev [2011].</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
