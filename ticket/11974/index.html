<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#11974 ($.parseHTML has ( lots ) of xss issues and can&amp;#39;t be labeled as secure in its current implementation) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/11973/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/11975/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#11974</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(cantfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened June 26, 2012 01:05AM UTC</p>
      
        <p>Closed June 26, 2012 01:24AM UTC</p>
      
      
        <p>Last modified May 22, 2013 08:56PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">$.parseHTML has ( lots ) of xss issues and can&#39;t be labeled as secure in its current implementation</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        James Churchman &lt;jameschurchman@gmail.com&gt;
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.8b1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>so the point of $.parseHTML is that it will safely return html and not make any cross site requests .. </p><p>well I'm not so sure that it does this .. the problem is that it returns dom elements .. and dom elements can ( naturally ) contain images .. and images naturally contain links to images</p><p>now as far as i know the dom prefetches any images, regardless of if the nodes are placed into the document or not .. so that it already has the image when it is finally inserted.. this means that any img nodes with embedded src url's, the url is given a GET request</p><p>so this will request the image by fetching the url</p><p>$.parseHTML("&lt;img src='http://static.jquery.com/files/rocker/images/logo_jquery_215x53.gif'&gt;")</p><p>with out it even being inserted</p><p>this leaves a few small but still significant types of xss attacks available .. one) where you spoof a get request on the target site and the server thinks that its a trusted request and performs the desired request. the user is still logged in and any id cookies would be sent. there are ways around this but many sites don't implement them two ) where it now makes a request to a foreign site .. this is not huge but it can still be used for tracking and other purposes .. & maybe more. + this is only for the image tag, i have not yet thought what could be done with data-uri's, link tags and more</p><p>i still think that the feature has good merit but it can't be labeled as something truly secure because its not ... apart from removing script tags there is little benefit to putting this directly into the document with innerHTML </p><p>so i think that the problem here is that it returns dom nodes, if it wishes to be secure, due to prefetching and other issues , i think it should return something else ( fake dom node objects .. ) that any potential user could easily scan & validate contains only items they approve ( divs, or images who's url's are in a place that they allow etc.. ) and then this could be inserted into the main document dom and the "proper" dom nodes produced for it </p><p>just a thought and hope this is not too unhelpful! :-)</p><p>James</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (7)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 26, 2012 01:24AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-new">→ needsdocs</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ cantfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Definitely, there are ways to attack or send data via back channels if the developer blindly processes untrusted content, even if they *know* that content is HTML. That applies whether jQuery is there or not.</p><p>The important things about $.parseHTML is that 1) the user explicitly says they are expecting HTML (not a selector) and 2) the user has the option to not run any scripts in the markup. The latter can be strictly enforced in environments that support Content Security Policy or for example Microsoft's <code>toStaticHTML</code>. </p><p>We can't prevent all XSS attacks inside jQuery. We're just trying to ensure that the developer is clear on what they are asking jQuery to do, and that requires making the inputs to some API calls clear.</p><p>I'm closing this canfix/needsdocs since the best we can do is educate. :-)</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 26, 2012 10:27AM UTC by <span class="author">James Churchman &lt;jameschurchman@gmail.com&gt;</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi dmethvin, thanks for your fast response :-)</p><p>I think that you fundamentally don't understand the issue. I agree with both 1) and 2) but the implementation is fundamentally flawed .. </p><p>please re-read <a href="http://blog.jquery.com/2012/06/22/jquery-1-8-beta-1-see-whats-coming-and-going/" class="ext-link"><span class="icon"></span>http://blog.jquery.com/2012/06/22/jquery-1-8-beta-1-see-whats-coming-and-going/</a> ( maybe you wrote this section I'm not sure :-) under XSS PROTECTION .. is specifically says that this is a safe feature to use for taking any untrusted source :</p><p>"Developers have sometimes forgotten this, passing strings to jQuery that come from untrusted sources such as the URL or user input." and it continues in a similar fashion.. </p><p>this directly implies its use is as an html parser of html from any source ..</p><p>( this does not align with "We're just trying to ensure that the developer is clear on what they are asking jQuery to do" as you state )</p><p>if the blog statement is the case, then the fundamental implementation is totally flawed, you can't go creating dom elements from untrusted sources, even if those elements are not ( yet ) inserted .. the dom will do all kinds of prefetchings and other side-effecting actions .</p><p>i agree that jquery can't prevent all possible xss's written with it, but it can avoid including functions that do it by default, especially when documented to the country .. so on this basis i am not happy that the ticket has been closed within hours of being opened ... </p><p>there are obviously a few good solutions :</p><p>1) the documentation is updated to state that this is simply a way to include html with out the ambiguity of $() possibly being seen as a selector and also striping script tags </p><p>or </p><p>2) it's reimplemented to generate jquery lookalike dom nodes that you can do the normal .attr and .text etc.. on but are not in fact real dom nodes, until inserted</p><p>( or maybe 3) there are multiple options in the call that let you specify what tag types are allowed disallowed or filtered, and for them what attributes are allowed or disallowed before the dom nodes are made and returned )</p><p>James</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 26, 2012 11:28AM UTC by <span class="author">James Churchman &lt;jameschurchman@gmail.com&gt;</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>ok so my initial trial was based on 30 seconds of playing around but having had a think you can run any js with this :-)</p><p>eg :</p><p>$.parseHTML("&lt;img src='http://static.jquery.com/files/rocker/images/logo_jquery_215x53.gif' onload='alert(\\"hi there\\")'&gt;")</p><p>will fire the onload event when the image is downloaded ( it will get called twice in fact , so i presume jquery is creating each element twice ), and before the image is ever loaded into the page or the return result of the parseHTML can be validated ... </p><p>or an even shorter example :</p><p>$.parseHTML("&lt;img src='z' onerror='alert(\\"hi there\\")'&gt;")</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 26, 2012 12:11PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> this directly implies its use is as an html parser of html from any source</blockquote><p>No, the issue with <code>$()</code> is that they are passing it what they think is a selector, but it really turns out to be HTML with executable code. That is the primary issue we're trying to address by making people spell it out with <code>$.parseHTML()</code>. The rest regarding trusted sources can be addressed in the docs.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 26, 2012 12:54PM UTC by <span class="author">James Churchman &lt;jameschurchman@gmail.com&gt;</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>thats an excellent, but opposite issue ..</p><p>in that case you need to have a $.selector("#element_id") type thing that allows somebody to explicitly say a string is a selector and can't be an html fragment as it could be with the current overloaded $ when used with user input</p><p>in that scenario it would be fantastic to have an explicit $.selector call added to jquery , but its the opposite issue to an xss secure html parser </p><p>please re-read the 1.8 announcement blog post :-)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 15, 2012 07:37PM UTC by <span class="author">mikesherov</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">needsdocs</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 22, 2013 08:56PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/13921">#13921</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
