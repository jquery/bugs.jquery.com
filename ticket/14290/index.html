<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#14290 (regression $(&amp;#39;&amp;lt;table&amp;gt;&amp;lt;/table&amp;gt;&amp;#39;).append(&amp;quot;text content&amp;quot;) fails in 1.10) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/14289/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/14291/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#14290</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened August 23, 2013 11:14PM UTC</p>
      
        <p>Closed September 19, 2013 02:27PM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">regression $(&#39;&lt;table&gt;&lt;/table&gt;&#39;).append(&quot;text content&quot;) fails in 1.10</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        karger@mit.edu
      </td>
      <th>Owned by:</th>
      <td>karger@mit.edu</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.10.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>$('&lt;table&gt;&lt;/table&gt;').append("text content") generates an exception in jquery 1.10.  It works fine in jquery 1.9 .  The resulting html is invalid, but it still seems wrong for jquery to throw an exception.</p><p>jsfiddle: <a href="http://jsfiddle.net/EPJS6/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/EPJS6/</a></p><p>The culprit is line 6300 of jquery-1.10.2.js ,</p><pre class="wiki">jQuery.nodeName( content.nodeType === 1 ? content : content.firstChild, "tr" ) </pre><p>which for some reason takes the firstChild of any content that is not an elementnode, so in particular when content is a textnode it takes the textNode's firstChild which is null and passes it as an argument to nodeName.  Are the two cases of the conditional swapped from what they should be?</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (7)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 24, 2013 01:00AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm okay with it throwing an error for this case. Is there some benefit to developers to letting it quietly create invalid markup?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 24, 2013 03:46AM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Well, to be clearer, while it always crashes it only *sometimes* creates invalid markup.  I ran into the bug because I am using a templating library that recursively copies child elements into (a copy of) the parent element.  The bug was triggered when the templating engine was copying a template containing </p><pre class="wiki">&lt;table&gt;     &lt;tbody&gt;&lt;tr&gt;stuff...&lt;/table&gt;</pre>.  The first child the templating engine tried to copy into a new table node was the textnode consisting of just whitespace before the tbody.  Creating (temporarily) &lt;table&gt;..whitespace..&lt;/table&gt; is, I think, a plausible step in building a table.   If jq continues to throw this error, then it becomes the responsibility of the template engine to check for and skip inserting whitespace, which just doesn't seem like a job it should have to do given that it is building valid html.  <p></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 30, 2013 11:57AM UTC by <span class="author">jordifebrer</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Ideally do not throw an exception and add the text content like jQuery 1.9 and older versions.&#92;
&#92;
Possible fix is:&#92;
&#92;
 function manipulationTarget( elem, content ) {&#92;
   return jQuery.nodeName( elem, &quot;table&quot; ) &amp;&amp;&#92;
-    jQuery.nodeName( content.nodeType === 1 ? content : content.firstChild, &quot;tr&quot; ) ?&#92;
+    jQuery.nodeName( ( content.nodeType === 1 || content.firstChild === null ) ? content : content.firstChild, &quot;tr&quot; ) </span> → <span class="change-field-new">1377863960254700</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Ideally do not throw an exception and add the text content like jQuery 1.9 and older versions.</p><p>Possible fix is:</p><pre class="wiki">
function manipulationTarget( elem, content ) {
   return jQuery.nodeName( elem, "table" ) &&
-    jQuery.nodeName( content.nodeType === 1 ? content : content.firstChild, "tr" ) ?
+    jQuery.nodeName( ( content.nodeType === 1 || content.firstChild === null ) ? content : content.firstChild, "tr" )
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 10, 2013 07:18PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ karger@mit.edu</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Sorry, what I was asking is, other than not throwing an error, what should the  outcome be? You're defining a behavior with your suggested patch but is that really the desired behavior?</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 12, 2013 06:13PM UTC by <span class="author">karger</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:4 dmethvin]:</p><blockquote> Sorry, what I was asking is, other than not throwing an error, what should the  outcome be? You're defining a behavior with your suggested patch but is that really the desired behavior?</blockquote><p>So at the risk of overgeneralizing, I think we should recognize that it is possible (and natural) for invalid html to "grow" to become valid.  This implies that jquery should be robust in handling (temporarily) invalid html, in order to protect the user from having to maintain validity at every single step.</p><p>Another, related example of this would be manipulating a table without a tbody.  jquery appears to helpfully create a tbody in this case.  But what happens if the table is only temporarily without a tbody, and the user adds one later?  Suddenly we have two tbodys, which is a problem.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 13, 2013 05:31PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> So at the risk of overgeneralizing, I think we should recognize that it is possible (and natural) for invalid html to "grow" to become valid. This implies that jquery should be robust in handling (temporarily) invalid html, in order to protect the user from having to maintain validity at every single step.</blockquote><p>It can be risky to define our behavior as a superset of the standard. If the standard changes against jQuery's behavior, we're forced to choose between standards and backwards compatibility. </p><p>The <a href="https://github.com/jquery/jquery/pull/1347/files#L1R290" class="ext-link"><span class="icon"></span>pull request</a>, only ensures that there is one child element in the table and (implicitly) that no exception was thrown. I think that is good, actually, because it doesn't put too many constraints on how a browser could handle invalid markup. But what if the browser discarded the text? I haven't looked at the requirements for how HTML5 would parse this but I wouldn't want to go beyond (and certainly not against) that.</p><blockquote> Another, related example of this would be manipulating a table without a tbody. jquery appears to helpfully create a tbody in this case. </blockquote><p>That is required because IE auto-inserts a tbody if we don't. It is easier to make all browsers behave consistently that way. I don't think this case is analogous.</p><blockquote> But what happens if the table is only temporarily without a tbody, and the user adds one later? Suddenly we have two tbodys, which is a problem.</blockquote><p>A table can have multiple tbody elements. <a href="http://dev.w3.org/html5/html-author/#the-table-element" class="ext-link"><span class="icon"></span>http://dev.w3.org/html5/html-author/#the-table-element</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 19, 2013 02:27PM UTC by <span class="author">Dave Methvin</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fix <a href="/ticket/14290">#14290</a>. Don't throw if text node is appended to table. Close gh-1371. </p><p> Changeset: ec3ac9a247ec3132dea3c30ca36cefc217e25441</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
