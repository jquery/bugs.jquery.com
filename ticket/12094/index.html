<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#12094 (Incorrect events triggering order on programmatic .focus()) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/12093/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/12095/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#12094</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(duplicate)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened July 17, 2012 12:58PM UTC</p>
      
        <p>Closed July 17, 2012 02:44PM UTC</p>
      
      
        <p>Last modified July 17, 2012 06:34PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Incorrect events triggering order on programmatic .focus()</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        xmorel
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>event</td>
      
        <th>Version:</th>
      
      <td>1.7.2</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>ie6 ie7 ie8 ie9 ie10</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>The normal workflow of moving focus from one element to an other, is to first trigger blur() on the first field, then trigger focus() on the second one. This is especially important to determine whether focus remains within a group of fields or gets out of those (a timeout can be set up on blur(), cancelled on focus(), if the timeout triggers then the focus has left the group's fields).</p><p>This normal workflow works in all situations: when the user tabs from one field to the next, when the user focuses the second field by clicking, and when focus is programmatically moved via <a href="http://www.w3.org/TR/REC-DOM-Level-1/level-one-html.html#method-focus" class="ext-link"><span class="icon"></span>HTMLElement#focus</a></p><p>But now when using jQuery#focus: <a href="http://jsfiddle.net/FDjFc/1/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/FDjFc/1/</a></p><p>The test case sets up the following:</p><ul><li>Assumes the first field is focused as source</li><li>Logs (prints) when the first field is blurred</li><li>Logs when the second field is focused</li></ul><p>Focus can be moved by pressing the [TAB] key (keypress), clicking on the second field (mouse), pressing the [DOWN] key (programmatic, DOM) and pressing the [UP] key (programmatic, jQuery).</p><p>Case has been tested in:</p><ul><li>Safari 5.1</li><li>Firefox 13</li><li>Opera 12</li><li>Chrome 19</li><li>Internet Explorer 9</li><li>Internet Explorer 8</li></ul><p>In ''all'' of those:</p><ul><li>on keypress, a blur event is triggered on the first field, then a focus even is triggered on the second field</li><li>on mouse, a blur event is triggered on the first field, then a focus even is triggered on the second field</li><li>on programmatic DOM, a blur event is triggered on the first field, then a focus even is triggered on the second field</li></ul><p>Divergences happen *only* in programmatic jQuery:</p><ul><li>Internet Explorer 8 and 9 will trigger focus, blur, then focus again</li><li>Other browsers trigger focus on the second field, then blur on the first one.</li></ul><p>Which means it is ''not possible'' to use the pattern outlined at the top if fields are going to be programmatically focused ''via jQuery'' (or inversely focusing a field programmatically ''via jQuery'' is going to break the pattern).</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (8)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 02:44PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">event</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-new">→ ie6 ie7 ie8 ie9 ie10</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ duplicate</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Focus and blur are miserably quirky in IE all the way up to IE10. We've discussed the issues with the IE team and they plan to look at it, but in the meantime I think there is very little we can do to rectify this from within jQuery. </p><p>I tried to deal with several of these issues such as <a href="/ticket/6705">#6705</a> during the 1.7 era but couldn't find an acceptable solution. Better to have it fire twice than not to fire at all--even though that's EXACTLY what the native handler does when the element already has focus. </p>
            </div>
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 02:44PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Duplicate of <a href="/ticket/6705">#6705</a>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 02:52PM UTC by <span class="author">xmorel</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Erm… I&#39;m sorry but did you actually read the bug or did you just read the title, assume it was an IE bug and tag it? The IE-fires-twice issue is a minor side-note, the bigger issue and the one which is &#39;&#39;broken&#39;&#39; is that jquery fires the blur and focus events &#39;&#39;in the wrong order&#39;&#39; when programmatically focusing a field, that&#39;s got nothing to do with IE, it happens this way in every single browser I tested.</span> → <span class="change-field-new">1342536813856411</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Erm… I'm sorry but did you actually read the bug or did you just read the title, assume it was an IE bug and tag it? The IE-fires-twice issue is a minor side-note, the bigger issue and the one after which the report is titled is that jquery fires the blur and focus events ''in the wrong order'' when programmatically focusing a field, that's got nothing to do with IE, it happens this way in every single browser I tested.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 03:31PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Well I thought I read the bug, but I must have missed an important plot point around chapter 12.</p><p>So if I may do Cliff Notes here, you are saying: </p> <ul><li>**DOM:** <code>A.focus()</code> with B in focus fires blur-B, focus-A.</li> <li>**jQuery:** <code>$A.focus()</code> with B in focus fires focus-A, blur-B.</li></ul><p>Except in IE, where it's more complicated. Is that right?</p><p>And, although it wasn't stated, jQuery's behavior has been like this ever since version 1.1 or so. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 05:32PM UTC by <span class="author">xmorel</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> DOM: A.focus() with B in focus fires blur-B, focus-A.</blockquote><p>and so will user-generated (non-programmatic) focus changes, yes.</p><blockquote> jQuery: $A.focus() with B in focus fires focus-A, blur-B.</blockquote><p>Yes, with the consequence of breaking a widespread pattern for handling focus within a group of fields.</p><blockquote> And, although it wasn't stated, jQuery's behavior has been like this ever since version 1.1 or so.</blockquote><p>I only tested 1.6 and 1.7, but wouldn't be surprised if it were older, so I'll trust you on that.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 06:05PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The break/fix is in the exact same place as the one I marked a dup, it's here:</p><p><a href="https://github.com/jquery/jquery/commit/6a670df9e9b9e5cd278b390a2e99ac179307a4e9#L0R527" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/commit/6a670df9e9b9e5cd278b390a2e99ac179307a4e9#L0R527</a></p><p>The idea was to try and use the native method to get similar behavior, but we can't do that easily because of delegation issues, IE focus inconsistencies, and problems with already-focused elements not firing focus. </p><p>Again, a patch is welcome, but it will still require handling all the special cases where people expect handlers to fire when they natively don't. I wasn't able to figure out a bulletproof solution when I was working on that code.</p><p>The workaround short of a patch is to fire DOM focus manually (e.g., <code>$(el)[0].focus()</code> instead of <code>$(el).focus()</code> and deal with its quirks instead of jQuery's quirks.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 06:25PM UTC by <span class="author">xmorel</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">&gt; The workaround short of a patch is to fire DOM focus manually&#92;
&#92;
Sure, and that&#39;s what we implemented, but it&#39;s rather frustrating to look for fuck-ups in your code, and end up realizing select&#39;s broken after all, in a way which diverges from all native behavior.</span> → <span class="change-field-new">1342549564791667</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>_comment1:</th>
                  <td>
                    
                      <span class="change-field-old">&gt; The workaround short of a patch is to fire DOM focus manually&#92;
&#92;
Sure, and that&#39;s how we fixed it, but it&#39;s rather frustrating to look for fuck-ups in your code, and end up realizing select&#39;s broken after all, in a way which diverges from all native behavior.</span> → <span class="change-field-new">1342549881154411</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>_comment2:</th>
                  <td>
                    
                      <span class="change-field-old">&gt; The workaround short of a patch is to fire DOM focus manually&#92;
&#92;
Sure, and that&#39;s how we fixed it, but it&#39;s rather frustrating to look for fuck-ups in your code, and end up realizing select&#39;s broken after all, in a way which diverges from all native behavior.&#92;
&#92;
edit: although&#92;
&#92;
&gt; The idea was to try and use the native method to get similar behavior, but we can&#39;t do that easily because of delegation issues&#92;
&#92;
for focus/blur, does that not happen just when the events are delegated? We&#39;re using direct binding — as in the demo case I posted — so the events &#39;&#39;should&#39;&#39; go through native should they not?</span> → <span class="change-field-new">1342550013971842</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>_comment3:</th>
                  <td>
                    
                      <span class="change-field-old">&gt; The workaround short of a patch is to fire DOM focus manually&#92;
&#92;
Sure, and that&#39;s how we fixed it, but it&#39;s rather frustrating to look for fuck-ups in your code, and end up realizing select&#39;s broken after all, in a way which diverges from all native behavior.&#92;
&#92;
edit: although&#92;
&#92;
&gt; The idea was to try and use the native method to get similar behavior, but we can&#39;t do that easily because of delegation issues&#92;
&#92;
for focus/blur, does that not happen just when the events are delegated? We&#39;re using direct binding — as in the demo case I posted — so the events &#39;&#39;should&#39;&#39; go through native should they not? Or is the issue with the morphing-on-trigger, which converts the native events and blows up the ordering?</span> → <span class="change-field-new">1342550063814695</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
        
          
        
          
        
          
            <div class="ticket-comment-body">
              <blockquote> The workaround short of a patch is to fire DOM focus manually</blockquote><p>Sure, and that's how we fixed it, but it's rather frustrating to look for fuck-ups in your code, and end up realizing select's broken after all, in a way which diverges from all native behavior.</p><p>edit: although</p><blockquote> The idea was to try and use the native method to get similar behavior, but we can't do that easily because of delegation issues</blockquote><p>for focus/blur, does that not happen just when the events are delegated? We're using direct binding — as in the demo case I posted — so the events ''should'' go through native should they not? Would the issue not be with the morphing-on-trigger, which converts the native events and blows up the ordering, rather than with the change you link to?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 17, 2012 06:34PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The source is there if you'd like to make suggestions. Maybe you could solve the problem. I've explained why we can't do EXACTLY what the native method does, it's not what people expect to happen. They want their focus/blur handler to fire when they trigger an event, regardless of whether the element is in focus/blur at the moment.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
