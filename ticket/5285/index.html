<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#5285 (IE7 &amp;amp; IE8 leak memory in jQuery.remove, probably caused by jQuery.data) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/5284/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/5286/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#5285</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened September 23, 2009 02:20PM UTC</p>
      
        <p>Closed September 24, 2009 01:37AM UTC</p>
      
      
        <p>Last modified March 10, 2012 05:31AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">IE7 &amp; IE8 leak memory in jQuery.remove, probably caused by jQuery.data</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        EliAndrewC
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.4">1.4</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>data</td>
      
        <th>Version:</th>
      
      <td>1.3.2</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>memory-leak data event remove</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Note: this problem was explored in depth on this Stack Overflow question and answer: <a href="http://stackoverflow.com/questions/1462649/jquery-memory-leak-with-dom-removal" class="ext-link"><span class="icon"></span>http://stackoverflow.com/questions/1462649/jquery-memory-leak-with-dom-removal</a></p><p>I've attached a page which demonstrates a memory leak in remove.  Interestingly, this memory leak is caused by the remove function's call to jQuery.event.remove which calls jQuery.data to see whether there are any events.</p><p>As documented in the Stack Overflow answer, this call to jQuery.data ends up creating an attribute to store the jQuery.cache id using the value of the expando variable as the attribute name.  However, it does this even when we're only reading the data, so if we add a check for this</p><p>if (!id && data===undefined)</p><p>    return undefined</p><p>then it makes the memory leak go away.  I actually have no idea why this makes the memory leak go away, since the attribute that stores the jQuery.cache id is deleted by the jQuery.removeData function, which is called in remove.</p><p>So basically, I have no idea why this memory leak exists, but it definitely does in both IE8 and IE8 compatibility mode (which makes me assume that it also exists in IE7).  This problem does not occur in Firefox.</p><p>Hopefully my attached proof-of-memory-leak plus the info I've provided will be more enlightening to people more familiar with jQuery's internals.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (1)</summary>

  <ul class="ticket-attachments">
    
      <li>
        <a href="/attachment/ticket/5285/jquery_memleak.html/index.html">jquery_memleak.html</a> (0.5 KB) - added by EliAndrewC
        <strong>September 23, 2009 02:22PM UTC</strong>.<br>
        <p>Standalone html file which demonstrates this memory leak.  I refer to the googleapi jquery.min.js to avoid having to attach it, but I did test with the latest jQuery (1.3.2)</p>
      </li>
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (4)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 24, 2009 01:37AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This appears to be fixed in SVN.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 14, 2011 11:12PM UTC by <span class="author">olau</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hey, did you actually run the test case? If I change it to use 1.5 or 1.5.1 and run it in sieve (with IE 6), I still get the leak? I'm asking because I'm seeing some leaks in IE with Flot, and they mostly seem to come from exactly this use case, appending some stuff to a div and then deleting it afterwards.</p><p>One can download sieve here:</p><p><a href="http://home.wanadoo.nl/jsrosman/" class="ext-link"><span class="icon"></span>http://home.wanadoo.nl/jsrosman/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 15, 2011 11:32AM UTC by <span class="author">olau</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hm, when I try it outside sieve, I don't seem to be getting the same result. Tried modifying the test case to increase the garbage produced and ran it directly in IE 6, 7 and 8 from the IE Collection. The memory usage is going up and down, but doesn't really seem to increase.</p><p>Sorry for the probably false alarm.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 26, 2011 06:31PM UTC by <span class="author">yuriy.horobey@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi guys, please see this issue again -- I have exactly the same problem with <a href="/wiki/FireFox">FireFox</a> 5.0.1</p><p>I have a table with about 5 rows, each row is loaded by ajax like this:</p><p>(each tr has custom attribute "job_id")</p><p>$(document).ready(function() {</p><p>    $(function() {</p><p>         runJobRowUpdater();</p><p>    });</p><p>});</p><p>function runJobRowUpdater() {</p><p>    var jobRows = $("tr[job_id]");</p><p>    for (var i = 0; i &lt; jobRows.length; i++) {</p><p>        var $row = $(jobRows[i]);</p><p>        var job_id = $row.attr("job_id")</p><p>        if (job_id) {</p><p>            updateJobRow(job_id);</p><p>        }</p><p>    }</p><p>}</p><p>function updateJobRow(job_id) {</p><p>    var $row = $("tr[job_id='" + job_id + "']");</p><p>    if (job_id) {</p><p>        $row.load("/jobs/" + job_id + "/row", function() {</p><p>            setTimeout("updateJobRow( " + job_id + "  )", 5000);</p><p>        });</p><p>    }</p><p>}</p><p></p><hr><p></p><p>So, each 5 seconds each row is loaded by ajax and sets timeout for next 5 seconds and so on.</p><p>After half an hour FF reports something like 2GB(!!!!) memory usage</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
