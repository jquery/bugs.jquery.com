<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#7083 (ifModified option - response status &amp;quot;notmodified&amp;quot; unreachable) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/7082/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/7084/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#7083</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(worksforme)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened September 26, 2010 12:07AM UTC</p>
      
        <p>Closed September 26, 2010 04:46AM UTC</p>
      
      
        <p>Last modified September 26, 2010 10:59AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">ifModified option - response status &quot;notmodified&quot; unreachable</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        jthelen
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        blocker
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.4.3">1.4.3</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.4.2</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>ifmodified, notmodified, lastmodified, etag</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><h2>Test case</h2><pre class="wiki">
$.ajax({url: 'http://example.com/whatever',
  ifModified: true,
  success: function(data, textStatus, xhr) {
  },
  error: function(xhr, textStatus) {
    alert(textStatus);
  }
});
</pre><p>Assume receiving a normal 304 response like this:</p><pre class="wiki">
HTTP/1.1 304 Not Modified
Date: Sat, 25 Sep 2010 23:13:59 GMT
Server: Apache/2.2.11
Connection: Keep-Alive
Keep-Alive: timeout=5, max=99
ETag: "2800000010766f-1a84-49116a4d99f1d"
</pre><h2>Expected result</h2><p>Alert of "notmodified".</p><h2>Actual result</h2><p>Alerts always "error", never "notmodified".</p><h2>Supposed cause</h2><p>Looking at the ajax response handling code of jquery 1.4.2, tracked it down to this:</p><pre class="wiki">
:
: line 5182 (onreadystatechange)

status = isTimeout === "timeout" ?
  "timeout" :
  !jQuery.httpSuccess( xhr ) ?
    "error" :
    s.ifModified && jQuery.httpNotModified(xhr, s.url ) ?
      "notmodified" :
      "success";

:
: line 5320 (httpSuccess)

return
  !xhr.status && location.protocol === "file:" ||
  ( xhr.status &gt;= 200 && xhr.status &lt; 300 ) ||
  xhr.status === 304 || xhr.status === 1223 ||
  xhr.status === 0;
</pre><p>Note that httpSuccess will always return <strong>true</strong> in our test case because of <strong>xhr.status === 304</strong>, resulting in status always being set to "error" and never reaching</p><pre class="wiki">
  s.ifModified && jQuery.httpNotModified(xhr, s.url ) ?
    "notmodified" :
    "success";
</pre></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (2)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 26, 2010 04:46AM UTC by <span class="author">snover</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ worksforme</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You are not reading that code properly. Returning true from httpSuccess means that the conditional moves to the right side of the <code>:</code> because of the boolean negation operator. jQuery ajax requests would be completely broken if your supposition were true.</p><p>I am not able to reproduce this issue. Testing with both <code>If-Modified-Since</code> and <code>If-None-Match</code> works properly across IE7+ Fx3.6+ Saf5, Chr6, O10.6+. I would recommend you post your full code to the <a href="http://forum.jquery.com" class="ext-link"><span class="icon"></span>jQuery Forum</a> and ask for support there.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 26, 2010 10:59AM UTC by <span class="author">jthelen</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 snover]:</p><blockquote> You are not reading that code properly...</blockquote><p>Argl, mea culpa. You are absolutely right, of course.</p><p>I forgot about the right-to-left associativity of the ! operator, when not using explicit parantheses. I'm always thinking in left-to-right parantheses, wrongly interpreting as</p><pre class="wiki">
(!xhr.status && location.protocol === "file:") ||
(xhr.status &gt;= 200 && xhr.status &lt; 300) ||
(xhr.status === 304) || (xhr.status === 1223) ||
(xhr.status === 0)

</pre><p>instead of</p><pre class="wiki">
!( xhr.status && location.protocol === "file:" || 
   ( xhr.status &gt;= 200 && xhr.status &lt; 300 ) ||
   xhr.status === 304 || xhr.status === 1223 ||
   xhr.status === 0 )
</pre><p>Meanwhile I found a 503 reponse incoming right before a 304 response is causing my problem. Using periodical (interval) ajax requests to the same URL. Somehow the xmlHttpRequest of the response still contains the former 503 data, instead of the 304. Still investigating, maybe got trapped by the used closure. But that's another story...</p><p>Thanks for taking the time and pointing me in the right direction.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
