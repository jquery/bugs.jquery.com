<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#8095 (ifModified caching functionality doesn&amp;#39;t work if set &amp;quot;cache: false&amp;quot;) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/8094/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/8096/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#8095</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened January 31, 2011 09:54AM UTC</p>
      
        <p>Closed January 31, 2011 07:00PM UTC</p>
      
      
        <p>Last modified March 19, 2012 09:24PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">ifModified caching functionality doesn&#39;t work if set &quot;cache: false&quot;</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        Vadim Kiryukhin
      </td>
      <th>Owned by:</th>
      <td>jaubourg</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.5.1">1.5.1</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.5</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p><strong>1. The version(s) of jQuery affected:</strong></p><p>version 1.4.4</p><p><strong>2. The browser (or browsers) that you are able to reproduce the bug in, including version numbers:</strong></p><p>Firefox, Chrome, IE</p><p><strong>3. The operating system (or operating systems) you experienced the bug on.</strong></p><p>Windows, Linux</p><p><strong>4. Step-by-step instructions on how to reproduce the issue, including any required system configuration changes</strong></p><p>Set option "cache" to false and option "ifModified" to true. </p><pre class="wiki">
$.ajax({
...
cache: false,
ifModified:true,
...

});
</pre><p>reproducible: 100%</p><p><strong>5. A description of what you expect to happen, and what actually happens</strong></p><p><strong>Expected:</strong> standard HTTP/1.1 cache exchange with ETag / If-None-Modified / "304 Not Modified" like it works if option ajax "cache" set to "true";</p><p><strong>Actual</strong>: cache exchange broken; jQuery doesn't send If-None-Modified" to server, so server always send "200 OK" status.</p><p><strong>The reason:</strong></p><p><strong>a)</strong> Option "cache:false" adds a random suffix (which is a current timestamp) to url. So url is never the same.</p><p><strong>b)</strong> Data from ETag header is saved in hash array where this url is used as a key.</p><p><strong>c)</strong> Next cycle jQuery generate a new suffix and attached it to url, then checks hash array using this new url a key to get saved value. </p><p>obviously, the value doesn't exist, so jQuery doesn't set If-None-Modified" header and server can't issue 304 response.</p><p><strong>Solution:</strong></p><p>'''don't use s.url as a key. Use a separate variable instead.'''</p><p>link to example to see this bug: </p><p><a href="http://www.eslinstructor.net/test/jquerybug/bug.html" class="ext-link"><span class="icon"></span>http://www.eslinstructor.net/test/jquerybug/bug.html</a></p><p>link to fixed version: </p><p><a href="http://www.eslinstructor.net/test/jquerybug/fixed.html" class="ext-link"><span class="icon"></span>http://www.eslinstructor.net/test/jquerybug/fixed.html</a></p><p>link to php (text), which I use for testing:</p><p><a href="http://www.eslinstructor.net/test/jquerybug/get_server_time.php.txt" class="ext-link"><span class="icon"></span>http://www.eslinstructor.net/test/jquerybug/get_server_time.php.txt</a></p><p>link to suggested fix (diff )</p><p><a href="http://www.eslinstructor.net/test/jquerybug/diff.txt" class="ext-link"><span class="icon"></span>http://www.eslinstructor.net/test/jquerybug/diff.txt</a></p><p>This solution (diff.txt) is tested for IE, Firefox, Chrome on Windows and Firefox on Linux. </p><p>This solution (diff.txt) DOESN'T WORK on Opera on Linux. I think there is another  jQuery bug, which prevent processing "304 Not Modified" header correctly in Opera. These two bugs are not  related.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (7)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2011 10:58AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">I&#39;m quite puzzled at why you would want to set cache to false and have ifModified set to true. Doing so, you&#39;re specifically asking ajax to make the response non-cachable yet still expect a &quot;304 Not Modified&quot; response (ie. a cached response).&#92;
&#92;
Current behaviour makes perfect sense:&#92;
1) hashmap key must be the full url with parameters (your &quot;solution&quot; didn&#39;t include the data into the cache_key),&#92;
2) If and when, cache is set to false, the anti-cache parameter is part of the full url and, thus, data is always pulled from the server and no 304 will ever be issued, which is actually exactly what the cache option is supposed to ensure.&#92;
&#92;
So, if you want to use ifModified and get 304 responses, just don&#39;t set the cache option to false.</span> → <span class="change-field-new">1296471614419133</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>I'm quite puzzled at why you would want to set cache to false and have ifModified set to true. Doing so, you're specifically asking ajax to make the response non-cachable yet still expect a "304 Not Modified" response (ie. a cached response).</p><p>Current behaviour makes perfect sense:</p><ul><li>hashmap key must be the full url with parameters (your "solution" didn't include the data into the cache_key),</li><li>If and when, cache is set to false, the anti-cache parameter is part of the full url and, thus, data is always pulled from the server and no 304 will ever be issued, which is actually exactly what the cache option is supposed to ensure.</li></ul><p>So, if you want to use ifModified and get 304 responses, just don't set the cache option to false.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2011 05:47PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 jaubourg]:</p><blockquote> I'm quite puzzled at why you would want to set cache to false and have ifModified set to true. Doing so, you're specifically asking ajax to make the response non-cachable yet still expect a "304 Not Modified" response (ie. a cached response).  Current behaviour makes perfect sense: * hashmap key must be the full url with parameters (your "solution" didn't include the data into the cache_key), * If and when, cache is set to false, the anti-cache parameter is part of the full url and, thus, data is always pulled from the server and no 304 will ever be issued, which is actually exactly what the cache option is supposed to ensure.  So, if you want to use ifModified and get 304 responses, just don't set the cache option to false.</blockquote><p>I set ''cache:false'' to prevent <strong>IE</strong> to cache Ajax GET <strong>REQUESTS</strong>, not Respond... There is no relation to "304 Not Modified" as request simply not sent.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2011 06:51PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">closed</span> → <span class="change-field-new">reopened</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 anonymous]:</p><blockquote> Replying to [comment:1 jaubourg]: &gt; I'm quite puzzled at why you would want to set cache to false and have ifModified set to true. Doing so, you're specifically asking ajax to make the response non-cachable yet still expect a "304 Not Modified" response (ie. a cached response). &gt;  &gt; Current behaviour makes perfect sense: &gt; * hashmap key must be the full url with parameters (your "solution" didn't include the data into the cache_key), &gt; * If and when, cache is set to false, the anti-cache parameter is part of the full url and, thus, data is always pulled from the server and no 304 will ever be issued, which is actually exactly what the cache option is supposed to ensure. &gt;  &gt; So, if you want to use ifModified and get 304 responses, just don't set the cache option to false.    I set ''cache:false'' to prevent <strong>IE</strong> to cache Ajax GET <strong>REQUESTS</strong>, not Respond... There is no relation to "304 Not Modified" as request simply not sent.</blockquote><p>Oh, I see where you're coming from now. You wanna bypass any IE caching while your server-side code ignores the anti-cache parameter jQuery added and delivers proper headers.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2011 06:51PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ jaubourg</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">reopened</span> → <span class="change-field-new">assigned</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 31, 2011 07:00PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">assigned</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixes <a href="/ticket/8095">#8095</a>. Properly handles the case where browser cache needs to be bypassed while server-side logic still delivers proper 304 responses. Unit test added. </p><p> Changeset: f43572d3b86074afc561822b7fd9592e1f05d19b</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 01, 2011 11:58AM UTC by <span class="author">jitter</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.next</span> → <span class="change-field-new">1.5.1</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 02, 2011 02:44AM UTC by <span class="author">jitter</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.4.4</span> → <span class="change-field-new">1.5</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
