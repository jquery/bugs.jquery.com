<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#10345 (IE&amp;lt;=8 preventDefault doesn&amp;#39;t prevent an element from taking focus) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/10344/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/10346/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#10345</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(patchwelcome)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened September 26, 2011 02:47PM UTC</p>
      
        <p>Closed October 07, 2011 01:18AM UTC</p>
      
      
        <p>Last modified April 30, 2014 07:13PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">IE&lt;=8 preventDefault doesn&#39;t prevent an element from taking focus</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        ajones754
      </td>
      <th>Owned by:</th>
      <td>ajones754</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.6.4</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>In IE&lt;=8, an element which makes a preventDefault() call when handling an event does not stop that element from stealing focus from another currently focused element.</p><p>Full HTML page code follows. Tested with jQuery 1.6.4 and 1.5.1. giving same result.</p><pre class="wiki">

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt; &lt;!-- http://www.w3.org/QA/2002/04/valid-dtd-list.html --&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;
 &lt;meta http-equiv="content-type" content="text/html;charset=utf-8" /&gt;
 &lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"&gt;&lt;/script&gt;
 &lt;style&gt;
 div:focus{background-color:cyan;}
 &lt;/style&gt;
 &lt;script type="text/javascript"&gt;
 $(document).ready(function(){
 $("#div3").mousedown(function(event){ event.preventDefault(); });
 });
 &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
 &lt;div id="div1" tabindex=1&gt;Div 1 - click me to focus&lt;/div&gt;
 &lt;div id="div2" tabindex=2&gt;Div 2 - click me to focus&lt;/div&gt;
 &lt;div id="div3"&gt;Div 3 - click on me to (erroneously) steal focus in IE&lt;=8. But not in IE9/FF/Chrome.&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;


</pre></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (9)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 26, 2011 02:51PM UTC by <span class="author">ajones754</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>jsFiddle: <a href="http://jsfiddle.net/KQBfP/3/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/KQBfP/3/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 26, 2011 09:49PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ ajones754</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Does the same problem occur if the example is coded in pure DOM functions? If so we probably can't fix it.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 28, 2011 04:54PM UTC by <span class="author">ajones754</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The problem does seem to occur in pure DOM functions i.e.</p><pre class="wiki">
&lt;div onmousedown="return false;"&gt;&lt;/div&gt;
</pre><p>However, I have found a workaround. It appears that the document.activeElement doesn't actually get set by IE until a later stage - so I store it and make a timeout that refocuses it after the mousedown has been handled: <a href="http://jsfiddle.net/KQBfP/5/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/KQBfP/5/</a></p><p>Can this workaround be intergrated into jQuery? If so, I think the only extra work needed would be to integrate this technique with jQuery's existing event handlers. Basically, all event handlers would have to wait for the originally focused element to be refocused before executing - in case they reference document.activeElement themselves.</p><p>Also, the .focus() call in refocus() (see the jsFiddle) would not have to trigger any .focus() event handlers itself.</p><p>Of course, all of this is IE&lt;=8 conditional.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 28, 2011 06:01PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for doing some research on this. Can you verify that the jQuery(edge) build fixes this problem? If so, it should work fine in 1.7.</p><p><a href="http://jsfiddle.net/KQBfP/9/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/KQBfP/9/</a></p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 28, 2011 06:43PM UTC by <span class="author">ajones754</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">new</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>No worries. jQuery(edge) doesn't appear to fix the issue; clicking on div3 can still steal focus from div1 or div2.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 07, 2011 01:18AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ patchwelcome</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I agree, 1.7b1 doesn't fix the problem but since it breaks for bare DOM that isn't too surprising.</p><blockquote> However, I have found a workaround. It appears that the document.activeElement doesn't actually get set by IE until a later stage - so I store it and make a timeout that refocuses it after the mousedown has been handled</blockquote><p>It is very risky to incorporate fixes into core that involve asynchronous actions, since they can cause problems if subsequent (immediate) events would override that delayed action.</p><p>I tried looking at special IE events like <code>onbeforeactivate</code> but they don't leave the focus in the right place:</p><p><a href="http://msdn.microsoft.com/en-us/library/ms536791%28v=vs.85%29.aspx" class="ext-link"><span class="icon"></span>http://msdn.microsoft.com/en-us/library/ms536791%28v=vs.85%29.aspx</a></p><p>This is a pretty obscure edge case so I am going to close it. If there is a way to fix it that doesn't involve asynchronous actions I'd consider it though.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2011 04:28AM UTC by <span class="author">spekary</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This bug is currently blocking a fix in jQueryUi for Autocomplete. See <a href="https://github.com/scottgonzalez/jquery-ui/compare/autocomplete-syncchange." class="ext-link"><span class="icon"></span>https://github.com/scottgonzalez/jquery-ui/compare/autocomplete-syncchange.</a> It is mentioned on the net here: <a href="http://stackoverflow.com/questions/6677082/ie-event-propagation-problem-jquery-autocomplete-jscrollpane" class="ext-link"><span class="icon"></span>http://stackoverflow.com/questions/6677082/ie-event-propagation-problem-jquery-autocomplete-jscrollpane</a></p><p>and also appears to be the cause of this old bug and other similar bugs:</p><p><a href="http://bugs.jquery.com/ticket/4029" class="ext-link"><span class="icon"></span>http://bugs.jquery.com/ticket/4029</a></p><p>So, its not that obscure of an edge case. For lots of current and future jQueryUI stuff, its pretty important to be able to keep a mousedown from causing a blur event.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2011 12:01PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:7 spekary]:</p><blockquote> This bug is currently blocking a fix in jQueryUi for Autocomplete.</blockquote><p>I don't think that's true. A bug in IE is blocking the fix for autocomplete. IE treats focus/blur asynchronously anyway, so there's nothing jQuery can do to fix the problem.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 30, 2014 07:13PM UTC by <span class="author">laughinghan@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is 3 years late but I just discovered there is in fact a way to get IE ≤ 8 to do what <code>e.preventDefault()</code> on <code>mousedown</code> does in other browsers (which prevents selection <em>**and**</em> prevents focus): set the <code>unselectable</code> attribute! <a href="http://stackoverflow.com/a/17525223/362030" class="ext-link"><span class="icon"></span>http://stackoverflow.com/a/17525223/362030</a></p><p>Note that unlike the workarounds always suggested (including comment:3), which always boil down to <code>setTimeout(function() { thingIDidntWantFocusStolenFrom.focus(); })</code>, this prevents focus from ever being stolen by the <code>mousedown</code> target in the first place!</p><p>What's funny about <code>unselectable</code> is that it isn't inherited, so it's often overlooked in favor of the <code>selectstart</code> event (which bubbles, and <code>e.preventDefault()</code> on which prevents selection but <em>**doesn't**</em> prevent focus), or set on every descendant element with a tree-traversal, but you can actually just set it on <code>event.target</code> on <code>mousedown</code>: <a href="http://jsbin.com/yagekiji/1" class="ext-link"><span class="icon"></span>http://jsbin.com/yagekiji/1</a></p><p>Unfortunately I can't think of a way to work this into a clean jQuery patch that avoids asynchronous actions, because setting <code>unselectable</code> is a permanent side-effect. The main problem, permanency, that just because <code>e.preventDefault()</code> was called on <em>**this**</em> <code>mousedown</code> doesn't mean we want selection and focus prevented forever, should be completely solved by listening for the next <code>mousedown</code> and, before running any user-supplied handlers, resetting (unsetting) <code>unselectable</code> (it only blocks selections starting in that element, which must fire <code>mousedown</code> on that element first). The minor problem, that it's a side-effect and the user could theoretically check for <code>unselectable</code> on the DOM element, is kind of <em>well you're peeking at exactly the stuff you asked us to hide from you, what did you expect</em>, but could be mitigated by resetting (unsetting) <code>unselectable</code> in a timeout after the <code>mousedown</code>.</p><p>In any case, I think this is an ingenious workaround for the common use case of "I don't want clicking anywhere in this element to steal focus from anywhere, ever"!</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
