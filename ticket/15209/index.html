<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#15209 (Scripts not being evaluated) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/15208/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/15210/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#15209</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(patchwelcome)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened August 10, 2014 05:07PM UTC</p>
      
        <p>Closed August 10, 2014 10:16PM UTC</p>
      
      
        <p>Last modified August 12, 2014 12:53AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Scripts not being evaluated</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        Dasher225
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.11.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Scripts are not being evaluated when I expect them to.</p><p>See here: <a href="http://jsfiddle.net/fz53r1kj/1/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/fz53r1kj/1/</a></p><p>In the jsFiddle, str1 is equal to the following. str2 is the same without the first script (which sorts).</p><p></p><hr><p></p><p>&lt;script&gt;</p><p>  var i, len, sortedChildren;</p><p>  sortedChildren = $('.rows').children().sort(function (a, b) {</p><p>    return $(a).data('rank') &lt; $(b).data('rank') ? -1 : 1;</p><p>  });</p><p>  for (i = 0, len = sortedChildren.length; i &lt; len; i++) {</p><p>    child = sortedChildren[i];</p><p>    $('.rows').append(child);</p><p>  }</p><p>&lt;/script&gt;</p><p>&lt;div class="rows"&gt;</p><p>  &lt;div data-rank="3"&gt;</p><p>    Three</p><p>    &lt;script&gt;$(‘[data-rank=3]’).css(color: ‘red’);&lt;/script&gt;</p><p>  &lt;/div&gt;</p><p>  &lt;div data-rank="2"&gt;</p><p>     Two</p><p>    &lt;script&gt;$(‘[data-rank=2]’).css(color: ‘green’);&lt;/script&gt;</p><p>  &lt;/div&gt;</p><p>  &lt;div data-rank="1"&gt;</p><p>    One</p><p>    &lt;script&gt;$(‘[data-rank=1]’).css(color: ‘blue’);&lt;/script&gt;</p><p>  &lt;/div&gt;</p><p>&lt;/div&gt;</p><p></p><hr><p></p><p>When appending str1, the scripts in the rows do not run.</p><p>When appending str2, the scripts in the rows run.</p><p>Thus it appears appending the elements a second time prevents the scripts inside from running.</p><p>Using jsFiddle this appears in chrome, firefox, and safari on Mac for all jquery versions 1.9.1 and later. It works as expected in 1.8.3 and earlier.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (4)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 10, 2014 10:16PM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ patchwelcome</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I tried to clean up your fiddle for better readability: <a href="http://jsfiddle.net/fz53r1kj/2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/fz53r1kj/2/</a></p><p>And it looks like you're really playing with fire. After your HTML (<code>&lt;script&gt;…&lt;/script&gt;&lt;div id="rows"&gt;…&lt;/div&gt;</code>) enters the body, we attempt to evaluate all four scripts (one doing <code>$rows.append( $rows.children().sort() )</code> and three doing <code>$row.css( "color", … )</code>). However, <strong>the first script manipulates containing elements of the later scripts</strong>, and when that happens our <code>buildFragment</code> code backing <code>.append</code> finds them in the document and therefore marks them as ''already'' executed, causing them to be skipped after the first script finishes. In short, recursive DOM manipulation doesn't play nice with synchronous (and singular) script execution.</p><p>I don't want to spend any time on this hairy edge case, but if you do then I would consider landing a solid (and small) pull request. However, that time would probably be better spent evaluating other ways to solve whatever problem led you to this bug report—if you can factor out the dependence on jQuery evaluating scripts for you, you will be happier when our behavior changes in future releases.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 11, 2014 05:10PM UTC by <span class="author">Dasher225</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Yep I learned what was causing them when trying to figure out what was wrong. </p><p>I do believe this is an edge case and I worked around it by just doing the sorting later. </p><p>One thing I don't understand though is why scripts are marked as run when they are appended after already being in the dom instead of when they are actually run. </p><p>Would changing where scripts are marked as run be an acceptable solution?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 11, 2014 06:43PM UTC by <span class="author">gibson042</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 Dasher225]:</p><blockquote> One thing I don't understand though is why scripts are marked as run when they are appended after already being in the dom instead of when they are actually run.  Would changing where scripts are marked as run be an acceptable solution?</blockquote><p>Only if it covered the case of scripts in the document that were not put there by jQuery (e.g., <code>&lt;div id="foo"&gt;&lt;script&gt;runOnce()&lt;/script&gt;&lt;/div&gt;&lt;script&gt;$("#foo").appendTo("#newContainer")&lt;/script&gt;</code>). This is why any script we find in the document is assumed to have already executed (and note that we mark scripts as executed when we ''find'' them instead of when we execute them because many scripts—in fact most—are executed outside of our knowledge and control).</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 12, 2014 12:53AM UTC by <span class="author">Dasher225</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Auhh cool. Thank you for the context. I will try and come up with a solution that takes that into account</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
