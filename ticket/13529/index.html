<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13529 ($.ajax() Deferred does not pass json data) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13528/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13530/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#13529</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(notabug)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened February 27, 2013 05:27PM UTC</p>
      
        <p>Closed February 27, 2013 11:44PM UTC</p>
      
      
        <p>Last modified February 28, 2013 10:19AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">$.ajax() Deferred does not pass json data</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        martijn@thany.nl
      </td>
      <th>Owned by:</th>
      <td>martijn@thany.nl</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        high
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.9.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>When calling a (proper) json handler that returns data (obviously), I'm doing that using the <code>$.ajax()</code> method, like this:</p><pre class="wiki">
#!js
$.ajax({
  cache: false,
  data: { foo: "bar" },
  dataType: "json",
  type: "POST",
  url: "some-url-that-returns-something.json",
  success: function(data) {
    //Yay json data!
  }
}).complete(function(data) {
  //Omg my json data's not here!
});
</pre><p>For illustration purposes, I'm using both the success callback of the <code>$.ajax</code> function, and the complete function of the <code>$.Deferred</code> interface. In the real world, I prefer to use the latter only.</p><p>But in the latter case, the json data is no longer accessible... It's not in <code>this</code>, not in any of the arguments, not in any properties of any of the <code>arguments</code>. Yesss, there's <code>data.responseText</code>, but that's just a string and not json data. Yesss, I can parse it yet again, but it's already been parsed (and potentionally gone through a converter if supplied) so doing it again is pointless.</p><p>So, I say this is a bug.</p><p>Which browser doesn't matter, but I tried in Firefox 19.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (10)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 05:35PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ martijn@thany.nl</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Are you saying there is a bug in that it's not working as documented? Can you point to the documentation that says the <code>.complete()</code> method on a jQXHR should be passed the data as its first argument?</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 05:56PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 dmethvin]:</p><blockquote> Are you saying there is a bug in that it's not working as documented? Can you point to the documentation that says the <code>.complete()</code> method on a jQXHR should be passed the data as its first argument?</blockquote><p>In case of a success, it should, it is unit tested afaik. What I'd like to see is an actual test case.</p><p>Also, to the OP, why don't you use <code>.done</code> rather than <code>.complete</code>?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 05:58PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>@dmethvin, scrap that, I mixed things with <code>.always</code> :/</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 08:08PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Actually, this hit me in real code as well. I&#39;d be for passing the parsed JSON to complete as well. I ended up re-parsing. Btw, I don&#39;t think the OP is saying the docs aren&#39;t clear, just that the current behavior is neither intuitive or efficient(since the JSON has already been parsed and correctly passed to success) in terms of dealing with JSON responses in the complete callback. I gotta go with the OP on this one.</span> → <span class="change-field-new">1361995761514300</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">high</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">git</span> → <span class="change-field-new">1.9.1</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Actually, this hit me in real code as well. I'd be for passing the parsed JSON to complete. I ended up re-parsing. Btw, I don't think the OP is saying the docs aren't clear, just that the current behavior is neither intuitive or efficient(since the JSON has already been parsed and correctly passed to success) in terms of dealing with JSON responses in the complete callback. I gotta go with the OP on this one.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 08:25PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Well, now that I think more about the implementation, we may not be able to guarantee the JSON would always be there since the complete callback is also called on failure (when there may not be any JSON to parse). So to make parameters consistent, it may have to stay inefficient, amd admittedly confusing. </p><p>Still, the data has been parsed so it would be reasonable to assume the parsed data would be available when you hit <code>always</code>. We _could_ perhaps tack on data as a 3rd argument when available and leave it up to the user to validate callback arguments. I'd be down for that, but if arguments are not validated and JSON is expected, complete callbacks will throw an error whenever there is a failure that does not provide JSON. In my opinion, a reasonable risk taken for the sake of convenience and overall performance, but others may not agree.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 10:42PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>There are a few things going on here, all tangled into one "bug report" that isn't a bug but more a series of documented but unfortunate coincidences. I think this is all working as documented:</p><p>1) The <code>.complete()</code> method of jQXHR is deprecated, and the <code>.always()</code> method of <code>$.Deferred</code> takes its place.</p><p>2) The creator of a <code>$.Deferred()</code> gets the opportunity to define what arguments are passed to <code>.done()</code> and <code>.fail()</code> handlers. They do not have to be identical and in fact often are not.</p><p>3) As a result of (2) the <code>.always()</code> handler cannot be guaranteed it will get a consistent set of arguments. The <code>$.Deferred()</code> creator must ensure it by design.</p><p>4) To simplify migration from the old-style callbacks and because there was no good reason to change it, we used the same argument lists for the <code>.done()</code> and <code>.fail()</code> methods in 1.5. At this point the trap was set.</p><p>5) In 1.6 we added the <code>.always()</code> method, whose added handlers are always called and passed the arg list of the <code>.resolve()</code> or <code>.reject()</code> call. So we get this signature:</p><pre class="wiki">
jqXHR.always(function(data|jqXHR, textStatus, jqXHR|errorThrown) { });
</pre><p>6) The <code>.always()</code> method isn't guaranteed to have the converted data, either the HTTP request or data conversion may have failed. But if it succeeded, the data should be the first argument. You will need to figure out whether it is the data you wanted or a jQXHR by looking at the third arg to see if it is a string.</p><p>7) Yeah.</p><p>Error case: <a href="http://jsfiddle.net/dmethvin/WVrxw/1/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/dmethvin/WVrxw/1/</a></p><p>Success case: <a href="http://jsfiddle.net/dmethvin/WVrxw/2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/dmethvin/WVrxw/2/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 11:29PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>We're over-thinking this... a lot. The OP clearly should use <code>.done</code> because his intention is to get the parsed data that is only present in case of a success. Using <code>.complete</code> is bad practice here, plain and simple.</p><p>Now, we discussed the order of arguments for success and error handlers ad nauseum before: we just cannot change them without breaking every single app in the known universe.</p><p>Also, as a side note, you can make sure the json data is on the jqXHR instance by doing so:</p><pre class="wiki">$.ajaxSetup({
  responseFields: {
    "json": "responseJSON"
  }
});
</pre><p>Now, everytime you request json successfully, the <code>jqXHR</code> instance will have the <code>responseJSON</code> field set properly.</p><p>Also, if we finally merge <a href="https://github.com/jquery/jquery/pull/1164" class="ext-link"><span class="icon"></span>PR1164</a>, this is fixed because the <code>responseJSON</code> field is added to the <code>jqXHR</code> instance there and it will be there for the error case if the data is proper json to boot.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 11:44PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I'm not sure why I was assuming the old complete was just an alias for always. That wouldn't work anyway, considering the difference in arguments. Thank you jaubuorg for making it clear yet again that you have it covered. I need to read all the ajax docs again. Forgive my ignorance.</p><p>As a side note, I'm in favor of landing 1164.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 27, 2013 11:50PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:8 timmywil]:</p><blockquote> I'm not sure why I was assuming the old complete was just an alias for always. That wouldn't work anyway, considering the difference in arguments. Thank you jaubuorg for making it clear yet again that you have it covered. I need to read all the ajax docs again. Forgive my ignorance.</blockquote><p>Forgive the docs... I don't remember if <code>responseFields</code> is even mentionned. Also, Dave did a tremendous job at summarizing the madness we got ourselves into with those signatures ;)</p><blockquote> As a side note, I'm in favor of landing 1164.</blockquote><p>Yeah, I really gotta get to it. It's just that I'm switching tasks like crazy these days.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 28, 2013 10:19AM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Just shows how confusing $.Deferred can be. There are like 4 or 5 ways to get a "done" signal (<code>complete</code>, <code>always</code>, <code>done</code>, <code>then</code>, and probably more), and they're all ever so slightly different. I will try to remember to stop using <code>complete</code>. It's not (no longer?) in the docs, so I guess that's a good thing.</p><p>Still it's weird that the parsed JSON is nowhere to be found in this function. I will stick to that conclusion, no matter how deprecated <code>complete</code> is.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
