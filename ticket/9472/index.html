<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#9472 ($.ajax: X-Requested-With header gets lost....request send twice?!) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/9471/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/9474/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#9472</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(invalid)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened May 31, 2011 10:07PM UTC</p>
      
        <p>Closed July 14, 2011 07:44AM UTC</p>
      
      
        <p>Last modified March 09, 2012 06:20AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">$.ajax: X-Requested-With header gets lost....request send twice?!</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        martin.keckeis1@gmail.com
      </td>
      <th>Owned by:</th>
      <td>martin.keckeis1@gmail.com</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next">1.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.6.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Hello,</p><p>i've run into a problem which drives me really crazy.</p><p>After 4 hours checking / searching i don't know where i can search for this problem anymore...</p><p>I would be really happy, if someone can help me further soon!</p><p>SOMETIMES!, so not every request, the request seems to be send twice, But it's not really send twice?!!</p><ul><li>Firebug show the request twice (but the first one not completed), in the first one the X-Request-With Header would be set</li></ul><pre class="wiki">
FIRST request header:
GET http://lisp/auth/userFavorite/list
Host	lisp
User-Agent	Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1 FirePHP/0.5
Accept	application/json, text/javascript, */*; q=0.01
Accept-Language	de-DE,de,en-US;q=0.9,en;q=0.9,de-formal;q=0.8,en-gb;q=0.8,en-ca;q=0.8,en-EN;q=0.7,de-AT;q=0.7,fr-FR;q=0.6,fr;q=0.6,he-IL;q=0.6,he;q=0.5,pt-PT;q=0.5,pt;q=0.4,ru-RU;q=0.4,ru;q=0.4,es-ES;q=0.3,es;q=0.3,nl-NL;q=0.2,nl;q=0.2,de-CH;q=0.2,de;q=0.1,en-us;q=0.1,en;q=0.0
Accept-Encoding	gzip, deflate
Accept-Charset	ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive	115
Connection	keep-alive
X-Requested-With	XMLHttpRequest
Referer	http://lisp/auth/index/startpage
Cookie	LISP=uqebnqnga8vs1kl32cnuvingi7; ZDEDebuggerPresent=php,phtml,php3
x-insight	activate
</pre><pre class="wiki">
SECOND request header:
GET http://lisp/auth/userFavorite/list
Host	lisp
User-Agent	Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1 FirePHP/0.5
Accept	text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language	de-DE,de,en-US;q=0.9,en;q=0.9,de-formal;q=0.8,en-gb;q=0.8,en-ca;q=0.8,en-EN;q=0.7,de-AT;q=0.7,fr-FR;q=0.6,fr;q=0.6,he-IL;q=0.6,he;q=0.5,pt-PT;q=0.5,pt;q=0.4,ru-RU;q=0.4,ru;q=0.4,es-ES;q=0.3,es;q=0.3,nl-NL;q=0.2,nl;q=0.2,de-CH;q=0.2,de;q=0.1,en-us;q=0.1,en;q=0.0
Accept-Encoding	gzip, deflate
Accept-Charset	ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive	115
Connection	keep-alive
Referer	http://lisp/auth/index/startpage
Cookie	LISP=uqebnqnga8vs1kl32cnuvingi7; ZDEDebuggerPresent=php,phtml,php3
x-insight	activate
</pre><ul><li>in Live HTTP headers i cannot see that the first one goes out or even get a response.</li></ul><pre class="wiki">
----------------------------------------------------------
http://lisp/auth/userFavorite/list

GET /auth/userFavorite/list HTTP/1.1
Host: lisp
User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1 FirePHP/0.5
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: de-DE,de,en-US;q=0.9,en;q=0.9,de-formal;q=0.8,en-gb;q=0.8,en-ca;q=0.8,en-EN;q=0.7,de-AT;q=0.7,fr-FR;q=0.6,fr;q=0.6,he-IL;q=0.6,he;q=0.5,pt-PT;q=0.5,pt;q=0.4,ru-RU;q=0.4,ru;q=0.4,es-ES;q=0.3,es;q=0.3,nl-NL;q=0.2,nl;q=0.2,de-CH;q=0.2,de;q=0.1,en-us;q=0.1,en;q=0.0
Accept-Encoding: gzip, deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 115
Connection: keep-alive
Referer: http://lisp/auth/index/startpage
Cookie: LISP=uqebnqnga8vs1kl32cnuvingi7; ZDEDebuggerPresent=php,phtml,php3
x-insight: activate

HTTP/1.1 200 OK
Date: Tue, 31 May 2011 20:41:01 GMT
Server: Apache
Set-Cookie: ZDEDebuggerPresent=php,phtml,php3; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Content-Encoding: gzip
Vary: Accept-Encoding
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/html; charset=utf-8
----------------------------------------------------------
</pre><ul><li>The Apache Log shows only one request (the second one, but also no redirect or anything else, otherwise i should see that in Live HTTP headers)</li><li>because i run into an error without this header in my custom PHP error log i see also the second one</li></ul><p>Further i thougth that i could log both request in a local JS variable, but that even doesn't work:</p><pre class="wiki">
var requestsLog = new Array();
requestsLog[requestsLog.length] = $.ajax({
url : loadUrl,
				type : ajaxMode,
				data : this.formData,
				dataType : 'json',

				headers: {
					'X-Requested-With': 'XMLHttpRequest'
				},

....

});
</pre><p>I also see only the second request. As you might have seen above, i'm also trying to forcing the header "X-Request-With".</p><p>So the header should always get send.</p><p>_______________________</p><p>Some more information about this problem:</p><ul><li>the webserver stands in austria</li><li>the problem first time occured when accessing the service from america (accessing over the intranet)</li><li>downgrading vo 1.5.2 also didn't helped, the error then goes further -&gt; because i run into an error and for me in PHP is a normal request i send the plain error HTML page and afterwards all Javascript files are loaded again with an XMLHttpRequest?!?</li><li>JSlins also didn't show errors in my code</li></ul></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (8)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 31, 2011 10:42PM UTC by <span class="author">martin.keckeis1@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Maybe i have also to mention that this also happens in IE8 (not only Firefox)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 10, 2011 07:26PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I have the same problem</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 29, 2011 06:55PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ martin.keckeis1@gmail.com</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for taking the time to contribute to the jQuery project! Please provide a reduced test case on <a href="http://jsfiddle.net" class="ext-link"><span class="icon"></span>http://jsfiddle.net</a> or a simplified test case on your own server that reproduces the issue experienced to help us assess your ticket.</p><p>Additionally, test against the jQuery (edge)/jQuery git version to ensure the issue still exists.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 29, 2011 09:41PM UTC by <span class="author">riageek+jquery@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I am also running into this issue. </p><p>It is very intermittent and does not occur with any regular frequency.</p><p>The symptoms are exactly like the ops. A seemingly hanging request with what appears (to <a href="/wiki/FireBug">FireBug</a>) to be two requests made however the server only actually sees one.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 29, 2011 10:40PM UTC by <span class="author">tedi17</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>To reproduce:</p><p>1. click the link below</p><p>2. keep the page opened</p><p>3. watch firebug console</p><p>4. click the button sometimes a couple of times</p><p><a href="http://jsfiddle.net/eFYrB/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/eFYrB/</a></p><p>"It is very intermittent and does not occur with any regular frequency".</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 14, 2011 07:44AM UTC by <span class="author">trac-o-bot</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Because we get so many tickets, we often need to return them to the initial reporter for more information. If that person does not reply within 14 days, the ticket will automatically be closed, and that has happened in this case. If you still are interested in pursuing this issue, feel free to add a comment with the requested information and we will be happy to reopen the ticket if it is still valid. Thanks!</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 31, 2011 03:28AM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is still an issue as far as I can tell and should be investigated.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 13, 2011 10:28AM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I've also been bitten by this bug, but after putting in a "beforeSend" logging call and also looking at the firebug output and jquery code I don't think this is a jquery bug. So I've looked at firefox bugs that could cause this and from this bug report, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=669759," class="ext-link"><span class="icon"></span>https://bugzilla.mozilla.org/show_bug.cgi?id=669759,</a> it seems to be a combination of two things:</p><p>1) There is a bug in firefox that means that if an xhr gets redirected then the custom headers are lost (I believe this bug has been recently fixed so maybe in due course it'll stop happening in newer firefox versions)</p><p>2) When "automatic proxy detection" is operating firefox will sometimes do an *internal* redirect which triggers the problem in 1)</p><p>Of course it's possible that it's not down to that bug, but that seems a likely explanation.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
