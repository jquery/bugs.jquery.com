<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13709 (.ajaxPrefilter() not working) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13707/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13710/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#13709</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(notabug)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened April 02, 2013 09:02AM UTC</p>
      
        <p>Closed April 04, 2013 09:57PM UTC</p>
      
      
        <p>Last modified April 05, 2013 07:15AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">.ajaxPrefilter() not working</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        GolubevS79@gmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.9.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th>Cc:</th>
      
      <td>jaubourg</td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>This scenario is not working:</p><pre class="wiki">
$.ajaxPrefilter("script json jsonp", function (options) {
    if (options.crossDomain) {
        options.crossDomain = false;
        options.url = "warning.htm";
        options.dataType = "html";

        return "html";
    }
});

$.ajax({
    url: "http://code.jquery.com/jquery-1.9.1.min.js",
    dataType: "script",
    success: function (data) {
        $("#target").append(data);
    },
    error: function (a, b, c) {
        $("#target").append(b);
    }
})
</pre><p>Result: "parseerror" (as result of parsing html by "eval" function), althought "dataType" equals "html" and other ajax settings in error callback is correct (but "dataTypes" equals ["text", "html", "script"])</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (5)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 04, 2013 07:30PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-new">→ jaubourg</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Another candidate for the jaubourg-shaped light. Seems like you'd need to modify <code>.dataTypes[]</code> (and it works if you do) but we don't document that.</p><p><a href="http://jsfiddle.net/TbK6C/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/TbK6C/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 04, 2013 07:39PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>dmethvin found the proper way to do what you want, though it could be simplified into:</p><pre class="wiki">options.dataTypes = [];
return "html";
</pre><p>The real question is why on earth you'd want to do something like this. How is the success handler supposed to know what kind of dataType it is receiving. Wouldn't it be simpler to abort the request in the prefilter with a proper reason?</p><pre class="wiki">if ( options.crossDomain ) {
    jqXHR.abort( "crossDomain" );
}
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 04, 2013 09:26PM UTC by <span class="author">golubevs79@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Success and error handlers in .ajax() has no importance here. The main reason is to prohibit cross domain requests and redirect user to some warning page (accordingly changing data type from script to html). The line</p><p>"options.dataType = "html"</p><p>in the .ajaxPrefilter() call ideally shouldn't be present (return "html" would be enough). It seems to me that the change of "dataTypes" array is some confusing (because it's your inner property) and change of documented "dataType" property would be sufficient.</p><p>In general, there is a main supervisor script that prohibits cross domain requests from other scripts with the help of following call:</p><pre class="wiki">
$.ajaxPrefilter("script json jsonp", function (options) {
    if (options.crossDomain) {
        options.crossDomain = false;
        options.url = "warning.htm";

        return "html";
    }
});
</pre><p>It's would be very useful</p><p>Sorry for my english :)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 04, 2013 09:57PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It's the way you "redirect" I don't get.</p><p>You're deep into the ajax architecture, requesting some <code>script</code> or <code>json</code>, then you automagically transform the request into <code>html</code>. It doesn't make much sense.</p><p>When you return a string from a prefilter, you effectively add a dataType at the beginning of the list of dataType, you're not overriding the dataType entirely.</p><p>This is so you can transparently get advantage of the conversion logic using multiple dataTypes (see <a href="http://demo.creative-area.net/jqcon2011/#27" class="ext-link"><span class="icon"></span>http://demo.creative-area.net/jqcon2011/#27</a> for an example).</p><p>By overriding the dataType like you wanna do in your prefilter you'll get stuff like this:</p><pre class="wiki">$.getScript( "http://path.to.other.domain/myScript.js", function( data ) {
    // Nothing was executed and data contains warning.htm
} );
</pre><p>How is this "redirecting"? What are you trying to achieve? If you wanna prohibit crossDomain request, just abort in the prefilter with a console warning to boot.</p><p>I'll close this as notabug because I'm convinced you need to think a little more about your use-case and the forums are better suited for this.</p><p>jQuery is working as expected here.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 05, 2013 07:15AM UTC by <span class="author">GolubevS79@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ok, let it be notabug :)</p><p>Of course do redirecting this way doesn't make sence. My use-case looks rather far-fetched because its sole purpose - to show that the value returned by the .ajaxPrefilter() does not override "dataType" property.  Although it's documented as</p><p>''The $.ajaxPrefilter() method can also redirect a request to another dataType by returning that dataType. For example, the following sets a request as "script" if the URL has some specific properties defined in a custom isActuallyScript() function:''</p><pre class="wiki">
$.ajaxPrefilter(function( options ) {
  if ( isActuallyScript( options.url ) ) {
    return "script";
  }
});
</pre><p>''This would ensure not only that the request is considered "script" but also that all the prefilters specifically attached to the script dataType would be applied to it.''</p><p>And now you say: ''When you return a string from a prefilter, you effectively add a dataType at the beginning of the list of dataType, you're not overriding the dataType entirely'' (i.e. "there is actually no data type redirection")</p><p>But everything is working properly if do as you mentioned above:</p><pre class="wiki">
options.dataTypes = [];
return "html";
</pre><p>and though it looks some strange, thanks for that code.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
