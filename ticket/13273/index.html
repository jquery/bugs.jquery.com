<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#13273 (Animation speed with numbers as strings (&amp;#39;5000&amp;#39;) will get default duration (400)) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/13272/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/13274/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#13273</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">feature</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened January 20, 2013 05:58AM UTC</p>
      
        <p>Closed January 21, 2013 07:18PM UTC</p>
      
      
        <p>Last modified January 23, 2013 04:12AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Animation speed with numbers as strings (&#39;5000&#39;) will get default duration (400)</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        mgreter
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>effects</td>
      
        <th>Version:</th>
      
      <td>1.9.0</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Hello</p><p>I've just found a small problem with setting the animation speed. In my case the duration is configurable by the user (a text input which will return a string). Here is a stripped down example of the problem:</p><pre class="wiki">
jQuery('#id').animate(
  { width: '100%' },
  '5000'
);
</pre><p>This animation will finish in 400 ms and not in 5000 ms. The reason for this is a check in jQuery.speed:</p><pre class="wiki">
typeof opt.duration === "number" ? opt.duration : ...
</pre><p>IMO that code should be:</p><pre class="wiki">
!isNaN(opt.duration) ? opt.duration : ...
</pre><p>Not sure if this code change could have any side effects. I cannot really think of any usefull onces.</p><p>Best wishes</p><p>Marcel Greter</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (6)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 20, 2013 06:09AM UTC by <span class="author">mgreter</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Sorry, did not post the complete fix. It somehow seems necessary to convert to string to an actual number on that line. Not sure why this is actually needed, but should (IMO) not be problematic as it now does what the user wants.&#92;
&#92;
{{{&#92;
!isNaN(opt.duration) ? parseFloat(opt.duration)&#92;
}}}</span> → <span class="change-field-new">1358662248484791</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Sorry, did not post the complete fix. It somehow seems necessary to convert the string to an actual number on that line. Not sure why this is actually needed, but should (IMO) not be problematic as it now does what the user wants.</p><pre class="wiki">
!isNaN(opt.duration) ? parseFloat(opt.duration)
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 21, 2013 07:18PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">effects</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>type:</th>
                  <td>
                    
                      <span class="change-field-old">bug</span> → <span class="change-field-new">feature</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Since this could be solved by sanitizing the input from the text, I don't think we need extra code to convert a string. </p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 22, 2013 05:20AM UTC by <span class="author">mgreter</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I agree that the input could be sanitized, but I still think jQuery does the wrong thing in this situation. IMO this behaviour can lead to hard to find bugs which should be avoided if feasable.</p><p>Please reconsider this bug report. The actual bug is not the conversion. It's the check (opt.duration === "number") that does the wrong thing. I'm not sure why the value then has to be an actual number (maybe that should be investigated further), but it's easy to fix it here.</p><p>To support the case I give you a few arguments why I think this should be changed.</p><p>1. I think it makes sense for the animation API to accept numbers also from strings if valid. Only lookup the speed otherwise and use the default if nothing matches. Setting an option to '5000' or 5000 and getting different results just doesn't feel right in a dynamic typed language.</p><p>2. Currently if you set jQuery.fx.speeds{'5000'} = 1500, a speed of '5000' will result in a duration of 1500ms. A speed of 5000 will result in a duration of 5000ms. And a speed of '500' will use the default duration. I'm not sure if this possibility is actually intended, but I doubt it.</p><p>3. The code changes should not have a big performance impact.</p><p>4. It would protect the coder from a possible pitfall.</p><p>Of course that's just my opinion. But I don't see a reason why this could or should not be fixed (enhanced).</p><p>Best wishes</p><p>Marcel Greter</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 22, 2013 01:35PM UTC by <span class="author">scottgonzalez</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <blockquote> I think it makes sense for the animation API to accept numbers also from strings if valid.</blockquote><p>Does it make sense for every single API that accepts numbers to accept strings? If not, why does <code>.animate()</code> deserve special treatment?</p><blockquote> Setting an option to '5000' or 5000 and getting different results just doesn't feel right in a dynamic typed language.</blockquote><p>Dynamic typing doesn't mean you can be willy-nilly with your types. This is like using <code>1</code> instead of <code>true</code> just because it can work. That doesn't mean that all places that accept a boolean should accept truthy/falsey values.</p><blockquote> Currently if you set jQuery.fx.speeds{'5000'} = 1500, a speed of '5000' will result in a duration of 1500ms. A speed of 5000 will result in a duration of 5000ms. And a speed of '500' will use the default duration. I'm not sure if this possibility is actually intended, but I doubt it.</blockquote><p>This is purely a hypothetical. Nobody would ever do such a thing, and if they did, then they clearly meant it.</p><blockquote> The code changes should not have a big performance impact.</blockquote><p>How about bytes? Don't forget to multiply for every single place a number is accepted since this would set a precedent.</p><blockquote> It would protect the coder from a possible pitfall.</blockquote><p>We can't protect from everything. The coder needs to take some responsibility. Strings are a valid form of input, so we're not going to special case certain string values.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 22, 2013 02:54PM UTC by <span class="author">mgreter</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:4 scott.gonzalez]:</p><blockquote> &gt; I think it makes sense for the animation API to accept numbers also from strings if valid.  Does it make sense for every single API that accepts numbers to accept strings? If not, why does <code>.animate()</code> deserve special treatment? </blockquote><p>IMO all APIs do accept numbers from strings when they expect a number. And not only numbers of the actual type number, but also if they are of type string. Like window.setTimeout(fn, '1000') or jQuery('#id').offset({ top: '400' }). The Problem is that Animate has a check (typeof opt.duration === "number") that leads to the IMO unexpected behaviour.</p><pre class="wiki">
  opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration :
    opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;
</pre><p>Sorry I wasted everybody's time!</p><p>Have a nice day</p><p>Marcel Greter</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 23, 2013 04:12AM UTC by <span class="author">mgreter</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi there</p><p>I thought about resting this case, as I now know this pitfall. But for the better of jQuery, I insist that this report is taken seriously! Altough it might be of marginal impact.</p><p>Replying to [comment:4 scott.gonzalez]:</p><blockquote> &gt; Setting an option to '5000' or 5000 and getting different results just doesn't feel right in a dynamic typed language.  Dynamic typing doesn't mean you can be willy-nilly with your types. This is like using <code>1</code> instead of <code>true</code> just because it can work. That doesn't mean that all places that accept a boolean should accept truthy/falsey values. </blockquote><p>If you use a check like "if (isEnabled)" it doesn't matter if you have 1, '1', 'asdqwe' or true, the check will always be true as long as dynamic typing resolves the value to a boolean that is true. But it doesn't if you write "if (isEnabled === true)". Why would you want to implement strict type checking everywhere? Why is it that we only have ~ 5 such typeof checks in the whole jQuery library? For me typeof is a feature that may should not even be in the specs of ECMA, but if you use it, you should know what you do! IMO it's confusing to the API user if you act differently for '5000' and 5000, merely because of the current type of the variable. That's something for C, C++ or maybe Java, but IMO not <a href="/wiki/JavaScript">JavaScript</a>. And comparing 1 to true is IMO not really the same as comparing '5000' to 5000. Compare '1' to 1 and explain me why one animation should run for 400ms and the other only for 1ms.</p><blockquote> &gt; Currently if you set jQuery.fx.speeds{'5000'} = 1500, a speed of '5000' will result in a duration of 1500ms. A speed of 5000 will result in a duration of 5000ms. And a speed of '500' will use the default duration. I'm not sure if this possibility is actually intended, but I doubt it.  This is purely a hypothetical. Nobody would ever do such a thing, and if they did, then they clearly meant it. </blockquote><p>Of course nobody would do such a thing! Why should one!? But it may be the only valid point to keep it the way it is now, as with the fix this behaviour would no longer exist. That was the only reason why I mentioned it!</p><blockquote> &gt; The code changes should not have a big performance impact.  How about bytes? Don't forget to multiply for every single place a number is accepted since this would set a precedent. </blockquote><p>As I've written more than once, it's not the conversion but the check that is the bug. So it doesn't mean this needs to be implemented everywhere, it's really just a bug about the speed/animation duration. And if you're talking about bytes, the check for any typeof call doesn't need a tripple equal sign to compare (a double equal sign should be enough as typeof will always return a string, as far as I know). If one would also optimize the ternary operator, I think it will use maybe +-2 bytes more than before!</p><pre class="wiki">
  opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration :
    opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;
</pre><pre class="wiki">
  opt.duration = jQuery.fx.off ? 0 : !isNaN(opt.duration) ? parseFloat(opt.duration) :
    opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;
</pre><blockquote> &gt; It would protect the coder from a possible pitfall.  We can't protect from everything. The coder needs to take some responsibility. Strings are a valid form of input, so we're not going to special case certain string values.</blockquote><p>It's true that you can't protect them from everything. But if you can protect him from one case withouth any further penalty, why not do it? I don't really get the core of this argument!</p><p>Sorry if I'm a little bit furious. But for me this clearly is a bug and should be fixed. I now know others may think different, but I'm ready to defend that case. So far no valid reasons have beeen given to not do so (IMHO)!</p><p>So to repeat the main case, I think this line:</p><pre class="wiki">

  opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration :
    opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;
</pre><p>Should be changed to this line:</p><pre class="wiki">
  opt.duration = jQuery.fx.off ? 0 : !isNaN(opt.duration) ? parseFloat(opt.duration) :
    opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;
</pre><p>If this code change does not land, it should at least be documented that an animation duration set to '1234' will result in the default fx.speed (400). So you would have to check for "is a number" yourself and convert it to an actual number type variable!</p><p>I have no idea how I could make it any clearer; to say it bluntely, "I don't get it why you don't get it". For me this case couldn't be any clearer. But I'm still open for constructive criticism, if it's directly about this problem.</p><p>Kind regards</p><p>Marcel Greter</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
