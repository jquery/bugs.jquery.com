<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#4120 (Be more liberal in accepting IDs) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/4119/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/4121/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#4120</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened February 11, 2009 04:02AM UTC</p>
      
        <p>Closed April 17, 2011 11:39PM UTC</p>
      
      
        <p>Last modified March 14, 2012 12:13PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Be more liberal in accepting IDs</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        brettz9
      </td>
      <th>Owned by:</th>
      <td>john</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        high
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/"></a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>selector</td>
      
        <th>Version:</th>
      
      <td>1.4.4</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>In your core code I think:</p><pre class="wiki">
quickExpr = /[&lt;]*(&lt;(.|\\s)+&gt;)[&gt;]*$|#([\\w-]+)$/
</pre><p>should allow the # selector be changed to be more liberal in accepting valid XML IDs: </p><pre class="wiki">
var nameStartChar = ':A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u0200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\ud800-\\udb7f\\udc00-\\udfff'; // The last two ranges are for surrogates that comprise #x10000-#xEFFFF
var nameEndChar = '.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040-';
var xmlName = '['+nameStartChar+']['+nameStartChar+nameEndChar+']*';
/////////
quickExpr = new RegExp('[&lt;]*(&lt;(.|\\s)+&gt;)[&gt;]*$|#('+xmlName+')$');
</pre><p>Per <a href="http://www.w3.org/TR/1999/REC-html401-19991224/types.html#type-name" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/1999/REC-html401-19991224/types.html#type-name</a> , unlike XML, HTML does not allow ':' or '_' at the beginning of an ID, nor does it allow any of the Unicode hex sequences above, but it is otherwise the same (i.e., the above expression for XML would work for HTML in being excessively liberal, as is the existing regexp).</p><p>I have not attempted to narrow down the first alternative in the expression, but that at least is not overly restrictive.</p><p>If you don't care for this verbosity (though I hope you wouldn't mind being XML friendly for the future), I think you could at least add the period to the latter alternative:</p><pre class="wiki">
quickExpr = /[&lt;]*(&lt;(.|\\s)+&gt;)[&gt;]*$|#([\\w.-]+)$/
</pre><p>since '.' is allowable in an HTML or XML ID and might be more widely used. See</p><p>Per <a href="http://www.w3.org/TR/1999/REC-html401-19991224/types.html#type-name" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/1999/REC-html401-19991224/types.html#type-name</a> <a href="http://www.w3.org/TR/REC-xml/#id" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/REC-xml/#id</a> <a href="http://www.w3.org/TR/REC-xml/#NT-Name" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/REC-xml/#NT-Name</a> <a href="http://www.w3.org/TR/REC-xml/#NT-NameChar" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/REC-xml/#NT-NameChar</a></p><p>This shouldn't interfere with other selectors since the Regex portion I've updated is only for detecting IDs.</p><p>Thanks!</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (8)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 12, 2009 02:04AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfilled</span> → <span class="change-field-new">selector</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ john</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 20, 2009 09:38PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I find it odd that you look to the HTML/XML specifications for the selectors instead of the CSS specification. The CSS specification is only designed to select a subset of all possible IDs/Classnames/Attributes. It's an unfortunate limitation but one that we should stick to.</p><p>In the meantime you should escape other characters, like so:</p><p>  $("#foo\\\\.bar")</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 31, 2010 06:02AM UTC by <span class="author">brettz9</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">closed</span> → <span class="change-field-new">reopened</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Just revisiting jQuery again after some time...</p><p>Since you are currently using the '#' value as input to document.getElementById, I believe the relevant specification is actually not CSS, but the DOM: <a href="http://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-getElBId" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-getElBId</a> , where it refers to the value being of type ID for an "Element" which is defined as HTML or XML.</p><p>But even assuming, CSS were the specification to use (e.g., if you implemented with document.querySelector where the Selectors API states "Both querySelector()  and querySelectorAll()  take a selector string (selectors) as their argument." which is defined in the CSS3 Selectors specification), whether using CSS3 selectors at <a href="http://www.w3.org/TR/css3-selectors" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/css3-selectors</a> or the grammar for CSS 2.1 at <a href="http://www.w3.org/TR/CSS21/grammar.html#scanner" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/CSS21/grammar.html#scanner</a> , these indicate that HASH is "#"{name} where 'name' is {nmchar}+ and where "nmchar" is [_a-z0-9-]|{nonascii}|{escape}. Although "nonascii" is defined as "[\\200-\\377]" in CSS 2.1, the notes above it state:</p><p>"The "\\377" represents the highest character number that current versions of Flex can deal with (decimal 255). It should be read as "\\4177777" (decimal 1114111), which is the highest possible code point in Unicode/ISO-10646."</p><p>And in CSS3 Selectors, that is clarified by using [^\\0-\\177] for "nonascii".</p><p>So if you don't want to enforce HTML/XML rules (which are for the most part actually stricter than the CSS selectors, excepting unescaped periods or colons), then the allowable CSS selectors appear even more liberal as far as Unicode:</p><p>var nonascii = '\\u0080-\\uFFFF\\ud800-\\udb7f\\udc00-\\udfff'; // The last two ranges are for surrogates that comprise #x10000-#xEFFFF</p><p>var escape = '\\\\[0-9a-f]{1,6}(\\r\\n|[ \\t\\r\\n\\f])?|\\\\[^\\r\\n\\f0-9a-f]';</p><p>quickExpr = new <a href="/wiki/RegExp">RegExp</a>('[&lt;]*(&lt;(.|\\\\s)+&gt;)[&gt;]*$|#([\\\\w'+nonascii+'|'+escape+'-])$', 'i');</p><p>However, at the very least, "escape" cannot be used in document.getElementById() and '.' and ':' can indeed be allowed, though in the case of document.querySelector(), in Firefox at least, it acts according to the CSS rules where it can indeed allow escaped CSS and rejects '.' and ':' (having of course their own reserved purposes in selectors).</p><p>So, really, it seems like I had it right before as far as Unicode, at least as far as your implementation as it is now...</p><p>And though I can file another bug, since it relates to the same line of code, I understand that non-capturing parentheses are a bit faster, so the second parenthetical grouping (which you are not using), might be changed to "(?:.|\\s)" (along with changing match[3] to match[2]), especially important for speed and perhaps memory too given the frequency of use of jQuery.fn.init() which uses this regular expression.</p><p>I might also think that putting the hash check as the first option in the regular expression may be a better solution since it will catch IDs very quickly (assuming <a href="/wiki/JavaScript">JavaScript</a> regexp engines parse left-to-right) and could switch to the alternate solution as soon as '#' was not detected, whereas as it is now, I believe the first check may be conducted until the end of the ID before realizing it wasn't a tag.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 31, 2010 06:21AM UTC by <span class="author">brettz9</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>My apologies, in looking at jQuery 1.4.2, I see that as far as match[3], that has already been dealt with. However, my other points still stand.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 22, 2010 07:22AM UTC by <span class="author">snover</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">IDs can be pretty much anything at this point as per the HTML5 spec. quickExpr should probably be looking like `/^(?:[^&lt;]*(&lt;[&#92;&#92;w&#92;&#92;W]+&gt;)[^&gt;]*$|#([&#92;&#92;S]+)$)/`, with a tweak to line 158 to `match[2].replace(/&#92;&#92;&#92;&#92;/g, &#39;&#39;)` since `getElementById` doesn’t do CSS syntax.</span> → <span class="change-field-new">1290410541346533</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.3.2</span> → <span class="change-field-new">1.5</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">minor</span> → <span class="change-field-new">high</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">reopened</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.3.1</span> → <span class="change-field-new">1.4.4</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>IDs can be pretty much anything at this point as per the HTML5 spec. quickExpr should probably be looking like <code>/^(?:[^&lt;]*(&lt;[\\w\\W]+&gt;)[^&gt;]*$|#([\\S]+)$)/</code>, with a tweak to line 158 to <code>match[2].replace(/\\\\/g, '')</code> since <code>getElementById</code> doesn’t do CSS syntax and will barf on escaped characters.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 31, 2011 02:01AM UTC by <span class="author">danheberden</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-new">→ 1.7</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 31, 2011 04:55AM UTC by <span class="author">danheberden</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/4703">#4703</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 17, 2011 11:39PM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">1.7</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:5 snover]: Unfortunately your particular proposal won't catch thinks like #id.class or #id&gt;div.</p><p>I'm still of the opinion that focusing on a simple selector to make faster is totally fine. Everything else just goes to Sizzle where all the edge cases are handled just fine.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
