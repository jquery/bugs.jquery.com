<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#5832 (Webkit radio input Node.cloneNode-related regression in jQuery 1.4 (patch and test included)) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/5831/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/5833/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#5832</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(duplicate)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened January 15, 2010 10:09PM UTC</p>
      
        <p>Closed October 19, 2010 01:11AM UTC</p>
      
      
        <p>Last modified October 19, 2010 01:11AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">Webkit radio input Node.cloneNode-related regression in jQuery 1.4 (patch and test included)</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        mmonteleone
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.4.1">1.4.1</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>core</td>
      
        <th>Version:</th>
      
      <td>1.4</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>cache cloneNode webkit radio input</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I am truly impressed with the quality of significant optimizations in the recent jQuery 1.4 release.  The use of fragment caching in conjunction with browser-native <code>Node.cloneNode</code> for small strings passed to $('...') is quite clever.  </p><p>I apologize for not noticing this earlier a, but it seems perhaps the use of <code>Node.cloneNode</code> has exposed at least one browser-specific implementation bug causing a regression.</p><p>Unlike other engines, Webkit's <code>Node.cloneNode</code> seems to not clone the 'checked' attribute of radio inputs.  It does clone the <code>checked</code> attribute of checkbox inputs.  This means that code that used to work fine, like...</p><p>    $('form').append('&lt;input type="radio" checked="checked" /&gt;'); </p><p>...no longer checks the input in Webkit for jQuery 1.4, since this fragment is otherwise small enough to hit the fragment cache and be subsequently cloned, and Webkit does not clone the <code>checked</code> attribute on radio inputs.</p><p>Here is code to reproduce in Webkit:</p><p>    &lt;!-- load jquery 1.3 --&gt;  </p><p>    &lt;script type="text/javascript" src="jquery-1.3.2.js"&gt;&lt;/script&gt;  </p><p>    &lt;script type="text/javascript"&gt;jq13 = jQuery.noConflict()&lt;/script&gt;  </p><p>    &lt;!-- load jquery 1.4 --&gt;  </p><p>    &lt;script type="text/javascript" src="jquery-1.4.js"&gt;&lt;/script&gt;  </p><p>    &lt;script type="text/javascript"&gt;jq14 = jQuery.noConflict()&lt;/script&gt;  </p><p>    &lt;script type="text/javascript"&gt;  </p><p>    jq14(function(){  </p><p>        // in jQuery 1.3, this works fine  </p><p>        jq13('form').append('&lt;input type="radio" id="r1" name="r1" value="r1val" checked="checked" /&gt;');  </p><p>        alert('1.3 - should be true: '    + jq13('#r1').is(':checked'));  </p><p>        <em> in jQuery 1.4, the fragment cache means that the new node gets cached, and then cloned  </em></p><p>         via Node.cloneNode.  Webkit will not honor the 'checked' attribute during cloning  </p><p>        // Oddly enough, it would have honored a checkbox's  </p><p>        jq14('form').append('&lt;input type="radio" id="r2" name="r2" value="r1val" checked="checked" /&gt;');  </p><p>        alert('1.4 - this is now false: ' + jq14('#r2').is(':checked'));  </p><p>    });  </p><p>    &lt;/script&gt;  </p><p>    &lt;body&gt;  </p><p>    &lt;form&gt;&lt;/form&gt;  </p><p>    &lt;/body&gt;  </p><p>And here is a live running sample: <a href="http://michaelmonteleone.net/files/jq14webkit/" class="ext-link"><span class="icon"></span>http://michaelmonteleone.net/files/jq14webkit/</a></p><p>So, this isn't technically a jQuery issue as much it is a Webkit one, except for the fact that these kinds of operations always worked before in jQuery before the advent of the fragment cache/<code>Node.cloneNode</code>.</p><p>I have prepared a small patch to address this within the <code>buildFragment</code> function by adding another clause to the end of the if branch where it determines whether the fragment should be cacheable (and thus cloned).  It's inspecting the fragment via a regex for the presence of various forms of checked="checked", and considering if matches exist.  Unit tests are included.</p><p><a href="http://github.com/mmonteleone/jquery/commit/60c28596fb1dbce44bf464435d31cc2faa2c1e09" class="ext-link"><span class="icon"></span>http://github.com/mmonteleone/jquery/commit/60c28596fb1dbce44bf464435d31cc2faa2c1e09</a></p><p>To be fully correct, the if statement should probably also check for jQuery.browser.webkit and a more precise regular expression that specifically matches only radio inputs, but I was concerned this would add too much overhead for such a commonly used function.</p><p>I recognize there is probably a much more elegant and efficient way of solving this problem!</p><p>Thank you for another fantastic release of a fantastic framework.</p><p>Michael Monteleone  </p><p>(michael@michaelmonteleone.net)</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (3)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 26, 2010 02:00AM UTC by <span class="author">mmonteleone</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Re-mentioned and resolved in <a href="/ticket/5929">#5929</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2010 01:11AM UTC by <span class="author">snover</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ duplicate</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 19, 2010 01:11AM UTC by <span class="author">snover</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Duplicate of <a href="/ticket/5929">#5929</a>.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
