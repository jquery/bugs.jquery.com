<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#4280 (&amp;quot;Permission Denied&amp;quot; errors in IE7 when unloading documents) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/4279/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/4281/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#4280</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened March 02, 2009 04:09PM UTC</p>
      
        <p>Closed December 10, 2009 12:01AM UTC</p>
      
      
        <p>Last modified March 14, 2012 03:18PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">&quot;Permission Denied&quot; errors in IE7 when unloading documents</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        haukurhaf
      </td>
      <th>Owned by:</th>
      <td>brandon</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.4">1.4</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>event</td>
      
        <th>Version:</th>
      
      <td>1.4a1</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>Access denied unload remove event</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>I've got a document with an iframe, which has a load event applied by jquery.</p><p>On unload of the parent document, I get an permission denied error message even though the parent and the iframe are on the same domain.</p><p>It appears as if the fix to prevent memory leaks in IE is failing.</p><p>This is the function where the error originates:</p><p><em> Prevent memory leaks in IE</em></p><p> And prevent errors on refresh with events like mouseover in other browsers</p><p><em> Window isn't included so as not to unbind existing unload events</em></p><p>jQuery( window ).bind( 'unload', function(){ </p><p>	for ( var id in jQuery.cache )</p><p>		 Skip the window</p><p>		if ( id != 1 && jQuery.cache[ id ].handle )</p><p>			jQuery.event.remove( jQuery.cache[ id ].handle.elem );</p><p>});</p><p>The error itself is thrown in the jQuery.event.remove method, specifically in this line here:</p><p>if ( elem.nodeType == 3 || elem.nodeType == 8 )</p><p>The "Permission Denied" error occurs when accessing the .nodeType property of the elem object.</p><p>This is our lazy fix for this problem:</p><p>	<em> Detach an event or set of events from an element</em></p><p>	remove: function(elem, types, handler) {</p><p>		 don't do events on text and comment nodes</p><p>        try</p><p>        {</p><p>		    if ( elem.nodeType == 3 || elem.nodeType == 8 )</p><p>			    return;</p><p>		}</p><p>		catch(e)</p><p>		{</p><p>		    return;</p><p>		}</p><p>Just enclose this line in a try-catch statement and return false if an error occurs.  I don't believe this has any bad side-effects, except perhaps the memory problem with IE. </p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (13)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 03, 2009 12:29AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Let's first figure out why the problem is happening before trapping and ignoring the error. Can you provide a simple test case that includes the minimal script and HTML to reproduce the problem?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 04, 2009 01:52PM UTC by <span class="author">haukurhaf</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hi,</p><p>I've been trying to reproduce this bug with as little HTML/Script as possible, but so far I haven't been able to do so.  It seems as if the bug is only triggered when certain combination of things are present on the pages.</p><p>The project where I'm having this bug is a quite large CMS system and it's kinda difficult for me to gradually include more and more stuff from it until the bug triggers.</p><p>Perhaps this ticket should just be ignored until I'm able to reproduce the bug with a more manageble piece of HTML/JS.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 26, 2009 04:36PM UTC by <span class="author">daw</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I am having the same problem. Also using iframes. They are dynamically created.</p><p>The problem seems to occur when having an iframe with a form, and the form is posted to. It does not occur if we just view the page. Only after having posted the form and the iframe has loaded another page, and we then try to close down the main window (or navigate away from it).</p><p>A try..catch would solve it.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 26, 2009 04:48PM UTC by <span class="author">daw</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>If someone else is having a problem with this, search in jquery.js for "Prevent memory leaks in IE" and apply a try...catch around the call to jQuery.event.remove():</p><pre class="wiki">
// Prevent memory leaks in IE
// And prevent errors on refresh with events like mouseover in other browsers
// Window isn't included so as not to unbind existing unload events
jQuery( window ).bind( 'unload', function(){
	for ( var id in jQuery.cache )
		// Skip the window
		if ( id != 1 && jQuery.cache[ id ].handle ) try {
			jQuery.event.remove( jQuery.cache[ id ].handle.elem );
		} catch (e) {};
});
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 05, 2009 07:12AM UTC by <span class="author">pbcomm</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I had the same issue with one of my scripts and added try, catch is various places mentioned in this post and they all seem to fail. After further investigation I have made the following changes:</p><p>Line: 2523 (event.remove)</p><p>if ( elem.nodeType == 3 || elem.nodeType == 8 )</p><p>Corrected to:</p><p>if ( typeof elem.nodeType === 'undefined' || elem.nodeType == 3 || elem.nodeType == 8 )</p><p>This solves the issue. I will post a test case tomorrow. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 09, 2009 03:22AM UTC by <span class="author">pbcomm</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Please ignore my comments above. This ticket should be closed as this is not a jQuery issue. The issue on IE7 with unload event only exists if the document.domain is being set to invalid or empty value and if there is functionality that uses location object.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 23, 2009 07:55PM UTC by <span class="author">wangyun</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is very much a jQuery problem. The application we run contains multiple domain. All of them belong to 'subdomain.domain.com'. So every page has a valid 'document.domain="subdomain.domain.com"' set. When I added the change to jQuery as suggested by &lt;daw&gt;. The error is gone. Hope there is a more elegant way to fix this.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 31, 2009 03:57AM UTC by <span class="author">aakoch</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I too am seeing this issue and was able to create a simple webpage to demonstrate it: <a href="http://adamkoch.com/permission_denied.html" class="ext-link"><span class="icon"></span>http://adamkoch.com/permission_denied.html</a></p><p>It happens when I remove the iframe and then refresh the page.</p><p>I have only seen this issue in IE7 and IE8, not in FF3 nor FF3.5</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 02, 2009 02:58PM UTC by <span class="author">aakoch</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In response to pbcomm, I'm not doing anything to the "document.domain" in my example and am getting this error.</p><p>Also, my test page doesn't seem to produce the error every time. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 09, 2009 02:34PM UTC by <span class="author">shonny</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It can be reproduced in IE6 , IE7, IE8.</p><p>Open new Tab or window in IE. Enter any address (f.e. <a href="http://jquery.com/)." class="ext-link"><span class="icon"></span>http://jquery.com/).</a> Then enter <a href="http://www.shonny.mail.ua/." class="ext-link"><span class="icon"></span>http://www.shonny.mail.ua/.</a> Put the cursor into "Message text:" field. </p><p>After this You must click IE Back button 2 times.</p><p>It is iframe, with document.body.contentEditable=true and document.designMode="on". We have used .bind('mousedown keydown', function (){...}) on this document.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 06, 2009 04:16AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This is a result of a "feature" implemented with IE6 when XP SP2 was released. Any time an iframe is reloaded, any references to objects within it are invalidated by IE and result in "Permission Denied" if you try to use them. </p><p>Addressing wangyun's comment, this is *not* a cross-domain issue; IE is shooting all the iframe object references out from under the scripts whenever the iframe is removed or reloaded. See the discussion of Object Caching here:</p><p><a href="http://msdn.microsoft.com/en-us/library/ms649488%28VS.85%29.aspx" class="ext-link"><span class="icon"></span>http://msdn.microsoft.com/en-us/library/ms649488%28VS.85%29.aspx</a></p><p>The case shonny mentions with designMode is specifically called out here as a problem:</p><p><a href="http://technet.microsoft.com/en-us/library/cc781229%28WS.10%29.aspx" class="ext-link"><span class="icon"></span>http://technet.microsoft.com/en-us/library/cc781229%28WS.10%29.aspx</a></p><p>I also grabbed this from a private email I got from a Microsoft developer back in 2004 regarding object caching:</p><blockquote> Whenever a script changes the content of another window, frame, or element, Internet Explorer now invalidates any objects it contains. If the script attempts to use an invalid object, it will receive a "permission denied" error. The controlling script can obtain a valid reference to the window's new object by retrieving the property again. Instances where scripts would need to re-cache a window object include the use of window.location, document.URL, window.navigate, or document.write.</blockquote><p>With all that in mind, maybe the try/catch is the way to fix it. Any references to elements in the old iframe that exist elsewhere will still cause this problem if accessed though.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 10, 2009 12:01AM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">critical</span> → <span class="change-field-new">major</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.3.2</span> → <span class="change-field-new">1.4a1</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Fixed.</p><p><a href="http://github.com/jquery/jquery/commit/b846ad4ca060a100dec3ace5711f96a083bc4ac3" class="ext-link"><span class="icon"></span>http://github.com/jquery/jquery/commit/b846ad4ca060a100dec3ace5711f96a083bc4ac3</a></p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 03, 2011 09:15PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>There's a problem with the above code when being used with Microsoft's ASP.net framework.</p><p>Specifically the ASP.net framework assigns a method to window.nodeName which causes jQuery.acceptData() to fail on line 1230 with an "Object doesn't support this property method"</p><p>I've fixed this by manually re-assigning window.nodeName to another variable before I include jQuery and then back once jQuery and the UI are loaded. But this is something that might warrant some kind of fix. It appears this behavior causes both jQuery and the jQuery UI to fail, I'm not sure what the best fix is since that behavior is depended on by an unknown amount of code in both libraries.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
