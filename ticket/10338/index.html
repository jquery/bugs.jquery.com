<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#10338 (getResponseHeader() broken for CORS requests in Firefox 6) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/10337/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/10339/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#10338</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened September 24, 2011 12:52AM UTC</p>
      
        <p>Closed January 26, 2013 09:41PM UTC</p>
      
      
        <p>Last modified October 15, 2013 04:49PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">getResponseHeader() broken for CORS requests in Firefox 6</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        anonymous
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next">1.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.6.4</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Due to a bug in Firefox[1] where .getAllResponseHeaders() returns the empty string despite .getResponseHeader("Content-Type") returning a non-empty string, jQuery fails to automatically decode JSON CORS responses in Firefox.</p><p>The bug is replicable in jQuery &gt;=1.5.2 but not in jQuery &lt;=1.4.4:  <a href="http://jsfiddle.net/xeBub/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/xeBub/</a></p><p>[1] <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=608735" class="ext-link"><span class="icon"></span>https://bugzilla.mozilla.org/show_bug.cgi?id=608735</a></p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (19)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 24, 2011 01:32AM UTC by <span class="author">conrad.irwin@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You can get a patch that fixes this at: <a href="https://github.com/jquery/jquery/pull/517" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/517</a> .</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 24, 2011 02:40AM UTC by <span class="author">conrad.irwin@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for the feedback [1] @dmethvin.</p><p>I've re-rolled the patch [2] with better adherence to the style rules.</p><p>I've asked Firefox why they haven't patched it [3], though I suspect the answer is that it's low-priority and no-one's felt the need to.</p><p>Do you have an idea how I would create a test for this? It seems like it should be the case that the test without this patch fails only in Firefox — but that would require actually making a cross-domain request; which is probably not acceptable for a test-suite that has to work everywhere.</p><p>[1] <a href="https://github.com/jquery/jquery/pull/517#issuecomment-2184486" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/517#issuecomment-2184486</a></p><p>[2] <a href="https://github.com/ConradIrwin/jquery/commits/fix.cors-firefox" class="ext-link"><span class="icon"></span>https://github.com/ConradIrwin/jquery/commits/fix.cors-firefox</a></p><p>[3] <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=608735#c5" class="ext-link"><span class="icon"></span>https://bugzilla.mozilla.org/show_bug.cgi?id=608735#c5</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 24, 2011 07:45AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I don't like the patch. It's really an ugly workaround in the sense that you list the headers you want supported (open door for people asking for more more more more). I'd live with a notification in the docs about the problem knowing full well that the new Firefox update policy will take care of the problem eventually. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 24, 2011 05:50PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I see your point @jaubourg. This isn't fixing the problem, it's just making a list of headers that would be nice to get when people try to request all headers. So the patch is creating a false sense that it has gotten all headers when it really hasn't. </p><p>It would be better for the requester to know about this problem in Firefox and work around it by requesting the headers *they* expect to receive, even if that turns out to be a large list. Otherwise they will inevitably ask for more headers to be added to our patch list. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 24, 2011 10:16PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">The list of headers is complete according to the CORS spec [1].&#92;
&#92;
In order to get access to more headers, you&#39;d have to rely on the Access-Control-Expose-Headers header, which is broken in Chrome and Safari, and broken-by-design in that Javascript can&#39;t read it (so we *could* try and read that, and if we can append any headers that are whitelisted to the list we try to read, but it would only work in Firefox and under very limited conditions).&#92;
&#92;
A better fix would be to delegate jqXHR.getResponseHeader() to the builtin getResponseHeader(), though that would break the nice encapsulation of transporters.&#92;
&#92;
If we wanted to document this, and provide a work-around, the best thing I can think of (though it&#39;s not very nice) is to do is to override jQuery.ajaxSettings.xhr (something like):&#92;
&#92;
var _super = jQuery.ajaxSettings.xhr;&#92;
jQuery.ajaxSettings.xhr = function () {&#92;
    var xhr = _super(),&#92;
        getAllResponseHeaders = xhr.getAllResponseHeaders;&#92;
&#92;
    xhr.getAllResponseHeaders = function () {&#92;
        if ( getAllResponseHeaders() ) {&#92;
            return getAllResponseHeaders();&#92;
        }&#92;
        var allHeaders = &quot;&quot;;&#92;
        $( [&quot;Cache-Control&quot;, &quot;Content-Language&quot;, &quot;Content-Type&quot;,&#92;
                &quot;Expires&quot;, &quot;Last-Modified&quot;, &quot;Pragma&quot;] ).each(function (i, header_name) {&#92;
&#92;
            if ( xhr.getResponseHeader( header_name ) ) {&#92;
                allHeaders += header_name + &quot;: &quot; + xhr.getResponseHeader( header_name ) + &quot;&#92;&#92;n&quot;;&#92;
            }&#92;
            return allHeaders;&#92;
        });&#92;
    };&#92;
    return xhr;&#92;
};&#92;
&#92;
[1] &quot;&quot;&quot;User agents must filter out all response headers other than those that are a simple response header [2] or of which the field name is an ASCII case-insensitive match for one of the values of the Access-Control-Expose-Headers headers (if any), before exposing response headers to APIs defined in CORS API specifications.&#92;
&#92;
E.g. the getResponseHeader() method of XMLHttpRequest will therefore not expose any header not indicated above.&quot;&quot;&quot;&#92;
[2] http://www.w3.org/TR/cors/#simple-response-header</span> → <span class="change-field-new">1317051024285075</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>The list of headers is complete according to the CORS spec [1].</p><p>In order to get access to more headers, you'd have to rely on the Access-Control-Expose-Headers header, which is broken in Chrome and Safari, and broken-by-design in that Javascript can't read it (so we *could* try and read that, and if we can append any headers that are whitelisted to the list we try to read, but it would only work in Firefox and under very limited conditions).</p><p>A better fix would be to delegate jqXHR.getResponseHeader() to the builtin getResponseHeader(), though that would break the nice encapsulation of transporters.</p><p>If we wanted to document this, and provide a work-around, the best thing I can think of (though it's not very nice) is to do is to override jQuery.ajaxSettings.xhr (something like):</p><pre class="wiki">
var _super = jQuery.ajaxSettings.xhr;
jQuery.ajaxSettings.xhr = function () {
    var xhr = _super(),
        getAllResponseHeaders = xhr.getAllResponseHeaders;

    xhr.getAllResponseHeaders = function () {
        if ( getAllResponseHeaders() ) {
            return getAllResponseHeaders();
        }
        var allHeaders = "";
        $( ["Cache-Control", "Content-Language", "Content-Type",
                "Expires", "Last-Modified", "Pragma"] ).each(function (i, header_name) {

            if ( xhr.getResponseHeader( header_name ) ) {
                allHeaders += header_name + ": " + xhr.getResponseHeader( header_name ) + "\\n";
            }
            return allHeaders;
        });
    };
    return xhr;
};
</pre><p>[1] """User agents must filter out all response headers other than those that are a simple response header [2] or of which the field name is an ASCII case-insensitive match for one of the values of the Access-Control-Expose-Headers headers (if any), before exposing response headers to APIs defined in CORS API specifications.</p><p>E.g. the getResponseHeader() method of XMLHttpRequest will therefore not expose any header not indicated above."""</p><p>[2] <a href="http://www.w3.org/TR/cors/#simple-response-header" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/cors/#simple-response-header</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 26, 2011 03:32PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-new">→ needsdocs</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I agree it's not very nice but I honestly prefer something like this over patching for a problem (hopefully) short-lived.</p><p>I can't keep count of how many problems we had with CORS so far :/</p><p>Replying to [comment:5 conrad.irwin@…]:</p><blockquote> The list of headers is complete according to the CORS spec [1].  In order to get access to more headers, you'd have to rely on the Access-Control-Expose-Headers header, which is broken in Chrome and Safari, and broken-by-design in that Javascript can't read it (so we *could* try and read that, and if we can append any headers that are whitelisted to the list we try to read, but it would only work in Firefox and under very limited conditions).  A better fix would be to delegate jqXHR.getResponseHeader() to the builtin getResponseHeader(), though that would break the nice encapsulation of transporters.  If we wanted to document this, and provide a work-around, the best thing I can think of (though it's not very nice) is to do is to override jQuery.ajaxSettings.xhr (something like):  <pre class="wiki">
&gt; var _super = jQuery.ajaxSettings.xhr;
&gt; jQuery.ajaxSettings.xhr = function () {
&gt;     var xhr = _super(),
&gt;         getAllResponseHeaders = xhr.getAllResponseHeaders;
&gt; 
&gt;     xhr.getAllResponseHeaders = function () {
&gt;         if ( getAllResponseHeaders() ) {
&gt;             return getAllResponseHeaders();
&gt;         }
&gt;         var allHeaders = "";
&gt;         $( ["Cache-Control", "Content-Language", "Content-Type",
&gt;                 "Expires", "Last-Modified", "Pragma"] ).each(function (i, header_name) {
&gt; 
&gt;             if ( xhr.getResponseHeader( header_name ) ) {
&gt;                 allHeaders += header_name + ": " + xhr.getResponseHeader( header_name ) + "\\n";
&gt;             }
&gt;             return allHeaders;
&gt;         });
&gt;     };
&gt;     return xhr;
&gt; };
&gt; </pre>  [1] """User agents must filter out all response headers other than those that are a simple response header [2] or of which the field name is an ASCII case-insensitive match for one of the values of the Access-Control-Expose-Headers headers (if any), before exposing response headers to APIs defined in CORS API specifications.  E.g. the getResponseHeader() method of XMLHttpRequest will therefore not expose any header not indicated above.""" [2] <a href="http://www.w3.org/TR/cors/#simple-response-header" class="ext-link"><span class="icon"></span>http://www.w3.org/TR/cors/#simple-response-header</a></blockquote>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 26, 2011 03:33PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">None</span> → <span class="change-field-new">1.next</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 18, 2011 09:52AM UTC by <span class="author">addyosmani</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">needsdocs</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Docs for this have been added.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 14, 2011 10:42PM UTC by <span class="author">mitar</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>CCing.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 15, 2011 12:15AM UTC by <span class="author">mitar</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This does not really work. I am getting:</p><pre class="wiki">
"[Exception... \\"Illegal operation on WrappedNative prototype object\\"  nsresult: \\"0x8057000c (NS_ERROR_XPC_BAD_OP_ON_WN_PROTO)\\"  location: \\"JS frame :: http://127.0.0.1:8000/static/project/js/common.js :: &lt;TOP_LEVEL&gt; :: line 225\\"  data: no]"
</pre><p>Why solution/hack cannot simply reuse native <code>getResponseHeader</code>? Then there will be no need for a list of supported header names?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 15, 2011 01:29AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Have you tried filing a bug with Firefox?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 15, 2011 09:20AM UTC by <span class="author">mitar</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>There is a bug existing already there for <code>getResponseHeader</code>? And I am getting this on a bit old Firefox, 4.0.1. (Want to have support also old Firefox versions.)</p><p>But as I understand, calling <code>getResponseHeader</code> on native xhr would work? How can I access this native <code>getResponseHeader</code>? Because this broke for me with upgrade to jQuery 1.7. Before I had 1.4.2 and it worked. So obviously it is possible to make <code>getResponseHeader</code> work independently from Firefox bug.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed November 17, 2011 03:45PM UTC by <span class="author">volune</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Here is an updated work-around I use with jQuery 1.7 and Firefox 8</p><pre class="wiki">
var _super = $.ajaxSettings.xhr;
$.ajaxSetup( {
    xhr: function ()
    {
        var xhr = _super();
        var getAllResponseHeaders = xhr.getAllResponseHeaders;

        xhr.getAllResponseHeaders = function ()
        {
            var allHeaders = getAllResponseHeaders.call( xhr );
            if( allHeaders )
            {
                return allHeaders;
            }
            allHeaders = "";
            $( ["Cache-Control", "Content-Language", "Content-Type",
                "Expires", "Last-Modified", "Pragma"] ).each( function ( i, header_name )
                    {
                        if( xhr.getResponseHeader( header_name ) )
                        {
                            allHeaders += header_name + ": " + xhr.getResponseHeader( header_name ) + "\\n";
                        }
                    } );
            return allHeaders;
        };
        return xhr;
    }
} );
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:14">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 23, 2012 08:56PM UTC by <span class="author">keith.donald@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:14">comment:14</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Here's an refinement to the above work-around that makes a distinction between the fixed-list of simple response headers and a custom list for non-simple headers that the CORS server makes accessible via "Access-Control-Expose-Headers" (Location being a common one). It's also a AMD module.</p><pre class="wiki">
define("jquery-cors-patch", ["jquery"], function ($) {

  // workaround for Firefox CORS bug - see http://bugs.jquery.com/ticket/10338

  var _super = $.ajaxSettings.xhr;
  $.ajaxSetup({
    xhr: function() {
      var xhr = _super();
      var getAllResponseHeaders = xhr.getAllResponseHeaders;
      xhr.getAllResponseHeaders = function() {
    	  var allHeaders = getAllResponseHeaders.call(xhr);
        if (allHeaders) {
        	return allHeaders;
        }
        allHeaders = "";
        var concatHeader = function(i, header_name) {
      	  if (xhr.getResponseHeader(header_name)) {
            allHeaders += header_name + ": " + xhr.getResponseHeader( header_name ) + "\\n";
          }
        };
        // simple headers (fixed set)
        $(["Cache-Control", "Content-Language", "Content-Type", "Expires", "Last-Modified", "Pragma"]).each(concatHeader);
        // non-simple headers (add more as required)
        $(["Location"] ).each(concatHeader);        
        return allHeaders;
      };
      return xhr;
    }
  });

});
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:15">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 05, 2012 04:08PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:15">comment:15</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/11624">#11624</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:16">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 07, 2012 08:58PM UTC by <span class="author">malix.ren@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:16">comment:16</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>In the case that non-simple headers need to be exposed, ex.: </p><p>Access-Control-Expose-Headers : Location</p><p>It might be better to delegate getResponseHeader() to the real xhr object.</p><pre class="wiki">
diff --git a/src/ajax.js b/src/ajax.js
index 2bcc1d0..368c69d 100644
--- a/src/ajax.js
+++ b/src/ajax.js
@@ -458,7 +458,8 @@ jQuery.extend({
 						}
 						match = responseHeaders[ key.toLowerCase() ];
 					}
-					return match === undefined ? null : match;
+					// Work around for firefox: xhr.getAllResponseHeaders() retruns "" for cross domain request.
+					return match === undefined ? ( this.xhr === undefined ? null : this.xhr.getResponseHeader(key) ) : match;
 				},
 
 				// Overrides response content-type header
@@ -483,7 +484,7 @@ jQuery.extend({
 		// Callback for when everything is done
 		// It is defined here because jslint complains if it is declared
 		// at the end of the function (which would be more logical and readable)
-		function done( status, nativeStatusText, responses, headers ) {
+		function done( status, nativeStatusText, responses, headers, xhr ) {
 
 			// Called once
 			if ( state === 2 ) {
@@ -508,6 +509,9 @@ jQuery.extend({
 			// Set readyState
 			jqXHR.readyState = status &gt; 0 ? 4 : 0;
 
+			// set the real xhr object
+			jqXHR.xhr = xhr;
+			
 			var isSuccess,
 				success,
 				error,
diff --git a/src/ajax/xhr.js b/src/ajax/xhr.js
index 013863d..ec5daca 100644
--- a/src/ajax/xhr.js
+++ b/src/ajax/xhr.js
@@ -186,7 +186,7 @@ if ( jQuery.support.ajax ) {
 
 						// Call complete if needed
 						if ( responses ) {
-							complete( status, statusText, responses, responseHeaders );
+							complete( status, statusText, responses, responseHeaders, xhr );
 						}
 					};
 

</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:17">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed January 26, 2013 09:41PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:17">comment:17</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This bug is being actively worked by Firefox at this point, so I think we'll wait for their solution rather than bloating both 1.9 and 2.0 with a patch.</p><p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=608735#c38" class="ext-link"><span class="icon"></span>https://bugzilla.mozilla.org/show_bug.cgi?id=608735#c38</a></p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:18">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 20, 2013 11:22AM UTC by <span class="author">michael.conway@spirion.net</span></span>
        <a class="ticket-change-link" href="#comment:18">comment:18</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Some additional info on this odd behavior under Firefox.</p><p>I just hit up against this issue.  A bit of research showed my that the associated Firefox bug is now fixed, scheduled for release version 21.  I've just tried out Firefox 21 beta with jQuery 1.9.1 and the issue appears to be fixed.</p><p>I'm not sure when Firefox 21 production version will hit.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:19">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 15, 2013 04:49PM UTC by <span class="author">mikesherov</span></span>
        <a class="ticket-change-link" href="#comment:19">comment:19</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>BTW, this was fixed in FF21 a while ago as well as in webkit and blink:</p><p><a href="https://bugs.webkit.org/show_bug.cgi?id=41210" class="ext-link"><span class="icon"></span>https://bugs.webkit.org/show_bug.cgi?id=41210</a></p><p><a href="https://code.google.com/p/chromium/issues/detail?id=87338" class="ext-link"><span class="icon"></span>https://code.google.com/p/chromium/issues/detail?id=87338</a></p><p><a href="https://bugs.webkit.org/show_bug.cgi?id=76419" class="ext-link"><span class="icon"></span>https://bugs.webkit.org/show_bug.cgi?id=76419</a></p><p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=608735" class="ext-link"><span class="icon"></span>https://bugzilla.mozilla.org/show_bug.cgi?id=608735</a></p><p>confirmed using <a href="http://jsfiddle.net/xeBub/7/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/xeBub/7/</a> in browserstack</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
