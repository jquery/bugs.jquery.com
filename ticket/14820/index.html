<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#14820 (scroll event fires after scrollTop animation is complete) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/14819/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/14821/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#14820</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(invalid)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened February 19, 2014 06:56PM UTC</p>
      
        <p>Closed March 31, 2014 08:50AM UTC</p>
      
      
        <p>Last modified March 31, 2014 01:36PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">scroll event fires after scrollTop animation is complete</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        zzzzbov@gmail.com
      </td>
      <th>Owned by:</th>
      <td>zzzzbov@gmail.com</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>2.1.0</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Animations that animate the <code>scrollTop</code> property trigger scroll events, however it appears that an additional <code>scroll</code> event is triggered ''after'' the animation's <code>complete</code> callback has been called.</p><p><a href="http://jsfiddle.net/LMR4d/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/LMR4d/</a></p><p>I'm experiencing this in Chrome, Firefox, and IE10 on Windows 7.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (10)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 06, 2014 07:53AM UTC by <span class="author">voelzmo@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Does animate() really return a deferred? If I try your example with a self-created Deferred and the 'complete' callback, it seems to work:</p><pre class="wiki">
function animate(){
  var deferred = new jQuery.Deferred();
  $('html, body').animate({
    scrollTop: 500
  }, {
    complete : function() {
        deferred.resolve();
    },
    duration : 3000
  });  
  return deferred;
}
</pre>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 06, 2014 08:04AM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 voelzmo@…]:</p><p>Argh, nevermind. I was of course forgetting the most important thing: setting animatingScroll = false in the complete callback. Then I see the exact same behavior, see <a href="http://jsfiddle.net/89pnX/." class="ext-link"><span class="icon"></span>http://jsfiddle.net/89pnX/.</a></p><p>PS: We're on jQuery 1.7.2 so this problem seems to have been around for a while.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 06, 2014 08:08AM UTC by <span class="author">voelzmo</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Replying to [comment:2 anonymous]:&#92;
Aaaaand here is the correct URL, sorry for the mess: http://jsfiddle.net/89pnX/2/&#92;
</span> → <span class="change-field-new">1394093665666810</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>_comment1:</th>
                  <td>
                    
                      <span class="change-field-old">Replying to [comment:2 anonymous]:&#92;
Aaaaand here is the correct URL, sorry for the mess: http://jsfiddle.net/89pnX/3/&#92;
</span> → <span class="change-field-new">1394093752337769</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 anonymous]:</p><p>Aaaaand here is the correct URL, sorry for the mess: <a href="http://jsfiddle.net/89pnX/3/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/89pnX/3/</a></p><p>A possible workaround seems to be to delay the execution of the complete callback by a magic number: <a href="http://jsfiddle.net/89pnX/4/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/89pnX/4/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 06, 2014 09:19PM UTC by <span class="author">zzzzbov@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 voelzmo@…]:</p><blockquote> Does animate() really return a deferred? If I try your example with a self-created Deferred and the 'complete' callback, it seems to work:  <pre class="wiki">
&gt; function animate(){
&gt;   var deferred = new jQuery.Deferred();
&gt;   $('html, body').animate({
&gt;     scrollTop: 500
&gt;   }, {
&gt;     complete : function() {
&gt;         deferred.resolve();
&gt;     },
&gt;     duration : 3000
&gt;   });  
&gt;   return deferred;
&gt; }
&gt; </pre></blockquote><p><code>animate()</code> doesn't return a deferred, <code>promise()</code> on a jQuery collection returns a deferred that resolves when ''all'' <code>'fx'</code> queues have completed. The provided example code resolves when the ''first'' <code>'fx'</code> queue has completed.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 06, 2014 09:32PM UTC by <span class="author">zzzzbov@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>It appears as though this isn't actually a bug with jQuery, and instead seems to be a quirk of scroll events in the browser. <a href="http://stackoverflow.com/a/21949168/497418" class="ext-link"><span class="icon"></span>See this related question on <a href="/wiki/StackOverflow">StackOverflow</a> for additional details</a>.</p><p>Assigning a new scroll value does not immediately queue a scroll event. Instead, there can be an unknown amount of delay between setting <code>scrollTop</code> and the <code>scroll</code> event firing (<a href="http://jsfiddle.net/jSBn2/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/jSBn2/</a>). Sometimes the <code>scroll</code> event will be immediately queued in the event loop, sometimes not.</p><p>This delay is what's causing the odd behavior of the <code>scroll</code> event after the <code>complete</code> callback.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 06, 2014 09:55PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I thought this was what happened: When you set <code>scrollTop</code> it queues an event to occur once the thread completes. On the final step of the animation the Deferred resolves synchronously and immediately calls all the callbacks. Then the thread completes and the event fires. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 06, 2014 10:07PM UTC by <span class="author">zzzzbov@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:6 dmethvin]:</p><blockquote> I thought this was what happened: When you set <code>scrollTop</code> it queues an event to occur once the thread completes. On the final step of the animation the Deferred resolves synchronously and immediately calls all the callbacks. Then the thread completes and the event fires.  </blockquote><p>Promises aren't supposed to resolve synchronously, although I'm aware that jQuery's deferreds deviate from the <a href="https://github.com/promises-aplus/promises-spec" class="ext-link"><span class="icon"></span>Promises/A+ spec</a>. Even if that were the case, including a <code>delay(0)</code> call into the chain before the promise should fix the issue, <a href="http://jsfiddle.net/zzzzBov/LMR4d/2/" class="ext-link"><span class="icon"></span>which it doesn't</a>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 16, 2014 03:51PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ zzzzbov@gmail.com</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">pending</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Oh, I see you were animating two things and then using the per-element callback. That's not going to work consistently anyway. See the discussion here: <a href="https://github.com/jquery/api.jquery.com/issues/417" class="ext-link"><span class="icon"></span>https://github.com/jquery/api.jquery.com/issues/417</a></p><p>Does that docs issue answer your question?</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 31, 2014 08:50AM UTC by <span class="author">trac-o-bot</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">pending</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Because we get so many tickets, we often need to return them to the initial reporter for more information. If that person does not reply within 14 days, the ticket will automatically be closed, and that has happened in this case. If you still are interested in pursuing this issue, feel free to add a comment with the requested information and we will be happy to reopen the ticket if it is still valid. Thanks!</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 31, 2014 01:36PM UTC by <span class="author">zzzzbov@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:8 dmethvin]:</p><blockquote> Oh, I see you were animating two things and then using the per-element callback.</blockquote><p>I'm not sure I follow. I animated two things and set up a promise to fire once when both fx queues were clear.</p><p>voelzmo's snippet uses the per-animation callback, maybe that's what you were referring to.</p><p>Either way, I found that the <code>scroll</code> event doesn't fire synchronously after <code>scrollTop</code> is changed, which is what is causing the erratic behavior. As it's a native browser behavior, it's not a bug in jQuery, so this ticket can remain closed.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
