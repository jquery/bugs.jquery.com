<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#10168 (jQuery.event.trigger and inline handlers.) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/10167/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/10169/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#10168</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened August 30, 2011 02:23PM UTC</p>
      
        <p>Closed October 13, 2011 04:11AM UTC</p>
      
      
        <p>Last modified July 29, 2013 07:16PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">jQuery.event.trigger and inline handlers.</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        stefen@mediaodyssee.com
      </td>
      <th>Owned by:</th>
      <td>dmethvin</td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>event</td>
      
        <th>Version:</th>
      
      <td>1.6.2</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Looking at the <code>event.js</code> file, in the <code>jQuery.event.trigger</code> method, it seems that a triggered event is first bubbled manually, then triggered natively to allow default browser behaviours. The problem occurs when you add a listener without <code>jQuery</code>, like an inline <code>onclick</code> listener.</p><p>As I understand it, it kind of looks that way :</p><pre class="wiki">
current = evt.target;
do
    execute current jquery handlers
    execute current inline handler
    current = current.parentNode
while not evt.isPropagationStopped

if not evt.defaultPrevented
    deactivating jquery handlers
    deactivating evt.target inline handler but not ancestor ones
    evt.target[event.type]()
</pre><p>So, if the event is not <code>defaultPrevented</code>, the upward inline handlers are executed twice. If it is, listeners added using native <code>attachEvent|addEventListener</code> methods would be triggered but delayed compared to the <code>jQuery</code> handlers, and also the <code>evt.isPropagationStopped</code> eventually setted by a previous <code>jQuery</code> handler would be ignored.</p><p>Although the <code>jQuery.event.triggered</code> flag, which seems to deactivate the <code>jQuery</code> shared handler, can be used in the inline handlers as well, why not doing something like this :</p><pre class="wiki">
if evt.target[event.type]
    evt.target[event.type]()
else
    bubble manually ...
</pre><p>I'm although curious about the way you will handle the <code>DOM 3</code> capture behaviour.</p><p>Another thought : I can imagine how tough it is to maintain the consistency of the lib, but the more I'm reading it, the more I'm thinking : if I'm building a web app using <code>jQuery</code>, I shouldn't use anything else which is not build against the same <code>jQuery</code>, otherwise I would encounter strange behaviours. It would be nice to inform users about the interactions and caveats somewhere in the documentation. If it is, my bad, I'll do better reading it next time.</p><p>Seems to be related to the following tickets : <a href="/ticket/6593">#6593</a>, <a href="/ticket/6705">#6705</a></p><p>Here's the use case : == <a href="http://jsfiddle.net/FrKyN/19/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/FrKyN/19/</a> ==</p><p>Tested using <code>Chromium 13</code> and <code>Aurora 6</code></p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (9)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 30, 2011 03:20PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Those are some great questions!&#92;
&#92;
Your analysis is basically correct. There are a few related tickets like #3287 as well that show other issues with the `.trigger()` design peeking through. I think the general team consensus is that inline handlers are both bad practice and a pain in our butts due to issues like this.&#92;
&#92;
I suspect the reason this may not be reported very often is that the most common way for people to use inline handlers is to prevent the default action, which means they never see the double triggering.&#92;
&#92;
If we&#39;re going to fix this and continue supporting inline handlers, we have to run them in the trigger loop up front so they can stop propagation and prevent default. In that case we&#39;d need to figure out some way to remove/restore all the inline handlers just like we do for the target -- really messy for something we don&#39;t even want people to do.&#92;
&#92;
Either that or we have to eliminate that trigger loop *entirely* for native events (still need it for custom events) and have the browser do the propagation. You&#39;re basically proposing that with the `evt.target[event.type]` test. That brings issues like #3287 into play, which would be a major breaking change.&#92;
&#92;
As for capture behavior, jQuery doesn&#39;t support it via the external API. It&#39;s used in a couple of places for special events (see `focusin` and `focusout`).</span> → <span class="change-field-new">1314717760618358</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">Looking at the `event.js` file, in the `jQuery.event.trigger` method, it seems that a triggered event is first bubbled manually, then triggered natively to allow default browser behaviours. The problem occurs when you add a listener without `jQuery`, like an inline `onclick` listener.&#92;
&#92;
As I understand it, it kind of looks that way :&#92;
{{{&#92;
current = evt.target;&#92;
do&#92;
    execute current jquery handlers&#92;
    execute current inline handler&#92;
    current = current.parentNode&#92;
while not evt.isPropagationStopped&#92;
&#92;
if not evt.defaultPrevented&#92;
    deactivating jquery handlers&#92;
    deactivating evt.target inline handler but not ancestor ones&#92;
    evt.target[event.type]()&#92;
}}}&#92;
So, if the event is not `defaultPrevented`, the upward inline handlers are executed twice. If it is, listeners added using native `attachEvent|addEventListener` methods would be triggered but delayed compared to the `jQuery` handlers, and also the `evt.isPropagationStopped` eventually setted by a previous `jQuery` handler would be ignored.&#92;
&#92;
Although the `jQuery.event.triggered` flag, which seems to deactivate the `jQuery` shared handler, can be used in the inline handlers as well, why not doing something like this :&#92;
{{{&#92;
if evt.target[event.type]&#92;
    evt.target[event.type]()&#92;
else&#92;
    bubble manually ...&#92;
}}}&#92;
I&#39;m although curious about the way you will handle the `DOM 3` capture behaviour.&#92;
&#92;
Another thought : I can imagine how tough it is to maintain the consistency of the lib, but the more I&#39;m reading it, the more I&#39;m thinking : if I&#39;m building a web app using `jQuery`, I shouldn&#39;t use anything else which is not build against the same `jQuery`, otherwise I would encounter strange behaviours. It would be nice to inform users about the interactions and caveats somewhere in the documentation. If it is, my bad, I&#39;ll do better reading it next time.&#92;
&#92;
Seems to be related to the following tickets : [ticket: 6593], [ticket: 6705]&#92;
&#92;
Here&#39;s the use case : == http://jsfiddle.net/FrKyN/19/ ==&#92;
&#92;
Tested using `Chromium 13` and `Aurora 6`</span> → <span class="change-field-new">Looking at the `event.js` file, in the `jQuery.event.trigger` method, it seems that a triggered event is first bubbled manually, then triggered natively to allow default browser behaviours. The problem occurs when you add a listener without `jQuery`, like an inline `onclick` listener.&#92;
&#92;
As I understand it, it kind of looks that way :&#92;
{{{&#92;
current = evt.target;&#92;
do&#92;
    execute current jquery handlers&#92;
    execute current inline handler&#92;
    current = current.parentNode&#92;
while not evt.isPropagationStopped&#92;
&#92;
if not evt.defaultPrevented&#92;
    deactivating jquery handlers&#92;
    deactivating evt.target inline handler but not ancestor ones&#92;
    evt.target[event.type]()&#92;
}}}&#92;
So, if the event is not `defaultPrevented`, the upward inline handlers are executed twice. If it is, listeners added using native `attachEvent|addEventListener` methods would be triggered but delayed compared to the `jQuery` handlers, and also the `evt.isPropagationStopped` eventually setted by a previous `jQuery` handler would be ignored.&#92;
&#92;
Although the `jQuery.event.triggered` flag, which seems to deactivate the `jQuery` shared handler, can be used in the inline handlers as well, why not doing something like this :&#92;
{{{&#92;
if evt.target[event.type]&#92;
    evt.target[event.type]()&#92;
else&#92;
    bubble manually ...&#92;
}}}&#92;
I&#39;m although curious about the way you will handle the `DOM 3` capture behaviour.&#92;
&#92;
Another thought : I can imagine how tough it is to maintain the consistency of the lib, but the more I&#39;m reading it, the more I&#39;m thinking : if I&#39;m building a web app using `jQuery`, I shouldn&#39;t use anything else which is not build against the same `jQuery`, otherwise I would encounter strange behaviours. It would be nice to inform users about the interactions and caveats somewhere in the documentation. If it is, my bad, I&#39;ll do better reading it next time.&#92;
&#92;
Seems to be related to the following tickets : #6593, #6705&#92;
&#92;
Here&#39;s the use case : == http://jsfiddle.net/FrKyN/19/ ==&#92;
&#92;
Tested using `Chromium 13` and `Aurora 6`</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Those are some great questions!</p><p>Your analysis is basically correct. There are a few related tickets like <a href="/ticket/3827">#3827</a> as well that show other issues with the <code>.trigger()</code> design peeking through. I think the general team consensus is that inline handlers are both bad practice and a pain in our butts due to issues like this.</p><p>I suspect the reason this may not be reported very often is that the most common way for people to use inline handlers is to prevent the default action, which means they never see the double triggering.</p><p>If we're going to fix this and continue supporting inline handlers, we have to run them in the trigger loop up front so they can stop propagation and prevent default. In that case we'd need to figure out some way to remove/restore all the inline handlers just like we do for the target -- really messy for something we don't even want people to do.</p><p>Either that or we have to eliminate that trigger loop *entirely* for native events (still need it for custom events) and have the browser do the propagation. You're basically proposing that with the <code>evt.target[event.type]</code> test. That brings issues like <a href="/ticket/3827">#3827</a> into play, which would be a major breaking change.</p><p>As for capture behavior, jQuery doesn't support it via the external API. It's used in a couple of places for special events (see <code>focusin</code> and <code>focusout</code>).</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 30, 2011 04:18PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>No troll, but I want to make sure this is mentioned: <a href="http://docs.jquery.com/Won't_Fix#Inline_Event_Handlers" class="ext-link"><span class="icon"></span>http://docs.jquery.com/Won't_Fix#Inline_Event_Handlers</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 30, 2011 04:32PM UTC by <span class="author">stefen@mediaodyssee.com</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 rwaldron]:</p><blockquote> No troll, but I want to make sure this is mentioned: <a href="http://docs.jquery.com/Won't_Fix#Inline_Event_Handlers" class="ext-link"><span class="icon"></span>http://docs.jquery.com/Won't_Fix#Inline_Event_Handlers</a></blockquote><p>Oops, didn't see that one...</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 30, 2011 04:57PM UTC by <span class="author">stefen@mediaodyssee.com</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks for the explanation, I was just surprised by the way it was done, looking at the code. I think I understand the pros and cons of using obstrusive javascript, but it still kinda weird when using the native event listener subscribers. And as <code>jQuery</code> can be used with third party components, it's still something to warn about. I'm still thinking that using the native events (or document.createEvent) when available, for non custom events, would be more appropriate, but facing the major breaking changes which I can't see in all their extents, it's way over my head.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 13, 2011 04:11AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">event</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Although I would love to revisit this, the few changes I attempted to make on focus/blur handlers in 1.7 convince me that it won't be possible. One major issue is that if we let the native method fire the event it doesn't always fire the way it does currently. For example, the focus event handlers won't run if the element is already focused or is hidden. Currently we'd always run the handlers even if focusing the element would fail.</p>
            </div>
          
        
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 13, 2011 04:11AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-old strikethrough">wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">closed</span> → <span class="change-field-new">reopened</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 13, 2011 04:11AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>owner:</th>
                  <td>
                    
                      <span class="change-field-new">→ dmethvin</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">reopened</span> → <span class="change-field-new">assigned</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed October 13, 2011 04:11AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">assigned</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 29, 2013 07:16PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/14199">#14199</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
