<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#11082 (jQuery.support object now incorrect/incomplete until jQuery.ready fires) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/11081/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/11086/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#11082</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened December 20, 2011 11:57PM UTC</p>
      
        <p>Closed June 26, 2012 03:23AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">jQuery.support object now incorrect/incomplete until jQuery.ready fires</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        ppan235@gmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>support</td>
      
        <th>Version:</th>
      
      <td>1.7.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p><strong>Summary</strong></p><p>Two recent changes (links below) mean that the jQuery support object is now incorrect/incomplete until jQuery.ready fires. This means jQuery functions incorrectly before this point. The behaviour change is a regression: 1.7.0 doesn't do this; 1.7.1 does. Test case is below.</p><p><strong>Cause</strong></p><p>Various tests that probe the browser environment and update jQuery.support accordingly are now being run inside a function passed to jQuery.ready.</p><p><a href="https://github.com/jquery/jquery/commit/93750cee36f0b2edc1afd2dad64d9306865a39b9" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/commit/93750cee36f0b2edc1afd2dad64d9306865a39b9</a></p><p><a href="https://github.com/jquery/jquery/commit/9bea2167c434d5b97643f53da16b04927dc02a7d" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/commit/9bea2167c434d5b97643f53da16b04927dc02a7d</a></p><p>Search for "jQuery(function() {".</p><p><strong>Problem</strong></p><p>A race condition now exists for client code that loads jquery and then uses it immediately, without explicitly waiting for jQuery.ready to fire. If jQuery.ready/browser-probes run first, the client code sees the complete/correct jQuery.support object. If the client code runs first, it sees the incomplete/correct version. This means that jQuery functions incorrectly at this point.</p><p>I've seen this problem as I'm loading jQuery into an already loaded page (using a bookmarklet), and then calling jQuery immediately. My client code isn't inside its own jQuery.ready, as I've seen problems in the past with the "ready" event not firing on an already loaded page.</p><p><strong>Solution</strong></p><p>I "fixed" the problem on Mac Firefox 8.0.1 by making all the browser probes for jQuery.support run inline, rather than at jQuery.ready. I just commented out the two uses of "jQuery(function() {". However, this doesn't seem like a long-term fix.</p><p>Ideally, jQuery.support (and jQuery as a whole) should be fully initialized by the time jQuery loads. So all setup must run within the jquery load thread, not triggered by a later event. In the case of the browser probes for jQuery.support:</p><ul><li>If the probes need a fully loaded DOM, is there some way of detecting this inline, rather than needing to wait for the jQuery.ready event to fire?</li><li>Or could a function passed to jQuery.ready be run inline immediately, if the DOM is already loaded?</li></ul><p><strong>Test case</strong></p><p>Copy html code below into test file, then load and view console. Output shows support object is incorrect before jQuery.ready:</p><pre class="wiki">
$.support.reliableHiddenOffsets before jQuery.ready: undefined
$.support.reliableHiddenOffsets after jQuery.ready: true
</pre><pre class="wiki">
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;body&gt;
    &lt;script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        console.log("$.support.reliableHiddenOffsets before jQuery.ready: " + $.support.reliableHiddenOffsets);
        $(function() {
            console.log("$.support.reliableHiddenOffsets after jQuery.ready: " + $.support.reliableHiddenOffsets);
        })
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><p>To see correct 1.7.0 behaviour, just load jquery-1.7.0.js instead. Output should be:</p><pre class="wiki">
$.support.reliableHiddenOffsets before jQuery.ready: true
$.support.reliableHiddenOffsets after jQuery.ready: true
</pre><p>Tested on Mac Firefox 8.0.1 and Safari 5.1.2</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (3)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 21, 2011 12:10AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">support</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Sorry, I agree with your analysis but this is something we're more likely to document than change.</p><p>Our experience is showing that page load is a very inopportune time to do many of these feature detects. First there is the performance issue; if all the tests have to be done before document ready then we are holding up the page for tests that may not be needed until much later. Then there is the problem that some browsers (particularly old ones) seem to be in a relatively unstable state until the page has fully and completely loaded; feature tests sometimes stress them out. </p><p>My preferred solution would be to deprecate jQuery.support as an external interface. We tried to share these feature detects when we could, but they become a liability when others depend on them and we can no longer deliver them reliably or on time. In cases where we no longer need those feature detects due to code rewrites we are technically unable to remove them because it's an external interface.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 21, 2011 03:29AM UTC by <span class="author">ppan235@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:1 dmethvin]:</p><p>Thanks for the quick response. Three points:</p><p><strong>Would you be willing to fix this bug for the case when jQuery is being loaded into already loaded page?</strong> Stability shouldn't be an issue in this case, as the whole DOM tree is already there. Rough sketch:</p><ul><li>When doing feature detects that require a full DOM tree, test if the DOM tree is loaded, maybe using the check logic that currently fires the jQuery.ready event.</li><li>If the DOM tree is loaded, do feature detects inline, else postpone to a jQuery.ready function</li></ul><p>I'd very much appreciate this, as this the case I specifically care about.</p><p>'''This bug isn't really connected to jQuery.support being externally accessible.''' I tracked this bug down when investigating a huge slowdown in jQuery.is(':visible') performance. The root cause was that the underlying logic has a fast way of determining element visibility, if $.support.reliableHiddenOffsets is true. Since the variable now returns undefined, the visibility logic falls back to using the slow alternative.</p><p><strong>Improving performance is a laudable goal, but being correct is also important :-)</strong> Improving jquery "boot" time is a great idea; doing this by putting off non-essential feature detects seems a good way of doing this. However, this current approach of postponing feature detects until jQuery.ready fires has downsides:</p><ul><li>jQuery interface functions that are internally dependent on a correct jQuery.support object can now behave slowly, or possibly incorrectly, as with jQuery.is(':visible')</li><li>jQuery usage will now become more complex, and possibly confusing. Users will need to be told (and remember) that jQuery will only behave as expected once jQuery.ready has fired.</li></ul><p>I imagine that the ideal solution is some form of just-in-time feature detection, triggered by calling an interface function that uses a particular jQuery.support variable. So, the first call to jQuery.is(':visible') triggers a feature detect to set $.support.reliableHiddenOffsets.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed June 26, 2012 03:23AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>We'll track this in <a href="/ticket/10814">#10814</a>, and <a href="/ticket/11766">#11766</a> moved <code>jQuery.browser</code> to an unstable list with the idea that we may change it without deprecation notices.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
