<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#8671 (.parseJSON can&amp;#39;t decode a new Date) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/8669/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/8672/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#8671</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(wontfix)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened March 27, 2011 06:27PM UTC</p>
      
        <p>Closed March 27, 2011 06:47PM UTC</p>
      
      
        <p>Last modified July 16, 2013 11:28PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">.parseJSON can&#39;t decode a new Date</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        mithon81@hotmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.next">1.next</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>data</td>
      
        <th>Version:</th>
      
      <td>1.5.1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>When I do a</p><pre class="wiki">jQuery.parseJSON("{\\"BirthDate\\":new Date(1301180400000)}");</pre><p>i get: Invalid JSON: {"BirthDate":new Date(1301180400000)}</p><p>But if I use the <a href="/wiki/ExtJS">ExtJS</a> equivalent: </p><pre class="wiki">Ext.decode("{\\"BirthDate\\":new Date(1301180400000)}");</pre><p>i get the desired object containing a javascript Date instance.</p><p>Right now this means I must return MIME text/plain from my service and convert the return value with Ext.decode instead of simply supplying application/json in the service and getting the desired json back immediately.</p><p>I realize there is a discussion about the validity of sending constructor calls inside a json, but I think there was a rather well made point in that discussion; Since JSON is the javascript object notation wouldn't that imply that javascript builtin objects should deserialize properly?</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (9)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 27, 2011 06:47PM UTC by <span class="author">ajpiano</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ wontfix</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>jQuery.parseJSON emulates the behaviour of the native browser JSON object where it does not exist, and delegates to it where it does, which is most modern browsers.  Deviating from the native behaviour and supporting constructor functions, which are NOT valid JSON, would not be a wise move from my perspective.  It's all well and good that Ext chooses to support this, but I can't see us following in that direction - primarily because of compatibility with native JSON.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 29, 2011 12:40PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Go to jsonlint.com and enter this:</p><pre class="wiki">
{"BirthDate": new Date(1301180400000)}
</pre><p>It's not valid JSON. It's valid <a href="/wiki/JavaScript">JavaScript</a>, but not JSON.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 08, 2011 08:48PM UTC by <span class="author">Gaute Løken &lt;mithon81@hotmail.com&gt;</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Sorry about my late reply. Your responses were marked as spam unfortunately. </p><p>I would much appreciate a pointer or two on the following:</p><p>1) How (in what format) should I return dates from my web services and how should I consume them on the client? Is there a standard way? Will I have to make a pass over the response json replacing strings with dates according to certain rules etc, or is there a more slick way of doing this?</p><p>2) The stated reason is "primarily because of compatibility with native JSON". Is there an introductory resource available to inform me of these compatibility issues? </p><p>I'll just have to take your word for supporting constructor functions not being a wise move. From a cursory search this seems to be due to parsing performance. Good enough reason for me.</p><p>Would the problem then be that Date is not a strong type in native JSON? To me it sounds like this is a standards problem that should be looked into. One has to deal with formating amounts and dates for presentation, but there should be a standard for the model datatypes. Like there are floats usable for amounts, there should also be a native date datatype. </p><p>If native JSON could be expanded to accept something like the following it would be awesome:</p><pre class="wiki">
{"BirthDate": D1301180400000}
</pre><p>As an aside it should probably also accept a format for a regex as a native type as well, but I guess that's more of a long shot. </p><p>I realize I'm probably ranting to the wrong people, but maybe you have some influence with these things.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 14, 2011 03:43PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>What about the valid JSON format that ASP.NET uses.</p><p>{"recdate":"\\/Date(1302776454430)\\/","count":1}</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 14, 2011 03:56PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">data</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 15, 2011 01:55PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>As per <a href="http://bugs.jquery.com/ticket/8320" class="ext-link"><span class="icon"></span>http://bugs.jquery.com/ticket/8320</a> here is a converter for the date.</p><p>$.ajaxSetup({</p><p>    <em> use custom converter to handle invalid json data returned by WCF Data Service</em></p><p>     ignores invalid escaped single quotes (\\') in json data</p><p>    <em>     e.g. { "foo": "bar\\'tender" } --&gt; { "foo": "bar'tender" }</em></p><p>     also converts Microsoft Dates into actual Date objects</p><p>    //     e.g. { "\\/Date(###)\\/" } --&gt; { new Date(###) }</p><p>    converters: {</p><p>        "text json": function (textValue)</p><p>        {</p><p>            return (new Function("return " + textValue</p><p>                .replace(/"\\\\\\/Date\\((-?\\d*)\\)\\\\\\/"/g, "new Date($1)")</p><p>            ))();</p><p>        }</p><p>    }</p><p>});</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 16, 2011 05:23PM UTC by <span class="author">Gaute Løken &lt;mithon81@hotmail.com&gt;</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Firstly, thank you very much for the tip on the converters which gives me a hook for working around the problem, and for the tip on $.ajaxSetup which allows me to use that hook in a sentralized place instead of specifying it to $.ajax() all the time.</p><p>Unfortunately it's not the perfect hook since $.parseJSON doesn't have an overload that allows me to deal with how each value is decoded, but only has a global point for the complete raw json string. Actually I might dig into that a bit and see if I can suggest something (in a different post).</p><p>Without that however, the suggested replace doesn't work. That sort of regex would only work if I had such a hook. As it is the global replace works only to fix faulty json from the service. But it must still return valid JSON to be parsed by $.parseJSON. That is, this only works for non-nested data, which isn't good enough for my needs.</p><p>I am left with 3 options:</p><p>1) Return the non-native JSON from my service and set up jQuery to use the Ext decoder which is able to handle this:</p><pre class="wiki">
$.ajaxSetup({
    converters: { "text json": Ext.decode }
});
</pre><p>Now that I know this is non-valid JSON I hate giving up and using something non standard. In practice it seems to solve everything though.</p><p>2) Return valid JSON and use a replace scheme to convert it to non-valid JSON with Date constructors, and then use the Ext decoder. This would allow me to insert JSON validation before I make it invalid, and thus giving me the security I loose from option 1.</p><pre class="wiki">
$.ajaxSetup({
    converters: {
        "text json": function(json) {
            //TODO: Test json is valid
            var procJson = json.replace(/"\\\\\\/Date\\((-?\\d*\\+\\d{4})\\)\\\\\\/"/g, "new Date($1)");
            return Ext.decode(procJson);
        }
    }
});
</pre><p>3) Return valid JSON, but make a more complex JSON converter which first parses the input using $.parseJSON, and then recursively traverses the resulting object graph looking for strings containing Dates, and converting them. This is a little more involved, so I'm going to need to define some helper methods and regexes. I will assume ISO 8601 format for my dates, and I might not have the perfect regex for it, since I didn't look up the iso, and merely cooked up a regex from an example string; "1993-04-16T18:36:40.8983282+02:00". Here's the code:</p><pre class="wiki">
var reDate = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{7}[\\+-]\\d{2}:\\d{2}$/;
var reArray = /^function Array\\(\\)/;
var reObject = /^function Object\\(\\)/;

function isArray(val) { return reArray.test(val.constructor.toString()); }
function isObject(val) { return reObject.test(val.constructor.toString()); }

function convertJsonDates(value, index, parent) {
    if (typeof(value)=='string' && reDate.test(value)) {
        if (parent)
            parent[index] = new Date(value);
        else
            return new Date(value);
    } else if (isArray(value)) {
        for (var i = 0; i &lt; value.length; i++)
            convertJsonDates(value[i], i, value);
    } else if (isObject(value)) {
        for (var p in value)
            convertJsonDates(value[p], p, value);
    }
    return parent || value;
}

$.ajaxSetup({
    converters: {
        "text json": function(json) {
            return convertJsonDates($.parseJSON(json));
        }
    }
});
</pre><p>And the sanity-check for the conversion function:</p><pre class="wiki">
console.log(convertJsonDates({
    "a": "foo",
    "b": "goo",
    "c": [
    1024,
    "1993-04-16T18:36:40.8983282+02:00"
    ],
    "d": {
        "a": 3.1415,
        "b": 1.2345,
        "c": "1993-04-16T18:36:40.8983282+02:00"
    },
    "e": "1993-04-16T18:36:40.8983282+02:00"
}));
</pre><p>So, that was quite fun tbh. :) But I'm still undecided on what's the best approach. At this point I guess it's a matter of performance. I'm guessing that Ext.decode uses eval at some point internally. So the question really is wether or not $.parseJSON + a call to convertJsonDates is faster than eval. Any educated guesses? If I want to validate the JSON (option 2), then I have to add that validation to the equation. Finally it's a question of maintainability and cleanliness. Is it better to do these things in custom code (option 3), or cut my losses and let eval handle it (through Ext decoder)?</p><p>Sorry about the length of these posts. I hope some of you find them helpfull however. I appreciate the input so far. Thanks!</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 16, 2013 07:31PM UTC by <span class="author">jeanph01@gmail.com</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I would be nice if jQuery provided an option to take care of dates during JSON parsing (ex:a callback) so that we can get native <a href="/wiki/JavaScript">JavaScript</a> date objects. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed July 16, 2013 11:28PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:8 jeanph01@…]:</p><blockquote> I would be nice if jQuery provided an option to take care of dates during JSON parsing (ex:a callback) so that we can get native <a href="/wiki/JavaScript">JavaScript</a> date objects. </blockquote><p>You can easily duck-punch jQuery.parseJSON to include this functionality</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
