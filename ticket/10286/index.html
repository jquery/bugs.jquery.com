<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#10286 (AJAX prefilters and callbacks have no opportunity to influence Deferred object resolution) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/10285/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/10287/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#10286</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">enhancement</span>
      <span class="ticket-resolution">(invalid)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened September 15, 2011 07:17PM UTC</p>
      
        <p>Closed September 19, 2011 07:57AM UTC</p>
      
      
        <p>Last modified September 21, 2011 07:31AM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">AJAX prefilters and callbacks have no opportunity to influence Deferred object resolution</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        dthm5kvf6e@snkmail.com
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>1.6.4rc1</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th>Cc:</th>
      
      <td>jaubourg</td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>While I can supply success, error, and completion callbacks to any $.ajax() call, by the time these callbacks are invoked, the default AJAX transport object has already resolved or rejected the embedded promise/Deferred object on my behalf. Any code that was waiting on said resolution will be invoked whether I want it to or not. </p><p>The only way that I can pre-empt this behavior is by defining my own AJAX transport whose "send" method will receive a pointer to the default "done" method which performs this task. Since there is no way for such a custom transport to inherit or invoke the remainder of the default transport's logic without duplicating core library code, this is not a practical solution, either. </p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (5)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 19, 2011 07:57AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>cc:</th>
                  <td>
                    
                      <span class="change-field-new">→ jaubourg</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ invalid</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>It's actually quite easy to override the promise behaviour of the jqXHR object in a prefilter. You just need to use the promise method of a new Deferred object with the jqXHR object itself as the target objet parameter:</p><pre class="wiki">
$.ajaxPrefilter(function( options, originalOptions, jqXHR ) {
    var originalPromise = jqXHR.promise(),
        newDefer = $.Deferred(function( defer ) {
            defer.promise( jqXHR );
            jqXHR.success = defer.done;
            jqXHR.error = defer.fail;
            // Need a little bit more work to handle complete
        });
    originalPromise.done(function() {
        newDefer.resolve( /* whatever */ );
    });
});
</pre><p>Callbacks are not attached after prefilters are called so they will be attached to your new deferred this way. The jqXHR object hasn't been given to any external code yet (the beforeSend callback is called AFTER prefilters) so it's 100% safe.</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 19, 2011 04:16PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Thanks. That's pretty ugly, though.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 20, 2011 01:13PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Replying to [comment:2 anonymous]:</p><blockquote> Thanks. That's pretty ugly, though.</blockquote><p>Well, let's see:</p><ul><li>You don't have to know about the internals of the transport layer</li><li>You don't have to worry about the dataType conversion layer</li><li>You don't need to worry about another prefilter doing something similar (everything will still work as intended)</li></ul><p>I'd say it's pretty neat in its simplicity. You could even do it using pipe:</p><pre class="wiki">
jqXHR.pipe( function() {
   // Handle success and eventually redirect
}, function() {
   // Handle error and eventually redirect
} ).promise( jqXHR );
// Aliases
jqXHR.success = jqXHR.done;
jqXHR.error = jqXHR.fail;
</pre><p>Of course, you still have to handle complete if you really need to but that's not that much of an hassle, is it?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 20, 2011 05:28PM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The API could make that process a whole lot less retarded by vending a reference to the internal "done" method, but that would involve actual thought in place of snark on your part, so I shant be holding my breath. </p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed September 21, 2011 07:31AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Giving access to the internal &quot;done&quot; method (whatever you exactly mean by that) is insufficient and dangerous. A key in the design of Deferreds is to ensure no-one will bork your Deferreds to death. The fact that Deferreds methods are &quot;detachable&quot; (lexically bound) allows a lot of flexibility without the need to compromise the Deferred&#39;s internal state by having the Deferred&#39;s guts wide opened. Please, stop obsessing about your immediate problem and just ponder this for a mere second.&#92;
&#92;
No, really, stop being mad at me/the screen/the world right now, re-read the paragraph above and do think about it.&#92;
&#92;
I know it&#39;s always difficult to understand that cutting corners for every specific edge-case is NOT good design. Making so said edge-case can be solved using a reasonable ammount of code without compromising everyone else&#39;s code (at least not that easily, I know we&#39;re still in JavaScript) is the ultimate goal.&#92;
&#92;
Now bring on the insults!</span> → <span class="change-field-new">1316597811802338</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Giving access to the internal "done" method (whatever you exactly mean by that) is insufficient and dangerous. A key in the design of Deferreds is to ensure no-one will bork your Deferreds to death. The fact that Deferreds methods are "detachable" (lexically bound) allows a lot of flexibility without the need to compromise the Deferred's internal state by having the Deferred's guts wide opened. Please, stop obsessing about your immediate problem and just ponder this for a mere second.</p><p>No, really, stop being mad at me/the screen/the world right now, re-read the paragraph above and do think about it.</p><p>I know it's always difficult to understand that cutting corners for every specific edge-case is NOT good design. Making so said edge-case can be solved using a reasonable amount of code without compromising everyone else's code (at least not that easily, I know we're still in <a href="/wiki/JavaScript">JavaScript</a>) is the ultimate goal.</p><p>Now bring on the insults!</p>
            </div>
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
