<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#10944 ($.ajax does not always return an object implementing the Promise interface) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/10943/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/10946/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#10944</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened December 03, 2011 12:08AM UTC</p>
      
        <p>Closed May 16, 2012 06:04PM UTC</p>
      
      
        <p>Last modified May 16, 2012 06:13PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">$.ajax does not always return an object implementing the Promise interface</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        fastfasterfastest
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        low
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.8">1.8</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>ajax</td>
      
        <th>Version:</th>
      
      <td>1.7.1</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>1.8-discuss</td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>The documentation of $.ajax states "The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...".  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.</p><p>If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.</p><p>E.g., <a href="http://jsfiddle.net/67DJr/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/67DJr/</a></p><pre class="wiki">
$.ajax( '/echo/html' , { beforeSend: function(){ return confirm('Access resource?'); } })
    .done(function() { alert("success"); })
    .fail(function() { alert("error"); })
    .always(function() { alert("complete"); });
</pre><p>The above code causes a javascript error if user clicks Cancel.</p><p>Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (20)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 05, 2011 10:25AM UTC by <span class="author">sindresorhus</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfiled</span> → <span class="change-field-new">ajax</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>priority:</th>
                  <td>
                    
                      <span class="change-field-old">undecided</span> → <span class="change-field-new">low</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">open</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 07, 2011 02:51AM UTC by <span class="author">fastfasterfastest</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Rather than returning a Promise object that has been rejected, it may make more sense to return a Promise object that is in "pending" state and that will never be resolved nor rejected.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 07, 2011 09:16AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">This is a backward compatibility issue. 1.4.x already returned false when beforeSend returned false.&#92;
&#92;
I agree returning a rejected promise would be better, especially given $.when( false ) would give a resolved promise and cannot be used to &quot;save the day&quot; in this situation.&#92;
&#92;
I&#39;ll tag this as open for discussion for 1.8.</span> → <span class="change-field-new">1323249482378178</span>
                    
                  </td>
                </tr>
              
            
              
            
              
                <tr>
                  <th>keywords:</th>
                  <td>
                    
                      <span class="change-field-new">→ 1.8-discuss</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>This is a backward compatibility issue. 1.4.x already returned false when beforeSend returned false.</p><p>I agree returning a rejected promise would be better, especially given $.when( false ) would give a resolved promise and cannot be used to "save the day" in this situation.</p><p>However, such a change would break existing code (though I dunno how many people rely on the existing behaviour -- our unit tests do at least).</p><p>I'll tag this as open for discussion for 1.8.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 07, 2011 09:36PM UTC by <span class="author">fastfasterfastest</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>One issue with returning a rejected promise is handling of errors.</p><p>Currently, the "fail functions" of an ajax promise will be called only if the ajax call errored.  If $.ajax returns a rejected promise when beforeSend returns false, then those "fail functions" would be called as well - and they would (likely) need to determine when/why they got called (e.g. to present some information to the user), was it because beforeSend returned false or was it because the $.ajax call failed.</p><p>Also, if a rejected promise is returned when beforeSend returns false, then the "fail functions" of the ajax promise will be called, but the error callback in the ajax settings will not be called.  I.e.:</p><pre class="wiki">
$.ajax( '/echo/html' , {
    beforeSend: function(){ return confirm('Access resource?'); },
    error: function() { alert("will not be called if beforeSend returns false"); }
})
.fail(function() { alert("will be called if beforeSend returns false });
</pre><p>That would be a little "inconsistent" with the current behavior where the error callback in the ajax settings and the promise's fail functions will either all be called, or none will be called, depending on whether the ajax call succeeds.</p><p>Therefore, I think it may be better to return a promise that will never be resolved nor rejected if beforeSend returns false.</p><p>(Another possible alternative would be to no longer be able to cancel the call by beforeSend returning false, i.e. beforeSend's return value would be ignored.)</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 07, 2011 11:48PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Well, how useful would a pending Promise be? Do we really want to force users to check the Promise's state in order to determine what happened?</p><p>I'm not that shocked by the inconsistency of having fail callbacks added later on called whereas ones given in the error options were not. I'd rather see this as a feature.</p><p>Ignoring the return value of beforeSend is clearly not an option here.</p><p>And btw, same goes when aborting in a prefilter.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 07, 2011 11:55PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Seems like a rejected promise would be the way to go, although I think we would want to document some way to determine it was rejected due to the beforeSend callback returning false. I agree a forever-pending state is not good.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 13, 2011 02:50PM UTC by <span class="author">jzaefferer</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span> → <span class="change-field-new">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, Could be considered a bug.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 13, 2011 04:25PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, but we will break existing code with this.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 13, 2011 06:02PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span> → <span class="change-field-new">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, to a rejected Promise. We'll need to document the change.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 13, 2011 07:09PM UTC by <span class="author">fastfasterfastest</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Assuming a rejected promise will be returned:</p><ul><li>Should $.ajax error callback be called or not?</li></ul><p>If it will be called, then that would be another backward compatibility issue since the error callback is currently not called when beforeSend returns false.</p><ul><li>With what values should the promise be rejected with?</li></ul><p>It would (probably) be useful to reject it with some value to allow the fail functions to determine if the rejection was due to beforeSend or whether the rejection was due to something that happened during the http request.  Currently an $.ajax promise is rejected with three parameters: jqXHR, textStatus, errorThrown.</p><p>Perhaps it should be rejected with a particular textStatus value when beforeSend returns false.  E.g. "beforesend" or "requestcancelled" (since a prefilter apparently might cause the call to be not-made as well).  Perhaps the currently used "abort" may cover it - I am not 100% sure under what circumstances "abort" is used today.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:11">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 14, 2011 01:36PM UTC by <span class="author">mikesherov</span></span>
        <a class="ticket-change-link" href="#comment:11">comment:11</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span> → <span class="change-field-new">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, we need to keep our promises when we say it in the docs. pun intended.</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:12">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 14, 2011 04:12PM UTC by <span class="author">timmywil</span></span>
        <a class="ticket-change-link" href="#comment:12">comment:12</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:13">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 19, 2011 05:35PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:13">comment:13</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>description:</th>
                  <td>
                    
                      <span class="change-field-old">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span> → <span class="change-field-new">The documentation of $.ajax states &quot;The jqXHR objects returned by $.ajax() as of jQuery 1.5 implement the Promise interface...&quot;.  This is not true in 1.7.1.  As a consequence one cannot (safely) use the Promise programming model on the object returned by $.ajax.&#92;
&#92;
If you use a beforeSend callback and the callback returns false, then $.ajax does not return an object that implements the Promise interface - $.ajax instead returns a boolean.&#92;
&#92;
E.g., http://jsfiddle.net/67DJr/&#92;
&#92;
&#92;
{{{&#92;
$.ajax( &#39;/echo/html&#39; , { beforeSend: function(){ return confirm(&#39;Access resource?&#39;); } })&#92;
    .done(function() { alert(&quot;success&quot;); })&#92;
    .fail(function() { alert(&quot;error&quot;); })&#92;
    .always(function() { alert(&quot;complete&quot;); });&#92;
}}}&#92;
&#92;
&#92;
The above code causes a javascript error if user clicks Cancel.&#92;
&#92;
Per documentation, $.ajax should always return an object that implements the Promise interface.  In the case of beforeSend returning false, and thus cancelling or preventing the call from being made, it seems to make sense for $.ajax to return a Promise object that has been rejected.</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1</p>
            </div>
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:14">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 26, 2011 02:07PM UTC by <span class="author">doom777</span></span>
        <a class="ticket-change-link" href="#comment:14">comment:14</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>+1, caused me an hour of headache + need to put special </p><pre class="wiki">
var ret = jQuery.get(url);
if(ret === false)
 handleErr();
else
 ret.success(handleSuccess).error(handleErr)
</pre><p>everwhere in the code until you fix it</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:15">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 23, 2012 11:03AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:15">comment:15</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/ticket/9203">#9203</a> is a duplicate of this ticket.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:16">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 25, 2012 08:02AM UTC by <span class="author">anonymous</span></span>
        <a class="ticket-change-link" href="#comment:16">comment:16</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>When is this going to get fixed already? Deferred objects have a clear success/fail architecture, and those who use methods that return deferred objects, rely on that. If beforeSend returns false, then the request ''fail''ed and should ''deferred.reject'' Classic case, I can't comprehend why someone would want .ajax() to return false sometimes.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:17">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 25, 2012 02:12PM UTC by <span class="author">rwaldron</span></span>
        <a class="ticket-change-link" href="#comment:17">comment:17</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I think there is some concern that remains unresolved:</p><blockquote> jaubourg +1, but we will break existing code with this.</blockquote>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:18">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 25, 2012 02:21PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:18">comment:18</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Well, it is in 1.8pre.&#92;
&#92;
Current implementation doesn&#39;t fire success, error and complete handlers (to be backward compatible). However newly added handlers using done/fail/complete methods will be called subsequently. Status of the error in &quot;cancelled&quot;.</span> → <span class="change-field-new">1335363742617755</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Well, it is in 1.8pre.</p><p>Current implementation doesn't fire success, error and complete handlers (to be backward compatible). However newly added handlers using done/fail/complete methods will be called subsequently. Status of the error is "cancelled".</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:19">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 16, 2012 06:04PM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:19">comment:19</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">open</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>$.ajax now always returns an object implementing the Promise interface. Fixes <a href="/ticket/10944">#10944</a>. Unit tests amended.</p><p>For back-compat, in case of an early abort, callbacks passed in the options are not called (while subsequent callbacks attached to the returned Promise are).</p><p>For early abort triggered by returning false in beforeSend, statusText is "canceled". </p><p> Changeset: 395612bb152660226b93f7f096cd0146fc06991e</p>
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:20">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed May 16, 2012 06:13PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:20">comment:20</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">None</span> → <span class="change-field-new">1.8</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
