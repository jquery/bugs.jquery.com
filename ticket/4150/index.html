<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#4150 (jQuery(str) has Performance/Crash issues with space right padded strings.) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/4149/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/4151/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#4150</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">bug</span>
      <span class="ticket-resolution">(fixed)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened February 14, 2009 04:55AM UTC</p>
      
        <p>Closed December 20, 2009 05:45AM UTC</p>
      
      
        <p>Last modified March 14, 2012 03:03PM UTC</p>
      
    </div>
  </div>

  <h1 class="ticket-title">jQuery(str) has Performance/Crash issues with space right padded strings.</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        JosephPecoraro
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        major
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/1.4">1.4</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>core</td>
      
        <th>Version:</th>
      
      <td>1.4a2</td>
    </tr>
    <tr>
      
        <th>Keywords:</th>
      
      <td>right pad spaces</td>
      
        <th>Cc:</th>
      
      <td>joepeck02@gmail.com</td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>General:</p><p></p><hr><p></p><p>Passing a string into jQuery() containing html/xml that is right padded with spaces causes errors in Safari/Webkit and severe performance impacts on all other browsers I could test.  As the number of spaces increases, the parse time grows exponentially, 2s 4s, 8s, 16s, etc.  The string input must contain a &lt;tag&gt;.  All browsers appear fine with left-padded text but fail with right-padded text.</p><p>Unknown and untested to see if this was a problem in past version of jQuery.  I spent the time to write this report because I was really irked that Firefox kept crashing on me.  I eventually figured it out and saw the problems all over.</p><p>Browsers Tested:</p><p></p><hr><p></p><p>OS X Safari / Webkit:</p>  <ul><li>Throws "Syntax error, unrecognized expression: &gt;" warning and stops script execution.</li></ul><p>OS X Firefox 3:</p>  <ul><li>Poor performance on right pad.</li>  <li>Hangs before displaying the page.  May take 30s to display.</li></ul><p>OS X Opera 9:</p>  <ul><li>Poor performance on right pad.</li>  <li>Successfully loads the page then runs the scripts.</li></ul><p>XP Firefox 2:</p>  <ul><li>Poor performance on right pad</li>  <li>Hangs before displaying the page.  May get a "long script" warning.</li></ul><p>XP IE 6:</p>  <ul><li>Poor performance on right pad.  Although better then Firefox!</li></ul><p>Suggestions:</p><p></p><hr><p></p><p>I don't know what to say here.  I don't know enough about how jQuery works and the underling browser iefficiencies.  I imagine this could be turned around into browser bug reports if that is the case.  jQuery could force the developer to trim() text, but then again maybe the jQuery(str) function itself should trim its input.  Would that have any serious impact on performance?  How about just right-trimming?  I'm out of my league here, so I'm passing it on to you.</p><p>Attached:</p><p></p><hr><p></p>  <ul><li>Unit Test to show the problem</li>  <li>Version of jQuery emitting the problem</li>  <li>Pictures of my results on current browsers (listed above)</li></ul><p>Please keep me updated.  Thanks!</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (7)</summary>

  <ul class="ticket-attachments">
    
      <li>
        <a href="/attachment/ticket/4150/RightPadUnitTest.zip/index.html">RightPadUnitTest.zip</a> (23.0 KB) - added by JosephPecoraro
        <strong>February 14, 2009 04:57AM UTC</strong>.<br>
        <p>Unit Test</p>
      </li>
    
      <li>
        <a href="/attachment/ticket/4150/RightPadUnitTest2.zip/index.html">RightPadUnitTest2.zip</a> (72.1 KB) - added by JosephPecoraro
        <strong>February 14, 2009 08:02PM UTC</strong>.<br>
        <p>Newer tests to test newlines and desired output.</p>
      </li>
    
      <li>
        <a href="/attachment/ticket/4150/osx_firefox_3_0_6_results.png/index.html">osx_firefox_3_0_6_results.png</a> (131.2 KB) - added by JosephPecoraro
        <strong>February 14, 2009 04:58AM UTC</strong>.<br>
        
      </li>
    
      <li>
        <a href="/attachment/ticket/4150/osx_opera_9_63_results.png/index.html">osx_opera_9_63_results.png</a> (27.9 KB) - added by JosephPecoraro
        <strong>February 14, 2009 04:59AM UTC</strong>.<br>
        
      </li>
    
      <li>
        <a href="/attachment/ticket/4150/osx_webkit_nightly_results.png/index.html">osx_webkit_nightly_results.png</a> (64.0 KB) - added by JosephPecoraro
        <strong>February 14, 2009 04:58AM UTC</strong>.<br>
        
      </li>
    
      <li>
        <a href="/attachment/ticket/4150/xp_firefox_2_0_0_12_results.png/index.html">xp_firefox_2_0_0_12_results.png</a> (240.2 KB) - added by JosephPecoraro
        <strong>February 14, 2009 04:59AM UTC</strong>.<br>
        
      </li>
    
      <li>
        <a href="/attachment/ticket/4150/xp_ie_6_results.png/index.html">xp_ie_6_results.png</a> (50.3 KB) - added by JosephPecoraro
        <strong>February 14, 2009 04:59AM UTC</strong>.<br>
        
      </li>
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (10)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 14, 2009 05:03AM UTC by <span class="author">JosephPecoraro</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I have been a fan of jQuery for a while, but there has been some serious criticism lately that has peeked my interest.  I spent a lot of time submitting this report, including wrestling with this trac system by writing and rewriting my bug report multiple times... then needing to uploading multiple files because of asinine limits...</p><p>I would appreciate it if this bug was handled in a way that can restore some of my confidence in the jQuery team and community.  I hope this helps or gets moved in the right direction.  Thank You.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 14, 2009 05:05AM UTC by <span class="author">JosephPecoraro</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The Component is "core."  It appears as though that got lost when I had to rewrite the report.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 14, 2009 02:44PM UTC by <span class="author">Rwhitbeck</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p><a href="/wiki/JosephPecoraro">JosephPecoraro</a>, thanks for your effort in submitting this bug, it is very thorough. Well take a look at it and hopefully restore your confidence in jQuery again.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 14, 2009 07:02PM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>If every bug report had a thorough test case like this one does, they would be a lot easier to find and fix! Firebug said it was spending most of its time in jQuery.init. A little investigation from there showed it was this line:</p><pre class="wiki">
   var match = quickExpr.exec( selector );
</pre><p>This is quickExpr:</p><pre class="wiki">
quickExpr = /^[^&lt;]*(&lt;(.|\\s)+&gt;)[^&gt;]*$|^#([\\w-]+)$/,
</pre><p>Something about the regexp is probably causing the JS matcher to backtrack a LOT. The problem with the regexp isn't obvious to me, but at least we have it narrowed down to one line.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 14, 2009 08:02PM UTC by <span class="author">JosephPecoraro</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Very cool guys.  I checked it out and here are my thoughts:</p><p>Change the quickExpr regex to the following and see how the rest of jQuery's tests run:</p><p> </p><pre class="wiki">
  quickExpr = /^[^&lt;]*(&lt;(.|\\n)+&gt;)[^&gt;]*$|^#([\\w-]+)$/,
 </pre><p></p><p>I changed the white-space matching portion on the optimized tag search portion.</p><p> </p><pre class="wiki">
  (.|\\s) =&gt; (.|\\n)
 </pre><p></p><p>This resource says that "." matches every character except a new line:</p><p><a href="http://www.evolt.org/article/Regular_Expressions_in_JavaScript/17/36435/" class="ext-link"><span class="icon"></span>http://www.evolt.org/article/Regular_Expressions_in_JavaScript/17/36435/</a></p><p>I don't know wether or not that is true across "all browsers". So clearly this change should be tested to see if it works everywhere... but check out the results:</p><p>1. Perfect Results and Excellent performance in Firefox (3 and 2), Opera 9, IE6</p><p>2. It corrects Webkit's random error... Although Safari 3.2 still throws the error...</p><p>Thats all positive!</p><p>I've uploaded a new version 2 of the <a href="/wiki/UnitTest">UnitTest</a> to test spaces and newlines and desired output.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 14, 2009 08:59PM UTC by <span class="author">JosephPecoraro</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Hmm, I'm not typically a Window's user (I just open VMWare to test IE6), but a thought occurred to me that "(.|\\n)" wouldn't match "\\r".  I tested this in <a href="/wiki/WebKit">WebKit</a> and Firefox and both returned null.</p><pre class="wiki">
js&gt; /(.|\\n)/.exec("\\r")       
null
</pre><p>So, if this is a viable change then it might be necessary to make the regex:</p><pre class="wiki">
(.|[\\n\\r]) or (.|\\n|\\r)
</pre><p>Aside:</p><p>Further tests showed that \\r inside the content will throw errors in Webkit if the regex doesn't explicitly match \\r.  Note, this is specific to being "in the html content" because when you run it from the Developer Console it will work fine.  It only throws the error if it was in the actual content that Webkit/Safari loaded.  That just keeps getting more and more confusing!  If I find enough time I'll submit a bug report to the Webkit team on that.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed February 26, 2009 05:47PM UTC by <span class="author">JosephPecoraro</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Any news?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 07, 2009 05:16AM UTC by <span class="author">JosephPecoraro</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Take 2. Any news?</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed August 09, 2009 01:14AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>component:</th>
                  <td>
                    
                      <span class="change-field-old">unfilled</span> → <span class="change-field-new">core</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>milestone:</th>
                  <td>
                    
                      <span class="change-field-old">1.3.2</span> → <span class="change-field-new">1.3.3</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.3.1</span> → <span class="change-field-new">1.3.2</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>This ticket got lost because it was lacking a component. Ressurecting for 1.3.3.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:10">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed December 20, 2009 05:45AM UTC by <span class="author">john</span></span>
        <a class="ticket-change-link" href="#comment:10">comment:10</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ fixed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>version:</th>
                  <td>
                    
                      <span class="change-field-old">1.3.2</span> → <span class="change-field-new">1.4a2</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I just re-tested the attached test case and it's no longer a problem. We've since changed the quickExpr so I bet that helped. We now do [\\w\\W]+.</p><p>Going to mark this as resolved.</p>
            </div>
          
        
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
