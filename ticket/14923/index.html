<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-pagefind-meta="title">#14923 (Expose responses to .ajax statusCode handlers) - jQuery - Bug Tracker</title>
    <meta name="description" content="Static archive of the old bugs.jquery.com Trac site.">
    
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="/bundle/SEeiGkT-TJ.css">
  </head>
  <body>
    <div class="banner flex-center">
      <span>jQuery issues have moved to <a href="https://github.com/jquery/jquery/issues">GitHub</a>. This site is now a static archive of the old <a href="https://trac.edgewall.org/">Trac</a> bugs site. Some functions and pages are no longer available.</span>
    </div>
    <div class="container">
      <a href="#skip" class="visually-hidden">Skip to main content</a>
      <header class="flex-column">
        <div class="flex-row flex-between-start">
          <a id="jq-siteLogo" href="/" title="jQuery Home">
            <img src="/img/logo.svg" width="215" alt="jQuery: Write Less, Do More.">
          </a>
          <input class="hamburger-toggle visually-hidden" id="jq-menutoggle" type="checkbox">
          <label aria-label="Toggle Menu" for="jq-menutoggle" class="hamburger-lines flex-column flex-between-center">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </label>
          <div id="jq-menus">
            <nav id="jq-primaryNavigation">
              <h2 class="visually-hidden">jQuery sites navigation menu</h2>
              <ul class="nav">
                <li class="jq-jquery active">
                  <a href="https://jquery.com/" title="jQuery Home">jQuery</a>
                </li>
                <li class="jq-plugins">
                  <a href="https://plugins.jquery.com/" title="jQuery Plugins">Plugins</a>
                </li>
                <li class="jq-ui">
                  <a href="https://jqueryui.com/" title="jQuery UI">UI</a>
                </li>
                <li class="jq-meetup">
                  <a href="https://meetups.jquery.com/" title="jQuery Meetups">Meetups</a>
                </li>
                <li class="jq-forum">
                  <a href="https://forum.jquery.com/" title="jQuery Forum">Forum</a>
                </li>
                <li class="jq-blog">
                  <a href="https://blog.jquery.com/" title="jQuery Blog">Blog</a>
                </li>
                <li class="jq-about">
                  <a href="https://openjsf.org" title="About jQuery and OpenJS">About</a>
                </li>
                <li class="jq-donate">
                  <a href="https://openjsf.org/about/project-funding-opportunities/" title="Donate to OpenJS">Donate</a>
                </li>
              </ul>
            </nav>
            <nav id="jq-secondaryNavigation">
              <h2 class="visually-hidden">jQuery Core navigation menu</h2>
              <ul class="nav">
                <li class="jq-download">
                  <a href="https://jquery.com/download/">
                    Download
                  </a>
                </li>
                <li class="jq-documentation">
                  <a href="https://api.jquery.com/">
                    Documentation
                  </a>
                </li>
                <li class="jq-tutorials">
                  <a href="https://learn.jquery.com/">
                    Tutorials
                  </a>
                </li>
                <li class="jq-bugTracker">
                  <a href="https://github.com/jquery/jquery/issues">
                    Bug Tracker
                  </a>
                </li>
                <li class="jq-discussion">
                  <a href="https://forum.jquery.com/">
                    Discussion
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div id="bug-tracker-form" class="flex-column flex-between-center">
          <h1>Bug Tracker</h1>
          <div id="search"></div>
          
        </div>
      </header>
      <main id="skip" class="flex-column">
        <h2 class="visually-hidden">Side navigation</h2>
        <nav id="jq-sidenav" class="flex-column white-box">
          <h5 class="sidenav-header">Bug Tracker</h5>
          <a href="/newticket">New Ticket</a>
          <a href="/report">View Tickets</a>
          <a href="/ticketgraph">Ticket Graph</a>
          <a href="/roadmap">Roadmap</a>
          <a href="/timeline">Recent Changes</a>
        </nav>
        <div id="jq-content" class="white-box">
          

<div class="flex-column" data-pagefind-body="">
  

  <nav class="content-nav">
    <ul class="flex-row">
      
        <li>
          <a href="/ticket/14922/">← Previous Ticket</a>
        
      
      
        </li><li>
          <a href="/ticket/14925/">Next Ticket →</a>
        </li>
      
    </ul>
  </nav>


<div class="ticket-info">
  <div class="flex-row flex-between-start">
    <h3>
      <a href="" class="ticket-number">#14923</a>
      <span class="ticket-status">closed</span>
      <span class="ticket-type">feature</span>
      <span class="ticket-resolution">(notabug)</span>
    </h3>

    <div class="ticket-dates">
      <p>Opened March 26, 2014 09:22PM UTC</p>
      
        <p>Closed April 14, 2014 03:29AM UTC</p>
      
      
    </div>
  </div>

  <h1 class="ticket-title">Expose responses to .ajax statusCode handlers</h1>

  <table class="ticket-properties">
    <tr>
      <th>Reported by:</th>
      <td>
        Marc_Brooks
      </td>
      <th>Owned by:</th>
      <td></td>
    </tr>
    <tr>
      <th>
        Priority:
      </th>
      <td>
        undecided
      </td>
      
        <th class="missing">Milestone:</th>
      
      <td>
        <a href="/milestone/None">None</a>
      </td>
    </tr>
    <tr>
      <th>Component:</th>
      <td>unfiled</td>
      
        <th>Version:</th>
      
      <td>2.1.0</td>
    </tr>
    <tr>
      
        <th class="missing">Keywords:</th>
      
      <td></td>
      
        <th class="missing">Cc:</th>
      
      <td></td>
    </tr>
    <tr>
      <th class="missing">
        Blocked by:
      </th>
      <td></td>
      <th class="missing">
        Blocking:
      </th>
      <td></td>
    </tr>
  </table>
  <div class="ticket-info-bottom">
    <h5 class="ticket-description-title">Description</h5>
    <div class="ticket-description"><p>Since a lot of APIs have useful information in the response text (''sometimes plain-text, sometimes HTML, sometimes JSON, etc''), it would be helpful to allow error handlers to see the responses that jQuery went to all the trouble of parsing.</p><p>Let's just add the already-parsed response object to:</p><p>1. The list of arguments in the <strong>deferred.resolveWith</strong> or <strong>deferred.rejectWith</strong> calls. This would modify the call signature of those methods adding a signal argument but that should not break any existing implementations.</p><p>2. Set a response property on the <strong>jqHR</strong>. I'm concerned with this having leak/lifetime implications, but the advantage would be to also have that information available on the <strong>jqHR.statusCode</strong> handlers.</p><p>3. Only pass the response object to the <strong>jqHR.statusCode</strong> handlers. This would change their call signature from void to a single argument, but since there are very users of this method, and they should only be expecting this pointing at the underlying <strong>jqHR</strong>, we should be safe. Sadly this would be pretty difficult to hook up properly without doing option 2.</p></div>
  </div>
</div>

<details>
  <summary class="ticket-details-summary">Attachments (0)</summary>

  <ul class="ticket-attachments">
    
  </ul>
</details>

<details open="">
  <summary class="ticket-details-summary">Change History (9)</summary>
  
    <div class="ticket-change flex-column" id="comment:1">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 26, 2014 10:12PM UTC by <span class="author">Marc_Brooks</span></span>
        <a class="ticket-change-link" href="#comment:1">comment:1</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Not sure where I can get a fiddle that makes a 4xx error that includes a response, but here's a starting fiddle <a href="http://jsfiddle.net/IDisposable/2LxPW/1/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/IDisposable/2LxPW/1/</a></p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:2">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 26, 2014 10:24PM UTC by <span class="author">Marc_Brooks</span></span>
        <a class="ticket-change-link" href="#comment:2">comment:2</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
                <tr>
                  <th>_comment0:</th>
                  <td>
                    
                      <span class="change-field-old">Added a pull request implementing option #1 https://github.com/jquery/jquery/pull/1552&#92;
&#92;
Kind of shows that it would be nicer to do option #2, but then the response object isn&#39;t known to to the success case since we don&#39;t pass the jqXHR object to that resolve.</span> → <span class="change-field-new">1395872759859426</span>
                    
                  </td>
                </tr>
              
            
              
            
          </tbody>
        </table>
        
          
        
          
            <div class="ticket-comment-body">
              <p>Added a pull request implementing option 1 <a href="https://github.com/jquery/jquery/pull/1552" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/pull/1552</a></p><p>Kind of shows that it would be nicer to do option 2, but then the response object isn't known to to the success case since we don't pass the jqXHR object to that resolve.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:3">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 27, 2014 12:02AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:3">comment:3</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>The jqXHR object already has response fields (<code>response</code>, <code>responseXML</code> and <code>responseJSON</code>) that are available in both resolved and rejected states. So I'm not sure what you're asking for here.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:4">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 27, 2014 01:21AM UTC by <span class="author">Marc_Brooks</span></span>
        <a class="ticket-change-link" href="#comment:4">comment:4</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>I don't see that in <a href="http://jsfiddle.net/IDisposable/2LxPW/4/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/IDisposable/2LxPW/4/</a> (hitting a twitter endpoint that has a text response to a 401)</p><p>The console.log(jqXHR) gives</p><pre class="wiki">
Object {readyState: 0, getResponseHeader: function, getAllResponseHeaders: function, setRequestHeader: function, overrideMimeType: function…}
abort: function ( statusText ) {
always: function () {
complete: function () {
done: function () {
error: function () {
fail: function () {
getAllResponseHeaders: function () {
getResponseHeader: function ( key ) {
overrideMimeType: function ( type ) {
pipe: function ( /* fnDone, fnFail, fnProgress */ ) {
progress: function () {
promise: function ( obj ) {
readyState: 0
setRequestHeader: function ( name, value ) {
state: function () {
status: 0
statusCode: function ( map ) {
statusText: "error"
success: function () {
then: function ( /* fnDone, fnFail, fnProgress */ ) {
__proto__: Object
</pre><p>What I'm trying to accomplish is when there is an error state, having access to the actual response (hopefully fully parsed for JSON or XML) since we have that already done in the done method of $.ajax.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:5">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 27, 2014 04:05AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:5">comment:5</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>That seems very fishy to me. <code>responseXXX</code> fields are set in <code>ajaxConvert</code> ( <a href="https://github.com/jquery/jquery/blob/master/src/ajax.js#L216" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/blob/master/src/ajax.js#L216</a> ) which is called for both success and errors ( <a href="https://github.com/jquery/jquery/blob/master/src/ajax.js#L691" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/blob/master/src/ajax.js#L691</a> ). It uses the global option set in ajaxSettings ( <a href="https://github.com/jquery/jquery/blob/master/src/ajax.js#L332" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/blob/master/src/ajax.js#L332</a> ) which references text, XML and JSON dataTypes.</p><p>Unless you're using an older version of jQuery or response headers are not set up properly, those fields will be set.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:6">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 27, 2014 04:11AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:6">comment:6</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Also, we're supposedly dealing with a 401 but look at the status on the jqXHR instance:</p><blockquote> status: 0</blockquote><p>Seems to me there's something wrong with the test case.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:7">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 27, 2014 05:40AM UTC by <span class="author">Marc_Brooks</span></span>
        <a class="ticket-change-link" href="#comment:7">comment:7</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>Ah, but the s (created at <a href="https://github.com/jquery/jquery/blob/master/src/ajax.js#L691" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/blob/master/src/ajax.js#L691</a> ) is NOT the jqXHR (created at <a href="https://github.com/jquery/jquery/blob/master/src/ajax.js#L428" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/blob/master/src/ajax.js#L428</a> ) of line 216 is NOT the jqXHR of line 741 et al. They are different objects entirely. The result of ajaxConvert from <a href="https://github.com/jquery/jquery/blob/master/src/ajax.js#L691" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/blob/master/src/ajax.js#L691</a> is assigned to a local that I just want passed to the deferred resolves of various ilk so I can reach up and get the raw text or JSON or XML as parsed.</p><p>You can see from the jsFiddle that it was running against 2.1, but here's a new and improved one against 2.x <a href="http://jsfiddle.net/IDisposable/2LxPW/5/" class="ext-link"><span class="icon"></span>http://jsfiddle.net/IDisposable/2LxPW/5/</a> which still shows that the jqXHR does NOT have the responses handy.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:8">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed March 27, 2014 06:20AM UTC by <span class="author">jaubourg</span></span>
        <a class="ticket-change-link" href="#comment:8">comment:8</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              <p>You have no response because the actual request was not issued. It's a CORS issue you have here, hence why the <code>status</code> is <code>0</code>. That's pretty obvious when you open your favorite development tool:</p><pre class="wiki">
XMLHttpRequest cannot load https://api.twitter.com/oauth/access_token. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://fiddle.jshell.net' is therefore not allowed access. 
</pre><p>Have you tried with a same-domain setup? Because we do have unit tests regarding those <code>responseXXX</code> fields: <a href="https://github.com/jquery/jquery/blob/master/test/unit/ajax.js#L1391" class="ext-link"><span class="icon"></span>https://github.com/jquery/jquery/blob/master/test/unit/ajax.js#L1391</a></p><p>Also, <code>jqXHR</code> actually is the same object throughout the whole ajax request. Objects are passed by reference in <a href="/wiki/JavaScript">JavaScript</a>.</p>
            </div>
          
        
      </div>
    </div>
  
    <div class="ticket-change flex-column" id="comment:9">
      <h3 class="flex-row flex-between-start ticket-change-header">
        <span>Changed April 14, 2014 03:29AM UTC by <span class="author">dmethvin</span></span>
        <a class="ticket-change-link" href="#comment:9">comment:9</a>
      </h3>

      <div class="ticket-change-content">
        <table class="ticket-changes">
          <tbody>
            
              
            
              
                <tr>
                  <th>resolution:</th>
                  <td>
                    
                      <span class="change-field-new">→ notabug</span>
                    
                  </td>
                </tr>
              
            
              
                <tr>
                  <th>status:</th>
                  <td>
                    
                      <span class="change-field-old">new</span> → <span class="change-field-new">closed</span>
                    
                  </td>
                </tr>
              
            
          </tbody>
        </table>
        
          
            <div class="ticket-comment-body">
              
            </div>
          
        
          
        
          
        
      </div>
    </div>
  
</details>
</div>
        </div>
      </main>
      <footer>
        Copyright &copy; 2024
        <a href="https://openjsf.org">The OpenJS Foundation</a>
      </footer>
    </div>
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
  </body>
</html>
